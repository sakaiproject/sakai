# travis-ci currently has Maven 3.2 which doesn't read our .mvn folder
# and https://github.com/travis-ci/travis-ci/issues/4613 means we can't set MAVEN_OPTS directly
before_install:
  # To get some build progress you could have -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.event.ExecutionEventLogger=info
  # but this results in more than 10,000 lines of build output
  - echo "MAVEN_OPTS='-Xms168m -Xmx1536m -XX:NewSize=64m -Djava.awt.headless=true -Dorg.slf4j.simpleLogger.defaultLogLevel=warn'" > ~/.mavenrc
  # https://github.com/travis-ci/travis-ci/issues/4629
  # This stops lots of warning about the broken nexus.codehaus.org repository
  - rm ~/.m2/settings.xml
  
language: java
jdk:
  - openjdk8
sudo: false

cache:
 directories:
 - $HOME/.m2

# We don't want to cache our own artifacts, just the externally downloaded ones.
# This makes the cache smaller and helps highlight problems with a clean build
before_cache:
 - find $HOME/.m2/repository/org/sakaiproject -name \*-SNAPSHOT.\*  -delete

# connect SonarCloud
addons:
  sonarcloud:
    organization: "sakai-sandbox"
    token:
      secure: "x59elKsea0HAOMrRnxSkP3hAVG+d5eZaxjm/s9Q9tKXxZMeUo+bsxuxmbt+yGeyyj8sMeN3Wce1i0lNbnGlyBFZF7gSefimHvOM72pCv9oqBwm+MAyGqd+bBMX+ctWq9jAkz7uxRVbRnt0tHqow/ZJa4C4UXoRnNOV1SFq1sG0vJV5aSX6CAsYn42rGt0PxPT71FFl+T7XTlFcQClPJ/z92OwcykKtVq1RYL9c/jjTXoj43/KXCRhMUZixHnuko1/NBBUWlrDJjkW09QE0GnDEeHbq0gnt2A0Mvu5Qb6GNeX4XkovV2mqbpR8s84XjdFgdg3iUtDDfL12M6wuGaTDOH1x/PEx3m/Oz47FQ2o7bADGnJ4cTPzJPmqvwm6Y+iSACXNhr1lh8EKt5+F2iJ5wROuNlONOfTOrJrYKWPqiczPE0DMsAiZUagG+WfMNgXOlNJc0NklsTGN9OI5w/LKcn25UoMd+MwpWvCWtfm169i8SliI+tbYcB7JerV56XU76xn9fGWBqovOx/RIvENGgTQ5A1LkonfCvE50R/r8BshYZouBCFn6/t1SImgae7Xnpx9vsYh7wdLXJSL7B/+iAa8+MWoKFmz4+SGlqmTLVpxXhZi3lVJR2vzMrQZmXXsK1IPp4ox8zDLgjIzImJlW7bHqsuT5uTq0wLUynxiG6mc="
script:
  # this is what we want Travis to do
  - mvn clean install org.jacoco:jacoco-maven-plugin:prepare-agent sonar:sonar -Dsonar.host.url=https://sonarcloud.io
