<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <f:view>
        <h:head>
            <ui:fragment rendered="#{not empty requestScope['html.head']}">
                <h:outputText value="#{requestScope['html.head']}" escape="false" />
            </ui:fragment>
            <title>
                <h:outputText value="#{delivery.assessmentTitle}" />
            </title>
            <ui:include src="/jsf/delivery/deliveryjQuery.xhtml" />
        </h:head>
        <h:body onload="#{empty requestScope['html.body.onload'] ? '' : requestScope['html.body.onload']}">
            <h:outputText value="&lt;a name='top'&gt;&lt;/a&gt;" escape="false" />

            <div class="portletBody">
                <div style="#{delivery.settings.divBgcolor};#{delivery.settings.divBackground}">
                    <h:form id="takeAssessmentForm" enctype="multipart/form-data" onsubmit="saveTime()">

                        <h:panelGroup rendered="#{delivery.actionString == 'previewAssessment'}">
                            <div class="sak-banner-info">
                                <h:outputText value="#{deliveryMessages.ass_preview}" escape="false" />
                                <h:commandButton value="#{deliveryMessages.exit_preview}"
                                    styleClass="exitPreviewButton"
                                    action="#{person.cleanResourceIdListInPreview}"
                                    type="submit"
                                    onclick="return returnToHostUrl(&#39;#{delivery.selectURL}&#39;);" />
                            </div>
                        </h:panelGroup>

                        <h:inputHidden id="partIndex" value="#{delivery.partIndex}" />
                        <h:inputHidden id="questionIndex" value="#{delivery.questionIndex}" />
                        <h:inputHidden id="formatByPart" value="#{delivery.settings.formatByPart}" />
                        <h:inputHidden id="formatByAssessment" value="#{delivery.settings.formatByAssessment}" />
                        <h:inputHidden id="lastSubmittedDate1" value="#{delivery.assessmentGrading.submittedDate.time}"
                            rendered="#{delivery.assessmentGrading.submittedDate != null}" />
                        <h:inputHidden id="lastSubmittedDate2" value="0"
                            rendered="#{delivery.assessmentGrading.submittedDate == null}" />
                        <h:inputHidden id="hasTimeLimit" value="#{delivery.hasTimeLimit}" />
                        <h:inputHidden id="showTimeWarning" value="#{delivery.showTimeWarning}" />

                        <h3 style="insColor insBak">
                            <h:outputText value="#{deliveryMessages.submission_warning}" escape="false" />
                        </h3>

                        <f:subview id="assessmentDeliveryHeading">
                            <ui:include src="/jsf/delivery/assessmentDeliveryTimer.xhtml" />
                        </f:subview>

                        <h:inputHidden id="assessmentID" value="#{delivery.assessmentId}" />
                        <h:inputHidden id="assessTitle" value="#{delivery.assessmentTitle}" />

                        <h:panelGroup styleClass="sak-banner-warn">
                            <h:outputText value="#{deliveryMessages.submit_warning_1} " escape="false" />
                            <h:outputText value="#{deliveryMessages.submit_warning_2} " escape="false" />
                            <h:outputText value="#{deliveryMessages.submit_warning_3_non_linear} "
                                rendered="#{delivery.navigation ne '1'}" escape="false" />
                            <h:outputText value="#{deliveryMessages.submit_warning_3_linear} "
                                rendered="#{delivery.navigation eq '1'}" escape="false" />
                        </h:panelGroup>

                        <h:panelGroup layout="block">
                            <h:panelGroup layout="block" styleClass="row">
                                <h:panelGroup layout="block" styleClass="col-sm-2">
                                    <h:outputLabel value="#{deliveryMessages.course_name}" />
                                </h:panelGroup>
                                <h:panelGroup layout="block" styleClass="col-sm-10">
                                    <h:outputText value="#{delivery.courseName}" />
                                </h:panelGroup>
                            </h:panelGroup>
                            <h:panelGroup layout="block" styleClass="row">
                                <h:panelGroup layout="block" styleClass="col-sm-2">
                                    <h:outputLabel value="#{deliveryMessages.creator}" />
                                </h:panelGroup>
                                <h:panelGroup layout="block" styleClass="col-sm-10">
                                    <h:outputText value="#{delivery.creatorName}" />
                                </h:panelGroup>
                            </h:panelGroup>
                            <h:panelGroup layout="block" styleClass="row">
                                <h:panelGroup layout="block" styleClass="col-sm-2">
                                    <h:outputLabel value="#{deliveryMessages.assessment_title}" />
                                </h:panelGroup>
                                <h:panelGroup layout="block" styleClass="col-sm-10">
                                    <h:outputText value="#{delivery.assessmentTitle}" escape="false" />
                                </h:panelGroup>
                            </h:panelGroup>
                        </h:panelGroup>

                        <p class="act">
                            <h:commandButton id="submitForGrade" type="submit" value="#{deliveryMessages.button_submit_grading}"
                                action="#{delivery.submitForGrade}" styleClass="active"
                                rendered="#{(delivery.actionString == 'takeAssessment' or delivery.actionString == 'previewAssessment')
                                    and delivery.navigation ne '1' and !delivery.doContinue}"
                                disabled="#{delivery.actionString == 'previewAssessment'}" />

                            <h:commandButton type="submit" value="#{deliveryMessages.button_submit_grading}"
                                action="#{delivery.submitForGrade}" id="submitForm" styleClass="active"
                                rendered="#{(delivery.actionString == 'takeAssessment' or delivery.actionString == 'previewAssessment')
                                    and delivery.navigation eq '1' and !delivery.doContinue}"
                                disabled="#{delivery.actionString == 'previewAssessment'}"
                                onclick="pauseTiming='false'" onkeypress="pauseTiming='false'" />

                            <h:commandButton type="submit" value="#{deliveryMessages.button_submit_grading}"
                                action="#{delivery.submitForGrade}" id="submitForm1" styleClass="active"
                                rendered="#{delivery.actionString == 'takeAssessmentViaUrl'}"
                                onclick="pauseTiming='false'" onkeypress="pauseTiming='false'" />

                            <h:commandButton id="previous" type="submit" value="#{deliveryMessages.previous}"
                                action="#{delivery.confirmSubmitPrevious}"
                                rendered="#{(delivery.actionString == 'previewAssessment'
                                    or delivery.actionString == 'takeAssessment'
                                    or delivery.actionString == 'takeAssessmentViaUrl')
                                    and delivery.navigation ne '1'}" />

                            <h:commandButton id="save" type="submit" value="#{commonMessages.action_save}"
                                action="#{delivery.saveWork}"
                                style="display:none"
                                rendered="#{delivery.actionString == 'previewAssessment'
                                    or delivery.actionString == 'takeAssessment'
                                    or delivery.actionString == 'takeAssessmentViaUrl'}" />

                            <h:commandButton type="submit" value="#{commonMessages.cancel_action}"
                                action="select" id="cancel"
                                rendered="#{(delivery.actionString == 'previewAssessment'
                                    or delivery.actionString == 'takeAssessment'
                                    or delivery.actionString == 'takeAssessmentViaUrl')
                                    and delivery.navigation eq '1'}"
                                onclick="pauseTiming='false'" onkeypress="pauseTiming='false'" />
                        </p>
                    </h:form>
                </div>
            </div>

            <ui:include src="/jsf/delivery/deliveryScript.xhtml" />

            <h:outputScript target="body">
                //<![CDATA[
                function saveTime() {
                  if ((typeof (document.forms[0].elements['takeAssessmentForm:assessmentDeliveryHeading:elapsed']) != undefined) &&
                      ((document.forms[0].elements['takeAssessmentForm:assessmentDeliveryHeading:elapsed']) != null)) {
                    pauseTiming = 'false';
                    document.forms[0].elements['takeAssessmentForm:assessmentDeliveryHeading:elapsed'].value = #{delivery.timeElapse};
                  }
                }
                //]]>
            </h:outputScript>
        </h:body>
    </f:view>

</ui:composition>
