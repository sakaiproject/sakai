<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:samigo="http://www.sakaiproject.org/samigo">

    <f:view>
        <f:event type="preRenderView" listener="#{portalHeaderConfigurator.configure}" />
        <h:head>
            <ui:fragment rendered="#{not empty requestScope['html.head']}">
                <h:outputText value="#{requestScope['html.head']}" escape="false" />
            </ui:fragment>
            <title>
                <h:outputText value="#{authorMessages.create_modify_a}" />
            </title>
            <script type="text/javascript" src="/samigo-app/js/authoring.js"></script>
            <script type="text/javascript" src="/samigo-app/js/authoringQuestionCancellation.js"></script>
            <script type="text/javascript" src="/library/webjars/jquery/1.12.4/jquery.min.js"></script>
            <script type="text/javascript" src="/samigo-app/js/selection.author.preview.js"></script>
            <script type="text/javascript" src="/library/js/spinner.js"></script>
            <script type="text/javascript" src="/samigo-app/js/jsf.js"></script>
            <link rel="stylesheet" type="text/css" href="/samigo-app/css/imageQuestion.author.css" />
        </h:head>
        <h:body onload="document.forms[0].reset(); disableIt(); resetSelectMenus(); #{empty requestScope['html.body.onload'] ? '' : requestScope['html.body.onload']}">
            <div class="portletBody container-fluid">
                <h:form id="assessmentForm">

                    <h:panelGroup rendered="#{!author.isEditPendingAssessmentFlow}" styleClass="sak-banner-warn">
                        <h:panelGrid columns="1">
                            <h:outputText value="#{authorMessages.edit_published_assessment_warn_1}" />
                            <h:outputText value="#{authorMessages.edit_published_assessment_warn_21}" rendered="#{assessmentBean.hasGradingData}" />
                            <h:outputText value="#{authorMessages.edit_published_assessment_warn_22}" rendered="#{!assessmentBean.hasGradingData}" />
                        </h:panelGrid>
                    </h:panelGroup>

                    <h:inputHidden id="assessmentId" value="#{assessmentBean.assessmentId}" />
                    <h:inputHidden id="showCompleteAssessment" value="#{author.showCompleteAssessment}" />
                    <h:inputHidden id="title" value="#{assessmentBean.title}" />
                    <h:inputHidden id="SectionIdent" value="#{author.currentSection}" />
                    <h:inputHidden id="ItemIdent" value="#{author.currentItem}" />
                    <h:inputHidden id="fixedQuestionIds" value="#{sectionBean.fixedQuestionIds}" />

                    <ui:include src="/jsf/author/editAssessmentHeadings.xhtml" />

                    <div class="navView">
                        <h1>
                            <h:outputText value="#{authorMessages.qs}#{authorMessages.column} #{assessmentBean.title}" escape="false" />
                            <h:outputText value=" #{authorMessages.dash} #{author.editPoolSectionName}" escape="false" rendered="#{author.isEditPoolFlow}" />
                        </h1>
                    </div>

                    <div class="navList">
                        <h:outputText value="#{assessmentBean.questionSize} #{authorMessages.existing_qs} #{authorMessages.dash} " rendered="#{assessmentBean.questionSize gt 1}" />
                        <h:outputText value="#{assessmentBean.questionSize} #{authorMessages.existing_q} #{authorMessages.dash} " rendered="#{assessmentBean.questionSize == 1}" />
                        <h:outputText value="#{assessmentBean.questionSize} #{authorMessages.existing_qs} #{authorMessages.dash} " rendered="#{assessmentBean.questionSize == 0}" />
                        <h:outputText value="#{assessmentBean.totalScore}">
                            <f:convertNumber maxFractionDigits="2" groupingUsed="false" />
                        </h:outputText>
                        <h:outputText value="&#160;" escape="false" />
                        <h:outputText value="#{authorMessages.total_pts}" rendered="#{assessmentBean.totalScore gt 1}" />
                        <h:outputText value="#{authorMessages.total_pt}" rendered="#{assessmentBean.totalScore == 1}" />
                        <h:outputText value="#{authorMessages.total_pts}" rendered="#{assessmentBean.totalScore == 0}" />
                    </div>

                    <p class="navViewAction">
                        <h:commandLink title="#{authorMessages.t_addPart}" id="addPart" action="editPart" immediate="true" rendered="#{author.isEditPendingAssessmentFlow}">
                            <h:outputText value="#{authorMessages.subnav_add_part}" />
                            <f:param name="assessmentId" value="#{assessmentBean.assessmentId}" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.AuthorPartListener" />
                        </h:commandLink>

                        <h:outputText value=" #{authorMessages.separator} " rendered="#{assessmentBean.showPrintLink eq 'true'}" />

                        <h:commandLink title="#{commonMessages.action_preview}" action="beginAssessment" rendered="#{assessmentBean.assessmentId gt 0}">
                            <h:outputText value="#{commonMessages.action_preview}" />
                            <f:param name="assessmentId" value="#{assessmentBean.assessmentId}" />
                            <f:param name="publishedId" value="#{author.editPublishedAssessmentID}" />
                            <f:param name="actionString" value="previewAssessment" />
                            <f:param name="fromEdit" value="true" />
                            <f:param name="isFromPrint" value="false" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.delivery.BeginDeliveryActionListener" />
                        </h:commandLink>

                        <h:outputText value=" #{authorMessages.separator} " rendered="#{assessmentBean.showPrintLink eq 'true'}" />

                        <h:commandLink action="#{itemauthor.print}" rendered="#{assessmentBean.showPrintLink eq 'true' and assessmentBean.showPrintAssessment ne 'true'}">
                            <h:outputText value="#{authorMessages.subnav_print}" escape="false" />
                        </h:commandLink>
                        <h:commandLink action="#{pdfAssessment.prepPDF}" rendered="#{assessmentBean.showPrintLink eq 'true' and assessmentBean.showPrintAssessment eq 'true'}">
                            <f:param name="assessmentId" value="#{assessmentBean.assessmentId}" />
                            <f:param name="publishedId" value="#{author.editPublishedAssessmentID}" />
                            <f:param name="actionString" value="editAssessment" />
                            <f:param name="isFromPrint" value="true" />
                            <h:outputText value="#{printMessages.print}" escape="false" />
                        </h:commandLink>

                        <h:outputText value=" #{authorMessages.separator} " />

                        <h:commandLink title="#{authorMessages.t_settings}" id="editAssessmentSettings_editAssessment" action="editAssessmentSettings"
                            immediate="true" rendered="#{author.isEditPendingAssessmentFlow and assessmentBean.assessmentId gt 0}">
                            <h:outputText value="#{commonMessages.settings_action}" />
                            <f:param name="assessmentId" value="#{assessmentBean.assessmentId}" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.AuthorSettingsListener" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.SetFromPageAsEditAssessmentListener" />
                        </h:commandLink>

                        <h:commandLink title="#{authorFrontDoorMessages.t_editSettings}" id="editPublishedAssessmentSettings_editAssessment" immediate="true"
                            rendered="#{!author.isEditPendingAssessmentFlow}" action="#{author.getOutcome}">
                            <h:outputText value="#{commonMessages.settings_action}" />
                            <f:param name="publishedId" value="#{assessmentBean.assessmentId}" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.EditPublishedSettingsListener" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.SetFromPageAsEditAssessmentListener" />
                        </h:commandLink>

                        <h:outputText value=" #{authorMessages.separator} " rendered="#{author.isEditPendingAssessmentFlow and assessmentBean.questionSize gt 0}" />

                        <h:commandLink title="#{commonMessages.publish_action}" id="editAssessmentSettings_editAssessment2"
                            action="#{assessmentSettings.getOutcomePublish}" immediate="true"
                            rendered="#{author.isEditPendingAssessmentFlow and assessmentBean.questionSize gt 0}">
                            <h:outputText value="#{commonMessages.publish_action}" />
                            <f:param name="assessmentId" value="#{assessmentBean.assessmentId}" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ConfirmPublishAssessmentListener" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.PublishAssessmentListener" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.SetFromPageAsEditAssessmentListener" />
                        </h:commandLink>
                    </p>

                    <h:panelGrid columns="1" styleClass="validation"
                        rendered="#{author.isEditPoolFlow and (assessmentBean.sections[0].sectionAuthorType != null and assessmentBean.sections[0].sectionAuthorTypeString == '2')}">
                        <h:outputFormat value="#{authorMessages.edit_published_assessment_warn_edit_pool_questions}">
                            <f:param value="#{author.editPoolName}" />
                        </h:outputFormat>
                    </h:panelGrid>

                    <h:panelGrid columns="1" styleClass="validation"
                        rendered="#{author.isEditPoolFlow and (assessmentBean.sections[0].sectionAuthorType != null and assessmentBean.sections[0].sectionAuthorTypeString == '3')}">
                        <h:outputFormat value="#{authorMessages.edit_published_assessment_warn_edit_pool_fixed_questions}">
                            <f:param value="#{author.editPoolNameFixed}" />
                            <f:param value="#{author.editPoolName}" />
                        </h:outputFormat>
                    </h:panelGrid>

                    <h:panelGrid columns="1" styleClass="validation"
                        rendered="#{author.isEditPoolFlow and (assessmentBean.sections[0].sectionAuthorType != null and assessmentBean.sections[0].sectionAuthorTypeString == '4')}">
                        <h:outputText value="#{authorMessages.edit_published_assessment_warn_edit_multiple_pools}" />
                    </h:panelGrid>

                    <h:panelGrid columns="2" width="100%" columnClasses="shortText,navList">
                        <h:panelGroup rendered="#{!author.isEditPendingAssessmentFlow}" />

                        <h:panelGroup>
                            <h:commandButton id="republish" value="#{authorMessages.button_republish}" type="submit" styleClass="active"
                                rendered="#{!author.isEditPendingAssessmentFlow}"
                                action="#{author.getOutcome}" onclick="SPNR.disableControlsAndSpin(this, null);">
                                <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ConfirmRepublishAssessmentListener" />
                                <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.SetFromPageAsEditAssessmentListener" />
                            </h:commandButton>

                            <h:commandButton id="republishRegrade" value="#{authorMessages.button_republish_and_regrade}" type="submit" styleClass="active"
                                rendered="#{!author.isEditPendingAssessmentFlow and assessmentBean.hasGradingData}"
                                action="#{author.getOutcome}" onclick="SPNR.disableControlsAndSpin(this, null);">
                                <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ConfirmRepublishAssessmentListener" />
                                <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.SetFromPageAsEditAssessmentListener" />
                            </h:commandButton>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{!author.isEditPendingAssessmentFlow}" />

                        <h:panelGroup>
                            <h:commandButton value="#{authorMessages.button_return_to_main}" id="returnToMain" rendered="#{author.isEditPoolFlow}">
                                <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.EditPublishedQuestionPoolPartListener" />
                            </h:commandButton>
                        </h:panelGroup>
                    </h:panelGrid>

                    <h:panelGrid columns="1" width="100%" columnClasses="navList" border="0"
                        rendered="#{!author.isEditPendingAssessmentFlow and assessmentBean.hasGradingData}">
                        <h:outputLink title="#{assessmentSettingsMessages.whats_this_link}" value="#" onclick="javascript:window.open('/samigo-app/jsf/author/regradeRepublishPopUp.faces','RegradeRepublish','width=400,height=400,scrollbars=yes, resizable=yes');" onkeypress="javascript:window.open('/samigo-app/jsf/author/regradeRepublishPopUp.faces','RegradeRepublishPopUp','width=400,height=400,scrollbars=yes, resizable=yes');">
                            <h:outputText value=" #{assessmentSettingsMessages.whats_this_link}" />
                        </h:outputLink>
                    </h:panelGrid>

                    <h:commandLink id="hiddenlink" action="#{itemauthor.doit}" value="" styleClass="d-none">
                        <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.StartCreateItemListener" />
                    </h:commandLink>

                    <h:messages styleClass="sak-banner-error" rendered="#{! empty facesContext.maximumSeverity}" layout="table" />

                    <div class="tier1">
                        <h:dataTable id="parts" width="100%" value="#{assessmentBean.sections}" var="partBean">
                            <h:column>
                                <h:panelGrid styleClass="table table-striped" columns="2" width="100%" columnClasses="navView,navList" border="0">
                                    <h:panelGroup rendered="#{!author.isEditPoolFlow}">
                                        <h:outputLabel for="number" value="#{authorMessages.p}" />
                                        <h:outputText value="&#160;" escape="false" />
                                        <h:selectOneMenu id="number" value="#{partBean.number}" onchange="enableOrderUpdate()" rendered="#{!author.isEditPoolFlow}">
                                            <f:selectItems value="#{assessmentBean.partNumbers}" />
                                        </h:selectOneMenu>
                                        <h:outputText value="#{partBean.number}: " rendered="#{!author.isEditPendingAssessmentFlow}" />
                                        <h:outputText value="&#160;" escape="false" />
                                        <h:panelGroup rendered="#{!author.isEditPoolFlow}">
                                            <h:outputText rendered="#{(partBean.sectionAuthorType == null or partBean.sectionAuthorTypeString == '1') and partBean.questions gt 1}" value="#{partBean.title} #{authorMessages.dash} #{partBean.questions} #{authorMessages.questions_lower_case}" escape="false" />
                                            <h:outputText rendered="#{(partBean.sectionAuthorType == null or partBean.sectionAuthorTypeString == '1') and partBean.questions == 1}" value="#{partBean.title} #{authorMessages.dash} #{partBean.questions} #{authorMessages.question_lower_case}" escape="false" />
                                            <h:outputText rendered="#{(partBean.sectionAuthorType == null or partBean.sectionAuthorTypeString == '1') and partBean.questions == 0}" value="#{partBean.title} #{authorMessages.dash} #{partBean.questions} #{authorMessages.questions_lower_case}" escape="false" />

                                            <h:outputText rendered="#{(partBean.sectionAuthorType != null and partBean.sectionAuthorTypeString == '3') and partBean.numberToBeFixedString gt 1}" value="#{authorMessages.fixed_label_part} #{partBean.numberToBeFixedString}" escape="false" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </h:panelGrid>

                                <h:panelGroup rendered="#{author.isEditPendingAssessmentFlow and !author.isEditPoolFlow}">
                                    <div class="insert-question-row">
                                        <div class="sak-banner-info">
                                            <h:outputLabel for="changeQType" value="#{authorMessages.ins_new_q} " />
                                            <h:outputText value="&#160;" escape="false" />
                                            <h:selectOneMenu id="changeQType" onchange="clickInsertLink(this);" value="#{itemauthor.itemTypeString}">
                                                <f:selectItem itemLabel="#{authorMessages.select_qtype}" itemValue="1,#{partBean.number},#{partBean.itemContents.size()}" />
                                                <f:valueChangeListener type="org.sakaiproject.tool.assessment.ui.listener.author.StartInsertItemListener" />
                                                <f:selectItems value="#{itemConfig.itemTypeSelectList}" />
                                            </h:selectOneMenu>
                                        </div>
                                    </div>
                                </h:panelGroup>

                                <h:dataTable id="questions" value="#{partBean.itemContents}" var="question" width="100%"
                                    rendered="#{(!author.isEditPoolFlow and (partBean.sectionAuthorType == null or partBean.sectionAuthorTypeString == '1')) or (author.isEditPoolFlow and author.editPoolSectionId != null and partBean.sectionId == author.editPoolSectionId)}">
                                    <h:column>
                                        <h:panelGrid styleClass="table samigo-question-info" columns="2" width="100%" columnClasses="navView,navList">
                                            <h:panelGroup>
                                                <h:outputLabel for="number" value="#{authorMessages.q} " />
                                                <h:outputText value="&#160;" escape="false" />
                                                <h:inputHidden id="currItemId" value="#{question.itemData.itemIdString}" />
                                                <h:selectOneMenu id="number" onchange="enableOrderUpdate()" value="#{question.number}" rendered="#{!author.isEditPoolFlow}">
                                                    <f:selectItems value="#{partBean.questionNumbers}" />
                                                </h:selectOneMenu>
                                                <h:outputText value="#{question.number}: " rendered="#{!author.isEditPendingAssessmentFlow}" />
                                                <h:panelGroup>
                                                    <h:outputText rendered="#{question.itemData.typeId == 1}" value=" #{commonMessages.multiple_choice_sin}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 2}" value=" #{commonMessages.multipl_mc_ms}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 12}" value=" #{commonMessages.multipl_mc_ss}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 13}" value=" #{authorMessages.matrix_choice_surv}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 3}" value=" #{authorMessages.multiple_choice_surv}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 4}" value=" #{authorMessages.true_false}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 5}" value=" #{authorMessages.short_answer_essay}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 8}" value=" #{authorMessages.fill_in_the_blank}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 11}" value=" #{authorMessages.fill_in_numeric}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 9}" value=" #{authorMessages.matching}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 7}" value=" #{authorMessages.audio_recording}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 6}" value=" #{authorMessages.file_upload}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 14}" value=" #{authorMessages.extended_matching_items}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 15}" value=" #{authorMessages.calculated_question}" />
                                                    <h:outputText rendered="#{question.itemData.typeId == 16}" value=" #{authorMessages.image_map_question}" />
                                                </h:panelGroup>
                                            </h:panelGroup>
                                        </h:panelGrid>

                                        <h:panelGrid>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 16}">
                                                <ui:include src="/jsf/author/preview_item/ImageMapQuestion.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 15}">
                                                <ui:include src="/jsf/author/preview_item/CalculatedQuestion.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 14}">
                                                <ui:include src="/jsf/author/preview_item/ExtendedMatchingItems.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 13}">
                                                <ui:include src="/jsf/author/preview_item/MatrixChoicesSurvey.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 12 or question.itemData.typeId == 2}">
                                                <ui:include src="/jsf/author/preview_item/MultipleChoiceMultipleCorrect.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 11}">
                                                <ui:include src="/jsf/author/preview_item/FillInNumeric.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 9}">
                                                <ui:include src="/jsf/author/preview_item/Matching.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 8}">
                                                <ui:include src="/jsf/author/preview_item/FillInTheBlank.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 7}">
                                                <ui:include src="/jsf/author/preview_item/AudioRecording.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 6}">
                                                <ui:include src="/jsf/author/preview_item/FileUpload.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 5}">
                                                <ui:include src="/jsf/author/preview_item/ShortAnswer.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 4}">
                                                <ui:include src="/jsf/author/preview_item/TrueFalse.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 3}">
                                                <ui:include src="/jsf/author/preview_item/MultipleChoiceSurvey.xhtml" />
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{question.itemData.typeId == 1}">
                                                <ui:include src="/jsf/author/preview_item/MultipleChoiceSingleCorrect.xhtml" />
                                            </h:panelGroup>
                                        </h:panelGrid>
                                    </h:column>
                                </h:dataTable>
                            </h:column>
                        </h:dataTable>
                    </div>

                    <h:panelGroup rendered="#{question.itemData.typeId == 15}" />

                </h:form>
            </div>
        </h:body>
    </f:view>

</ui:composition>
