<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:samigo="http://www.sakaiproject.org/samigo"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <f:view>
        <f:event type="preRenderView" listener="#{portalHeaderConfigurator.configure}" />
        <h:head>
            <ui:fragment rendered="#{not empty requestScope['html.head']}">
                <h:outputText value="#{requestScope['html.head']}" escape="false" />
            </ui:fragment>
            <title>
                <h:outputText value="#{authorMessages.item_display_author}" />
            </title>
            <script type="text/javascript" src="/samigo-app/js/authoring.js"></script>
        </h:head>
        <h:body onload="countNum();#{empty requestScope['html.body.onload'] ? '' : requestScope['html.body.onload']}">
            <div class="portletBody container-fluid">
<!-- content... -->
<!-- FORM -->



<!-- HEADING -->
<ui:include src="/jsf/author/item/itemHeadings.xhtml" />
<h:form id="itemForm">
    <ui:fragment>
        <input type="hidden" id="ckeditor-autosave-context" name="ckeditor-autosave-context" value="samigo_edit_tf" />
    </ui:fragment>
    <ui:fragment rendered="#{itemauthor.currentItem.itemId != null}">
        <input type="hidden" id="ckeditor-autosave-entity-id" name="ckeditor-autosave-entity-id" value="#{itemauthor.currentItem.itemId}" />
    </ui:fragment>
<p class="act">
  <h:commandButton rendered="#{itemauthor.target=='assessment'}" value="#{commonMessages.action_save}" action="#{itemauthor.currentItem.getOutcome}" styleClass="active">
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.ItemAddListener" />
  </h:commandButton>
  <h:commandButton rendered="#{itemauthor.target=='questionpool'}" value="#{commonMessages.action_save}" action="#{itemauthor.currentItem.getPoolOutcome}" styleClass="active">
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.ItemAddListener" />
  </h:commandButton>


  <h:commandButton rendered="#{itemauthor.target=='assessment'}" value="#{commonMessages.cancel_action}" action="editAssessment" immediate="true">
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.ResetItemAttachmentListener" />
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.EditAssessmentListener" />
  </h:commandButton>

 <h:commandButton rendered="#{itemauthor.target=='questionpool'}" value="#{commonMessages.cancel_action}" action="editPool" immediate="true">
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.ResetItemAttachmentListener" />
 </h:commandButton>
</p>

    <!-- QUESTION PROPERTIES -->
    <!-- 1 POINTS -->
    <div class="form-group row">
        <h:outputLabel for="answerptr" value="#{authorMessages.answer_point_value}" styleClass="col-md-2 form-label"/>
        <div class="col-md-2">
            <h:inputText id="answerptr" label="#{authorMessages.pt}" value="#{itemauthor.currentItem.itemScore}" 
                         required="true" disabled="#{author.isEditPoolFlow}" styleClass="form-control ConvertPoint">
                <f:validateDoubleRange minimum="0.00"/>
            </h:inputText>
            <h:message for="answerptr" styleClass="validate"/>
        </div>
    </div>
    <div class="form-group row">
        <h:outputLabel for="itemScore" value="#{authorMessages.answer_point_value_display}" styleClass="col-md-2 form-label"/>
        <div class="col-md-5 samigo-inline-radio">
            <h:selectOneRadio value="#{itemauthor.currentItem.itemScoreDisplayFlag}" id="itemScore">
                <f:selectItem itemValue="true" itemLabel="#{authorMessages.yes}" />
                <f:selectItem itemValue="false" itemLabel="#{authorMessages.no}" />
            </h:selectOneRadio>
        </div>
    </div>

    <!-- 1.2 MIN POINTS -->
    <f:subview id="minPoints" rendered="#{itemauthor.allowMinScore}">
        <div class="form-group row">   
            <h:outputLabel for="answerminptr" value="#{authorMessages.answer_min_point_value}" 
                           styleClass="col-md-2 form-label"/>
            <div class="col-md-2">
                <h:inputText
                    id="answerminptr"
                    value="#{itemauthor.currentItem.itemMinScore}"
                    styleClass="form-control ConvertPoint"
                    disabled="#{itemauthor.currentItem.renderMinPointsWarning}">
                    <f:validateDoubleRange />
                </h:inputText>    
                <small>
                    <h:outputText
                        id="min-point-info"
                        value="#{authorMessages.answer_min_point_info}"
                        styleClass="sak-banner-info"
                        rendered="#{!itemauthor.currentItem.renderMinPointsWarning}" />
                </small>
                <small>
                    <div><h:outputText
                        id="min-point-warning"
                        styleClass="sak-banner-info"
                        style="display:#{(itemauthor.currentItem.renderMinPointsWarning)?'inline-block':'none'}"
                        value="#{authorMessages.answer_min_point_value_warning}" />
                    </div>
                </small>
                <h:message for="answerminptr" styleClass="validate"/>
            </div>
        </div>
    </f:subview>

    <!-- NEGATIVE POINT -->
    <div class="form-group row">
        <h:outputLabel for="answerdsc" value="#{authorMessages.negative_point_value}" styleClass="col-md-2 form-label"/>
        <div class="col-md-2">
            <h:inputText id="answerdsc" value="#{itemauthor.currentItem.itemDiscount}" 
                         required="true" styleClass="form-control ConvertPoint">
                <f:validateDoubleRange />
            </h:inputText>
            <h:message for="answerdsc" styleClass="validate"/>
        </div>
    </div>

    <!-- Extra Credit -->
    <ui:include src="/jsf/author/inc/extraCreditSetting.xhtml" />

    <!-- 2 TEXT -->
    <div class="form-group row">
        <h:outputLabel for="questionItemText_textinput" value="#{authorMessages.q_text}" styleClass="form-label"/>
        <!-- STUB FOR WYSIWYG -->
        <!-- WYSIWYG -->   
        <div class="col-md-10">
            <h:panelGrid>
                <samigo:wysiwyg identity="questionItemText" rows="140" value="#{itemauthor.currentItem.itemText}" hasToggle="yes" mode="author" maxCharCount="60000" />
            </h:panelGrid>
        </div>
    </div>

    <!-- 2a ATTACHMENTS -->
    <ui:include src="/jsf/author/item/attachment.xhtml" />

    <!-- 3 ANSWER -->
    <div class="form-group row">
        <h:outputLabel for="TF" value="#{authorMessages.answer} " styleClass="col-md-2 form-label"/>
        <div class="col-md-10 samigo-inline-radio">
            <h:selectOneRadio layout="lineDirection" id="TF" border="0"
                              value="#{itemauthor.currentItem.corrAnswer}">
                <f:selectItems value="#{itemauthor.trueFalseAnswerSelectList}" />
            </h:selectOneRadio>
        </div>
    </div>
    
    <!-- 4 RATIONALE -->
    <div class="form-group row">
        <h:outputLabel for="rational" value="#{authorMessages.req_rationale}" styleClass="col-md-2 form-label"/>
        <div class="col-md-2 samigo-inline-radio">
            <h:selectOneRadio value="#{itemauthor.currentItem.rationale}" id="rational" required="true">
                <f:selectItem itemValue="true" itemLabel="#{authorMessages.yes}" />
                <f:selectItem itemValue="false" itemLabel="#{authorMessages.no}" />
            </h:selectOneRadio>
            <h:message for="rational" styleClass="validate"/>
        </div>
    </div>

    <!-- 4a TIMED -->
    <ui:include src="/jsf/author/item/timed.xhtml" />

    <!-- 5 PART -->
    <h:panelGroup styleClass="form-group row" layout="block" rendered="#{itemauthor.target == 'assessment'}">
        <h:panelGroup rendered="#{not author.isEditPoolFlow}">
            <h:outputLabel for="assignToPart" value="#{authorMessages.assign_to_p}" styleClass="col-md-2 form-label"/>
            <div class="col-md-10">
                <h:selectOneMenu id="assignToPart" value="#{itemauthor.currentItem.selectedSection}">
                    <f:selectItems  value="#{itemauthor.sectionSelectList}" />
                </h:selectOneMenu>
            </div>
        </h:panelGroup>
    </h:panelGroup>

    <!-- 6 POOL -->
    <h:panelGroup styleClass="form-group row" layout="block" 
                  rendered="#{itemauthor.target == 'assessment'  and  author.isEditPendingAssessmentFlow}">  
        <h:outputLabel for="assignToPool" value="#{authorMessages.assign_to_question_p}" styleClass="col-md-2 form-label"/>
        <div class="col-md-10">
            <h:selectOneMenu id="assignToPool" value="#{itemauthor.currentItem.selectedPool}">
                <f:selectItem itemValue="" itemLabel="#{authorMessages.select_a_pool_name}" />
                <f:selectItems value="#{itemauthor.poolSelectList}" />
            </h:selectOneMenu>
        </div>
    </h:panelGroup>

    <!-- FEEDBACK -->
    <h:panelGroup rendered="#{itemauthor.target == 'questionpool' or (itemauthor.target != 'questionpool' and author.isEditPendingAssessmentFlow and assessmentSettings.feedbackAuthoring ne '2') or (!author.isEditPendingAssessmentFlow and publishedSettings.feedbackAuthoring ne '2')}"><br />
        <div class="form-group row">
            <h2>
                <h:outputText value="#{authorMessages.correct_incorrect_an}" styleClass="col-md-12 form-label"/>
            </h2>
        </div>
        <div class="form-group row">
            <h:outputLabel for="questionFeedbackCorrect_textinput" value="#{authorMessages.correct_answer_opti}" styleClass="form-label"/>
            <!-- WYSIWYG -->
            <div class="col-md-10">
                <h:panelGrid>
                    <samigo:wysiwyg identity="questionFeedbackCorrect" rows="140" value="#{itemauthor.currentItem.corrFeedback}" hasToggle="yes" mode="author" maxCharCount="60000" />
                </h:panelGrid>
            </div>
        </div>
        <div class="form-group row">
            <h:outputLabel for="questionFeedbackIncorrect_textinput" value="#{authorMessages.incorrect_answer_op}" styleClass="form-label"/>
            <!-- WYSIWYG -->
            <div class="col-md-10">
                <h:panelGrid>
                    <samigo:wysiwyg identity="questionFeedbackIncorrect" rows="140" value="#{itemauthor.currentItem.incorrFeedback}" hasToggle="yes" mode="author" maxCharCount="60000" />
                </h:panelGrid>
            </div>
        </div>
    </h:panelGroup>

    <!-- METADATA -->
    <h:panelGroup rendered="#{itemauthor.showMetadata == 'true'}" styleClass="longtext">
        <h:outputLabel value="Metadata"/><br/>
        <div class="form-group row">
            <h:outputLabel for="obj" value="#{authorMessages.objective}" styleClass="col-md-2 form-label"/>
            <div class="col-md-5">
                <h:inputText size="30" id="obj" value="#{itemauthor.currentItem.objective}" styleClass="form-control"/>
            </div>
       </div>
       <div class="form-group row">
           <h:outputLabel for="keyword" value="#{authorMessages.keyword}" styleClass="col-md-2 form-label"/>
           <div class="col-md-5">
               <h:inputText size="30" id="keyword" value="#{itemauthor.currentItem.keyword}" styleClass="form-control"/>
           </div>
       </div>
       <div class="form-group row">
           <h:outputLabel for="rubric" value="#{authorMessages.rubric_colon}" styleClass="col-md-2 form-label"/>
           <div class="col-md-5">
               <h:inputText size="30" id="rubric" value="#{itemauthor.currentItem.rubric}" styleClass="form-control"/>
           </div>
       </div>
    </h:panelGroup>

    <ui:include src="/jsf/author/item/tags.xhtml" />


<p class="act">
  <h:commandButton rendered="#{itemauthor.target=='assessment'}" value="#{commonMessages.action_save}" action="#{itemauthor.currentItem.getOutcome}" styleClass="active">
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.ItemAddListener" />
  </h:commandButton>
  <h:commandButton rendered="#{itemauthor.target=='questionpool'}" value="#{commonMessages.action_save}" action="#{itemauthor.currentItem.getPoolOutcome}" styleClass="active">
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.ItemAddListener" />
  </h:commandButton>


  <h:commandButton rendered="#{itemauthor.target=='assessment'}" value="#{commonMessages.cancel_action}" action="editAssessment" immediate="true">
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.ResetItemAttachmentListener" />
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.EditAssessmentListener" />
  </h:commandButton>

 <h:commandButton rendered="#{itemauthor.target=='questionpool'}" value="#{commonMessages.cancel_action}" action="editPool" immediate="true">
        <f:actionListener
           type="org.sakaiproject.tool.assessment.ui.listener.author.ResetItemAttachmentListener" />
 </h:commandButton>

</p>
</h:form>


<!-- end content -->
            </div>
        </h:body>
    </f:view>

</ui:composition>
