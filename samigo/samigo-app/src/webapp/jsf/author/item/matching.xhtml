<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:samigo="http://www.sakaiproject.org/samigo"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:sakai="http://sakaiproject.org/jsf2/sakai">

    <f:view>
        <f:event type="preRenderView" listener="#{portalHeaderConfigurator.configure}" />
        <h:head>
            <ui:fragment rendered="#{not empty requestScope['html.head']}">
                <h:outputText value="#{requestScope['html.head']}" escape="false" />
            </ui:fragment>
            <title>
                <h:outputText value="#{authorMessages.item_display_author}" />
            </title>
            <script type="text/javascript" src="/samigo-app/js/authoring.js"></script>
            <script type="text/javascript" src="/library/js/spinner.js"></script>
        </h:head>
        <h:body onload="#{empty requestScope['html.body.onload'] ? '' : requestScope['html.body.onload']}">
            <div class="portletBody">
                <ui:include src="/jsf/author/item/itemHeadings.xhtml" />
                <h:form id="itemForm">
                    <ui:fragment>
                        <input type="hidden" id="ckeditor-autosave-context" name="ckeditor-autosave-context" value="samigo_edit_matching" />
                    </ui:fragment>
                    <ui:fragment rendered="#{itemauthor.currentItem.itemId != null}">
                        <input type="hidden" id="ckeditor-autosave-entity-id" name="ckeditor-autosave-entity-id" value="#{itemauthor.currentItem.itemId}" />
                    </ui:fragment>

                    <p class="act">
                        <h:commandButton rendered="#{itemauthor.target == 'assessment'}" value="#{commonMessages.action_save}" action="#{itemauthor.currentItem.getOutcome}" styleClass="active">
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ItemAddListener" />
                        </h:commandButton>
                        <h:commandButton rendered="#{itemauthor.target == 'questionpool'}" value="#{commonMessages.action_save}" action="#{itemauthor.currentItem.getPoolOutcome}" styleClass="active">
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ItemAddListener" />
                        </h:commandButton>
                        <h:commandButton rendered="#{itemauthor.target == 'assessment'}" value="#{commonMessages.cancel_action}" action="editAssessment" immediate="true">
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ResetItemAttachmentListener" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.EditAssessmentListener" />
                        </h:commandButton>
                        <h:commandButton rendered="#{itemauthor.target == 'questionpool'}" value="#{commonMessages.cancel_action}" action="editPool" immediate="true">
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ResetItemAttachmentListener" />
                        </h:commandButton>
                    </p>

                    <div style="display:none">
                        <h:inputTextarea id="ed0" cols="10" rows="10" value="            " />
                    </div>

                    <div class="form-group row">
                        <h:outputLabel for="answerptr" value="#{authorMessages.answer_point_value}" styleClass="col-md-4 col-lg-2 form-label" />
                        <div class="col-md-2">
                            <h:inputText id="answerptr" label="#{authorMessages.pt}" value="#{itemauthor.currentItem.itemScore}" required="true" disabled="#{author.isEditPoolFlow}" styleClass="form-control ConvertPoint">
                                <f:validateDoubleRange minimum="0.00" />
                            </h:inputText>
                            <h:message for="answerptr" styleClass="validate" />
                        </div>
                    </div>

                    <div class="form-group row">
                        <h:outputLabel for="itemScore" value="#{authorMessages.answer_point_value_display}" styleClass="col-md-4 col-lg-2 form-label" />
                        <div class="col-md-5 samigo-inline-radio">
                            <h:selectOneRadio value="#{itemauthor.currentItem.itemScoreDisplayFlag}" id="itemScore">
                                <f:selectItem itemValue="true" itemLabel="#{authorMessages.yes}" />
                                <f:selectItem itemValue="false" itemLabel="#{authorMessages.no}" />
                            </h:selectOneRadio>
                        </div>
                    </div>

                    <f:subview id="minPoints" rendered="#{itemauthor.allowMinScore}">
                        <div class="form-group row">
                            <h:outputLabel for="answerminptr" value="#{authorMessages.answer_min_point_value}" styleClass="col-md-4 col-lg-2 form-label" />
                            <div class="col-md-2">
                                <h:inputText id="answerminptr" value="#{itemauthor.currentItem.itemMinScore}" styleClass="form-control ConvertPoint">
                                    <f:validateDoubleRange />
                                </h:inputText>
                                <h:outputText value="#{authorMessages.answer_min_point_info}" />
                                <h:message for="answerminptr" styleClass="validate" />
                            </div>
                        </div>
                    </f:subview>

                    <ui:include src="/jsf/author/inc/extraCreditSetting.xhtml" />

                    <div class="form-group row">
                        <h:outputLabel for="questionItemText_textinput" value="#{authorMessages.q_text}" styleClass="form-label" />
                        <div class="col-md-8">
                            <h:panelGrid>
                                <samigo:wysiwyg identity="questionItemText" rows="140" value="#{itemauthor.currentItem.instruction}" hasToggle="yes" mode="author" maxCharCount="60000">
                                    <f:validateLength maximum="60000" />
                                </samigo:wysiwyg>
                            </h:panelGrid>
                        </div>
                    </div>

                    <ui:include src="/jsf/author/item/attachment.xhtml" />

                    <div class="longtext">
                        <h:outputLabel for="pairs" value="#{authorMessages.create_pairing}" />
                    </div>
                    <div>
                        <h:dataTable cellpadding="0" cellspacing="0" styleClass="listHier" id="pairs" value="#{itemauthor.currentItem.matchItemBeanList}" var="pair">
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="" />
                                </f:facet>
                                <h:outputText value="#{pair.sequence}" />
                            </h:column>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="#{authorMessages.matching_choice_col}" />
                                </f:facet>
                                <h:outputText escape="false" value="#{pair.choice}" styleClass="mcAnswerText" />
                            </h:column>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="#{authorMessages.matching_match_col}" />
                                </f:facet>
                                <h:outputText escape="false" value="#{pair.match}" styleClass="mcAnswerText" />
                            </h:column>
                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="" />
                                </f:facet>
                                <h:panelGrid>
                                    <h:panelGroup>
                                        <h:commandLink rendered="#{itemauthor.currentItem.currentMatchPair.sequence != pair.sequence}" id="modifylink" immediate="true" action="#{itemauthor.currentItem.editMatchPair}">
                                            <h:outputText id="modifytext" value="#{commonMessages.edit_action}" />
                                            <f:param name="sequence" value="#{pair.sequence}" />
                                        </h:commandLink>
                                        <h:outputText value="#{authorMessages.matching_currently_editing}" rendered="#{itemauthor.currentItem.currentMatchPair.sequence == pair.sequence}" />
                                        <h:outputText value=" #{authorMessages.separator} " rendered="#{itemauthor.currentItem.currentMatchPair.sequence != pair.sequence}" />
                                        <h:commandLink id="removelink" immediate="true" action="#{itemauthor.currentItem.removeMatchPair}" rendered="#{itemauthor.currentItem.currentMatchPair.sequence != pair.sequence}">
                                            <h:outputText id="removetext" value="#{commonMessages.remove_action}" />
                                            <f:param name="sequence" value="#{pair.sequence}" />
                                        </h:commandLink>
                                    </h:panelGroup>
                                </h:panelGrid>
                            </h:column>
                        </h:dataTable>
                        <h:panelGroup rendered="#{itemauthor.currentItem.matchItemBeanList eq '[]'}">
                            <p><h:outputText value="#{authorMessages.no_matching_pair}" /></p>
                        </h:panelGroup>
                    </div>

                    <div class="tier2">
                        <div class="form-group row">
                            <h:outputLabel value="#{authorMessages.matching_choice_col}" styleClass="form-label" />
                            <div class="col-md-8">
                                <h:panelGrid>
                                    <samigo:wysiwyg value="#{itemauthor.currentItem.currentMatchPair.choice}" rows="140" hasToggle="yes" mode="author" maxCharCount="4000">
                                        <f:validateLength maximum="4000" />
                                    </samigo:wysiwyg>
                                </h:panelGrid>
                            </div>
                        </div>
                        <div class="form-group row">
                            <h:outputLabel for="controllingSequence" value="#{authorMessages.matching_match_col}" styleClass="form-label" />
                            <div class="col-md-8">
                                <h:selectOneMenu value="#{itemauthor.currentItem.currentMatchPair.controllingSequence}" id="controllingSequence">
                                    <f:selectItems value="#{itemauthor.currentItem.selfSequenceList}" />
                                </h:selectOneMenu>
                                <h:outputLabel id="noFeedbackMsg" value="#{authorMessages.feedback_unavailable}" style="display:none;" />
                                <h:panelGrid>
                                    <samigo:wysiwyg value="#{itemauthor.currentItem.currentMatchPair.match}" rows="140" hasToggle="yes" mode="author" maxCharCount="4000">
                                        <f:validateLength maximum="4000" />
                                    </samigo:wysiwyg>
                                </h:panelGrid>
                            </div>
                        </div>
                    </div>

                    <h:panelGroup id="feedbackContainer" layout="block" rendered="#{itemauthor.target == 'questionpool' or (itemauthor.target != 'questionpool' and ((author.isEditPendingAssessmentFlow and assessmentSettings.feedbackAuthoring ne '1') or (!author.isEditPendingAssessmentFlow and publishedSettings.feedbackAuthoring ne '1')))}">
                        <div class="form-group row">
                            <h:outputLabel for="questionMatchFeedbackCorrect_textinput" value="#{authorMessages.correct_match_feedback_opt}" styleClass="form-label" />
                            <div class="col-md-8">
                                <h:panelGrid>
                                    <samigo:wysiwyg identity="questionMatchFeedbackCorrect" rows="140" value="#{itemauthor.currentItem.currentMatchPair.corrMatchFeedback}" hasToggle="yes" mode="author" maxCharCount="60000">
                                        <f:validateLength maximum="60000" />
                                    </samigo:wysiwyg>
                                </h:panelGrid>
                            </div>
                        </div>
                        <div class="form-group row">
                            <h:outputLabel for="questionMatchFeedbackIncorrect_textinput" value="#{authorMessages.incorrect_match_feedback_opt}" styleClass="form-label" />
                            <div class="col-md-8">
                                <h:panelGrid>
                                    <samigo:wysiwyg identity="questionMatchFeedbackIncorrect" rows="140" value="#{itemauthor.currentItem.currentMatchPair.incorrMatchFeedback}" hasToggle="yes" mode="author" maxCharCount="60000">
                                        <f:validateLength maximum="60000" />
                                    </samigo:wysiwyg>
                                </h:panelGrid>
                            </div>
                        </div>
                    </h:panelGroup>

                    <div class="tier2">
                        <h:commandButton value="#{commonMessages.action_save_pair}" action="#{itemauthor.currentItem.addMatchPair}" onclick="SPNR.disableControlsAndSpin(this, null);"></h:commandButton>
                    </div>

                    <ui:include src="/jsf/author/item/timed.xhtml" />

                    <h:panelGroup styleClass="form-group row" layout="block" rendered="#{itemauthor.target == 'assessment' and not author.isEditPoolFlow}">
                        <h:outputLabel for="assignToPart" value="#{authorMessages.assign_to_p}" styleClass="col-md-4 col-lg-2 form-label" />
                        <div class="col-md-8">
                            <h:selectOneMenu id="assignToPart" value="#{itemauthor.currentItem.selectedSection}">
                                <f:selectItems value="#{itemauthor.sectionSelectList}" />
                            </h:selectOneMenu>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup styleClass="form-group row" layout="block" rendered="#{itemauthor.target == 'assessment' and author.isEditPendingAssessmentFlow}">
                        <h:outputLabel for="assignToPool" value="#{authorMessages.assign_to_question_p}" styleClass="col-md-4 col-lg-2 form-label" />
                        <div class="col-md-8">
                            <h:selectOneMenu id="assignToPool" value="#{itemauthor.currentItem.selectedPool}">
                                <f:selectItem itemValue="" itemLabel="#{authorMessages.select_a_pool_name}" />
                                <f:selectItems value="#{itemauthor.poolSelectList}" />
                            </h:selectOneMenu>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{itemauthor.target == 'questionpool' or (itemauthor.target != 'questionpool' and ((author.isEditPendingAssessmentFlow and assessmentSettings.feedbackAuthoring ne '2') or (!author.isEditPendingAssessmentFlow and publishedSettings.feedbackAuthoring ne '2')))}">
                        <div class="form-group row">
                            <h2>
                                <h:outputText value="#{authorMessages.correct_incorrect_an}" styleClass="col-md-12 form-label" />
                            </h2>
                        </div>
                        <div class="form-group row">
                            <h:outputLabel for="questionFeedbackCorrect_textinput" value="#{authorMessages.correct_answer_opti}" styleClass="form-label" />
                            <div class="col-md-8">
                                <h:panelGrid>
                                    <samigo:wysiwyg identity="questionFeedbackCorrect" rows="140" value="#{itemauthor.currentItem.corrFeedback}" hasToggle="yes" mode="author" maxCharCount="60000">
                                        <f:validateLength maximum="60000" />
                                    </samigo:wysiwyg>
                                </h:panelGrid>
                            </div>
                        </div>
                        <div class="form-group row">
                            <h:outputLabel for="questionFeedbackIncorrect_textinput" value="#{authorMessages.incorrect_answer_op}" styleClass="form-label" />
                            <div class="col-md-8">
                                <h:panelGrid>
                                    <samigo:wysiwyg identity="questionFeedbackIncorrect" rows="140" value="#{itemauthor.currentItem.incorrFeedback}" hasToggle="yes" mode="author" maxCharCount="60000">
                                        <f:validateLength maximum="60000" />
                                    </samigo:wysiwyg>
                                </h:panelGrid>
                            </div>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{itemauthor.showMetadata == 'true'}" styleClass="longtext">
                        <h:outputLabel value="Metadata" />
                        <div class="form-group row">
                            <h:outputLabel for="obj" value="#{authorMessages.objective}" styleClass="col-md-4 col-lg-2 form-label" />
                            <div class="col-md-5 col-lg-3">
                                <h:inputText size="30" id="obj" value="#{itemauthor.currentItem.objective}" styleClass="form-control" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <h:outputLabel for="keyword" value="#{authorMessages.keyword}" styleClass="col-md-4 col-lg-2 form-label" />
                            <div class="col-md-5 col-lg-3">
                                <h:inputText size="30" id="keyword" value="#{itemauthor.currentItem.keyword}" styleClass="form-control" />
                            </div>
                        </div>
                        <div class="form-group row">
                            <h:outputLabel for="rubric" value="#{authorMessages.rubric_colon}" styleClass="col-md-4 col-lg-2 form-label" />
                            <div class="col-md-5 col-lg-3">
                                <h:inputText size="30" id="rubric" value="#{itemauthor.currentItem.rubric}" styleClass="form-control" />
                            </div>
                        </div>
                    </h:panelGroup>

                    <ui:include src="/jsf/author/item/tags.xhtml" />

                    <p class="act">
                        <h:commandButton rendered="#{itemauthor.target == 'assessment'}" value="#{commonMessages.action_save}" action="#{itemauthor.currentItem.getOutcome}" styleClass="active">
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ItemAddListener" />
                        </h:commandButton>
                        <h:commandButton rendered="#{itemauthor.target == 'questionpool'}" value="#{commonMessages.action_save}" action="#{itemauthor.currentItem.getPoolOutcome}" styleClass="active">
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ItemAddListener" />
                        </h:commandButton>
                        <h:commandButton rendered="#{itemauthor.target == 'assessment'}" value="#{commonMessages.cancel_action}" action="editAssessment" immediate="true">
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ResetItemAttachmentListener" />
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.EditAssessmentListener" />
                        </h:commandButton>
                        <h:commandButton rendered="#{itemauthor.target == 'questionpool'}" value="#{commonMessages.cancel_action}" action="editPool" immediate="true">
                            <f:actionListener type="org.sakaiproject.tool.assessment.ui.listener.author.ResetItemAttachmentListener" />
                        </h:commandButton>
                    </p>
                </h:form>
            </div>

            <h:outputScript target="body">
                //<![CDATA[
                applyMenuListener('controllingSequence', 'feedbackContainer', 'noFeedbackMsg');
                //]]>
            </h:outputScript>
        </h:body>
    </f:view>

</ui:composition>
