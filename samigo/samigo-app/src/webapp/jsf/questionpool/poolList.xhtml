<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <f:view>
        <h:head>
            <ui:fragment rendered="#{not empty requestScope['html.head']}">
                <h:outputText value="#{requestScope['html.head']}" escape="false" />
            </ui:fragment>
            <title>
                <h:outputText value="#{questionPoolMessages.q_mgr}" />
            </title>
            <script>
                function flagFolders() {
                    collapseAllRows();
                }
                window.onload = flagFolders;
            </script>
        </h:head>
        <h:body
            onload="collapseAllRows();#{empty requestScope['html.body.onload'] ? '' : requestScope['html.body.onload']};disabledButton();">
            <h:panelGroup layout="block" styleClass="portletBody container-fluid">
                <h:form id="questionpool">

                    <h:panelGroup rendered="#{authorization.createAssessment or authorization.editAnyAssessment or authorization.editOwnAssessment or authorization.gradeAnyAssessment or authorization.gradeOwnAssessment or authorization.adminTemplate or authorization.adminQuestionPool or authorization.adminAssessment}"
                        layout="block">
                        <ul class="navIntraTool actionToolbar" role="menu">
                            <h:panelGroup rendered="#{authorization.createAssessment or authorization.editAnyAssessment or authorization.editOwnAssessment or authorization.gradeAnyAssessment or authorization.gradeOwnAssessment}">
                                <li role="menuitem">
                                    <span>
                                        <h:commandLink title="#{generalMessages.t_assessment}" action="author"
                                            id="authorlink" immediate="true">
                                            <h:outputText value="#{generalMessages.assessment}" />
                                            <f:actionListener
                                                type="org.sakaiproject.tool.assessment.ui.listener.author.AuthorActionListener" />
                                            <f:actionListener
                                                type="org.sakaiproject.tool.assessment.ui.listener.questionpool.CancelImportToAssessmentListener" />
                                            <f:actionListener
                                                type="org.sakaiproject.tool.assessment.ui.listener.evaluation.ResetResultsCalculatedListener" />
                                        </h:commandLink>
                                    </span>
                                </li>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{authorization.createAssessment}">
                                <li role="menuitem">
                                    <span>
                                        <h:commandLink title="#{generalMessages.add}" action="#{author.getOutcome}"
                                            immediate="true">
                                            <f:param name="action" value="create_assessment_title" />
                                            <f:actionListener
                                                type="org.sakaiproject.tool.assessment.ui.listener.author.AuthorAssessmentListener" />
                                            <h:outputText value="#{generalMessages.add}" />
                                        </h:commandLink>
                                    </span>
                                </li>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{authorization.adminTemplate and template.showAssessmentTypes}">
                                <li role="menuitem">
                                    <span>
                                        <h:commandLink title="#{generalMessages.t_template}" action="template"
                                            immediate="true">
                                            <f:actionListener
                                                type="org.sakaiproject.tool.assessment.ui.listener.author.TemplateListener" />
                                            <h:outputText value="#{generalMessages.template}" />
                                        </h:commandLink>
                                    </span>
                                </li>
                            </h:panelGroup>

                            <li role="menuitem">
                                <span class="current">
                                    <h:outputText value="#{questionPoolMessages.qps}" />
                                </span>
                            </li>

                            <li role="menuitem">
                                <span class="menuitem">
                                    <h:commandLink id="evnetLogLink" accesskey="#{generalMessages.a_log}"
                                        title="#{generalMessages.t_eventLog}" action="eventLog" immediate="true"
                                        rendered="#{authorization.adminQuestionPool}">
                                        <h:outputText value="#{generalMessages.eventLog}" />
                                    </h:commandLink>
                                </span>
                            </li>

                            <li role="menuitem">
                                <span class="menuitem">
                                    <h:commandLink id="sectionActivity"
                                        accesskey="#{generalMessages.a_section_activity}"
                                    title="#{generalMessages.section_activity}" action="sectionActivity"
                                        immediate="true" rendered="#{authorization.adminQuestionPool}">
                                        <h:outputText value="#{generalMessages.section_activity}" />
                                    </h:commandLink>
                                </span>
                            </li>

                            <h:panelGroup rendered="#{authorization.adminAssessment}">
                                <li role="menuitem">
                                    <span class="menuitem">
                                        <h:commandLink id="restoreAssessments"
                                            accesskey="#{generalMessages.a_restore_assessments}"
                                            title="#{generalMessages.t_restore_assessments}" action="restoreAssessments"
                                            immediate="true">
                                            <h:outputText value="#{generalMessages.restore_assessments}" />
                                        </h:commandLink>
                                    </span>
                                </li>
                            </h:panelGroup>
                        </ul>
                    </h:panelGroup>

                    <h:panelGroup layout="block" styleClass="page-header">
                        <h1>
                            <h:outputText value="#{generalMessages.questionPool}" />
                        </h1>
                    </h:panelGroup>

                    <h:outputText rendered="#{questionpool.importToAuthoring}"
                        value="#{questionPoolMessages.msg_imp_poolmanager}" />

                    <ui:fragment rendered="#{!questionpool.importToAuthoring and authorization.createQuestionPool}">
                        <p class="navViewAction">
                            <h:commandLink title="#{questionPoolMessages.t_addPool}" id="add" immediate="true"
                                action="#{questionpool.addPool}">
                                <h:outputText value="#{questionPoolMessages.add_new_pool}" />
                                <f:param name="qpid" value="0" />
                                <f:param name="outCome" value="poolList" />
                            </h:commandLink>

                            <h:outputText value=" #{generalMessages.separator} " />
                            <h:outputText value="&#160;" escape="false" />

                            <h:commandLink title="#{questionPoolMessages.t_importPool}" id="import" immediate="true"
                                action="importPool">
                                <h:outputText value="#{questionPoolMessages.t_importPool}" />
                                <f:param name="qpid" value="0" />
                                <f:param name="outCome" value="poolList" />
                            </h:commandLink>

                            <h:outputText value=" #{generalMessages.separator} " />
                            <h:outputText value="&#160;" escape="false" />

                            <h:commandLink title="#{questionPoolMessages.t_transferPool}" id="transfer"
                                immediate="true" action="#{questionpool.transferPool}">
                                <h:outputText value="#{questionPoolMessages.transfer_pool_ownership}" />
                                <f:param name="qpid" value="0" />
                                <f:param name="outCome" value="poolList" />
                            </h:commandLink>
                        </p>
                    </ui:fragment>

                    <h:messages styleClass="sak-banner-error" rendered="#{facesContext.maximumSeverity ne null}"
                        layout="table" />

                    <ui:include src="/jsf/questionpool/poolTreeTable.xhtml" />

                    <h:panelGroup layout="block" styleClass="act">
                        <h:commandButton rendered="#{questionpool.importToAuthoring eq false and authorization.deleteOwnQuestionPool}"
                            type="submit" immediate="true" id="Submit" value="#{questionPoolMessages.delete}"
                            action="#{questionpool.startRemovePool}" styleClass="d-none" />

                        <h:commandButton rendered="#{questionpool.importToAuthoring}"
                            type="submit" immediate="true" id="cancel" value="#{commonMessages.cancel_action}"
                            action="#{questionpool.cancelImport}" />
                    </h:panelGroup>
                </h:form>
            </h:panelGroup>
        </h:body>
    </f:view>
</ui:composition>
