<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <f:view>
        <h:head>
            <ui:fragment rendered="#{not empty requestScope['html.head']}">
                <h:outputText value="#{requestScope['html.head']}" escape="false" />
            </ui:fragment>
            <title>
                <h:outputText value="#{questionPoolMessages.q_mgr}" />
            </title>
            <script src="/samigo-app/js/samigotree.js"></script>
            <script src="/library/js/spinner.js"></script>
            <script>
                function flagFolders() {
                    collapseAllRows();
                }
                function initPage() {
                    const submitButton = document.getElementById("questionpoolshare:Submit");
                    if (submitButton) {
                        submitButton.disabled = true;
                    }
                    flagFolders();
                }
                function checkUpdate() {
                    updateButtonStatusOnCheck(
                        document.getElementById("questionpoolshare:Submit"),
                        document.getElementById("questionpoolshare")
                    );
                }
                window.addEventListener("load", initPage);
            </script>
        </h:head>

        <h:body
            onload="collapseAllRows();disabledButton();#{empty requestScope['html.body.onload'] ? '' : requestScope['html.body.onload']};">
            <div class="portletBody container-fluid">
                <h:form id="questionpoolshare">
                    <ui:include src="/jsf/questionpool/questionpoolHeadings.xhtml" />
                    <br />

                    <h3>
                        <h:outputText value="#{questionPoolMessages.share_pool}" />
                    </h3>

                    <h:messages styleClass="sak-banner-error"
                        rendered="#{facesContext.maximumSeverity ne null}" layout="table" />

                    <div class="tier1">
                        <h4>
                            <h:outputText
                                value="#{questionPoolMessages.members_with_access} &quot;#{questionpoolshare.questionPoolName}&quot; " />
                        </h4>
                    </div>

                    <div class="tier2">
                        <h:dataTable cellpadding="0" cellspacing="0" id="withAccessTable"
                            value="#{questionpoolshare.agentsWithAccess}" var="agent"
                            styleClass="listHier table table-striped table-bordered">

                            <h:column id="col1">
                                <f:facet name="header">
                                    <h:panelGroup>
                                        <h:commandLink title="#{questionPoolMessages.alt_sortName}"
                                            id="sortByDisplayName" immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWith ne 'displayName'}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <f:param name="orderBy" value="displayName" />
                                            <f:param name="ascending" value="true" />
                                            <f:param name="list" value="agentsWithAccess" />
                                            <h:outputText value="#{questionPoolMessages.name}" />
                                        </h:commandLink>

                                        <h:commandLink title="#{questionPoolMessages.alt_sortName}"
                                            immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWith eq 'displayName' and questionpoolshare.sortAscendingWith}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <h:outputText value="#{questionPoolMessages.name}"
                                                styleClass="currentSort" />
                                            <f:param name="orderBy" value="displayName" />
                                            <f:param name="ascending" value="false" />
                                            <f:param name="list" value="agentsWithAccess" />
                                            <h:graphicImage
                                                alt="#{questionPoolMessages.alt_sortNameDescending}"
                                                rendered="#{questionpoolshare.sortAscendingWith}"
                                                url="/images/sortascending.gif" />
                                        </h:commandLink>

                                        <h:commandLink title="#{questionPoolMessages.alt_sortName}"
                                            immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWith eq 'displayName' and !questionpoolshare.sortAscendingWith}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <h:outputText value="#{questionPoolMessages.name}"
                                                styleClass="currentSort" />
                                            <f:param name="orderBy" value="displayName" />
                                            <f:param name="ascending" value="true" />
                                            <f:param name="list" value="agentsWithAccess" />
                                            <h:graphicImage
                                                alt="#{questionPoolMessages.alt_sortNameAscending}"
                                                rendered="#{!questionpoolshare.sortAscendingWith}"
                                                url="/images/sortdescending.gif" />
                                        </h:commandLink>
                                    </h:panelGroup>
                                </f:facet>

                                <h:panelGroup id="firstcolumn">
                                    <h:outputText value="#{agent.agentDisplayName}" />
                                </h:panelGroup>
                            </h:column>

                            <h:column id="col2">
                                <f:facet name="header">
                                    <h:panelGroup>
                                        <h:commandLink title="#{questionPoolMessages.alt_sortRole}"
                                            id="sortByRole" immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWith ne 'role'}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <f:param name="orderBy" value="role" />
                                            <f:param name="ascending" value="true" />
                                            <f:param name="list" value="agentsWithAccess" />
                                            <h:outputText value="#{questionPoolMessages.role}" />
                                        </h:commandLink>

                                        <h:commandLink title="#{questionPoolMessages.alt_sortRole}"
                                            immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWith eq 'role' and questionpoolshare.sortAscendingWith}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <h:outputText value="#{questionPoolMessages.role}"
                                                styleClass="currentSort" />
                                            <f:param name="orderBy" value="role" />
                                            <f:param name="ascending" value="false" />
                                            <f:param name="list" value="agentsWithAccess" />
                                            <h:graphicImage
                                                alt="#{questionPoolMessages.alt_sortRoleDescending}"
                                                rendered="#{questionpoolshare.sortAscendingWith}"
                                                url="/images/sortascending.gif" />
                                        </h:commandLink>

                                        <h:commandLink title="#{questionPoolMessages.alt_sortRole}"
                                            immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWith eq 'role' and !questionpoolshare.sortAscendingWith}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <h:outputText value="#{questionPoolMessages.role}"
                                                styleClass="currentSort" />
                                            <f:param name="orderBy" value="role" />
                                            <f:param name="ascending" value="true" />
                                            <f:param name="list" value="agentsWithAccess" />
                                            <h:graphicImage
                                                alt="#{questionPoolMessages.alt_sortRoleAscending}"
                                                rendered="#{!questionpoolshare.sortAscendingWith}"
                                                url="/images/sortdescending.gif" />
                                        </h:commandLink>
                                    </h:panelGroup>
                                </f:facet>

                                <h:panelGroup id="secondcolumn">
                                    <h:outputText value="#{agent.role}" />
                                </h:panelGroup>
                            </h:column>

                            <h:column id="col3">
                                <f:facet name="header">
                                    <h:panelGroup>
                                        <h:outputText value="#{questionPoolMessages.access} " />
                                        <h:outputLink
                                            title="#{assessmentSettingsMessages.whats_this_link}"
                                            value="#"
                                            onclick="javascript:window.open('/samigo-app/jsf/questionpool/accesstype_whatsThis.xhtml','AccessType_WhatsThis','width=800,height=660,scrollbars=yes,resizable=yes');"
                                            onkeypress="javascript:window.open('/samigo-app/jsf/questionpool/accesstype_whatsThis.xhtml','AccessType_WhatsThis','width=800,height=660,scrollbars=yes,resizable=yes');">
                                            <h:outputText
                                                value=" (#{assessmentSettingsMessages.whats_this_link})" />
                                        </h:outputLink>
                                    </h:panelGroup>
                                </f:facet>

                                <h:panelGroup id="thirdcolumn">
                                    <h:outputText value="#{agent.accessTypeId}">
                                        <f:converter
                                            converterId="org.sakaiproject.tool.assessment.jsf.convert.AccessTypeConverter" />
                                    </h:outputText>
                                </h:panelGroup>
                            </h:column>

                            <h:column id="col4">
                                <f:facet name="header">
                                    <h:outputText value="#{questionPoolMessages.revoke_access}" />
                                </f:facet>
                                <h:selectManyCheckbox id="revokeCheckbox"
                                    value="#{questionpoolshare.destPools}" onclick="checkUpdate();"
                                    onkeypress="checkUpdate();">
                                    <f:selectItem itemValue="#{agent.agentId}"
                                        itemDisabled="#{agent.agentId eq questionpoolshare.questionPoolOwnerId}"
                                        itemLabel="" />
                                </h:selectManyCheckbox>
                            </h:column>
                        </h:dataTable>
                    </div>

                    <br />

                    <div class="tier1">
                        <h4>
                            <h:outputText
                                value="#{questionPoolMessages.members_without_access} &quot;#{questionpoolshare.questionPoolName}&quot; " />
                        </h4>
                    </div>

                    <div class="tier2">
                        <h:dataTable cellpadding="0" cellspacing="0" id="withoutAccessTable"
                            value="#{questionpoolshare.agentsWithoutAccess}"
                            binding="#{questionpoolshare.dataTable}" var="agent"
                            styleClass="listHier table table-striped table-bordered">

                            <h:column id="col1">
                                <f:facet name="header">
                                    <h:panelGroup>
                                        <h:commandLink title="#{questionPoolMessages.alt_sortName}"
                                            id="sortByDisplayNameWithout" immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWithout ne 'displayName'}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <f:param name="orderBy" value="displayName" />
                                            <f:param name="ascending" value="true" />
                                            <f:param name="list" value="agentsWithoutAccess" />
                                            <h:outputText value="#{questionPoolMessages.name}" />
                                        </h:commandLink>

                                        <h:commandLink title="#{questionPoolMessages.alt_sortName}"
                                            immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWithout eq 'displayName' and questionpoolshare.sortAscendingWithout}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <h:outputText value="#{questionPoolMessages.name}"
                                                styleClass="currentSort" />
                                            <f:param name="orderBy" value="displayName" />
                                            <f:param name="ascending" value="false" />
                                            <f:param name="list" value="agentsWithoutAccess" />
                                            <h:graphicImage
                                                alt="#{questionPoolMessages.alt_sortNameDescending}"
                                                rendered="#{questionpoolshare.sortAscendingWithout}"
                                                url="/images/sortascending.gif" />
                                        </h:commandLink>

                                        <h:commandLink title="#{questionPoolMessages.alt_sortName}"
                                            immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWithout eq 'displayName' and !questionpoolshare.sortAscendingWithout}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <h:outputText value="#{questionPoolMessages.name}"
                                                styleClass="currentSort" />
                                            <f:param name="orderBy" value="displayName" />
                                            <f:param name="ascending" value="true" />
                                            <f:param name="list" value="agentsWithoutAccess" />
                                            <h:graphicImage
                                                alt="#{questionPoolMessages.alt_sortNameAscending}"
                                                rendered="#{!questionpoolshare.sortAscendingWithout}"
                                                url="/images/sortdescending.gif" />
                                        </h:commandLink>
                                    </h:panelGroup>
                                </f:facet>

                                <h:panelGroup id="firstcolumnWithout">
                                    <h:outputText value="#{agent.agentDisplayName}" />
                                </h:panelGroup>
                            </h:column>

                            <h:column id="col2">
                                <f:facet name="header">
                                    <h:panelGroup>
                                        <h:commandLink title="#{questionPoolMessages.alt_sortRole}"
                                            id="sortByRoleWithout" immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWithout ne 'role'}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <f:param name="orderBy" value="role" />
                                            <f:param name="ascending" value="true" />
                                            <f:param name="list" value="agentsWithoutAccess" />
                                            <h:outputText value="#{questionPoolMessages.role}" />
                                        </h:commandLink>

                                        <h:commandLink title="#{questionPoolMessages.alt_sortRole}"
                                            immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWithout eq 'role' and questionpoolshare.sortAscendingWithout}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <h:outputText value="#{questionPoolMessages.role}"
                                                styleClass="currentSort" />
                                            <f:param name="orderBy" value="role" />
                                            <f:param name="ascending" value="false" />
                                            <f:param name="list" value="agentsWithoutAccess" />
                                            <h:graphicImage
                                                alt="#{questionPoolMessages.alt_sortRoleDescending}"
                                                rendered="#{questionpoolshare.sortAscendingWithout}"
                                                url="/images/sortascending.gif" />
                                        </h:commandLink>

                                        <h:commandLink title="#{questionPoolMessages.alt_sortRole}"
                                            immediate="true"
                                            rendered="#{questionpoolshare.sortPropertyWithout eq 'role' and !questionpoolshare.sortAscendingWithout}"
                                            action="#{questionpoolshare.sortByColumnHeader}">
                                            <h:outputText value="#{questionPoolMessages.role}"
                                                styleClass="currentSort" />
                                            <f:param name="orderBy" value="role" />
                                            <f:param name="ascending" value="true" />
                                            <f:param name="list" value="agentsWithoutAccess" />
                                            <h:graphicImage
                                                alt="#{questionPoolMessages.alt_sortRoleAscending}"
                                                rendered="#{!questionpoolshare.sortAscendingWithout}"
                                                url="/images/sortdescending.gif" />
                                        </h:commandLink>
                                    </h:panelGroup>
                                </f:facet>

                                <h:panelGroup id="secondcolumnWithout">
                                    <h:outputText value="#{agent.role}" />
                                </h:panelGroup>
                            </h:column>

                            <h:column id="col3">
                                <f:facet name="header">
                                    <h:panelGroup>
                                        <h:outputText value="#{questionPoolMessages.access} " />
                                        <h:outputLink
                                            title="#{assessmentSettingsMessages.whats_this_link}"
                                            value="#"
                                            onclick="javascript:window.open('/samigo-app/jsf/questionpool/accesstype_whatsThis.xhtml','AccessType_WhatsThis','width=800,height=660,scrollbars=yes,resizable=yes');"
                                            onkeypress="javascript:window.open('/samigo-app/jsf/questionpool/accesstype_whatsThis.xhtml','AccessType_WhatsThis','width=800,height=660,scrollbars=yes,resizable=yes');">
                                            <h:outputText
                                                value=" (#{assessmentSettingsMessages.whats_this_link})" />
                                        </h:outputLink>
                                    </h:panelGroup>
                                </f:facet>

                                <h:panelGroup id="thirdcolumnWithout">
                                    <h:selectOneMenu value="#{agent.accessTypeId}" immediate="true"
                                        onchange="form.submit();"
                                        valueChangeListener="#{questionpoolshare.changeAccessTypeSelect}">
                                        <f:selectItems value="#{questionpoolshare.accessTypes}" />
                                    </h:selectOneMenu>
                                </h:panelGroup>
                            </h:column>

                            <h:column id="col4">
                                <f:facet name="header">
                                    <h:outputText value="#{questionPoolMessages.grant_access}" />
                                </f:facet>
                                <h:selectManyCheckbox id="grantCheckbox"
                                    value="#{questionpoolshare.destPools}" onclick="checkUpdate();"
                                    onkeypress="checkUpdate();">
                                    <f:selectItem itemValue="#{agent.agentId}" itemLabel="" />
                                </h:selectManyCheckbox>
                            </h:column>
                        </h:dataTable>
                    </div>

                    <p class="act">
                        <h:commandButton type="submit" immediate="true" id="Submit"
                            value="#{questionPoolMessages.t_updateSharedPoolAccess}"
                            action="#{questionpoolshare.sharePool}"
                            onclick="SPNR.disableControlsAndSpin(this, null);" styleClass="active" />

                        <h:commandButton type="submit" immediate="true" id="cancel"
                            value="#{commonMessages.cancel_action}" action="poolList"
                            onclick="SPNR.disableControlsAndSpin(this, null);" />
                    </p>
                </h:form>
            </div>
        </h:body>
    </f:view>
</ui:composition>
