<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <f:view>
        <h:head>
            <ui:fragment rendered="#{not empty requestScope['html.head']}">
                <h:outputText value="#{requestScope['html.head']}" escape="false" />
            </ui:fragment>
            <title>
                <h:outputText value="#{sectionActivityMessages.section_activity_report}" />
            </title>
            <script src="/samigo-app/js/eventInfo.js"></script>
        </h:head>

        <h:body onload="#{empty requestScope['html.body.onload'] ? '' : requestScope['html.body.onload']}">
            <div class="portletBody container-fluid">
                <h:form id="sectionActivityId">
                    <h:messages infoClass="validation" warnClass="validation"
                        errorClass="validation" fatalClass="validation" />

                    <ui:include src="/jsf/section-activity/sectionActivityHeadings.xhtml" />

                    <div class="page-header">
                        <h1>
                            <h:outputText value="#{sectionActivityMessages.section_activity_report_colon}" />
                            <small>
                                <h:outputText value="#{sectionActivity.selectedUserDisplayName}" />
                            </small>
                        </h1>
                    </div>

                    <h:panelGroup layout="block" styleClass="form-group">
                        <h:outputLabel for="studentName"
                            value="#{sectionActivityMessages.view_student}" />
                        <h:outputText value="&#160;" escape="false" />
                        <h:selectOneMenu id="studentName" value="#{sectionActivity.selectedUser}"
                            required="true" onchange="document.forms[0].submit();"
                            styleClass="form-select form-select-sm">
                            <f:selectItems value="#{sectionActivity.displayNamesList}" />
                            <f:valueChangeListener
                                type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                        </h:selectOneMenu>
                    </h:panelGroup>

                    <br />

                    <div class="tier1 table-responsive">
                        <h:dataTable styleClass="table table-striped"
                            value="#{sectionActivity.sectionActivityDataList}" var="pageData">

                            <h:column rendered="#{sectionActivity.sortType ne 'assessmentName'}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_sortTitle}"
                                        id="title" action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.assessment_name}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                        <f:param name="sortBy" value="assessmentName" />
                                        <f:param name="sortAscending" value="true" />
                                    </h:commandLink>
                                </f:facet>

                                <h:panelGroup rendered="#{!pageData.anonymousGrading}">
                                    <h:commandLink title="#{sectionActivityMessages.assessment_name}"
                                        action="studentScores" immediate="true">
                                        <h:outputText value="#{pageData.assessmentName}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.ResetTotalScoreListener" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.TotalScoreListener" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.StudentScoreListener" />
                                        <f:param name="publishedId" value="#{pageData.assessmentId}" />
                                        <f:param name="studentid" value="#{sectionActivity.selectedUser}" />
                                        <f:param name="publishedIdd" value="#{pageData.assessmentId}" />
                                        <f:param name="gradingData"
                                            value="#{pageData.assessmentGradingId}" />
                                    </h:commandLink>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{pageData.anonymousGrading}">
                                    <h:outputText value="#{pageData.assessmentName}" />
                                    <h:panelGroup styleClass="info">
                                        <h:graphicImage url="/images/info_icon.gif" alt=""
                                            styleClass="infoDiv" />
                                        <h:panelGroup styleClass="makeLogInfo"
                                            style="display:none;z-index:2000;" layout="block">
                                            <h:outputText value="#{sectionActivityMessages.anon_grading_info}" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </h:panelGroup>
                            </h:column>

                            <h:column
                                rendered="#{sectionActivity.sortType eq 'assessmentName' and sectionActivity.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_sortTitle}"
                                        action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.assessment_name}" />
                                        <f:param name="sortAscending" value="false" />
                                        <h:graphicImage
                                            alt="#{sectionActivityMessages.alt_sortTitleAscending}"
                                            rendered="#{sectionActivity.sortAscending}"
                                            url="/images/sortascending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                    </h:commandLink>
                                </f:facet>

                                <h:panelGroup rendered="#{!pageData.anonymousGrading}">
                                    <h:commandLink title="#{sectionActivityMessages.assessment_name}"
                                        action="studentScores" immediate="true">
                                        <h:outputText value="#{pageData.assessmentName}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.ResetTotalScoreListener" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.TotalScoreListener" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.StudentScoreListener" />
                                        <f:param name="publishedId" value="#{pageData.assessmentId}" />
                                        <f:param name="studentid" value="#{sectionActivity.selectedUser}" />
                                        <f:param name="publishedIdd" value="#{pageData.assessmentId}" />
                                        <f:param name="gradingData"
                                            value="#{pageData.assessmentGradingId}" />
                                    </h:commandLink>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{pageData.anonymousGrading}">
                                    <h:outputText value="#{pageData.assessmentName}" />
                                    <h:panelGroup styleClass="info">
                                        <h:graphicImage url="/images/info_icon.gif" alt=""
                                            styleClass="infoDiv" />
                                        <h:panelGroup styleClass="makeLogInfo"
                                            style="display:none;z-index:2000;" layout="block">
                                            <h:outputText value="#{sectionActivityMessages.anon_grading_info}" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </h:panelGroup>
                            </h:column>

                            <h:column
                                rendered="#{sectionActivity.sortType eq 'assessmentName' and !sectionActivity.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_sortTitle}"
                                        action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.assessment_name}" />
                                        <f:param name="sortAscending" value="true" />
                                        <h:graphicImage
                                            alt="#{sectionActivityMessages.alt_sortTitleDescending}"
                                            rendered="#{!sectionActivity.sortAscending}"
                                            url="/images/sortdescending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                    </h:commandLink>
                                </f:facet>

                                <h:panelGroup rendered="#{!pageData.anonymousGrading}">
                                    <h:commandLink title="#{sectionActivityMessages.assessment_name}"
                                        action="studentScores" immediate="true">
                                        <h:outputText value="#{pageData.assessmentName}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.ResetTotalScoreListener" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.TotalScoreListener" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.evaluation.StudentScoreListener" />
                                        <f:param name="publishedId" value="#{pageData.assessmentId}" />
                                        <f:param name="studentid" value="#{sectionActivity.selectedUser}" />
                                        <f:param name="publishedIdd" value="#{pageData.assessmentId}" />
                                        <f:param name="gradingData"
                                            value="#{pageData.assessmentGradingId}" />
                                    </h:commandLink>
                                </h:panelGroup>

                                <h:panelGroup rendered="#{pageData.anonymousGrading}">
                                    <h:outputText value="#{pageData.assessmentName}" />
                                    <h:panelGroup styleClass="info">
                                        <h:graphicImage url="/images/info_icon.gif" alt=""
                                            styleClass="infoDiv" />
                                        <h:panelGroup styleClass="makeLogInfo"
                                            style="display:none;z-index:2000;" layout="block">
                                            <h:outputText value="#{sectionActivityMessages.anon_grading_info}" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </h:panelGroup>
                            </h:column>

                            <h:column rendered="#{sectionActivity.sortType ne 'assessmentId'}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_sortAssessmentId}"
                                        id="assessmentId" action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.assessment_id}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                        <f:param name="sortBy" value="assessmentId" />
                                        <f:param name="sortAscending" value="true" />
                                    </h:commandLink>
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{pageData.assessmentId}" />
                                </h:panelGroup>
                            </h:column>

                            <h:column
                                rendered="#{sectionActivity.sortType eq 'assessmentId' and sectionActivity.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_sortAssessmentId}"
                                        action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.assessment_id}" />
                                        <f:param name="sortAscending" value="false" />
                                        <h:graphicImage
                                            alt="#{sectionActivityMessages.alt_sortAssessmentIdAscending}"
                                            rendered="#{sectionActivity.sortAscending}"
                                            url="/images/sortascending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{pageData.assessmentId}" />
                                </h:panelGroup>
                            </h:column>

                            <h:column
                                rendered="#{sectionActivity.sortType eq 'assessmentId' and !sectionActivity.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_sortAssessmentId}"
                                        action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.assessment_id}" />
                                        <f:param name="sortAscending" value="true" />
                                        <h:graphicImage
                                            alt="#{sectionActivityMessages.alt_sortAssessmentIdDescending}"
                                            rendered="#{!sectionActivity.sortAscending}"
                                            url="/images/sortdescending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{pageData.assessmentId}" />
                                </h:panelGroup>
                            </h:column>

                            <h:column rendered="#{sectionActivity.sortType ne 'submitDate'}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_submitDate}"
                                        id="submitDate" action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.date_completed}" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                        <f:param name="sortBy" value="submitDate" />
                                        <f:param name="sortAscending" value="true" />
                                    </h:commandLink>
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{pageData.submitDate}">
                                        <f:convertDateTime dateStyle="medium" timeStyle="short"
                                            timeZone="#{author.userTimeZone}" />
                                    </h:outputText>
                                </h:panelGroup>
                            </h:column>

                            <h:column
                                rendered="#{sectionActivity.sortType eq 'submitDate' and sectionActivity.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_submitDate}"
                                        action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.date_completed}" />
                                        <f:param name="sortAscending" value="false" />
                                        <h:graphicImage
                                            alt="#{sectionActivityMessages.alt_sortSubmitDateAscending}"
                                            rendered="#{sectionActivity.sortAscending}"
                                            url="/images/sortascending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{pageData.submitDate}">
                                        <f:convertDateTime dateStyle="medium" timeStyle="short"
                                            timeZone="#{author.userTimeZone}" />
                                    </h:outputText>
                                </h:panelGroup>
                            </h:column>

                            <h:column
                                rendered="#{sectionActivity.sortType eq 'submitDate' and !sectionActivity.sortAscending}">
                                <f:facet name="header">
                                    <h:commandLink title="#{sectionActivityMessages.t_submitDate}"
                                        action="sectionActivity">
                                        <h:outputText value="#{sectionActivityMessages.date_completed}" />
                                        <f:param name="sortAscending" value="true" />
                                        <h:graphicImage
                                            alt="#{sectionActivityMessages.alt_sortSubmitDateDescending}"
                                            rendered="#{!sectionActivity.sortAscending}"
                                            url="/images/sortdescending.gif" />
                                        <f:actionListener
                                            type="org.sakaiproject.tool.assessment.ui.listener.author.SectionActivityListener" />
                                    </h:commandLink>
                                </f:facet>
                                <h:panelGroup>
                                    <h:outputText value="#{pageData.submitDate}">
                                        <f:convertDateTime dateStyle="medium" timeStyle="short"
                                            timeZone="#{author.userTimeZone}" />
                                    </h:outputText>
                                </h:panelGroup>
                            </h:column>

                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="#{sectionActivityMessages.percent_correct}" />
                                </f:facet>
                                <h:panelGroup rendered="#{!pageData.notAvailableGrade}">
                                    <h:outputText value="#{pageData.roundedPercentage}" />
                                    <h:outputText value="%" />
                                </h:panelGroup>
                                <h:panelGroup rendered="#{pageData.notAvailableGrade}">
                                    <h:outputText value="#{sectionActivityMessages.not_available}" />
                                </h:panelGroup>
                            </h:column>

                            <h:column>
                                <f:facet name="header">
                                    <h:outputText value="#{sectionActivityMessages.correct_possible}" />
                                </f:facet>
                                <h:panelGroup rendered="#{!pageData.notAvailableGrade}">
                                    <h:outputText value="#{pageData.roundedFinalScore}" />
                                    <h:outputText value="/" />
                                    <h:outputText value="#{pageData.roundedMaxScore}" />
                                </h:panelGroup>
                                <h:panelGroup rendered="#{pageData.notAvailableGrade}">
                                    <h:outputText value="#{sectionActivityMessages.not_available}" />
                                </h:panelGroup>
                            </h:column>
                        </h:dataTable>
                    </div>
                </h:form>
            </div>
        </h:body>
    </f:view>

</ui:composition>
