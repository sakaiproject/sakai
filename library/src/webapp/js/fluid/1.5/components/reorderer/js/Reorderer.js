var fluid_1_5=fluid_1_5||{};!function($,fluid){"use strict";fluid.reorderer=fluid.registerNamespace("fluid.reorderer"),fluid.reorderer.defaultAvatarCreator=function(item,cssClass,dropWarning){fluid.dom.cleanseScripts(fluid.unwrap(item));var avatar=$(item).clone();if(fluid.dom.iterateDom(avatar.get(0),function(node){node.removeAttribute("id"),"input"===node.tagName.toLowerCase()&&node.setAttribute("disabled","disabled")}),avatar.removeProp("id"),avatar.removeClass("ui-droppable"),avatar.addClass(cssClass),dropWarning){var avatarContainer=$(document.createElement("div"));avatarContainer.append(avatar),avatarContainer.append(dropWarning),avatar=avatarContainer}return $("body").append(avatar),$.browser.safari||avatar.css("display","block").width(item.offsetWidth).height(item.offsetHeight),$.browser.opera&&avatar.hide(),avatar},fluid.reorderer.bindHandlersToContainer=function(container,keyDownHandler,keyUpHandler){var actualKeyDown=keyDownHandler,advancedPrevention=!1;$.browser.opera&&(container.keypress(function(evt){return advancedPrevention?(advancedPrevention=!1,evt.preventDefault(),!1):void 0}),actualKeyDown=function(evt){var oldret=keyDownHandler(evt);oldret===!1&&(advancedPrevention=!0)}),container.keydown(actualKeyDown),container.keyup(keyUpHandler)},fluid.reorderer.addRolesToContainer=function(that){that.container.attr("role",that.options.containerRole.container),that.container.attr("aria-multiselectable","false"),that.container.attr("aria-readonly","false"),that.container.attr("aria-disabled","false")},fluid.reorderer.createAvatarId=function(parentId){return parentId+"_avatar"},fluid.reorderer.keys={TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,META:19,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,i:73,j:74,k:75,m:77},fluid.reorderer.defaultKeysets=[{modifier:function(evt){return evt.ctrlKey},up:fluid.reorderer.keys.UP,down:fluid.reorderer.keys.DOWN,right:fluid.reorderer.keys.RIGHT,left:fluid.reorderer.keys.LEFT},{modifier:function(evt){return evt.ctrlKey},up:fluid.reorderer.keys.i,down:fluid.reorderer.keys.m,right:fluid.reorderer.keys.k,left:fluid.reorderer.keys.j}],fluid.defaults("fluid.reorderer",{gradeNames:["fluid.viewComponent","autoInit"],styles:{defaultStyle:"fl-reorderer-movable-default",selected:"fl-reorderer-movable-selected",dragging:"fl-reorderer-movable-dragging",mouseDrag:"fl-reorderer-movable-dragging",hover:"fl-reorderer-movable-hover",dropMarker:"fl-reorderer-dropMarker",avatar:"fl-reorderer-avatar"},selectors:{dropWarning:".flc-reorderer-dropWarning",movables:".flc-reorderer-movable",selectables:".flc-reorderer-movable",dropTargets:".flc-reorderer-movable",grabHandle:"",stylisticOffset:""},avatarCreator:fluid.reorderer.defaultAvatarCreator,keysets:fluid.reorderer.defaultKeysets,containerRole:"{that}.layoutHandler.options.containerRole",selectablesTabindex:"{that}.layoutHandler.options.selectablesTabindex",layoutHandler:"fluid.listLayoutHandler",members:{activeItem:null,kbDropWarning:"{that}.dom.dropWarning"},events:{onShowKeyboardDropWarning:null,onSelect:null,onBeginMove:"preventable",onMove:null,afterMove:null,onHover:null,onRefresh:null},listeners:{onCreate:[{funcName:"fluid.reorderer.bindHandlersToContainer",args:["{that}.container","{that}.handleKeyDown","{that}.handleKeyUp"]},{funcName:"fluid.reorderer.addRolesToContainer",args:"{that}"},{funcName:"fluid.tabbable",args:"{that}.container"},{funcName:"fluid.reorderer.processAfterMoveCallbackUrl",args:"{that}"},"{that}.refresh"],onRefresh:{listener:"fluid.reorderer.initItems",args:"{that}",priority:-1e3},onHover:{funcName:"fluid.reorderer.hoverStyleHandler",args:["{that}.dom","{that}.options.styles","{arguments}.0","{arguments}.1"]}},invokers:{changeSelectedToDefault:{funcName:"fluid.reorderer.changeSelectedToDefault",args:["{arguments}.0","{that}.options.styles"]},setDropEffects:{funcName:"fluid.reorderer.setDropEffects",args:["{that}.dom","{arguments}.0"]},createDropMarker:{funcName:"fluid.reorderer.createDropMarker",args:["{arguments}.0","{that}.options.styles.dropMarker"]},refresh:{funcName:"fluid.reorderer.refresh",args:["{that}.dom","{that}.events","{that}.selectableContext","{that}.activeItem"],dynamic:!0},selectItem:{funcName:"fluid.reorderer.selectItem",args:["{that}","{arguments}.0"]},initSelectables:{funcName:"fluid.reorderer.initSelectables",args:["{that}"]},initMovable:{funcName:"fluid.reorderer.initMovable",args:["{that}","{that}.dropManager","{arguments}.0"]},isMove:{funcName:"fluid.reorderer.isMove",args:["{that}.options.keysets","{arguments}.0"]},isActiveItemMovable:{funcName:"fluid.reorderer.isActiveItemMovable",args:["{that}.activeItem","{that}.dom"],dynamic:!0},handleKeyDown:{funcName:"fluid.reorderer.handleKeyDown",args:["{that}","{that}.options.styles","{arguments}.0"]},handleDirectionKeyDown:{funcName:"fluid.reorderer.handleDirectionKeyDown",args:["{that}","{arguments}.0"]},handleKeyUp:{funcName:"fluid.reorderer.handleKeyUp",args:["{that}","{that}.options.styles","{arguments}.0"]},requestMovement:{funcName:"fluid.reorderer.requestMovement",args:["{that}","{arguments}.0","{arguments}.1"]}},mergePolicy:{keysets:"replace","selectors.labelSource":"selectors.grabHandle","selectors.selectables":"selectors.movables","selectors.dropTargets":"selectors.movables"},components:{layoutHandler:{type:"{that}.options.layoutHandler",container:"{reorderer}.container"},dropManager:{type:"fluid.dropManager"},labeller:{type:"fluid.reorderer.labeller",options:{members:{dom:"{reorderer}.dom"},getGeometricInfo:"{reorderer}.layoutHandler.getGeometricInfo",orientation:"{reorderer}.layoutHandler.options.orientation",layoutType:"{reorderer}.options.layoutHandler"}}},disableWrap:!1}),fluid.reorderer.noModifier=function(evt){return!(evt.ctrlKey||evt.altKey||evt.shiftKey||evt.metaKey)},fluid.reorderer.isMove=function(keysets,evt){for(var i=0;i<keysets.length;i++)if(keysets[i].modifier(evt))return!0;return!1},fluid.reorderer.isActiveItemMovable=function(activeItem,dom){return $.inArray(activeItem,dom.fastLocate("movables"))>=0},fluid.reorderer.handleKeyDown=function(thatReorderer,styles,evt){if(!thatReorderer.activeItem||thatReorderer.activeItem!==evt.target)return!0;var jActiveItem=$(thatReorderer.activeItem);return!jActiveItem.hasClass(styles.dragging)&&thatReorderer.isMove(evt)?(thatReorderer.isActiveItemMovable()&&(jActiveItem.removeClass(styles.selected),jActiveItem.addClass(styles.dragging),jActiveItem.attr("aria-grabbed","true"),thatReorderer.setDropEffects("move")),!1):thatReorderer.handleDirectionKeyDown(evt)},fluid.reorderer.handleDirectionKeyDown=function(thatReorderer,evt){var item=thatReorderer.activeItem;if(!item)return!0;for(var keysets=thatReorderer.options.keysets,i=0;i<keysets.length;i++){var keyset=keysets[i],keydir=fluid.keyForValue(keyset,evt.keyCode);if(keydir){var isMovement=keyset.modifier(evt),dirnum=fluid.keycodeDirection[keydir],relativeItem=thatReorderer.layoutHandler.getRelativePosition(item,dirnum,!isMovement);if(relativeItem){if(isMovement){var prevent=thatReorderer.events.onBeginMove.fire(item);if(prevent===!1)return!1;var kbDropWarning=thatReorderer.kbDropWarning;kbDropWarning.length>0&&("locked"===relativeItem.clazz?(thatReorderer.events.onShowKeyboardDropWarning.fire(item,kbDropWarning),kbDropWarning.show()):kbDropWarning.hide()),relativeItem.element&&thatReorderer.requestMovement(relativeItem,item)}else fluid.reorderer.noModifier(evt)&&(fluid.blur(item),fluid.focus($(relativeItem.element)));return!1}}}return!0},fluid.reorderer.handleKeyUp=function(thatReorderer,styles,evt){if(!thatReorderer.activeItem||thatReorderer.activeItem!==evt.target)return!0;var jActiveItem=$(thatReorderer.activeItem);return jActiveItem.hasClass(styles.dragging)&&!thatReorderer.isMove(evt)?(thatReorderer.kbDropWarning&&thatReorderer.kbDropWarning.hide(),jActiveItem.removeClass(styles.dragging),jActiveItem.addClass(styles.selected),jActiveItem.attr("aria-grabbed","false"),thatReorderer.setDropEffects("none"),!1):!1},fluid.reorderer.requestMovement=function(thatReorderer,requestedPosition,item){if(item=fluid.unwrap(item),requestedPosition&&fluid.unwrap(requestedPosition.element)!==item){var activeItem=$(thatReorderer.activeItem);activeItem.unbind("blur.fluid.reorderer"),thatReorderer.events.onMove.fire(item,requestedPosition),thatReorderer.dropManager.geometricMove(item,requestedPosition.element,requestedPosition.position),fluid.focus(activeItem),thatReorderer.refresh(),thatReorderer.dropManager.updateGeometry(thatReorderer.layoutHandler.getGeometricInfo()),thatReorderer.events.afterMove.fire(item,requestedPosition,thatReorderer.dom.fastLocate("movables"))}},fluid.reorderer.hoverStyleHandler=function(dom,styles,item,state){dom.fastLocate("grabHandle",item)[state?"addClass":"removeClass"](styles.hover)},fluid.reorderer.processAfterMoveCallbackUrl=function(thatReorderer){var options=thatReorderer.options;options.afterMoveCallbackUrl&&thatReorderer.events.afterMove.addListener(function(){var layoutHandler=thatReorderer.layoutHandler,model=layoutHandler.getModel?layoutHandler.getModel():options.acquireModel(thatReorderer);$.post(options.afterMoveCallbackUrl,JSON.stringify(model))},"postModel")},fluid.reorderer.postInit=function(that){that.kbDropWarning&&(that.mouseDropWarning=that.kbDropWarning.clone()),that.options.keysets=fluid.makeArray(that.options.keysets)},fluid.reorderer.setDropEffects=function(dom,value){dom.fastLocate("dropTargets").attr("aria-dropeffect",value)},fluid.reorderer.createDropMarker=function(tagName,dropClass){var dropMarker=$(document.createElement(tagName));return dropMarker.addClass(dropClass),dropMarker.hide(),dropMarker},fluid.reorderer.changeSelectedToDefault=function(jItem,styles){jItem.removeClass(styles.selected),jItem.removeClass(styles.dragging),jItem.addClass(styles.defaultStyle),jItem.attr("aria-selected","false")},fluid.reorderer.initSelectables=function(thatReorderer){for(var handleBlur=function(evt){return thatReorderer.changeSelectedToDefault($(this)),evt.stopPropagation()},handleFocus=function(evt){return thatReorderer.selectItem(this),evt.stopPropagation()},handleClick=function(evt){var handle=fluid.unwrap(thatReorderer.dom.fastLocate("grabHandle",this));fluid.dom.isContainer(handle,evt.target)&&$(this).focus()},selectables=thatReorderer.dom.fastLocate("selectables"),i=0;i<selectables.length;++i){var selectable=$(selectables[i]);$.data(selectable[0],"fluid.reorderer.selectable-initialised")||(selectable.addClass(thatReorderer.options.styles.defaultStyle),selectable.bind("blur.fluid.reorderer",handleBlur),selectable.focus(handleFocus),selectable.click(handleClick),selectable.attr("role",thatReorderer.options.containerRole.item),selectable.attr("aria-selected","false"),selectable.attr("aria-disabled","false"),$.data(selectable[0],"fluid.reorderer.selectable-initialised",!0))}thatReorderer.selectableContext||(thatReorderer.selectableContext=fluid.selectable(thatReorderer.container,{selectableElements:selectables,selectablesTabindex:thatReorderer.options.selectablesTabindex,direction:null}))},fluid.reorderer.selectItem=function(thatReorderer,anItem){thatReorderer.events.onSelect.fire(anItem),thatReorderer.activeItem&&thatReorderer.activeItem!==anItem&&thatReorderer.changeSelectedToDefault($(thatReorderer.activeItem)),thatReorderer.activeItem=anItem;var jItem=$(anItem),styles=thatReorderer.options.styles;jItem.removeClass(styles.defaultStyle),jItem.addClass(styles.selected),jItem.attr("aria-selected","true")},fluid.reorderer.initMovable=function(thatReorderer,dropManager,item){var options=thatReorderer.options,styles=options.styles;item.attr("aria-grabbed","false"),item.mouseover(function(){thatReorderer.events.onHover.fire(item,!0)}),item.mouseout(function(){thatReorderer.events.onHover.fire(item,!1)});var avatar,handle=thatReorderer.dom.fastLocate("grabHandle",item);item.draggable({refreshPositions:!1,scroll:!0,helper:function(){var dropWarningEl;return thatReorderer.mouseDropWarning&&(dropWarningEl=thatReorderer.mouseDropWarning[0]),avatar=$(options.avatarCreator(item[0],styles.avatar,dropWarningEl)),avatar.prop("id",fluid.reorderer.createAvatarId(thatReorderer.container.id)),avatar},start:function(e){var prevent=thatReorderer.events.onBeginMove.fire(item);if(prevent===!1)return!1;var handle=thatReorderer.dom.fastLocate("grabHandle",item)[0],handlePos=fluid.dom.computeAbsolutePosition(handle),handleWidth=handle.offsetWidth,handleHeight=handle.offsetHeight;item.focus(),item.removeClass(options.styles.selected),item.addClass(options.styles.mouseDrag),item.attr("aria-grabbed","true"),thatReorderer.setDropEffects("move"),dropManager.startDrag(e,handlePos,handleWidth,handleHeight),avatar.show()},stop:function(e,ui){item.removeClass(options.styles.mouseDrag),item.addClass(options.styles.selected),$(thatReorderer.activeItem).attr("aria-grabbed","false");var markerNode=fluid.unwrap(thatReorderer.dropMarker);markerNode.parentNode&&markerNode.parentNode.removeChild(markerNode),avatar.hide(),ui.helper=null,thatReorderer.setDropEffects("none"),dropManager.endDrag(),thatReorderer.requestMovement(dropManager.lastPosition(),item),thatReorderer.activeItem.focus()},handle:handle===item?null:handle})},fluid.reorderer.initItems=function(thatReorderer){var movables=thatReorderer.dom.fastLocate("movables"),dropTargets=thatReorderer.dom.fastLocate("dropTargets");thatReorderer.initSelectables();for(var i=0;i<movables.length;i++){var item=movables[i];$.data(item,"fluid.reorderer.movable-initialised")||(thatReorderer.initMovable($(item)),$.data(item,"fluid.reorderer.movable-initialised",!0))}movables.length>0&&!thatReorderer.dropMarker&&(thatReorderer.dropMarker=thatReorderer.createDropMarker(movables[0].tagName)),thatReorderer.dropManager.updateGeometry(thatReorderer.layoutHandler.getGeometricInfo());var dropChangeListener=function(dropTarget){fluid.dom.moveDom(thatReorderer.dropMarker,dropTarget.element,dropTarget.position),thatReorderer.dropMarker.css("display",""),thatReorderer.mouseDropWarning&&(dropTarget.lockedelem?thatReorderer.mouseDropWarning.show():thatReorderer.mouseDropWarning.hide())};thatReorderer.dropManager.dropChangeFirer.addListener(dropChangeListener,"fluid.reorderer"),dropTargets.attr("aria-dropeffect","none")},fluid.reorderer.refresh=function(dom,events,selectableContext,activeItem){dom.refresh("movables"),dom.refresh("selectables"),dom.refresh("grabHandle",dom.fastLocate("movables")),dom.refresh("stylisticOffset",dom.fastLocate("movables")),dom.refresh("dropTargets"),selectableContext&&(selectableContext.selectables=dom.fastLocate("selectables"),selectableContext.selectablesUpdated(activeItem)),events.onRefresh.fire()},fluid.reorderer.roles={GRID:{container:"grid",item:"gridcell"},LIST:{container:"list",item:"listitem"},REGIONS:{container:"main",item:"article"}};var simpleInit=function(container,layoutHandler,options){return options=options||{},options.layoutHandler=layoutHandler,fluid.reorderer(container,options)};fluid.reorderList=function(container,options){return simpleInit(container,"fluid.listLayoutHandler",options)},fluid.reorderGrid=function(container,options){return simpleInit(container,"fluid.gridLayoutHandler",options)},fluid.reorderer.SHUFFLE_GEOMETRIC_STRATEGY="shuffleProjectFrom",fluid.reorderer.GEOMETRIC_STRATEGY="projectFrom",fluid.reorderer.LOGICAL_STRATEGY="logicalFrom",fluid.reorderer.WRAP_LOCKED_STRATEGY="lockedWrapFrom",fluid.reorderer.NO_STRATEGY=null,fluid.reorderer.relativeInfoGetter=function(orientation,coStrategy,contraStrategy,dropManager,disableWrap){return function(item,direction,forSelection){var dirorient=fluid.directionOrientation(direction),strategy=dirorient===orientation?coStrategy:contraStrategy;return null!==strategy?dropManager[strategy](item,direction,forSelection,disableWrap):null}},fluid.reorderer.makeGeometricInfoGetter=function(orientation,sentinelize,dom){return function(){var that={sentinelize:sentinelize,extents:[{orientation:orientation,elements:dom.fastLocate("dropTargets")}],elementMapper:function(element){return-1===$.inArray(element,dom.fastLocate("movables"))?"locked":null},elementIndexer:function(element){var selectables=dom.fastLocate("selectables");return{elementClass:that.elementMapper(element),index:$.inArray(element,selectables),length:selectables.length}}};return that}},fluid.defaults("fluid.layoutHandler",{gradeNames:["fluid.viewComponent"],disableWrap:"{reorderer}.options.disableWrap",members:{reordererDom:"{reorderer}.dom"},components:{dropManager:"{reorderer}.dropManager"}}),fluid.defaults("fluid.listLayoutHandler",{gradeNames:["fluid.layoutHandler","autoInit"],orientation:fluid.orientation.VERTICAL,containerRole:fluid.reorderer.roles.LIST,selectablesTabindex:-1,sentinelize:!0}),fluid.listLayoutHandler.finalInit=function(that){var options=that.options;that.getRelativePosition=fluid.reorderer.relativeInfoGetter(options.orientation,fluid.reorderer.LOGICAL_STRATEGY,null,that.dropManager,options.disableWrap),that.getGeometricInfo=fluid.reorderer.makeGeometricInfoGetter(options.orientation,options.sentinelize,that.reordererDom)},fluid.defaults("fluid.gridLayoutHandler",{gradeNames:["fluid.layoutHandler","autoInit"],orientation:fluid.orientation.HORIZONTAL,containerRole:fluid.reorderer.roles.GRID,selectablesTabindex:-1,sentinelize:!1}),fluid.gridLayoutHandler.finalInit=function(that){var options=that.options;that.getRelativePosition=fluid.reorderer.relativeInfoGetter(options.orientation,options.disableWrap?fluid.reorderer.SHUFFLE_GEOMETRIC_STRATEGY:fluid.reorderer.LOGICAL_STRATEGY,fluid.reorderer.SHUFFLE_GEOMETRIC_STRATEGY,that.dropManager,options.disableWrap),that.getGeometricInfo=fluid.reorderer.makeGeometricInfoGetter(options.orientation,options.sentinelize,that.reordererDom)},fluid.defaults("fluid.reorderer.labeller",{gradeNames:["fluid.eventedComponent","autoInit"],members:{movedMap:{},moduleCell:{expander:{funcName:"fluid.reorderer.labeller.computeModuleCell",args:["{that}.resolver","{that}.options.orientation"]}},layoutType:{expander:{funcName:"fluid.computeNickName",args:"{that}.options.layoutType"}},positionTemplate:{expander:{funcName:"fluid.reorderer.labeller.computePositionTemplate",args:["{that}.resolver","{that}.layoutType"]}}},strings:{overallTemplate:"%recentStatus %item %position %movable",position:"%index of %length",position_moduleLayoutHandler:"%index of %length in %moduleCell %moduleIndex of %moduleLength",moduleCell_0:"row",moduleCell_1:"column",movable:"movable",fixed:"fixed",recentStatus:"moved from position %position"},components:{resolver:{type:"fluid.messageResolver",options:{messageBase:"{labeller}.options.strings"}}},invokers:{renderLabel:{funcName:"fluid.reorderer.labeller.renderLabel",args:["{labeller}","{arguments}.0","{arguments}.1"]}},listeners:{"{reorderer}.events.onRefresh":{listener:"fluid.reorderer.labeller.onRefresh",args:"{that}"},"{reorderer}.events.onMove":{listener:"fluid.reorderer.labeller.onMove",args:["{that}","{arguments}.0","{arguments}.1"]}}}),fluid.reorderer.labeller.computeModuleCell=function(resolver,orientation){return resolver.resolve("moduleCell_"+orientation)},fluid.reorderer.labeller.computePositionTemplate=function(resolver,layoutType){return resolver.lookup(["position_"+layoutType,"position"])},fluid.reorderer.labeller.onRefresh=function(that){var selectables=that.dom.locate("selectables"),movedMap=that.movedMap;fluid.each(selectables,function(selectable){var labelOptions={},id=fluid.allocateSimpleId(selectable),moved=movedMap[id],label=that.renderLabel(selectable),plainLabel=label;moved&&(moved.newRender=plainLabel,label=that.renderLabel(selectable,moved.oldRender.position),$(selectable).one("focusout.ariaLabeller",function(){if(movedMap[id]){var oldLabel=movedMap[id].newRender.label;delete movedMap[id],fluid.updateAriaLabel(selectable,oldLabel)}}),labelOptions.dynamicLabel=!0),fluid.updateAriaLabel(selectable,label.label,labelOptions)})},fluid.reorderer.labeller.onMove=function(that,item){fluid.clear(that.movedMap),$(item).unbind("focusout.ariaLabeller");var movingId=fluid.allocateSimpleId(item);that.movedMap[movingId]={oldRender:that.renderLabel(item)}},fluid.reorderer.indexRebaser=function(indices){return indices.index++,void 0!==indices.moduleIndex&&indices.moduleIndex++,indices},fluid.reorderer.labeller.renderLabel=function(that,selectable,recentPosition){var geom=that.options.getGeometricInfo(),indices=fluid.reorderer.indexRebaser(geom.elementIndexer(selectable));indices.moduleCell=that.moduleCell;var recentStatus,elementClass=geom.elementMapper(selectable),labelSource=that.dom.locate("labelSource",selectable);recentPosition&&(recentStatus=that.resolver.resolve("recentStatus",{position:recentPosition}));var topModel={item:"string"==typeof labelSource?labelSource:fluid.dom.getElementText(fluid.unwrap(labelSource)),position:that.positionTemplate.resolveFunc(that.positionTemplate.template,indices),movable:that.resolver.resolve("locked"===elementClass?"fixed":"movable"),recentStatus:recentStatus||""},template=that.resolver.lookup(["overallTemplate"]),label=template.resolveFunc(template.template,topModel);return{position:topModel.position,label:label}}}(jQuery,fluid_1_5);