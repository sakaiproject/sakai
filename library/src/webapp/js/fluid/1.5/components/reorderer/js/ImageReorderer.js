var fluid_1_5=fluid_1_5||{};!function($,fluid){"use strict";fluid.registerNamespace("fluid.reorderImages"),fluid.reorderImages.deriveLightboxCellBase=function(namebase,index){return namebase+"lightbox-cell:"+index+":"},fluid.reorderImages.addThumbnailActivateHandler=function(container){var enterKeyHandler=function(evt){if(evt.which===fluid.reorderer.keys.ENTER){var thumbnailAnchors=$("a",evt.target);document.location=thumbnailAnchors.attr("href")}};container.keypress(enterKeyHandler)},fluid.reorderImages.seekNodesById=function(rootnode,tagname,idmatch){for(var inputs=rootnode.getElementsByTagName(tagname),togo=[],i=0;i<inputs.length;i+=1){var input=inputs[i],id=input.id;id&&id.match(idmatch)&&togo.push(input)}return togo},fluid.reorderImages.createImageCellFinder=function(parentNode,containerId){containerId=containerId||parentNode.prop("id"),parentNode=fluid.unwrap(parentNode);var lightboxCellNamePattern="^"+fluid.reorderImages.deriveLightboxCellBase(containerId,"[0-9]+")+"$";return function(){return fluid.reorderImages.seekNodesById(parentNode,"div",lightboxCellNamePattern)}},fluid.reorderImages.seekForm=function(container){return fluid.findAncestor(container,function(element){return $(element).is("form")})},fluid.reorderImages.seekInputs=function(container,reorderform){return fluid.reorderImages.seekNodesById(reorderform,"input","^"+fluid.reorderImages.deriveLightboxCellBase(container.prop("id"),"[^:]*")+"reorder-index$")},fluid.reorderImages.mapIdsToNames=function(container,reorderform){for(var inputs=fluid.reorderImages.seekInputs(container,reorderform),i=0;i<inputs.length;i++){var input=inputs[i],name=input.name;input.name=name||input.id}},fluid.reorderImages.createIDAfterMoveListener=function(container){var reorderform=fluid.reorderImages.seekForm(container);return fluid.reorderImages.mapIdsToNames(container,reorderform),function(){var inputs,i;for(inputs=fluid.reorderImages.seekInputs(container,reorderform),i=0;i<inputs.length;i+=1)inputs[i].value=i;if(reorderform&&reorderform.action){var order=$(reorderform).serialize();$.post(reorderform.action,order,function(){})}}},fluid.defaults("fluid.reorderImages",{gradeNames:["fluid.reorderer","autoInit"],layoutHandler:"fluid.gridLayoutHandler",listeners:{"afterMove.postModel":{expander:{funcName:"fluid.reorderImages.createIDAfterMoveListener",args:"{that}.container"}}},selectors:{movables:{expander:{funcName:"fluid.reorderImages.createImageCellFinder",args:"{that}.container"}},labelSource:".flc-reorderer-imageTitle"}}),fluid.lightbox=fluid.reorderImages}(jQuery,fluid_1_5);