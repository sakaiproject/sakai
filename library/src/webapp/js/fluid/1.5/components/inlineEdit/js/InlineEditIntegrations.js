var fluid_1_5=fluid_1_5||{};!function($,fluid){"use strict";fluid.defaults("fluid.inlineEdit.editorViewAccessor",{gradeNames:["fluid.viewComponent","autoInit"],invokers:{value:{funcName:"fluid.inlineEdit.editorViewAccessor.value",args:["{that}.container","{that}.options","{arguments}.0"]}}}),fluid.inlineEdit.editorViewAccessor.value=function(editField,options,newValue){var editor=options.editorGetFn(editField);return editor&&0!==editor.length?void 0===newValue?options.getValueFn(editor):void options.setValueFn(editField,editor,newValue):(void 0!==newValue&&$(editField).val(newValue),"")},fluid.defaults("fluid.inlineEdit.richTextViewAccessor",{gradeNames:["fluid.viewComponent","autoInit"],invokers:{value:{funcName:"fluid.inlineEdit.richTextViewAccessor.value",args:["{that}.container","{arguments}.0"]}}}),fluid.inlineEdit.richTextViewAccessor.value=function(element,newValue){return fluid.html(element,newValue)},fluid.inlineEdit.normalizeHTML=function(value){var togo=$.trim(value.replace(/\s+/g," "));return togo=togo.replace(/\s+<\//g,"</"),togo=togo.replace(/<([a-z0-9A-Z\/]+)>/g,function(match){return match.toLowerCase()})},fluid.inlineEdit.htmlComparator=function(el1,el2){return fluid.inlineEdit.normalizeHTML(el1)===fluid.inlineEdit.normalizeHTML(el2)},fluid.inlineEdit.bindRichTextHighlightHandler=function(element,displayModeRenderer,invitationStyle){element=$(element);var focusOn=function(){displayModeRenderer.addClass(invitationStyle)},focusOff=function(){displayModeRenderer.removeClass(invitationStyle)};element.focus(focusOn),element.blur(focusOff)},fluid.inlineEdit.setupRichTextEditButton=function(that){var opts=that.options,textEditButton=that.locate("textEditButton");if(0===textEditButton.length){var markup=$("<a href='#_' class='flc-inlineEdit-textEditButton'></a>");markup.text(opts.strings.textEditButton),that.locate("text").after(markup),textEditButton=that.locate("textEditButton")}return textEditButton},fluid.inlineEdit.richTextDisplayModeRenderer=function(that,edit){var styles=that.options.styles,displayModeWrapper=fluid.inlineEdit.setupDisplayModeContainer(styles),displayModeRenderer=that.viewEl.wrap(displayModeWrapper).parent();return that.textEditButton=fluid.inlineEdit.setupRichTextEditButton(that),displayModeRenderer.append(that.textEditButton),displayModeRenderer.addClass(styles.focus),fluid.inlineEdit.bindHoverHandlers(displayModeRenderer,styles.invitation),fluid.inlineEdit.bindMouseHandlers(that.textEditButton,edit),fluid.inlineEdit.bindKeyboardHandlers(that.textEditButton,edit),fluid.inlineEdit.bindRichTextHighlightHandler(that.viewEl,displayModeRenderer,styles.invitation),fluid.inlineEdit.bindRichTextHighlightHandler(that.textEditButton,displayModeRenderer,styles.invitation),displayModeRenderer};var flTinyMCE=fluid.registerNamespace("fluid.inlineEdit.tinyMCE");fluid.inlineEdit.tinyMCE.getEditor=function(editField){return tinyMCE.get(editField.prop("id"))},fluid.inlineEdit.tinyMCE.setValue=function(editField,editor,value){$(editField).val(value),editor.setContent(value,{format:"raw"})},fluid.inlineEdit.tinyMCE.getValue=function(editor){return editor.getContent()},fluid.defaults("fluid.inlineEdit.tinyMCE.viewAccessor",{gradeNames:["fluid.inlineEdit.editorViewAccessor","autoInit"],editorGetFn:flTinyMCE.getEditor,setValueFn:flTinyMCE.setValue,getValueFn:flTinyMCE.getValue}),fluid.inlineEdit.tinyMCE.blurHandlerBinder=function(that){function focusEditor(editor){setTimeout(function(){tinyMCE.execCommand("mceFocus",!1,that.editField[0].id),editor.selection.select(editor.getBody(),1),editor.selection.collapse(0)},10)}that.events.afterInitEdit.addListener(function(editor){focusEditor(editor);var editorBody=editor.getBody();that.deadMansBlur=fluid.deadMansBlur(that.editField,{cancelByDefault:!0,exclusions:{body:$(editorBody),container:that.container},handler:function(){that[that.options.onBlur]()}}),editor.controlManager.onAdd.add(function(e){e.onShowMenu&&e.onShowMenu.add(function(){var el=fluid.byId(e.element.id);el&&that.deadMansBlur.addExclusion({id:el})})})}),that.events.afterBeginEdit.addListener(function(){var editor=tinyMCE.get(that.editField[0].id);editor&&focusEditor(editor),that.deadMansBlur&&that.deadMansBlur.reArm()}),that.events.afterFinishEdit.addListener(function(){that.deadMansBlur.noteProceeded()})},fluid.inlineEdit.tinyMCE.editModeRenderer=function(that){var options=that.options.tinyMCE;options.elements=fluid.allocateSimpleId(that.editField);var oldinit=options.init_instance_callback;options.init_instance_callback=function(instance){that.events.afterInitEdit.fire(instance),oldinit&&oldinit()},setTimeout(function(){tinyMCE.init(options)},1)},fluid.defaults("fluid.inlineEdit.tinyMCE",{gradeNames:["fluid.inlineEdit","autoInit"],tinyMCE:{mode:"exact",theme:"simple"},listeners:{onCreate:{"this":"tinyMCE",method:"init",namespace:"initTinyMCE",args:"{that}.options.tinyMCE"}},useTooltip:!0,selectors:{edit:"textarea"},styles:{invitation:"fl-inlineEdit-richText-invitation",displayView:"fl-inlineEdit-textContainer",text:""},strings:{textEditButton:"Edit"},displayAccessor:{type:"fluid.inlineEdit.richTextViewAccessor"},editAccessor:{type:"fluid.inlineEdit.tinyMCE.viewAccessor"},lazyEditView:!0,defaultViewText:"Click Edit",modelComparator:fluid.inlineEdit.htmlComparator,onBlur:"finish",blurHandlerBinder:fluid.inlineEdit.tinyMCE.blurHandlerBinder,displayModeRenderer:fluid.inlineEdit.richTextDisplayModeRenderer,editModeRenderer:fluid.inlineEdit.tinyMCE.editModeRenderer});var flCKEditor=fluid.registerNamespace("fluid.inlineEdit.CKEditor");fluid.inlineEdit.CKEditor.getEditor=function(editField){return CKEDITOR.instances[editField.prop("id")]},fluid.inlineEdit.CKEditor.setValue=function(editField,editor,value){editor.setData(value)},fluid.inlineEdit.CKEditor.getValue=function(editor){return editor.getData()},fluid.defaults("fluid.inlineEdit.CKEditor.viewAccessor",{gradeNames:["fluid.inlineEdit.editorViewAccessor","autoInit"],editorGetFn:flCKEditor.getEditor,setValueFn:flCKEditor.setValue,getValueFn:flCKEditor.getValue}),fluid.inlineEdit.CKEditor.focus=function(editor){setTimeout(function(){editor.focus()},0)},fluid.inlineEdit.CKEditor.normalizeHTML=function(value){var togo=fluid.inlineEdit.normalizeHTML(value),angpos=togo.indexOf(">");return-1!==angpos&&angpos<togo.length-1&&" "!==togo.charAt(angpos+1)&&(togo=togo.substring(0,angpos+1)+" "+togo.substring(angpos+1)),togo},fluid.inlineEdit.CKEditor.htmlComparator=function(el1,el2){return fluid.inlineEdit.CKEditor.normalizeHTML(el1)===fluid.inlineEdit.CKEditor.normalizeHTML(el2)},fluid.inlineEdit.CKEditor.blurHandlerBinder=function(that){that.events.afterInitEdit.addListener(fluid.inlineEdit.CKEditor.focus),that.events.afterBeginEdit.addListener(function(){var editor=fluid.inlineEdit.CKEditor.getEditor(that.editField);editor&&fluid.inlineEdit.CKEditor.focus(editor)})},fluid.inlineEdit.CKEditor.editModeRenderer=function(that){var id=fluid.allocateSimpleId(that.editField);$.data(fluid.unwrap(that.editField),"fluid.inlineEdit.CKEditor",that);var editor=CKEDITOR.replace(id,that.options.CKEditor);editor.on("instanceReady",function(e){fluid.inlineEdit.CKEditor.focus(e.editor),that.events.afterInitEdit.fire(e.editor)})},fluid.defaults("fluid.inlineEdit.CKEditor",{gradeNames:["fluid.inlineEdit","autoInit"],selectors:{edit:"textarea"},styles:{invitation:"fl-inlineEdit-richText-invitation",displayView:"fl-inlineEdit-textContainer",text:""},strings:{textEditButton:"Edit"},displayAccessor:{type:"fluid.inlineEdit.richTextViewAccessor"},editAccessor:{type:"fluid.inlineEdit.CKEditor.viewAccessor"},lazyEditView:!0,defaultViewText:"Click Edit",modelComparator:fluid.inlineEdit.CKEditor.htmlComparator,blurHandlerBinder:fluid.inlineEdit.CKEditor.blurHandlerBinder,displayModeRenderer:fluid.inlineEdit.richTextDisplayModeRenderer,editModeRenderer:fluid.inlineEdit.CKEditor.editModeRenderer,CKEditor:{}}),fluid.registerNamespace("fluid.inlineEdit.dropdown"),fluid.inlineEdit.dropdown.editModeRenderer=function(that){return fluid.allocateSimpleId(that.editField),that.editField.selectbox({finishHandler:function(){that.finish()}}),{container:that.editContainer,field:$("input.selectbox",that.editContainer)}},fluid.inlineEdit.dropdown.blurHandlerBinder=function(that){fluid.deadMansBlur(that.editField,{exclusions:{selectBox:$("div.selectbox-wrapper",that.editContainer)},handler:function(){that.cancel()}})},fluid.defaults("fluid.inlineEdit.dropdown",{gradeNames:["fluid.inlineEdit","autoInit"],applyEditPadding:!1,blurHandlerBinder:fluid.inlineEdit.dropdown.blurHandlerBinder,editModeRenderer:fluid.inlineEdit.dropdown.editModeRenderer})}(jQuery,fluid_1_5);