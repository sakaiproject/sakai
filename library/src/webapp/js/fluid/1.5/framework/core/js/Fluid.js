var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function($,fluid){"use strict";function transformInternal(source,togo,key,args){for(var transit=source[key],j=0;j<args.length-1;++j)transit=args[j+1](transit,key);togo[key]=transit}function regenerateCursor(source,segs,limit,sourceStrategy){for(var i=0;limit>i;++i)source=sourceStrategy(source,segs[i],i,fluid.makeArray(segs));return source}function regenerateSources(sources,segs,limit,sourceStrategies){for(var togo=[],i=0;i<sources.length;++i){var thisSource=regenerateCursor(sources[i],segs,limit,sourceStrategies[i]);void 0!==thisSource&&togo.push(thisSource)}return togo}fluid.version="Infusion 1.5",fluid.Error=Error,fluid.environment={fluid:fluid};var globalObject=window||{};fluid.defeatLogging=!0,fluid.activityTracing=!1,fluid.activityTrace=[];var activityParser=/(%\w+)/g;fluid.renderOneActivity=function(activity,nowhile){for(var togo=nowhile===!0?[]:["    while "],message=activity.message,index=activityParser.lastIndex=0;;){var match=activityParser.exec(message);if(!match)break;var key=match[1].substring(1);togo.push(message.substring(index,match.index)),togo.push(activity.args[key]),index=activityParser.lastIndex}return index<message.length&&togo.push(message.substring(index)),togo},fluid.renderActivity=function(activityStack,renderer){return renderer=renderer||fluid.renderOneActivity,fluid.transform(activityStack,renderer)},fluid.getActivityStack=function(){var root=fluid.globalThreadLocal();return root.activityStack||(root.activityStack=[]),root.activityStack},fluid.describeActivity=fluid.getActivityStack,fluid.logActivity=function(activity){activity=activity||fluid.describeActivity();var rendered=fluid.renderActivity(activity).reverse();fluid.log("Current activity: "),fluid.each(rendered,function(args){fluid.doLog(args)})},fluid.pushActivity=function(type,message,args){var record={type:type,message:message,args:args,time:(new Date).getTime()};fluid.activityTracing&&fluid.activityTrace.push(record),fluid.passLogLevel(fluid.logLevel.TRACE)&&fluid.doLog(fluid.renderOneActivity(record,!0));var activityStack=fluid.getActivityStack();activityStack.push(record)},fluid.popActivity=function(popframes){popframes=popframes||1,fluid.activityTracing&&fluid.activityTrace.push({pop:popframes});var activityStack=fluid.getActivityStack(),popped=activityStack.length-popframes;activityStack.length=0>popped?0:popped},fluid.FluidError=function(message){this.message=message,this.stack=(new Error).stack},fluid.FluidError.prototype=new Error,fluid.builtinFail=function(soft,args,activity){fluid.log.apply(null,[fluid.logLevel.FAIL,"ASSERTION FAILED: "].concat(args)),fluid.logActivity(activity);var message=args.join("");if(soft)throw new fluid.FluidError(message);message["Assertion failure - check console for details"]()};var softFailure=[!1];fluid.fail=function(){var args=fluid.makeArray(arguments),activity=fluid.makeArray(fluid.describeActivity());fluid.popActivity(activity.length);var topFailure=softFailure[0];"boolean"==typeof topFailure?fluid.builtinFail(topFailure,args,activity):"function"==typeof topFailure&&topFailure(args,activity)},fluid.pushSoftFailure=function(condition){"boolean"==typeof condition||"function"==typeof condition?softFailure.unshift(condition):-1===condition&&softFailure.shift()},fluid.notrycatch=!0,fluid.tryCatch=function(tryfun,catchfun,finallyfun){if(finallyfun=finallyfun||fluid.identity,fluid.notrycatch){var togo=tryfun();return finallyfun(),togo}try{return tryfun()}catch(e){if(!catchfun)throw e;catchfun(e)}finally{finallyfun()}},fluid.expect=function(name,members,target){fluid.transform(fluid.makeArray(members),function(key){"undefined"==typeof target[key]&&fluid.fail(name+" missing required parameter "+key)})},fluid.isLogging=function(){return logLevelStack[0].priority>fluid.logLevel.IMPORTANT.priority},fluid.isLogLevel=function(arg){return fluid.isMarker(arg)&&void 0!==arg.priority},fluid.passLogLevel=function(testLogLevel){return testLogLevel.priority<=logLevelStack[0].priority},fluid.setLogging=function(enabled){var logLevel;"boolean"==typeof enabled?logLevel=fluid.logLevel[enabled?"INFO":"IMPORTANT"]:fluid.isLogLevel(enabled)?logLevel=enabled:fluid.fail("Unrecognised fluid logging level ",enabled),logLevelStack.unshift(logLevel)},fluid.setLogLevel=fluid.setLogging,fluid.popLogging=function(){return 1===logLevelStack.length?logLevelStack[0]:logLevelStack.shift()},fluid.doLog=function(args){var str=args.join("");"undefined"!=typeof console?console.debug?console.debug.apply(console,args):"function"==typeof console.log?console.log.apply(console,args):console.log(str):"undefined"!=typeof YAHOO?YAHOO.log(str):"undefined"!=typeof opera&&opera.postError(str)},fluid.log=function(){var directArgs=fluid.makeArray(arguments),userLogLevel=fluid.logLevel.INFO;if(fluid.isLogLevel(directArgs[0])&&(userLogLevel=directArgs.shift()),fluid.passLogLevel(userLogLevel)){var arg0=fluid.renderTimestamp(new Date)+":  ",args=[arg0].concat(directArgs);fluid.doLog(args)}},fluid.identity=function(arg){return arg},fluid.isValue=function(value){return void 0!==value&&null!==value},fluid.isPrimitive=function(value){var valueType=typeof value;return!value||"string"===valueType||"boolean"===valueType||"number"===valueType||"function"===valueType},fluid.isArrayable=function(totest){return totest&&(totest.jquery||"[object Array]"===Object.prototype.toString.call(totest))},fluid.isPlainObject=function(totest){if(!totest)return!1;var string=Object.prototype.toString.call(totest);return"[object Array]"===string||"[object Object]"===string},fluid.isDOMNode=function(obj){return obj&&"number"==typeof obj.nodeType},fluid.isDOMish=function(obj){return fluid.isDOMNode(obj)||obj.jquery},fluid.isComponent=function(obj){return obj&&obj.typeName&&obj.id},fluid.freshContainer=function(tocopy){return fluid.isArrayable(tocopy)?[]:{}},fluid.copy=function(tocopy){return fluid.isPrimitive(tocopy)?tocopy:$.extend(!0,fluid.freshContainer(tocopy),tocopy)},fluid.makeArray=function(arg){var togo=[];if(null!==arg&&void 0!==arg)if(fluid.isPrimitive(arg)||"number"!=typeof arg.length)togo.push(arg);else for(var i=0;i<arg.length;++i)togo[i]=arg[i];return togo},fluid.transform=function(source){var togo=fluid.freshContainer(source);if(fluid.isArrayable(source))for(var i=0;i<source.length;++i)transformInternal(source,togo,i,arguments);else for(var key in source)transformInternal(source,togo,key,arguments);return togo},fluid.each=function(source,func){if(fluid.isArrayable(source))for(var i=0;i<source.length;++i)func(source[i],i);else for(var key in source)func(source[key],key)},fluid.make_find=function(find_if){var target=find_if?!1:void 0;return function(source,func,deffolt){var disp;if(fluid.isArrayable(source)){for(var i=0;i<source.length;++i)if(disp=func(source[i],i),disp!==target)return find_if?source[i]:disp}else for(var key in source)if(disp=func(source[key],key),disp!==target)return find_if?source[key]:disp;return deffolt}},fluid.find=fluid.make_find(!1),fluid.find_if=fluid.make_find(!0),fluid.accumulate=function(list,fn,arg){for(var i=0;i<list.length;++i)arg=fn(list[i],arg,i);return arg},fluid.remove_if=function(source,fn,target){if(fluid.isArrayable(source))for(var i=0;i<source.length;++i)fn(source[i],i)&&(target&&target.push(source[i]),source.splice(i,1),--i);else for(var key in source)fn(source[key],key)&&(target&&(target[key]=source[key]),delete source[key]);return target||source},fluid.generate=function(n,generator,applyFunc){for(var togo=[],i=0;n>i;++i)togo[i]=applyFunc?generator(i):generator;return togo},fluid.iota=function(count,first){first=first||0;for(var togo=[],i=0;count>i;++i)togo[togo.length]=first++;return togo},fluid.getMembers=function(holder,name){return fluid.transform(holder,function(member){return fluid.get(member,name)})},fluid.filterKeys=function(toFilter,keys,exclude){return fluid.remove_if($.extend({},toFilter),function(value,key){return exclude^-1===$.inArray(key,keys)})},fluid.censorKeys=function(toCensor,keys){return fluid.filterKeys(toCensor,keys,!0)},fluid.makeFlatten=function(index){return function(obj){var togo=[];return fluid.each(obj,function(){togo.push(arguments[index])}),togo}},fluid.keys=fluid.makeFlatten(1),fluid.values=fluid.makeFlatten(0),fluid.contains=function(obj,value){return obj?fluid.isArrayable(obj)?-1!==$.inArray(value,obj):fluid.find(obj,function(thisValue){return value===thisValue?!0:void 0}):void 0},fluid.keyForValue=function(obj,value){return fluid.find(obj,function(thisValue,key){return value===thisValue?key:void 0})},fluid.findKeyInObject=fluid.keyForValue,fluid.arrayToHash=function(array){var togo={};return fluid.each(array,function(el){togo[el]=!0}),togo},fluid.clear=function(target){if(fluid.isArrayable(target))target.length=0;else for(var i in target)delete target[i]},fluid.compareStringLength=function(ascending){return ascending?function(a,b){return a.length-b.length}:function(a,b){return b.length-a.length}},fluid.logLevelsSpec={FATAL:0,FAIL:5,WARN:10,IMPORTANT:12,INFO:15,TRACE:20},fluid.logLevel=fluid.transform(fluid.logLevelsSpec,function(value,key){return{type:"fluid.marker",value:key,priority:value}});var logLevelStack=[fluid.logLevel.IMPORTANT];fluid.VALUE={type:"fluid.marker",value:"VALUE"},fluid.NO_VALUE={type:"fluid.marker",value:"NO_VALUE"},fluid.EXPAND={type:"fluid.marker",value:"EXPAND"},fluid.EXPAND_NOW={type:"fluid.marker",value:"EXPAND_NOW"},fluid.isMarker=function(totest,type){return totest&&"object"==typeof totest&&"fluid.marker"===totest.type?type?totest.value===type.value:!0:!1},fluid.model={},fluid.model.copyModel=function(target,source){fluid.clear(target),$.extend(!0,target,source)},fluid.model.parseEL=function(EL){return""===EL?[]:String(EL).split(".")},fluid.model.composePath=function(prefix,suffix){return""===prefix?suffix:""===suffix?prefix:prefix+"."+suffix},fluid.model.composeSegments=function(){return fluid.makeArray(arguments).join(".")},fluid.path=fluid.model.composeSegments,fluid.composePath=fluid.model.composePath,fluid.requireDataBinding=function(){fluid.fail("Please include DataBinding.js in order to operate complex model accessor configuration")},fluid.model.setWithStrategy=fluid.model.getWithStrategy=fluid.requireDataBinding,fluid.model.resolvePathSegment=function(root,segment,create,origEnv){return!origEnv&&root.resolvePathSegment?root.resolvePathSegment(segment):create&&void 0===root[segment]?root[segment]={}:root[segment]},fluid.model.pathToSegments=function(EL,config){var parser=config&&config.parser?config.parser.parse:fluid.model.parseEL,segs="number"==typeof EL||"string"==typeof EL?parser(EL):EL;return segs},fluid.model.accessImpl=function(root,EL,newValue,config,initSegs,returnSegs,traverser){var segs=fluid.model.pathToSegments(EL,config),initPos=0;initSegs&&(initPos=initSegs.length,segs=initSegs.concat(segs));var uncess=newValue===fluid.NO_VALUE?0:1;return root=traverser(root,segs,initPos,config,uncess),newValue===fluid.NO_VALUE||newValue===fluid.VALUE?returnSegs?{root:root,segs:segs}:root:void(root[segs[segs.length-1]]=newValue)},fluid.model.accessSimple=function(root,EL,newValue,environment,initSegs,returnSegs){return fluid.model.accessImpl(root,EL,newValue,environment,initSegs,returnSegs,fluid.model.traverseSimple)},fluid.model.traverseSimple=function(root,segs,initPos,environment,uncess){for(var origEnv=environment,limit=segs.length-uncess,i=0;limit>i;++i){if(!root)return root;var segment=segs[i];root=environment&&environment[segment]?environment[segment]:fluid.model.resolvePathSegment(root,segment,1===uncess,origEnv),environment=null}return root},fluid.model.setSimple=function(root,EL,newValue,environment,initSegs){fluid.model.accessSimple(root,EL,newValue,environment,initSegs,!1)},fluid.model.getSimple=function(root,EL,environment,initSegs){return null===EL||void 0===EL||0===EL.length?root:fluid.model.accessSimple(root,EL,fluid.NO_VALUE,environment,initSegs,!1)},fluid.decodeAccessorArg=function(arg3){return arg3&&arg3!==fluid.model.defaultGetConfig&&arg3!==fluid.model.defaultSetConfig?"environment"===arg3.type?arg3.value:void 0:null},fluid.set=function(root,EL,newValue,config,initSegs){var env=fluid.decodeAccessorArg(config);void 0===env?fluid.model.setWithStrategy(root,EL,newValue,config,initSegs):fluid.model.setSimple(root,EL,newValue,env,initSegs)},fluid.get=function(root,EL,config,initSegs){var env=fluid.decodeAccessorArg(config);return void 0===env?fluid.model.getWithStrategy(root,EL,config,initSegs):fluid.model.accessImpl(root,EL,fluid.NO_VALUE,env,null,!1,fluid.model.traverseSimple)},fluid.model.setBeanValue=fluid.set,fluid.model.getBeanValue=fluid.get,fluid.getGlobalValue=function(path,env){return path?(env=env||fluid.environment,fluid.get(globalObject,path,{type:"environment",value:env})):void 0},fluid.bind=function(obj,fnName,args){return obj[fnName].apply(obj,fluid.makeArray(args))},fluid.invokeGlobalFunction=function(functionPath,args,environment){var func=fluid.getGlobalValue(functionPath,environment);return func?func.apply(null,args||[]):void fluid.fail("Error invoking global function: "+functionPath+" could not be located")},fluid.registerGlobalFunction=function(functionPath,func,env){env=env||fluid.environment,fluid.set(globalObject,functionPath,func,{type:"environment",value:env})},fluid.setGlobalValue=fluid.registerGlobalFunction,fluid.registerNamespace=function(naimspace,env){env=env||fluid.environment;var existing=fluid.getGlobalValue(naimspace,env);return existing||(existing={},fluid.setGlobalValue(naimspace,existing,env)),existing},fluid.dumpEl=fluid.identity,fluid.renderTimestamp=fluid.identity,fluid.registerNamespace("fluid.event"),fluid.generateUniquePrefix=function(){return Math.floor(1e12*Math.random()).toString(36)+"-"};var fluid_prefix=fluid.generateUniquePrefix();fluid.fluidInstance=fluid_prefix;var fluid_guid=1;fluid.allocateGuid=function(){return fluid_prefix+fluid_guid++},fluid.event.identifyListener=function(listener){return"string"==typeof listener||listener.$$fluid_guid||(listener.$$fluid_guid=fluid.allocateGuid()),listener.$$fluid_guid},fluid.event.impersonateListener=function(origListener,newListener){fluid.event.identifyListener(origListener),newListener.$$fluid_guid=origListener.$$fluid_guid},fluid.event.mapPriority=function(priority,count){return null===priority||void 0===priority?count:"last"===priority?Number.MAX_VALUE:"first"===priority?-Number.MAX_VALUE:-priority},fluid.priorityComparator=function(recA,recB){return recA.priority-recB.priority},fluid.event.sortListeners=function(listeners){var togo=[];return fluid.each(listeners,function(listener){void 0!==listener.length?togo=togo.concat(listener):togo.push(listener)}),togo.sort(fluid.priorityComparator)},fluid.event.invokeListener=function(listener,args){return"string"==typeof listener&&(listener=fluid.event.resolveListener({globalName:listener})),listener.apply(null,args)},fluid.event.resolveListener=function(listener){if(listener.globalName){var listenerFunc=fluid.getGlobalValue(listener.globalName);listenerFunc?listener=listenerFunc:fluid.fail("Unable to look up name "+listener.globalName+" as a global function")}return listener},fluid.nameComponent=function(that){return that?"component with typename "+that.typeName+" and id "+that.id:"[unknown component]"},fluid.event.nameEvent=function(that,eventName){return eventName+" of "+fluid.nameComponent(that)},fluid.makeEventFirer=function(unicast,preventable,name,ownerId){function fireToListeners(listeners,args,wrapper){if(listeners&&!that.destroyed){fluid.log(fluid.logLevel.TRACE,"Firing event "+name+" to list of "+listeners.length+" listeners");for(var i=0;i<listeners.length;++i){var lisrec=listeners[i];lisrec.listener=fluid.event.resolveListener(lisrec.listener);var listener=lisrec.listener;if(!lisrec.predicate||lisrec.predicate(listener,args)){var value,ret=(wrapper?wrapper(listener):listener).apply(null,args);if((preventable&&ret===!1||that.destroyed)&&(value=!1),unicast&&(value=ret),void 0!==value)return value}}}}var that,identify=fluid.event.identifyListener,lazyInit=function(){that.listeners={},that.byId={},that.sortedListeners=[],that.addListener=function(listener,namespace,predicate,priority,softNamespace){if(that.destroyed&&fluid.fail("Cannot add listener to destroyed event firer "+that.name),listener){unicast&&(namespace="unicast"),"string"==typeof listener&&(listener={globalName:listener});var id=identify(listener);namespace=namespace||id;var record={listener:listener,predicate:predicate,namespace:namespace,softNamespace:softNamespace,priority:fluid.event.mapPriority(priority,that.sortedListeners.length)};if(that.byId[id]=record,softNamespace){var thisListeners=that.listeners[namespace]=fluid.makeArray(that.listeners[namespace]);thisListeners.push(record)}else that.listeners[namespace]=record;that.sortedListeners=fluid.event.sortListeners(that.listeners)}},that.addListener.apply(null,arguments)};return that={eventId:fluid.allocateGuid(),ownerId:ownerId,name:name,typeName:"fluid.event.firer",destroy:function(){that.destroyed=!0},addListener:function(){lazyInit.apply(null,arguments)},removeListener:function(listener){if(that.listeners){var namespace,id;if("string"==typeof listener){namespace=listener;var record=that.listeners[listener];if(!record)return;listener=void 0!==record.length?record:record.listener}"function"==typeof listener&&(id=identify(listener),id||fluid.fail("Cannot remove unregistered listener function ",listener," from event "+that.name));var rec=that.byId[id],softNamespace=rec&&rec.softNamespace;namespace=namespace||rec&&rec.namespace||id,delete that.byId[id],softNamespace?fluid.remove_if(that.listeners[namespace],function(thisLis){return thisLis.listener.$$fluid_guid===id}):delete that.listeners[namespace],that.sortedListeners=fluid.event.sortListeners(that.listeners)}},fireToListeners:function(listeners,args,wrapper){return fireToListeners(listeners,args,wrapper)},fire:function(){return fireToListeners(that.sortedListeners,arguments)}}},fluid.event.getEventFirer=fluid.makeEventFirer,fluid.fireEvent=function(component,path,args){var firer=fluid.get(component,path);firer&&firer.fire.apply(null,fluid.makeArray(args))},fluid.event.addListenerToFirer=function(firer,value,namespace,wrapper){if(wrapper=wrapper||fluid.identity,fluid.isArrayable(value))for(var i=0;i<value.length;++i)fluid.event.addListenerToFirer(firer,value[i],namespace,wrapper);else"function"==typeof value||"string"==typeof value?wrapper(firer).addListener(value,namespace):value&&"object"==typeof value&&wrapper(firer).addListener(value.listener,namespace||value.namespace,value.predicate,value.priority,value.softNamespace)},fluid.event.resolveListenerRecord=function(records){return{records:records}},fluid.expandOptions=function(material){fluid.fail("fluid.expandOptions could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor "+material)},fluid.mergeListeners=function(that,events,listeners){fluid.each(listeners,function(value,key){var firer,namespace;if("{"===key.charAt(0))firer=fluid.expandOptions(key,that),firer||fluid.fail("Error in listener record: key "+key+' could not be looked up to an event firer - did you miss out "events." when referring to an event firer?');else{var keydot=key.indexOf(".");-1!==keydot&&(namespace=key.substring(keydot+1),key=key.substring(0,keydot)),events[key]||fluid.fail("Listener registered for event "+key+" which is not defined for this component"),firer=events[key]}var record=fluid.event.resolveListenerRecord(value,that,key,namespace,!0);fluid.event.addListenerToFirer(firer,record.records,namespace,record.adderWrapper)})},fluid.eventFromRecord=function(eventSpec,eventKey,that){var event,isIoCEvent=eventSpec&&("string"!=typeof eventSpec||"{"===eventSpec.charAt(0));return isIoCEvent?fluid.event.resolveEvent?event=fluid.event.resolveEvent(that,eventKey,eventSpec):fluid.fail("fluid.event.resolveEvent could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor ",eventSpec):event=fluid.makeEventFirer("unicast"===eventSpec,"preventable"===eventSpec,fluid.event.nameEvent(that,eventKey),that.id),event},fluid.instantiateFirers=function(that,options){fluid.each(options.events,function(eventSpec,eventKey){that.events[eventKey]=fluid.eventFromRecord(eventSpec,eventKey,that)})},fluid.mergeListenerPolicy=function(target,source,key){var hasNamespace="{"!==key.charAt(0)&&-1!==key.indexOf(".");return hasNamespace?source||target:fluid.arrayConcatPolicy(target,source)},fluid.makeMergeListenersPolicy=function(merger){return function(target,source){return target=target||{},fluid.each(source,function(listeners,key){target[key]=merger(target[key],listeners,key)}),target}},fluid.unique=function(array){return fluid.remove_if(array,function(element,i){return!element||i>0&&element===array[i-1]})},fluid.arrayConcatPolicy=function(target,source){return fluid.makeArray(target).concat(fluid.makeArray(source))},fluid.typeTag=function(name){return name?{typeName:name,id:fluid.allocateGuid()}:null},fluid.staticEnvironment=fluid.typeTag("fluid.staticEnvironment"),fluid.singleThreadLocal=function(initFunc){var value=initFunc();return function(newValue){return void 0===newValue?value:value=newValue}},fluid.threadLocal=fluid.singleThreadLocal,fluid.globalThreadLocal=fluid.threadLocal(function(){return fluid.typeTag("fluid.dynamicEnvironment")});var gradeTick=1,gradeTickStore={},defaultsStore={},resolveGradesImpl=function(gs,gradeNames,base){var raw=!0;return base?raw=1===gradeNames.length:gradeNames=fluid.makeArray(gradeNames),fluid.each(gradeNames,function(gradeName){if(gradeName&&!gs.gradeHash[gradeName]){var isDynamic="{"===gradeName.charAt(0),options=(isDynamic?null:raw?fluid.rawDefaults(gradeName):fluid.getGradedDefaults(gradeName))||{},thisTick=gradeTickStore[gradeName]||gradeTick-1;gs.lastTick=Math.max(gs.lastTick,thisTick),gs.gradeHash[gradeName]=!0,gs.gradeChain.push(gradeName),gs.optionsChain.push(options);for(var oGradeNames=fluid.makeArray(options.gradeNames),i=0;i<oGradeNames.length;++i){var oGradeName=oGradeNames[i],isAuto="autoInit"===oGradeName;raw?isAuto||resolveGradesImpl(gs,oGradeName):gs.gradeHash[oGradeName]||isAuto||(gs.gradeHash[oGradeName]=!0,gs.gradeChain.push(oGradeName))}}}),gs};fluid.resolveGradeStructure=function(defaultName,gradeNames){var gradeStruct={lastTick:0,gradeChain:[],gradeHash:{},optionsChain:[]};return resolveGradesImpl(gradeStruct,(fluid.makeArray(gradeNames).reverse()||[]).concat([defaultName]),!0)};var mergedDefaultsCache={};fluid.gradeNamesToKey=function(defaultName,gradeNames){return defaultName+"|"+gradeNames.join("|")},fluid.hasGrade=function(options,gradeName){return options&&options.gradeNames?fluid.contains(options.gradeNames,gradeName):!1},fluid.resolveGrade=function(defaults,defaultName,gradeNames){for(var gradeStruct=fluid.resolveGradeStructure(defaultName,gradeNames),mergeArgs=gradeStruct.optionsChain.reverse(),mergePolicy={},i=0;i<mergeArgs.length;++i)mergeArgs[i]&&mergeArgs[i].mergePolicy&&(mergePolicy=$.extend(!0,mergePolicy,mergeArgs[i].mergePolicy));mergeArgs=[mergePolicy,{}].concat(mergeArgs);var mergedDefaults=fluid.merge.apply(null,mergeArgs);return mergedDefaults.gradeNames=gradeStruct.gradeChain,fluid.hasGrade(defaults,"autoInit")&&mergedDefaults.gradeNames.push("autoInit"),{defaults:mergedDefaults,lastTick:gradeStruct&&gradeStruct.lastTick}},fluid.getGradedDefaults=function(defaultName,gradeNames){gradeNames=fluid.makeArray(gradeNames);var key=fluid.gradeNamesToKey(defaultName,gradeNames),mergedDefaults=mergedDefaultsCache[key];if(mergedDefaults){for(var lastTick=0,searchGrades=mergedDefaults.defaults.gradeNames||[],i=0;i<searchGrades.length;++i)lastTick=Math.max(lastTick,gradeTickStore[searchGrades[i]]||0);lastTick>mergedDefaults.lastTick&&(fluid.log("Clearing cache for component "+defaultName+" with gradeNames ",searchGrades),mergedDefaults=null)}if(!mergedDefaults){var defaults=fluid.rawDefaults(defaultName);if(!defaults)return defaults;mergedDefaults=mergedDefaultsCache[key]=fluid.resolveGrade(defaults,defaultName,gradeNames)}return mergedDefaults.defaults},fluid.annotateListeners=function(componentName,options){options.listeners&&(options.listeners=fluid.transform(options.listeners,function(record){var togo=fluid.makeArray(record);return fluid.transform(togo,function(onerec){return fluid.isPrimitive(onerec)||(onerec.componentSource=componentName),onerec})}))},fluid.rawDefaults=function(componentName,options){if(void 0===options)return defaultsStore[componentName];fluid.pushActivity("registerDefaults","registering defaults for grade %componentName with options %options",{componentName:componentName,options:options});var optionsCopy=fluid.expandCompact?fluid.expandCompact(options):fluid.copy(options);fluid.annotateListeners(componentName,optionsCopy),defaultsStore[componentName]=optionsCopy,gradeTickStore[componentName]=gradeTick++,fluid.popActivity()},fluid.doIndexDefaults=function(defaultName,defaults,index,indexSpec){for(var requiredGrades=fluid.makeArray(indexSpec.gradeNames),i=0;i<requiredGrades.length;++i)if(!fluid.hasGrade(defaults,requiredGrades[i]))return;for(var indexFunc="function"==typeof indexSpec.indexFunc?indexSpec.indexFunc:fluid.getGlobalValue(indexSpec.indexFunc),keys=indexFunc(defaults)||[],j=0;j<keys.length;++j)(index[keys[j]]=index[keys[j]]||[]).push(defaultName)},fluid.indexDefaults=function(indexName,indexSpec){var index={};for(var defaultName in defaultsStore){var defaults=fluid.getGradedDefaults(defaultName);fluid.doIndexDefaults(defaultName,defaults,index,indexSpec)}return index},fluid.defaults=function(componentName,options){return void 0===options?fluid.getGradedDefaults(componentName):(options&&options.options&&fluid.fail("Probable error in options structure for "+componentName+' with option named "options" - perhaps you meant to write these options at top level in fluid.defaults? - ',options),fluid.rawDefaults(componentName,options),fluid.hasGrade(options,"autoInit")&&fluid.makeComponent(componentName,fluid.getGradedDefaults(componentName)),void 0)},fluid.makeComponent=function(componentName,options){if(options.gradeNames&&0!==options.gradeNames.length){if(!options.initFunction){for(var blankGrades=[],i=0;i<options.gradeNames.length;++i){var gradeName=options.gradeNames[i],defaults=fluid.rawDefaults(gradeName);defaults||"autoInit"===gradeName||blankGrades.push(gradeName)}0===blankGrades.length?fluid.fail("Cannot autoInit component "+componentName+" which does not have an initFunction defined"):fluid.fail("The grade hierarchy of component with typeName "+componentName+" is incomplete - it inherits from the following grade(s): "+blankGrades.join(", ")+" for which the grade definitions are corrupt or missing. Please check the files which might include these  grades and ensure they are readable and have been loaded by this instance of Infusion")}}else fluid.fail("Cannot autoInit component "+componentName+" which does not have any gradeNames defined");var creator=function(){return fluid.initComponent(componentName,arguments)},existing=fluid.getGlobalValue(componentName);existing&&$.extend(creator,existing),fluid.setGlobalValue(componentName,creator)},fluid.makeComponents=function(components){fluid.each(components,function(value,key){var options={gradeNames:fluid.makeArray(value).concat(["autoInit"])};fluid.defaults(key,options)})},fluid.model.mergeModel=function(target,source){if(!fluid.isPrimitive(target)){var copySource=fluid.copy(source);$.extend(!0,source,target),$.extend(!0,source,copySource)}return source};var emptyPolicy={};fluid.derefMergePolicy=function(policy){return(policy?policy["*"]:emptyPolicy)||emptyPolicy},fluid.compileMergePolicy=function(mergePolicy){var builtins={},defaultValues={},togo={builtins:builtins,defaultValues:defaultValues};return mergePolicy?(fluid.each(mergePolicy,function(value,key){var parsed={},builtin=!0;if("function"==typeof value)parsed.func=value;else if("object"==typeof value)parsed=value;else if(fluid.isDefaultValueMergePolicy(value))fluid.set(defaultValues,key,"{that}.options."+value),togo.hasDefaults=!0,builtin=!1;else for(var split=value.split(/\s*,\s*/),i=0;i<split.length;++i)parsed[split[i]]=!0;builtin&&fluid.set(builtins,fluid.composePath(key,"*"),parsed)}),togo):togo},fluid.isDefaultValueMergePolicy=function(policy){return"string"==typeof policy&&-1===policy.indexOf(",")&&!/replace|preserve|nomerge|noexpand/.test(policy)},fluid.mergeOneImpl=function(thisTarget,thisSource,j,sources,newPolicy,i,segs){var togo=thisTarget,primitiveTarget=fluid.isPrimitive(thisTarget);return void 0!==thisSource&&(newPolicy.func||null===thisSource||!fluid.isPlainObject(thisSource)||fluid.isDOMish(thisSource)||thisSource===fluid.VALUE||newPolicy.preserve||newPolicy.nomerge?(sources[j]=void 0,togo=newPolicy.func?newPolicy.func.call(null,thisTarget,thisSource,segs[i-1],segs,i):fluid.isValue(thisTarget)&&newPolicy.preserve?fluid.model.mergeModel(thisTarget,thisSource):thisSource):primitiveTarget&&(togo=thisTarget=fluid.freshContainer(thisSource))),togo},fluid.fetchMergeChildren=function(target,i,segs,sources,mergePolicy,options){for(var thisPolicy=fluid.derefMergePolicy(mergePolicy),j=sources.length-1;j>=0;--j){var source=sources[j];if(void 0!==source&&(fluid.each(source,function(newSource,name){target.hasOwnProperty(name)||(segs[i]=name,options.strategy(target,name,i+1,segs,sources,mergePolicy))}),thisPolicy.replace))break}return target},fluid.inEvaluationMarker={__CURRENTLY_IN_EVALUATION__:!0},fluid.destroyedMarker={__COMPONENT_DESTROYED__:!0},fluid.strategyRecursionBailout=50,fluid.makeMergeStrategy=function(options){var strategy=function(target,name,i,segs,sources,policy){if(i>fluid.strategyRecursionBailout&&fluid.fail("Overflow/circularity in options merging, current path is ",segs," at depth ",i,' - please protect components from merging using the "nomerge" merge policy'),fluid.isPrimitive(target))return void 0;fluid.isTracing&&fluid.tracing.pathCount.push(fluid.path(segs.slice(0,i)));var oldTarget;if(target.hasOwnProperty(name)){if(oldTarget=target[name],!options.evaluateFully)return oldTarget}else target[name]=fluid.inEvaluationMarker;void 0===sources&&(segs=fluid.makeArray(segs),sources=regenerateSources(options.sources,segs,i-1,options.sourceStrategies),policy=regenerateCursor(options.mergePolicy,segs,i-1,fluid.concreteTrundler));var start,limit,mul,newPolicyHolder=fluid.concreteTrundler(policy,name),newPolicy=fluid.derefMergePolicy(newPolicyHolder);newPolicy.replace?(start=1-sources.length,limit=0,mul=-1):(start=0,limit=sources.length-1,mul=1);for(var thisTarget,newSources=[],j=start;limit>=j;++j){var k=mul*j,thisSource=options.sourceStrategies[k](sources[k],name,i,segs);if(void 0!==thisSource&&(newSources[k]=thisSource,void 0===oldTarget)){if(-1===mul){thisTarget=target[name]=thisSource;break}thisTarget=target[name]=fluid.mergeOneImpl(thisTarget,thisSource,j,newSources,newPolicy,i,segs,options)}}return void 0!==oldTarget&&(thisTarget=oldTarget),newSources.length>0&&(fluid.isPrimitive(thisTarget)||fluid.fetchMergeChildren(thisTarget,i,segs,newSources,newPolicyHolder,options)),void 0===oldTarget&&0===newSources.length&&delete target[name],thisTarget};return options.strategy=strategy,strategy},fluid.driveStrategy=function(root,pathSegs,strategy){pathSegs=fluid.makeArray(pathSegs);for(var i=0;i<pathSegs.length;++i){if(!root)return void 0;root=strategy(root,pathSegs[i],i+1,pathSegs)}return root},fluid.concreteTrundler=function(source,seg){return source?source[seg]:void 0},fluid.merge=function(policy){var sources=Array.prototype.slice.call(arguments,1),compiled=fluid.compileMergePolicy(policy).builtins,options=fluid.makeMergeOptions(compiled,sources,{});return options.initter(),options.target},fluid.simpleGingerBlock=function(source,recordType){var block={target:source,simple:!0,strategy:fluid.concreteTrundler,initter:fluid.identity,recordType:recordType,priority:fluid.mergeRecordTypes[recordType]};return block},fluid.makeMergeOptions=function(policy,sources,userOptions){
var options={mergePolicy:policy,sources:sources};return options=$.extend(options,userOptions),options.target=options.target||fluid.freshContainer(options.sources[0]),options.sourceStrategies=options.sourceStrategies||fluid.generate(options.sources.length,fluid.concreteTrundler),options.initter=function(){options.evaluateFully=!0,fluid.fetchMergeChildren(options.target,0,[],options.sources,options.mergePolicy,options)},fluid.makeMergeStrategy(options),options},fluid.transformOptions=function(options,transRec){fluid.expect("Options transformation record",["transformer","config"],transRec);var transFunc=fluid.getGlobalValue(transRec.transformer);return transFunc.call(null,options,transRec.config)},fluid.findMergeBlocks=function(mergeBlocks,recordType){return fluid.remove_if(fluid.makeArray(mergeBlocks),function(block){return block.recordType!==recordType})},fluid.transformOptionsBlocks=function(mergeBlocks,transformOptions,recordTypes){fluid.each(recordTypes,function(recordType){var blocks=fluid.findMergeBlocks(mergeBlocks,recordType);fluid.each(blocks,function(block){block[block.simple?"target":"source"]=fluid.transformOptions(block.source,transformOptions)})})},fluid.deliverOptionsStrategy=fluid.identity,fluid.computeComponentAccessor=fluid.identity,fluid.computeDynamicComponents=fluid.identity,fluid.mergeRecordTypes={defaults:0,localOptions:50,defaultValueMerge:100,subcomponentRecord:200,distribution:300,user:500,demands:600},fluid.destroyValue=function(target,path){target&&fluid.model.applyChangeRequest(target,{type:"DELETE",path:path})},fluid.mergeComponentOptions=function(that,componentName,userOptions,localOptions){function computeMergePolicy(){mergePolicy=fluid.driveStrategy(options,"mergePolicy",mergeOptions.strategy),mergePolicy=$.extend({},fluid.rootMergePolicy,mergePolicy),compiledPolicy=fluid.compileMergePolicy(mergePolicy),$.extend(!0,sharedMergePolicy,compiledPolicy.builtins)}var rawDefaults=fluid.rawDefaults(componentName),defaults=fluid.getGradedDefaults(componentName,rawDefaults&&rawDefaults.gradeNames?null:localOptions.gradeNames),sharedMergePolicy={},mergeBlocks=[];mergeBlocks=fluid.expandComponentOptions?mergeBlocks.concat(fluid.expandComponentOptions(sharedMergePolicy,defaults,userOptions,that)):mergeBlocks.concat([fluid.simpleGingerBlock(defaults,"defaults"),fluid.simpleGingerBlock(userOptions,"user")]);var options={},sourceStrategies=[],sources=[],baseMergeOptions={target:options,sourceStrategies:sourceStrategies},updateBlocks=function(){mergeBlocks.sort(fluid.priorityComparator),sourceStrategies.length=0,sources.length=0,fluid.each(mergeBlocks,function(block){sourceStrategies.push(block.strategy),sources.push(block.target)})};updateBlocks();var mergeOptions=fluid.makeMergeOptions(sharedMergePolicy,sources,baseMergeOptions);mergeOptions.mergeBlocks=mergeBlocks,mergeOptions.updateBlocks=updateBlocks,mergeOptions.destroyValue=function(path){for(var i=0;i<mergeBlocks.length;++i)fluid.destroyValue(mergeBlocks[i].target,path);fluid.destroyValue(baseMergeOptions.target,path)};var compiledPolicy,mergePolicy;computeMergePolicy(),compiledPolicy.hasDefaults&&(fluid.generateExpandBlock?(mergeBlocks.push(fluid.generateExpandBlock({options:compiledPolicy.defaultValues,recordType:"defaultValueMerge",priority:fluid.mergeRecordTypes.defaultValueMerge},that,{})),updateBlocks()):fluid.fail("Cannot operate mergePolicy ",mergePolicy," for component ",that," without including FluidIoC.js")),that.options=options;var optionsNickName=fluid.driveStrategy(options,"nickName",mergeOptions.strategy);that.nickName=optionsNickName||fluid.computeNickName(that.typeName),fluid.driveStrategy(options,"gradeNames",mergeOptions.strategy),fluid.deliverOptionsStrategy(that,options,mergeOptions);var transformOptions=fluid.driveStrategy(options,"transformOptions",mergeOptions.strategy);return transformOptions&&(fluid.transformOptionsBlocks(mergeBlocks,transformOptions,["user","subcomponentRecord"]),updateBlocks()),fluid.computeComponentAccessor(that),baseMergeOptions.target.mergePolicy||computeMergePolicy(),mergeOptions},fluid.defaults("fluid.function",{}),fluid.lifecycleFunctions={preInitFunction:!0,postInitFunction:!0,finalInitFunction:!0},fluid.rootMergePolicy=$.extend({gradeNames:fluid.arrayConcatPolicy,distributeOptions:fluid.arrayConcatPolicy,transformOptions:"replace"},fluid.transform(fluid.lifecycleFunctions,function(){return fluid.mergeListenerPolicy})),fluid.defaults("fluid.littleComponent",{gradeNames:["autoInit"],initFunction:"fluid.initLittleComponent",mergePolicy:fluid.rootMergePolicy,argumentMap:{options:0}}),fluid.defaults("fluid.eventedComponent",{gradeNames:["fluid.littleComponent","autoInit"],events:{onCreate:null,onAttach:null,onClear:null,onDestroy:null,afterDestroy:null},mergePolicy:{listeners:fluid.makeMergeListenersPolicy(fluid.mergeListenerPolicy)}}),fluid.COMPONENT_OPTIONS={type:"fluid.marker",value:"COMPONENT_OPTIONS"},fluid.emptySubcomponent=function(options){var that=fluid.typeTag("fluid.emptySubcomponent");that.options=options||{},that.options.gradeNames=[that.typeName],options=fluid.makeArray(options);for(var i=0;i<options.length;++i)that[options[i]]=fluid.identity;return that},fluid.computeNickName=function(typeName){var segs=fluid.model.parseEL(typeName);return segs[segs.length-1]},fluid.typeFount=function(options){var that=fluid.initLittleComponent("fluid.typeFount",options);return fluid.typeTag(that.options.targetTypeName)},fluid.initLittleComponent=function(name,userOptions,localOptions,receiver){var that=fluid.typeTag(name);localOptions=localOptions||{gradeNames:"fluid.littleComponent"},that.destroy=fluid.makeRootDestroy(that);var mergeOptions=fluid.mergeComponentOptions(that,name,userOptions,localOptions),options=that.options,evented=fluid.hasGrade(options,"fluid.eventedComponent");evented&&(that.events={}),(receiver||fluid.identity)(that,options,mergeOptions.strategy),fluid.computeDynamicComponents(that,mergeOptions);for(var i=0;i<mergeOptions.mergeBlocks.length;++i)mergeOptions.mergeBlocks[i].initter();return mergeOptions.initter(),delete options.mergePolicy,fluid.initLifecycleFunctions(that),fluid.fireEvent(options,"preInitFunction",that),evented&&(fluid.instantiateFirers(that,options),fluid.mergeListeners(that,that.events,options.listeners)),fluid.hasGrade(options,"autoInit")||fluid.clearLifecycleFunctions(options),that},fluid.updateWithDefaultLifecycle=function(key,value,typeName){var funcName=typeName+"."+key.substring(0,key.length-"function".length),funcVal=fluid.getGlobalValue(funcName);if("function"==typeof funcVal){value=fluid.makeArray(value);var existing=fluid.find(value,function(el){var listener=el.listener||el;return listener===funcVal||listener===funcName?!0:void 0});existing||value.push(funcVal)}return value},fluid.initLifecycleFunctions=function(that){var gradeNames=that.options.gradeNames||[];fluid.each(fluid.lifecycleFunctions,function(func,key){for(var value=that.options[key],i=gradeNames.length-1;i>=0;--i)"autoInit"!==gradeNames[i]&&(value=fluid.updateWithDefaultLifecycle(key,value,gradeNames[i]));value&&(that.options[key]=fluid.makeEventFirer(null,null,key,that.id),fluid.event.addListenerToFirer(that.options[key],value))})},fluid.clearLifecycleFunctions=function(options){fluid.each(fluid.lifecycleFunctions,function(value,key){delete options[key]}),delete options.initFunction},fluid.diagnoseFailedView=fluid.identity,fluid.makeRootDestroy=function(that){return function(){fluid.fireEvent(that,"events.onClear",[that,"",null]),fluid.doDestroy(that),fluid.fireEvent(that,"events.afterDestroy",[that,"",null])}},fluid.isDestroyed=function(that){return that.destroy===fluid.destroyedMarker},fluid.doDestroy=function(that,name,parent){fluid.fireEvent(that,"events.onDestroy",[that,name||"",parent]),that.destroy=fluid.destroyedMarker;for(var key in that.events)"afterDestroy"!==key&&"function"==typeof that.events[key].destroy&&that.events[key].destroy()},fluid.resolveReturnedPath=fluid.identity,fluid.initComponent=function(componentName,initArgs){var options=fluid.defaults(componentName);options.gradeNames||fluid.fail("Cannot initialise component "+componentName+" which has no gradeName registered");var that,args=[componentName].concat(fluid.makeArray(initArgs));return fluid.pushActivity("initComponent","constructing component of type %componentName with arguments %initArgs",{componentName:componentName,initArgs:initArgs}),that=fluid.invokeGlobalFunction(options.initFunction,args),fluid.diagnoseFailedView(componentName,that,options,args),fluid.fireEvent(that.options,"postInitFunction",that),fluid.initDependents&&fluid.initDependents(that),fluid.fireEvent(that.options,"finalInitFunction",that),fluid.clearLifecycleFunctions(that.options),fluid.fireEvent(that,"events.onCreate",that),fluid.popActivity(),fluid.resolveReturnedPath(that.options.returnedPath,that)?fluid.get(that,that.options.returnedPath):that},fluid.initSubcomponentImpl=function(that,entry,args){var togo;if("function"!=typeof entry){var entryType="string"==typeof entry?entry:entry.type;togo="fluid.emptySubcomponent"===entryType?fluid.emptySubcomponent(entry.options):fluid.invokeGlobalFunction(entryType,args)}else togo=entry.apply(null,args);return togo},fluid.initSubcomponents=function(that,className,args){var entry=that.options[className];if(entry){var entries=fluid.makeArray(entry),optindex=-1,togo=[];args=fluid.makeArray(args);for(var i=0;i<args.length;++i)args[i]===fluid.COMPONENT_OPTIONS&&(optindex=i);for(i=0;i<entries.length;++i)entry=entries[i],-1!==optindex&&(args[optindex]=entry.options),togo[i]=fluid.initSubcomponentImpl(that,entry,args);return togo}},fluid.initSubcomponent=function(that,className,args){return fluid.initSubcomponents(that,className,args)[0]};var charStart="(?:[\\w\\u00c0-\\uFFFF*_-";fluid.simpleCSSMatcher={regexp:new RegExp("([#.]?)("+charStart+"]|\\\\.)+)","g"),charToTag:{"":"tag","#":"id",".":"clazz"}},fluid.IoCSSMatcher={regexp:new RegExp("([&#]?)("+charStart+"]|\\.)+)","g"),charToTag:{"":"context","&":"context","#":"id"}};var childSeg=new RegExp("\\s*(>)?\\s*","g");fluid.parseSelector=function(selstring,strategy){var togo=[];selstring=$.trim(selstring);var regexp=strategy.regexp;regexp.lastIndex=0;for(var lastIndex=0;;){for(var atNode=[],first=!0;;){var segMatch=regexp.exec(selstring);if(!segMatch)break;if(segMatch.index!==lastIndex){if(!first)break;fluid.fail("Error in selector string - cannot match child selector expression starting at "+selstring.substring(lastIndex))}var thisNode={},text=segMatch[2],targetTag=strategy.charToTag[segMatch[1]];targetTag&&(thisNode[targetTag]=text),atNode[atNode.length]=thisNode,lastIndex=regexp.lastIndex,first=!1}childSeg.lastIndex=lastIndex;var fullAtNode={predList:atNode},childMatch=childSeg.exec(selstring);if(childMatch&&childMatch.index===lastIndex||fluid.fail("Error in selector string - can not match child selector expression at "+selstring.substring(lastIndex)),">"===childMatch[1]&&(fullAtNode.child=!0),togo[togo.length]=fullAtNode,childSeg.lastIndex>=selstring.length)break;lastIndex=childSeg.lastIndex,regexp.lastIndex=childSeg.lastIndex}return togo},fluid.stringToRegExp=function(str,flags){return new RegExp(str.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),flags)},fluid.stringTemplate=function(template,values){var keys=fluid.keys(values);keys=keys.sort(fluid.compareStringLength());for(var i=0;i<keys.length;++i){var key=keys[i],re=fluid.stringToRegExp("%"+key,"g");template=template.replace(re,values[key])}return template},fluid.defaults("fluid.messageResolver",{gradeNames:["fluid.littleComponent","autoInit"],mergePolicy:{messageBase:"nomerge",parents:"nomerge"},resolveFunc:fluid.stringTemplate,parseFunc:fluid.identity,messageBase:{},parents:[]}),fluid.messageResolver.preInit=function(that){that.messageBase=that.options.parseFunc(that.options.messageBase),that.lookup=function(messagecodes){var resolved=fluid.messageResolver.resolveOne(that.messageBase,messagecodes);return void 0===resolved?fluid.find(that.options.parents,function(parent){return parent?parent.lookup(messagecodes):void 0}):{template:resolved,resolveFunc:that.options.resolveFunc}},that.resolve=function(messagecodes,args){if(!messagecodes)return"[No messagecodes provided]";messagecodes=fluid.makeArray(messagecodes);var looked=that.lookup(messagecodes);return looked?looked.resolveFunc(looked.template,args):"[Message string for key "+messagecodes[0]+" not found]"}},fluid.messageResolver.resolveOne=function(messageBase,messagecodes){for(var i=0;i<messagecodes.length;++i){var code=messagecodes[i],message=messageBase[code];if(void 0!==message)return message}},fluid.messageLocator=function(messageBase,resolveFunc){var resolver=fluid.messageResolver({messageBase:messageBase,resolveFunc:resolveFunc});return function(messagecodes,args){return resolver.resolve(messagecodes,args)}}}(jQuery,fluid_1_5);