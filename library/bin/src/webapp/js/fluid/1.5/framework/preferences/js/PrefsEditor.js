var fluid_1_5=fluid_1_5||{};!function($,fluid){"use strict";fluid.defaults("fluid.prefs.prefsEditorLoader",{gradeNames:["fluid.viewComponent","autoInit"],components:{prefsEditor:{priority:"last",type:"fluid.prefs.prefsEditor",createOnEvent:"onCreatePrefsEditorReady"},templateLoader:{type:"fluid.prefs.resourceLoader",options:{events:{onResourcesLoaded:"{prefsEditorLoader}.events.onPrefsEditorTemplatesLoaded"}}},messageLoader:{type:"fluid.prefs.resourceLoader",options:{events:{onResourcesLoaded:"{prefsEditorLoader}.events.onPrefsEditorMessagesLoaded"}}}},events:{onPrefsEditorTemplatesLoaded:null,onPrefsEditorMessagesLoaded:null,onMsgResolverReady:null,onCreatePrefsEditorReady:{events:{templateLoaded:"onPrefsEditorTemplatesLoaded",msgResolverReady:"onMsgResolverReady"}}},listeners:{onPrefsEditorMessagesLoaded:{funcName:"fluid.prefs.prefsEditorLoader.createMsgResolver",args:["{arguments}.0","{that}"]}},distributeOptions:[{source:"{that}.options.templateLoader",removeSource:!0,target:"{that > templateLoader}.options"},{source:"{that}.options.messageLoader",removeSource:!0,target:"{that > messageLoader}.options"},{source:"{that}.options.templatePrefix",target:"{that > templateLoader > resourcePath}.options.value"},{source:"{that}.options.messagePrefix",target:"{that > messageLoader > resourcePath}.options.value"},{source:"{that}.options.prefsEditor",removeSource:!0,target:"{that > prefsEditor}.options"}]}),fluid.prefs.prefsEditorLoader.createMsgResolver=function(messageResources,that){var completeMessage;fluid.each(messageResources,function(oneResource){var message=JSON.parse(oneResource.resourceText);completeMessage=$.extend({},completeMessage,message)});var parentResolver=fluid.messageResolver({messageBase:completeMessage});that.msgResolver=fluid.messageResolver({messageBase:{},parents:[parentResolver]}),that.events.onMsgResolverReady.fire()},fluid.defaults("fluid.prefs.transformDefaultPanelsOptions",{gradeNames:["fluid.viewComponent","autoInit"],distributeOptions:[{source:"{that}.options.textSize",removeSource:!0,target:"{that textSize}.options"},{source:"{that}.options.lineSpace",removeSource:!0,target:"{that lineSpace}.options"},{source:"{that}.options.textFont",removeSource:!0,target:"{that textFont}.options"},{source:"{that}.options.contrast",removeSource:!0,target:"{that contrast}.options"},{source:"{that}.options.layoutControls",removeSource:!0,target:"{that layoutControls}.options"},{source:"{that}.options.linksControls",removeSource:!0,target:"{that linksControls}.options"}]}),fluid.defaults("fluid.prefs.resourceLoader",{gradeNames:["fluid.eventedComponent","autoInit"],listeners:{onCreate:{listener:"fluid.prefs.resourceLoader.loadTemplates",args:["{that}",{expander:{func:"{that}.resolveTemplates"}}]}},templates:{},components:{resourcePath:{type:"fluid.prefs.resourcePath"}},invokers:{transformURL:{funcName:"fluid.stringTemplate",args:["{arguments}.0",{"prefix/":"{that}.resourcePath.options.value"}]},resolveTemplates:{funcName:"fluid.prefs.resourceLoader.resolveTemplates",args:"{that}"}},events:{onResourcesLoaded:null}}),fluid.prefs.resourceLoader.resolveTemplates=function(that){var mapped=fluid.transform(that.options.templates,that.transformURL);return fluid.transform(mapped,function(url){return{url:url,forceCache:!0}})},fluid.prefs.resourceLoader.loadTemplates=function(that,resources){delete resources.expander,fluid.fetchResources(resources,function(){that.resources=resources,that.events.onResourcesLoaded.fire(resources)})},fluid.defaults("fluid.prefs.resourcePath",{gradeNames:["fluid.littleComponent","autoInit"],value:"../html/"}),fluid.defaults("fluid.prefs.settingsGetter",{gradeNames:["fluid.littleComponent","autoInit"],members:{getSettings:"{settingsStore}.get"}}),fluid.defaults("fluid.prefs.settingsSetter",{gradeNames:["fluid.littleComponent","autoInit"],invokers:{setSettings:{funcName:"fluid.prefs.settingsSetter.setSettings",args:["{arguments}.0","{settingsStore}.set"]}}}),fluid.prefs.settingsSetter.setSettings=function(model,set){var userSettings=fluid.copy(model);set(userSettings)},fluid.defaults("fluid.prefs.uiEnhancerRelay",{gradeNames:["autoInit","fluid.eventedComponent"],listeners:{onCreate:"{that}.addListener",onDestroy:"{that}.removeListener"},events:{updateEnhancerModel:"{fluid.prefs.prefsEditor}.events.onUpdateEnhancerModel"},invokers:{addListener:{funcName:"fluid.prefs.uiEnhancerRelay.addListener",args:["{that}.events.updateEnhancerModel","{that}.updateEnhancerModel"]},removeListener:{funcName:"fluid.prefs.uiEnhancerRelay.removeListener",args:["{that}.events.updateEnhancerModel","{that}.updateEnhancerModel"]},updateEnhancerModel:{funcName:"fluid.prefs.uiEnhancerRelay.updateEnhancerModel",args:["{uiEnhancer}","{fluid.prefs.prefsEditor}.model"]}}}),fluid.prefs.uiEnhancerRelay.addListener=function(modelChanged,listener){modelChanged.addListener(listener)},fluid.prefs.uiEnhancerRelay.removeListener=function(modelChanged,listener){modelChanged.removeListener(listener)},fluid.prefs.uiEnhancerRelay.updateEnhancerModel=function(uiEnhancer,newModel){uiEnhancer.updateModel(newModel)},fluid.defaults("fluid.prefs.prefsEditor",{gradeNames:["fluid.viewComponent","fluid.prefs.settingsGetter","fluid.prefs.settingsSetter","fluid.prefs.rootModel","autoInit"],invokers:{updateModel:{funcName:"fluid.fireSourcedChange",args:["{that}.applier","","{arguments}.0","{arguments}.1"]},fetch:{funcName:"fluid.prefs.prefsEditor.fetch",args:["{that}"]},applyChanges:{funcName:"fluid.prefs.prefsEditor.applyChanges",args:["{that}"]},save:{funcName:"fluid.prefs.prefsEditor.save",args:["{that}"]},saveAndApply:{funcName:"fluid.prefs.prefsEditor.saveAndApply",args:["{that}"]},reset:{funcName:"fluid.prefs.prefsEditor.reset",args:["{that}"]},cancel:{funcName:"fluid.prefs.prefsEditor.cancel",args:["{that}"]}},selectors:{cancel:".flc-prefsEditor-cancel",reset:".flc-prefsEditor-reset",save:".flc-prefsEditor-save",previewFrame:".flc-prefsEditor-preview-frame"},events:{onSave:null,onCancel:null,onReset:null,onAutoSave:null,modelChanged:null,onPrefsEditorRefresh:null,onUpdateEnhancerModel:null,onPrefsEditorMarkupReady:null,onReady:null},listeners:{onCreate:"fluid.prefs.prefsEditor.init",onAutoSave:"{that}.save"},resources:{template:"{templateLoader}.resources.prefsEditor"},autoSave:!1}),fluid.prefs.prefsEditor.applyChanges=function(that){that.events.onUpdateEnhancerModel.fire()},fluid.prefs.prefsEditor.fetch=function(that){var completeModel=that.getSettings();completeModel=$.extend(!0,{},that.rootModel,completeModel),that.updateModel(completeModel,"settingsStore"),that.events.onPrefsEditorRefresh.fire(),that.applyChanges()},fluid.prefs.prefsEditor.save=function(that){var savedSelections=fluid.copy(that.model);fluid.each(savedSelections,function(value,key){fluid.get(that.rootModel,key)===value&&delete savedSelections[key]}),that.events.onSave.fire(savedSelections),that.setSettings(savedSelections)},fluid.prefs.prefsEditor.saveAndApply=function(that){that.save(),that.events.onPrefsEditorRefresh.fire(),that.applyChanges()},fluid.prefs.prefsEditor.reset=function(that){that.updateModel(fluid.copy(that.rootModel)),that.events.onPrefsEditorRefresh.fire(),that.events.onReset.fire(that)},fluid.prefs.prefsEditor.cancel=function(that){that.events.onCancel.fire(),that.fetch()},fluid.prefs.prefsEditor.finishInit=function(that){var bindHandlers=function(that){var saveButton=that.locate("save");if(saveButton.length>0){saveButton.click(that.saveAndApply);var form=fluid.findForm(saveButton);$(form).submit(function(){that.saveAndApply()})}that.locate("reset").click(that.reset),that.locate("cancel").click(that.cancel)};that.container.append(that.options.resources.template.resourceText),bindHandlers(that),that.events.onPrefsEditorMarkupReady.fire(that),that.fetch(),that.events.onReady.fire(that)},fluid.prefs.prefsEditor.init=function(that){that.applier.modelChanged.addListener("",function(newModel,oldModel,changeRequest){that.events.modelChanged.fire(newModel,oldModel,changeRequest[0].source),that.options.autoSave&&that.events.onAutoSave.fire()}),setTimeout(function(){fluid.isDestroyed(that)||fluid.prefs.prefsEditor.finishInit(that)},1)},fluid.defaults("fluid.prefs.preview",{gradeNames:["fluid.viewComponent","autoInit"],components:{enhancer:{type:"fluid.uiEnhancer",container:"{preview}.enhancerContainer",createOnEvent:"onReady"},templateLoader:"{templateLoader}"},invokers:{updateModel:{funcName:"fluid.prefs.preview.updateModel",args:["{preview}","{prefsEditor}.model"]}},finalInitFunction:"fluid.prefs.preview.finalInit",events:{onReady:null},listeners:{"{prefsEditor}.events.modelChanged":"{that}.updateModel",onReady:"{that}.updateModel"},templateUrl:"%prefix/PrefsEditorPreview.html"}),fluid.prefs.preview.updateModel=function(that,model){setTimeout(function(){that.enhancer&&that.enhancer.updateModel(model)},0)},fluid.prefs.preview.finalInit=function(that){var templateUrl=that.templateLoader.transformURL(that.options.templateUrl);that.container.load(function(){that.enhancerContainer=$("body",that.container.contents()),that.events.onReady.fire()}),that.container.attr("src",templateUrl)}}(jQuery,fluid_1_5);