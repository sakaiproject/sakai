<style>
    .lti_tool_site_deploy {}
    .lti_tool_site_deploy .site-id-list-container {
         margin-top: 5px;
         margin-bottom: 5px;
         width: 500px;
    }
    .lti_tool_site_deploy .site-id {
        border:1px solid #555;
        padding:5px;
        font-size:1em;
        width: 300px;
    }
    .lti_tool_site_deploy .remove-btn {
        background: none;
        border: none;
        font-size: 1.5em;
        cursor: pointer;
    }
     .lti_tool_site_deploy .readonly {
        background-color: #f0f0f0;
    }

</style>

<div class="portletBody">
    <div class="lti_tool_site_deploy">
        <h3>
            $tlang.getString("tool.deploy")
        </h3>
        <form action="#toolForm("")" method="post" name="customizeForm" >

            $formOutput

            <input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
            <input type="hidden" name="id" value="$tool.get("id")" />

            <div class="site-id-list-container">
                <label style="font-weight: bold;">Sites containing the tool</label>

                <div id="site-id-list" class="site-id-list">
                    #if ($siteList && $siteList.size() > 0)
                        #foreach ($siteId in $siteList)
                            <div class="site-id-container">
                                <input type="text" class="site-id readonly" name="tool_site_ids" value="$siteId" readonly>
                                <button class="remove-btn" onclick="removeSiteId(this)">x</button>
                            </div>
                        #end
                    #end

                    <div class="site-id-container">
                        <input type="text" class="site-id" value="" name="tool_site_ids" placeholder="Enter site id...">
                        <button class="remove-btn" onclick="removeSiteId(this)">x</button>
                    </div>
                </div>

                <div style="margin-top: 5px; margin-bottom: 5px"><button class="btn-primary" onclick="addSiteId(event)">Add a site</button></div>
            </div>

            <p class="act">
                <input type="submit" accesskey ="d" class="active" name="$doToolAction"
                       value="$tlang.getString('gen.deploy')" />
                <input type="submit" accesskey ="x" name="$doCancel" value="$tlang.getString('gen.cancel')"
                       onclick="location = '$sakai_ActionURL.setPanel("ToolSystem")';return false;">
            </p>

        </form>
    </div>


    <script>
        function addSiteId(event) {
            event.preventDefault();  // Prevents the form submission and page refresh

            const siteIdList = document.getElementById('site-id-list');
            const newSiteIdContainer = document.createElement('div');
            newSiteIdContainer.className = 'site-id-container';

            const newSiteIdInput = document.createElement('input');
            newSiteIdInput.type = 'text';
            newSiteIdInput.className = 'site-id';
            newSiteIdInput.name = 'tool_site_ids';
            newSiteIdInput.placeholder = 'Enter site id...';

            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.innerHTML = 'x';
            removeBtn.onclick = function() { removeSiteId(this); };

            newSiteIdContainer.appendChild(newSiteIdInput);
            newSiteIdContainer.appendChild(removeBtn);
            siteIdList.appendChild(newSiteIdContainer);
        }

        function removeSiteId(button) {
            const siteIdContainer = button.parentElement;
            siteIdContainer.remove();
        }
    </script>


    ## Do we need this ?????
    ##    #if ( ! $isAdmin )
    ##        <script>includeLatestJQuery('lti_tool_site_deploy.vm');</script>
    ##
    ##        <script>
    ##            $(document).ready( function() {
    ##                ## Does nothing if we are not in a frame of the right name
    ##                setMainFrameHeight('sakai-basiclti-admin-iframe');
    ##                $(window).resize( function() {
    ##                    setMainFrameHeight('sakai-basiclti-admin-iframe');
    ##                });
    ##            });
    ##        </script>
    ##    #end

</div>
