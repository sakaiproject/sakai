/*! morpheus-master-grunt - v0.0.3 - 2015-05-11 This file is compiled */function closeDrawer(){$PBJQ("#selectSite div").hide(),$PBJQ("#selectSite").slideUp("fast"),removeDHTMLMask(),$PBJQ("#otherSiteTools").remove(),$PBJQ(".selectedTab").unbind("click"),$PBJQ(".moreSitesLink").unbind("keydown"),$PBJQ(".more-tab a").focus()}function createDHTMLMask(a){$PBJQ("body").append('<div id="portalMask">&nbsp;</div>'),$PBJQ("#portalMask").css("height",browserSafeDocHeight()).css({width:"100%","z-index":1e3,top:0,left:0}).bind("click",function(b){return a(),!1}),$PBJQ("#portalMask").bgiframe()}function removeDHTMLMask(){$PBJQ("#portalMask").remove()}function showToolMenu(a,b){a.preventDefault();var c=$PBJQ(a.target),d=c.attr("id"),e=d.replace(/!/g,"\\!").replace(/~/g,"\\~");if($PBJQ(".toolMenus").removeClass("toolMenusActive"),$PBJQ("."+e).length)$PBJQ("#otherSiteTools").remove();else{$PBJQ("#otherSiteTools").remove();var f='<ul id="otherSiteTools" class="'+d+'" role="menu">',g="/direct/site/"+d+"/pages.json";scroll(0,0);var h=c.offset(),i=parseInt($PBJQ("#maxToolsInt").text()),j=$PBJQ("#maxToolsAnchor").text(),k='<li class="otherSiteTool"><span><a role="menuitem" href="'+portal.portalPath+"/site/"+d+'" title="'+j+'"><span class="toolMenuIcon icon-sakai-see-all-tools"> </span>'+j+"</a></span></li>";$PBJQ.getJSON(g,function(a){$PBJQ.each(a,function(a,b){i>=a&&(b.toolpopup?f=f+'<li class="otherSiteTool"><span><a role="menuitem"  href="'+b.tools[0].url+'?sakai.popup=yes" title="'+b.title+'" onclick="window.open(\''+b.toolpopupurl+'\');"><span class="toolMenuIcon icon-'+b.tools[0].toolId.replace(/\./gi,"-")+'"> </span>'+b.title+"</a></span></li>":1===b.tools.length&&(f=f+'<li class="otherSiteTool"><span><a role="menuitem"  href="'+b.tools[0].url+'" title="'+b.title+'"><span class="toolMenuIcon icon-'+b.tools[0].toolId.replace(/\./gi,"-")+'"> </span>'+b.title+"</a></span></li>"))}),a.length-1>i&&(f+=k),f+="</ul>",$PBJQ("#portalOuterContainer").append(f),$PBJQ("#otherSiteTools").css({top:h.top+28,left:h.left-b}),$PBJQ("#otherSiteTools li a:first").focus(),c.parent().find(".toolMenus").addClass("toolMenusActive"),$PBJQ("#otherSiteTools").keydown(function(a){27==a.keyCode&&(a.preventDefault(),c.focus(),$PBJQ(this).remove(),$PBJQ("."+e).remove(),c.parent().find(".toolMenus").removeClass("toolMenusActive"))}),addArrowNavAndDisableTabNav($PBJQ("#otherSiteTools"),function(){c.focus(),$PBJQ("."+e).remove(),c.parent().find(".toolMenus").removeClass("toolMenusActive")})})}}function publishSite(a){var b="/direct/site/"+a+"/edit";$PBJQ.ajax({type:"POST",data:"published=true",url:b,success:function(){location.reload()}}).responseText}function toggleToolsNav(){event.preventDefault(),$PBJQ("body").toggleClass("toolsNav--displayed")}function toggleSitesNav(){event.preventDefault(),$PBJQ("body").toggleClass("sitesNav--displayed"),$PBJQ("#linkNav .Mrphs-sitesNav__drop").removeClass("is-clicked"),$PBJQ("#linkNav .Mrphs-sitesNav__submenu").removeClass("is-visible")}function keep_session_alive(){dismiss_session_alert(),$PBJQ.get(timeoutPortalPath)}function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto=true",cache:!0,dataType:"text",success:function(a){timeoutDialogFragment=a},error:function(a,b,c){timeoutDialogEnabled=!1}})}function show_timeout_alert(a){if(timeoutDialogEnabled)if($PBJQ("#portalMask").get(0)||(createDHTMLMask(dismiss_session_alert),$PBJQ("#portalMask").css("z-index",1e4)),$PBJQ("#timeout_alert_body").get(0))$PBJQ("#timeout_alert_body span").html(a),$PBJQ("#timeout_alert_body span").css("top",f_scrollTop()+100+"px");else{var b=timeoutDialogFragment.replace("{0}",a);$PBJQ("body").append(b)}}function toggleShortUrlOutput(a,b,c){$PBJQ(b).is(":checked")?$PBJQ.ajax({url:"/direct/url/shorten?path="+encodeURI(a),success:function(a){$PBJQ("."+c).val(a)}}):$PBJQ("."+c).val(a)}function addArrowNavAndDisableTabNav(a,b){a.find("li a").attr("tabindex","-1").keydown(function(c){var d=$PBJQ(c.target);if(40==c.keyCode){c.preventDefault();var e=d.parent().parent().next();void 0===e[0]?(a.slideUp("fast"),void 0!==b?b():d.parent().parent().parent().parent().children("a").focus()):e.find("a").focus()}else if(9==c.keyCode)a.slideUp("fast");else if(38==c.keyCode){c.preventDefault();var f=d.parent().parent().prev();void 0===f[0]?(a.slideUp("fast"),void 0!==b?b():d.parent().parent().parent().parent().children("a").focus()):f.find("a").focus()}})}function toggleMinimizeNav(){$PBJQ("#container").toggleClass("toggleNav--minimized");var a=$PBJQ(this),b=$PBJQ(".accessibility-btn-label",a);a.toggleClass("min max"),b.text()==a.data("title-expand")?(b.text(a.data("text-original")),a.attr("title",a.data("text-original")),a.attr("aria-pressed",!0),document.cookie="sakai_nav_minimized=false; path=/"):(a.data("text-original",b.text()),b.text(a.data("title-expand")),a.attr("title",a.data("title-expand")),a.attr("aria-pressed",!1),document.cookie="sakai_nav_minimized=true; path=/")}function updatePresence(){$PBJQ.ajax({url:sakaiPresenceFragment,cache:!1,success:function(a){var b=a.indexOf("<ul");if(1>b)return $PBJQ("#presenceCount").html(" "),$PBJQ("#presenceCount").removeClass("present").addClass("empty"),void location.reload();a=a.substr(b);for(var c=a,d="<li",e=0,f=0;f<c.length;f++)d==c.substr(f,d.length)&&e++;e>1?($PBJQ("#presenceCount").html(e+""),$PBJQ("#presenceCount").removeClass("empty").addClass("present")):1==e?($PBJQ("#presenceCount").html(e+""),$PBJQ("#presenceCount").removeClass("present").addClass("empty")):($PBJQ("#presenceCount").html(" "),$PBJQ("#presenceCount").removeClass("present").addClass("empty")),$PBJQ("#presenceIframe").html(a);var g=$PBJQ(".nav-selected .icon-sakai-chat").attr("href");$PBJQ("#presenceIframe .presenceList li.inChat span").wrap('<a href="'+g+'"></a>'),sakaiLastPresenceTimeOut=setTimeout("updatePresence()",3e4)},error:function(a,b){sakaiLastPresenceTimeOut=setTimeout("updatePresence()",6e4)}})}function toggleUserNav(){event.preventDefault(),$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden")}function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)}function f_filterResults(a,b,c){var d=a?a:0;return b&&(!d||d>b)&&(d=b),c&&(!d||d>c)?c:d}$PBJQ("details").details();var dhtml_view_sites=function(){$PBJQ("#selectSite").addClass("dhtml_more_tabs"),$PBJQ(".more-tab").position(),(dhtml_view_sites=function(){if($PBJQ("#selectSite").hasClass("outscreen")){$PBJQ("#selectSite").toggleClass("outscreen"),$PBJQ("#txtSearch").focus(),createDHTMLMask(dhtml_view_sites),$PBJQ(".selectedTab").bind("click",function(a){return dhtml_view_sites(),!1}),$PBJQ("#selectSite a:first").focus(),$PBJQ("#selectSite a").keydown(function(a){(38==a.keyCode||27==a.keyCode)&&(a.preventDefault(),closeDrawer())}),$PBJQ(".moreSitesLink").keydown(function(a){40==a.keyCode&&showToolMenu(a,0)});var a=$PBJQ("#txtSearch");a.length?$PBJQ(a[0]).keydown(function(a){9==a.keyCode&&a.shiftKey&&a.preventDefault()}):$PBJQ("#allSites").keydown(function(a){9==a.keyCode&&a.shiftKey&&a.preventDefault()}),$PBJQ("#otherSiteList > li:last").keydown(function(b){9!=b.keyCode||b.shiftKey||(b.preventDefault(),a.length?a[0].focus():$PBJQ("#allSites").focus())})}else $PBJQ("#selectSite").toggleClass("outscreen"),removeDHTMLMask(),$PBJQ("#otherSiteTools").remove(),$PBJQ(".selectedTab").unbind("click")})()};$PBJQ(document).ready(function(){function a(){$PBJQ("#txtSearch").val(""),$PBJQ("#otherSiteList li").show(),$PBJQ(".otherSitesCategorList li").show(),$PBJQ("#otherSitesCategorWrap h4").show(),$PBJQ("#noSearchResults").fadeOut(),$PBJQ("#imgSearch").fadeOut(),$PBJQ("#txtSearch").focus()}1===$PBJQ("#eid").length&&$PBJQ("#eid").focus(),$PBJQ(".more-tab a").keydown(function(a){return 40==a.keyCode||38==a.keyCode||27==a.keyCode?(a.preventDefault(),dhtml_view_sites()):void 0}),$PBJQ(".toolMenus").click(function(a){showToolMenu(a,173)});var b=portal.siteTitle;b&&(portal.shortDescription&&(b=b+" ("+portal.shortDescription+")"),$PBJQ(".portletTitle h2").prepend('<span class="siteTitle">'+b+":</span> ")),$PBJQ("#imgSearch").click(function(){a()}),$PBJQ("#txtSearch").keyup(function(b){27==b.keyCode&&a(),$PBJQ("#txtSearch").val().length>0&&($PBJQ("#otherSiteList li, .otherSitesCategorList li").hide(),$PBJQ("#otherSitesCategorWrap h4").hide(),$PBJQ("#otherSiteList li a span.fullTitle:Contains('"+$PBJQ("#txtSearch").val()+"')").parent("a").parent("li").show(),$PBJQ(".otherSitesCategorList li a span.fullTitle:Contains('"+$PBJQ("#txtSearch").val()+"')").parent("a").parent("li").show().closest("ul").prev("h4").show(),$PBJQ("#imgSearch").fadeIn("slow")),0==$PBJQ("#txtSearch").val().length&&a(),$PBJQ("#otherSiteList li:visible").length<1&&$PBJQ(".otherSitesCategorList li:visible").length<1&&($PBJQ(".norecords").remove(),$PBJQ("#otherSiteSearch #noSearchResults").fadeIn("slow"))}),$PBJQ.expr[":"].Contains=function(a,b,c){return $PBJQ(a).text().toUpperCase().indexOf(c[3].toUpperCase())>=0},$PBJQ("#presenceToggle").click(function(a){a.preventDefault(),$PBJQ("#presenceArea").toggle()}),$PBJQ(".trayPopupClose").click(function(a){a.preventDefault(),$PBJQ(this).closest(".trayPopup").hide()}),$PBJQ("a.tool-directurl").length&&$PBJQ("a.tool-directurl").cluetip({local:!0,arrows:!0,cluetipClass:"jtip",sticky:!0,cursor:"pointer",activation:"click",closePosition:"title",closeText:'<img src="/library/image/silk/cross.png" alt="close">'}),$PBJQ("#toggleSubsitesLink").click(function(a){var b=$PBJQ(this);if("block"==$PBJQ("#subSites").css("display"))$PBJQ("#subSites").hide();else{var c=b.position();$PBJQ("#subSites").css({position:"absolute",display:"block",left:c.left+b.width()+14+"px",top:c.top+"px"})}})}),$PBJQ(".js-toggle-sites-nav","#skipNav").on("click",toggleSitesNav),$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav);var sessionId="current",sessionTimeOut,timeoutDialogEnabled=!1,timeoutDialogWarningTime,timeoutLoggedoutUrl,timeoutPortalPath;$PBJQ(document).ready(function(){portal.loggedIn&&portal.timeoutDialog&&setTimeout("setup_timeout_config();",6e4)});var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled,timeoutDialogWarningTime=portal.timeoutDialog.seconds,timeoutLoggedoutUrl=portal.loggedOutUrl,timeoutPortalPath=portal.portalPath,1==timeoutDialogEnabled&&(poll_session_data(),fetch_timeout_dialog())},poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto=true&_="+(new Date).getTime(),dataType:"json",success:function(a){if(a.maxInactiveInterval=1e3*a.maxInactiveInterval,a.active&&null!=a.userId&&a.lastAccessedTime+a.maxInactiveInterval>a.currentTime){var b=a.lastAccessedTime+a.maxInactiveInterval-a.currentTime;1e3*timeoutDialogWarningTime>b?(min=Math.round(b/6e4),show_timeout_alert(min),clearTimeout(sessionTimeOut),sessionTimeOut=setTimeout("poll_session_data()",6e4)):(clearTimeout(sessionTimeOut),sessionTimeOut=setTimeout("poll_session_data()",b-1e3*timeoutDialogWarningTime))}else null==a.userId?location.href=timeoutLoggedoutUrl:sessionTimeOut=setTimeout("poll_session_data()",1e4)},error:function(a,b,c){}})},dismiss_session_alert=function(){removeDHTMLMask(),$PBJQ("#timeout_alert_body").remove()},timeoutDialogFragment,setupSkipNav=function(){$PBJQ("#skipNav a.Mrphs-skipNav__link").click(function(){var a=$PBJQ(this).attr("href");$PBJQ(a).attr("tabindex","-1").focus()})},setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(a){27==a.keyCode&&($PBJQ(this).parent().children("a").focus(),$PBJQ(this).toggleClass("is-visible"))}),$PBJQ(this).children("li:last").addClass("is-last-item")}),$PBJQ("ul.Mrphs-sitesNav__menu > li").mouseleave(function(){$PBJQ(this).find("ul").toggleClass("is-visible")}),fixTopNav=function(a){40==a.keyCode?(a.preventDefault(),$PBJQ("#selectSite").hide(),$PBJQ(this).parent().find(".Mrphs-sitesNav__drop").trigger("click",[!0])):27==a.keyCode&&($PBJQ(this).parent().children("a").focus(),$PBJQ(this).toggleClass("is-visible"))},$PBJQ(document).on?$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu > li.Mrphs-sitesNav__menuitem > a",fixTopNav):$PBJQ(".Mrphs-sitesNav__menu > .Mrphs-sitesNav__menuitem > a").live("keydown",fixTopNav),$PBJQ("ul.Mrphs-sitesNav__menu > li").mouseleave(function(){$PBJQ(this).find("ul").toggleClass("is-visible")}),$PBJQ("ul.Mrphs-sitesNav__menu li span.Mrphs-sitesNav__drop").click(function(a,b){$PBJQ(this).toggleClass("is-clicked"),a.preventDefault();var c=$PBJQ(a.target);if(c.next("ul").length)c.next("ul").toggleClass("is-visible"),b&&c.next("ul").find("a:first").focus();else{var d='<ul class="Mrphs-sitesNav__submenu is-visible" role="menu">',e=c.attr("data-site-id"),f=parseInt($PBJQ("#linkNav").attr("data-max-tools-int")),g=$PBJQ("#linkNav").attr("data-max-tools-anchor"),h='<li class="Mrphs-sitesNav__submenuitem"><a role="menuitem" href="'+portal.portalPath+"/site/"+e+'" title="'+g+'"><span class="toolMenuIcon icon-sakai-see-all-tools"></span>'+g+"</a></li>",i="/direct/site/"+c.attr("data-site-id")+"/pages.json",j=window.location.pathname.split("/").pop();$PBJQ.ajax({url:i,dataType:"json",success:function(a){$PBJQ.each(a,function(a,b){if(f>=a)if(b.toolpopup)d=d+'<li class="Mrphs-sitesNav__submenuitem" ><a role="menuitem" href="'+b.tools[0].url+'?sakai.popup=yes" title="'+b.title+'" onclick="window.open(\''+b.toolpopupurl+'\');"><span class="toolMenuIcon icon-'+b.tools[0].toolId.replace(/\./gi,"-")+'"></span>'+b.title+"</a></li>";else if(b.tools.length>=1){var c="";if(j==b.tools[0].id)var c=" is-current";d=d+'<li class="Mrphs-sitesNav__submenuitem'+c+'"><a role="menuitem" href="'+b.tools[0].url+'" title="'+b.title+'"><span class="toolMenuIcon icon-'+b.tools[0].toolId.replace(/\./gi,"-")+'"></span>'+b.title+"</a></li>"}}),a.length-1>f&&(d+=h),d+="</ul>",c.after(d),b&&c.next("ul").find("a:first").focus(),addArrowNavAndDisableTabNav($PBJQ(".Mrphs-sitesNav__submenu"))},error:function(a,b,c){}})}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__drop--hover")})};$PBJQ(".js-toggle-nav").on("click",toggleMinimizeNav),$PBJQ(".js-toggle-user-nav a#loginUser","#loginLinks").on("click",toggleUserNav),$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop","#loginLinks").on("click",toggleUserNav),WebFontConfig={google:{families:["Open+Sans:300italic,400italic,600italic,700italic,400,600,300,700:latin"]}},function(){var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js",a.type="text/javascript",a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}();