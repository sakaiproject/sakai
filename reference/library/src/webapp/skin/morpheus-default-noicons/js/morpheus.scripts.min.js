$PBJQ("details").details();
$PBJQ(document).ready(function(){updateFooterTime=(function(){if($PBJQ("#preferredTime").length==1){var c=$PBJQ("#preferredTime").data("preferredtzdisplay");
var e=new Date(parseInt($PBJQ("#preferredTime").data("preferredserverdateandgmtoffset")));
var a=e.getTime()-(new Date()).getTime()
}var b=$PBJQ("#serverTime").data("servertzdisplay");
var d=new Date(parseInt($PBJQ("#serverTime").data("serverdateandgmtoffset")));
var f=d.getTime()-(new Date()).getTime();
return function(){var g=new Date((new Date()).getTime()+f);
var h=g.toUTCString().replace(/GMT/,b).replace(/UTC/,b);
$PBJQ("#serverTime").text(h);
if($PBJQ("#preferredTime").length==1){var g=new Date((new Date()).getTime()+a);
var h=g.toUTCString().replace(/GMT/,c).replace(/UTC/,c);
$PBJQ("#preferredTime").text(h)
}setTimeout("updateFooterTime()",1000)
}
})();
if($PBJQ("#serverTime").length==1){updateFooterTime()
}});
var dhtml_view_sites=function(){$PBJQ("#selectSite").addClass("dhtml_more_tabs");
$PBJQ(".more-tab").position();
dhtml_view_sites=function(){if($PBJQ("#selectSite").hasClass("outscreen")){$PBJQ("#selectSite").toggleClass("outscreen");
$PBJQ("#txtSearch").focus();
createDHTMLMask(dhtml_view_sites);
$PBJQ(".selectedTab").bind("click",function(b){dhtml_view_sites();
return false
});
$PBJQ("#selectSite a:first").focus();
$PBJQ("#selectSite a").keydown(function(b){if(b.keyCode==38||b.keyCode==27){b.preventDefault();
closeDrawer()
}});
$PBJQ(".moreSitesLink").keydown(function(b){if(b.keyCode==40){showToolMenu(b,0)
}});
var a=$PBJQ("#txtSearch");
if(a.length){$PBJQ(a[0]).keydown(function(b){if(b.keyCode==9&&b.shiftKey){b.preventDefault()
}})
}else{$PBJQ("#allSites").keydown(function(b){if(b.keyCode==9&&b.shiftKey){b.preventDefault()
}})
}$PBJQ("#otherSiteList > li:last").keydown(function(b){if(b.keyCode==9&&!b.shiftKey){b.preventDefault();
if(a.length){a[0].focus()
}else{$PBJQ("#allSites").focus()
}}})
}else{$PBJQ("#selectSite").toggleClass("outscreen");
removeDHTMLMask();
$PBJQ("#otherSiteTools").remove();
$PBJQ(".selectedTab").unbind("click")
}};
dhtml_view_sites()
};
function closeDrawer(){$PBJQ("#selectSite").toggleClass("outscreen");
removeDHTMLMask();
$PBJQ("#otherSiteTools").remove();
$PBJQ(".selectedTab").unbind("click");
$PBJQ(".moreSitesLink").unbind("keydown");
$PBJQ(".more-tab a").focus()
}function createDHTMLMask(a){$PBJQ("body").append('<div id="portalMask">&nbsp;</div>');
$PBJQ("#portalMask").css("height",browserSafeDocHeight()).css({width:"100%","z-index":1000,top:0,left:0}).bind("click",function(b){a();
return false
});
$PBJQ("#portalMask").bgiframe()
}function removeDHTMLMask(){$PBJQ("#portalMask").remove()
}function showToolMenu(g,h){g.preventDefault();
var l=$PBJQ(g.target);
var j=l.attr("id");
var a=j.replace(/!/g,"\\!").replace(/~/g,"\\~");
$PBJQ(".toolMenus").removeClass("toolMenusActive");
if($PBJQ("."+a).length){$PBJQ("#otherSiteTools").remove()
}else{$PBJQ("#otherSiteTools").remove();
var b='<ul id="otherSiteTools" class="'+j+'" role="menu">';
var i="/direct/site/"+j+"/pages.json";
scroll(0,0);
var k=l.offset();
var f=parseInt($PBJQ("#maxToolsInt").text());
var d=$PBJQ("#maxToolsAnchor").text();
var c='<li class="otherSiteTool"><span><a role="menuitem" href="'+portal.portalPath+"/site/"+j+'" title="'+d+'"><span class="toolMenuIcon icon-sakai-see-all-tools"> </span>'+d+"</a></span></li>";
$PBJQ.getJSON(i,function(e){$PBJQ.each(e,function(m,n){if(m<=f){if(n.toolpopup){b=b+'<li class="otherSiteTool"><span><a role="menuitem"  href="'+n.tools[0].url+'?sakai.popup=yes" title="'+n.title+'" onclick="window.open(\''+n.toolpopupurl+'\');"><span class="toolMenuIcon icon-'+n.tools[0].toolId.replace(/\./gi,"-")+'"> </span>'+n.title+"</a></span></li>"
}else{if(n.tools.length===1){b=b+'<li class="otherSiteTool"><span><a role="menuitem"  href="'+n.tools[0].url+'" title="'+n.title+'"><span class="toolMenuIcon icon-'+n.tools[0].toolId.replace(/\./gi,"-")+'"> </span>'+n.title+"</a></span></li>"
}}}});
if((e.length-1)>f){b=b+c
}b=b+"</ul>";
$PBJQ("#portalOuterContainer").append(b);
$PBJQ("#otherSiteTools").css({top:k.top+28,left:k.left-h});
$PBJQ("#otherSiteTools li a:first").focus();
l.parent().find(".toolMenus").addClass("toolMenusActive");
$PBJQ("#otherSiteTools").keydown(function(m){if(m.keyCode==27){m.preventDefault();
l.focus();
$PBJQ(this).remove();
$PBJQ("."+a).remove();
l.parent().find(".toolMenus").removeClass("toolMenusActive")
}});
addArrowNavAndDisableTabNav($PBJQ("#otherSiteTools"),function(){l.focus();
$PBJQ("."+a).remove();
l.parent().find(".toolMenus").removeClass("toolMenusActive")
})
})
}}$PBJQ(document).ready(function(){if($PBJQ("#eid").length===1){$PBJQ("#eid").focus()
}$PBJQ(".more-tab a").keydown(function(c){if(c.keyCode==40||c.keyCode==38||c.keyCode==27){c.preventDefault();
return dhtml_view_sites()
}});
$PBJQ(".toolMenus").click(function(c){showToolMenu(c,173)
});
var b=portal.siteTitle;
if(b){if(portal.shortDescription){b=b+" ("+portal.shortDescription+")"
}$PBJQ(".portletTitle h2").prepend('<span class="siteTitle">'+b+":</span> ")
}$PBJQ("#imgSearch").click(function(){a()
});
$PBJQ("#txtSearch").keyup(function(c){if(c.keyCode==27){a()
}if($PBJQ("#txtSearch").val().length>0){$PBJQ("#otherSiteList li, .otherSitesCategorList li").hide();
$PBJQ("#otherSitesCategorWrap h4").hide();
$PBJQ("#otherSiteList li a span.fullTitle:Contains('"+$PBJQ("#txtSearch").val()+"')").parent("a").parent("li").show();
$PBJQ(".otherSitesCategorList li a span.fullTitle:Contains('"+$PBJQ("#txtSearch").val()+"')").parent("a").parent("li").show().closest("ul").prev("h4").show();
$PBJQ("#imgSearch").fadeIn("slow")
}if($PBJQ("#txtSearch").val().length==0){a()
}if($PBJQ("#otherSiteList li:visible").length<1&&$PBJQ(".otherSitesCategorList li:visible").length<1){$PBJQ(".norecords").remove();
$PBJQ("#otherSiteSearch #noSearchResults").fadeIn("slow")
}});
$PBJQ.expr[":"].Contains=function(d,e,c){return $PBJQ(d).text().toUpperCase().indexOf(c[3].toUpperCase())>=0
};
function a(){$PBJQ("#txtSearch").val("");
$PBJQ("#otherSiteList li").show();
$PBJQ(".otherSitesCategorList li").show();
$PBJQ("#otherSitesCategorWrap h4").show();
$PBJQ("#noSearchResults").fadeOut();
$PBJQ("#imgSearch").fadeOut();
$PBJQ("#txtSearch").focus()
}$PBJQ("#presenceToggle").click(function(c){c.preventDefault();
$PBJQ("#presenceArea").toggle()
});
$PBJQ(".trayPopupClose").click(function(c){c.preventDefault();
$PBJQ(this).closest(".trayPopup").hide()
});
if($PBJQ("a.tool-directurl").length){$PBJQ("a.tool-directurl").cluetip({local:true,arrows:true,cluetipClass:"jtip",sticky:true,cursor:"pointer",activation:"click",closePosition:"title",closeText:'<img src="/library/image/silk/cross.png" alt="close">'})
}$PBJQ("#toggleSubsitesLink").click(function(f){var d=$PBJQ(this);
if($PBJQ("#subSites").css("display")=="block"){$PBJQ("#subSites").hide()
}else{var c=d.position();
$PBJQ("#subSites").css({position:"absolute",display:"block",left:c.left+d.width()+14+"px",top:c.top+"px"})
}})
});
function publishSite(b){var a="/direct/site/"+b+"/edit";
var c=$PBJQ.ajax({type:"POST",data:"published=true",url:a,success:function(){location.reload()
}}).responseText
}function toggleToolsNav(){event.preventDefault();
$PBJQ("body").toggleClass("toolsNav--displayed")
}function toggleSitesNav(){event.preventDefault();
$PBJQ("body").toggleClass("sitesNav--displayed");
$PBJQ("#linkNav .Mrphs-sitesNav__drop").removeClass("is-clicked");
$PBJQ("#linkNav .Mrphs-sitesNav__submenu").removeClass("is-visible")
}$PBJQ(".js-toggle-sites-nav","#skipNav").on("click",toggleSitesNav);
$PBJQ(".js-toggle-tools-nav","#skipNav").on("click",toggleToolsNav);
var sessionId="current";
var sessionTimeOut;
var timeoutDialogEnabled=false;
var timeoutDialogWarningTime;
var timeoutLoggedoutUrl;
var timeoutPortalPath;
$PBJQ(document).ready(function(){if(portal.loggedIn&&portal.timeoutDialog){setTimeout("setup_timeout_config();",60000)
}});
var setup_timeout_config=function(){timeoutDialogEnabled=portal.timeoutDialog.enabled;
timeoutDialogWarningTime=portal.timeoutDialog.seconds;
timeoutLoggedoutUrl=portal.loggedOutUrl;
timeoutPortalPath=portal.portalPath;
if(timeoutDialogEnabled==true){poll_session_data();
fetch_timeout_dialog()
}};
var poll_session_data=function(){$PBJQ.ajax({url:"/direct/session/"+sessionId+".json?auto=true&_="+(new Date()).getTime(),dataType:"json",success:function(b){b.maxInactiveInterval=b.maxInactiveInterval*1000;
if(b.active&&b.userId!=null&&b.lastAccessedTime+b.maxInactiveInterval>b.currentTime){var a=b.lastAccessedTime+b.maxInactiveInterval-b.currentTime;
if(a<timeoutDialogWarningTime*1000){min=Math.round(a/(1000*60));
show_timeout_alert(min);
clearTimeout(sessionTimeOut);
sessionTimeOut=setTimeout("poll_session_data()",1000*60)
}else{clearTimeout(sessionTimeOut);
sessionTimeOut=setTimeout("poll_session_data()",(a-timeoutDialogWarningTime*1000))
}}else{if(b.userId==null){location.href=timeoutLoggedoutUrl
}else{sessionTimeOut=setTimeout("poll_session_data()",1000*10)
}}},error:function(c,a,b){}})
};
function keep_session_alive(){dismiss_session_alert();
$PBJQ.get(timeoutPortalPath)
}var dismiss_session_alert=function(){removeDHTMLMask();
$PBJQ("#timeout_alert_body").remove()
};
var timeoutDialogFragment;
function fetch_timeout_dialog(){$PBJQ.ajax({url:"/portal/timeout?auto=true",cache:true,dataType:"text",success:function(a){timeoutDialogFragment=a
},error:function(c,a,b){timeoutDialogEnabled=false
}})
}function show_timeout_alert(b){if(!timeoutDialogEnabled){return
}if(!$PBJQ("#portalMask").get(0)){createDHTMLMask(dismiss_session_alert);
$PBJQ("#portalMask").css("z-index",1000)
}if($PBJQ("#timeout_alert_body").get(0)){$PBJQ("#timeout_alert_body span").html(b);
$PBJQ("#timeout_alert_body span").css("top",(f_scrollTop()+100)+"px")
}else{var a=timeoutDialogFragment.replace("{0}",b);
$PBJQ("body").append(a)
}}function toggleShortUrlOutput(b,c,a){if($PBJQ(c).is(":checked")){$PBJQ.ajax({url:"/direct/url/shorten?path="+encodeURI(b),success:function(d){$PBJQ("."+a).val(d)
}})
}else{$PBJQ("."+a).val(b)
}}$PBJQ(document).ready(function(){$PBJQ(".Mrphs-toolTitleNav__link--directurl").click(function(b){var a=$PBJQ(this).position();
$PBJQ(this).siblings(".Mrphs-directUrl").toggleClass("active").css({left:a.left+"px"});
b.preventDefault()
})
});
var setupSkipNav=function(){$PBJQ("#skipNav a.Mrphs-skipNav__link").click(function(){var a=$PBJQ(this).attr("href");
$PBJQ(a).attr("tabindex","-1").focus()
})
};
var setupSiteNav=function(){$PBJQ("ul.Mrphs-sitesNav__menu").each(function(){$PBJQ(this).keydown(function(a){if(a.keyCode==27){$PBJQ(this).parent().children("a").focus();
$PBJQ(this).toggleClass("is-visible")
}});
$PBJQ(this).children("li:last").addClass("is-last-item")
});
$PBJQ("ul.Mrphs-sitesNav__menu > li").mouseleave(function(){$PBJQ(this).find("ul").toggleClass("is-visible")
});
fixTopNav=function(a){if(a.keyCode==40){a.preventDefault();
$PBJQ("#selectSite").hide();
$PBJQ(this).parent().find(".Mrphs-sitesNav__drop").trigger("click",[true])
}else{if(a.keyCode==27){$PBJQ(this).parent().children("a").focus();
$PBJQ(this).toggleClass("is-visible")
}}};
if($PBJQ(document).on){$PBJQ(document).on("keydown",".Mrphs-sitesNav__menu > li.Mrphs-sitesNav__menuitem > a",fixTopNav)
}else{$PBJQ(".Mrphs-sitesNav__menu > .Mrphs-sitesNav__menuitem > a").live("keydown",fixTopNav)
}$PBJQ("ul.Mrphs-sitesNav__menu > li").mouseleave(function(){$PBJQ(this).find("ul").toggleClass("is-visible")
});
$PBJQ("ul.Mrphs-sitesNav__menu li span.Mrphs-sitesNav__drop").click(function(g,d){$PBJQ(this).toggleClass("is-clicked");
g.preventDefault();
var i=$PBJQ(g.target);
if(i.next("ul").length){i.next("ul").toggleClass("is-visible");
if(d){i.next("ul").find("a:first").focus()
}}else{var k='<ul class="Mrphs-sitesNav__submenu is-visible" role="menu">';
var a=i.attr("data-site-id");
var f=parseInt($PBJQ("#linkNav").attr("data-max-tools-int"));
var c=$PBJQ("#linkNav").attr("data-max-tools-anchor");
var b='<li class="Mrphs-sitesNav__submenuitem"><a role="menuitem" href="'+portal.portalPath+"/site/"+a+'" title="'+c+'"><span class="toolMenuIcon icon-sakai-see-all-tools"></span>'+c+"</a></li>";
var h="/direct/site/"+i.attr("data-site-id")+"/pages.json";
var j=window.location.pathname.split("/").pop();
$PBJQ.ajax({url:h,dataType:"json",success:function(e){$PBJQ.each(e,function(m,n){if(m<=f){if(n.toolpopup){k=k+'<li class="Mrphs-sitesNav__submenuitem" ><a role="menuitem" href="'+n.tools[0].url+'?sakai.popup=yes" title="'+n.title+'" onclick="window.open(\''+n.toolpopupurl+'\');"><span class="toolMenuIcon icon-'+n.tools[0].toolId.replace(/\./gi,"-")+'"></span>'+n.title+"</a></li>"
}else{if(n.tools.length>=1){var l="";
if(j==n.tools[0].id){var l=" is-current"
}k=k+'<li class="Mrphs-sitesNav__submenuitem'+l+'"><a role="menuitem" href="'+n.tools[0].url+'" title="'+n.title+'"><span class="toolMenuIcon icon-'+n.tools[0].toolId.replace(/\./gi,"-")+'"></span>'+n.title+"</a></li>"
}}}});
if((e.length-1)>f){k=k+b
}k=k+"</ul>";
i.after(k);
if(d){i.next("ul").find("a:first").focus()
}addArrowNavAndDisableTabNav($PBJQ(".Mrphs-sitesNav__submenu"))
},error:function(m,e,l){}})
}}).hover(function(){$PBJQ(this).toggleClass("Mrphs-sitesNav__drop--hover")
})
};
function addArrowNavAndDisableTabNav(a,b){a.find("li a").attr("tabindex","-1").keydown(function(g){var f=$PBJQ(g.target);
if(g.keyCode==40){g.preventDefault();
var c=f.parent().parent().next();
if(c[0]===undefined){a.slideUp("fast");
if(b!==undefined){b()
}else{f.parent().parent().parent().parent().children("a").focus()
}}else{c.find("a").focus()
}}else{if(g.keyCode==9){a.slideUp("fast")
}else{if(g.keyCode==38){g.preventDefault();
var d=f.parent().parent().prev();
if(d[0]===undefined){a.slideUp("fast");
if(b!==undefined){b()
}else{f.parent().parent().parent().parent().children("a").focus()
}}else{d.find("a").focus()
}}}}})
}function toggleMinimizeNav(){$PBJQ("#container").toggleClass("toggleNav--minimized");
var b=$PBJQ(this);
var a=$PBJQ(".accessibility-btn-label",b);
b.toggleClass("min max");
if(a.text()==b.data("title-expand")){a.text(b.data("text-original"));
b.attr("title",(b.data("text-original")));
b.attr("aria-pressed",true);
document.cookie="sakai_nav_minimized=false; path=/"
}else{b.data("text-original",a.text());
a.text(b.data("title-expand"));
b.attr("title",(b.data("title-expand")));
b.attr("aria-pressed",false);
document.cookie="sakai_nav_minimized=true; path=/"
}}$PBJQ(".js-toggle-nav").on("click",toggleMinimizeNav);
function updatePresence(){$PBJQ.ajax({url:sakaiPresenceFragment,cache:false,success:function(g){var f=g.indexOf("<ul");
if(f<1){$PBJQ("#presenceCount").html(" ");
$PBJQ("#presenceCount").removeClass("present").addClass("empty");
location.reload();
return
}g=g.substr(f);
var e=g;
var b="<li";
var a=0;
for(var d=0;
d<e.length;
d++){if(b==e.substr(d,b.length)){a++
}}if(a>1){$PBJQ("#presenceCount").html(a+"");
$PBJQ("#presenceCount").removeClass("empty").addClass("present")
}else{if(a==1){$PBJQ("#presenceCount").html(a+"");
$PBJQ("#presenceCount").removeClass("present").addClass("empty")
}else{$PBJQ("#presenceCount").html(" ");
$PBJQ("#presenceCount").removeClass("present").addClass("empty")
}}$PBJQ("#presenceIframe").html(g);
var c=$PBJQ(".nav-selected .icon-sakai-chat").attr("href");
$PBJQ("#presenceIframe .presenceList li.inChat span").wrap('<a href="'+c+'"></a>');
sakaiLastPresenceTimeOut=setTimeout("updatePresence()",30000)
},error:function(b,a){sakaiLastPresenceTimeOut=setTimeout("updatePresence()",60000)
}})
}function toggleUserNav(){event.preventDefault();
$PBJQ(".Mrphs-userNav__subnav").toggleClass("is-hidden")
}$PBJQ(".js-toggle-user-nav a#loginUser","#loginLinks").on("click",toggleUserNav);
$PBJQ(".js-toggle-user-nav .Mrphs-userNav__drop","#loginLinks").on("click",toggleUserNav);
function f_scrollTop(){return f_filterResults(window.pageYOffset?window.pageYOffset:0,document.documentElement?document.documentElement.scrollTop:0,document.body?document.body.scrollTop:0)
}function f_filterResults(d,b,a){var c=d?d:0;
if(b&&(!c||(c>b))){c=b
}return a&&(!c||(c>a))?a:c
}WebFontConfig={google:{families:["Open+Sans:300italic,400italic,600italic,700italic,400,600,300,700:latin"]}};
(function(){var a=document.createElement("script");
a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";
a.type="text/javascript";
a.async="true";
var b=document.getElementsByTagName("script")[0];
b.parentNode.insertBefore(a,b)
})();