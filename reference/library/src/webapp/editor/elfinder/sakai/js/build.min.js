(function($){$.sakai={};$.sakai.elfinder={}})(jQuery);(function($){$.sakai.elfinder.query=function(){var query={};var string=window.location.search.slice(1);var params=string.split("&");$.each(params,function(idx,param){var keyValue=param.split("=");query[keyValue[0]]=keyValue[1]});return query}})(jQuery);(function($){$.sakai.tools=["Announcements","Attachments","Forums","Polls"]})(jQuery);(function($){var ui=$.sakai.elfinder.ui=function($elfinder){this.footer=function(){var $footer=$('<div id="sakai-ui-footer"></div>').addClass(toClass(elements.confirmbar));var $OK=$("<div>OK</div>").addClass(toClass(elements.button,elements.ok));var $Cancel=$("<div>Cancel</div>").addClass(toClass(elements.button,elements.cancel));var $buttons=$("<div><div/>").append($OK,$Cancel).addClass(toClass(elements.buttons));return $footer.append($buttons)};$elfinder.append(this.footer());$elfinder.find(elements.statusbar).insertAfter(".elfinder-toolbar");$elfinder.find(".elfinder-stat-size, .elfinder-stat-selected").appendTo(elements.confirmbar)};var toClass=ui.toClass=function(){return $.makeArray(arguments).join(" ").replace(/\./g,"")};var elements=ui.elements={};ui.setSaveCloseButtons=function($dialog){var $buttons=$dialog.find(".ui-button").addClass(toClass(elements.button));var $cancel=$($buttons[0]).addClass(toClass(elements.cancel));var $saveandclose=$($buttons[1]).addClass(toClass(elements.ok));var $save=$($buttons[2]).addClass(toClass(elements.ok));$saveandclose.insertAfter($save);$cancel.insertAfter($saveandclose)};elements.footer="#sakai-ui-footer";elements.confirmbar="elfinder-confirm-bar";elements.buttons=".buttons";elements.button=".button";elements.ok=".button-ok";elements.cancel=".button-cancel";elements.statusbar=".elfinder-statusbar";elements.confirmbar=".elfinder-confirm-bar"})(jQuery);(function($){var border=2;$.sakai.elfinder.resizer=function($elfinder,$window){$window.resize(function(){var winHeight=$window.height()-border;if($elfinder.height()!==winHeight){$elfinder.height(winHeight).resize()}})}})(jQuery);(function($){var $window=$(window);var query=$.sakai.elfinder.query();var url="/"+(query.connector||"");var startDir=query.startdir;var lang=query.langCode;if(startDir){startDir=startDir.split("/");startDir=startDir.filter(function(elem){return elem});startDir=startDir.slice(1);startDir="/"+startDir.join("/")+"/content/";startDir=btoa(startDir);startDir=startDir.replace("+","-").replace("/","_").replace("=",".")}var type=query.type;var onlyMimes=[];if(type=="image"){onlyMimes=["image"]}else if(type=="flash"){onlyMimes=["application/x-shockwave-flash"]}var testHelp={type:"dialog",title:"Help",content:"example"};var ui=$.sakai.elfinder.ui;var tools=$.sakai.tools;$.sakai.elfinder.options={url:url,startPathHash:startDir,lang:lang,defaultView:"list",getFileCallback:function(file){},onlyMimes:onlyMimes,height:$window.height(),uiOptions:{toolbar:[["help",testHelp],["back","forward"],["reload"],["home","up"],["mkdir","upload"],["open","download","getfile"],["info"],["quicklook"],["copy","cut","paste"],["search"],["view"]],tree:{getClass:function(directory){var classes="";if(directory.tool&&$.inArray(directory.tool,tools)){classes="sakai-tool-"+directory.tool.toLowerCase()}return classes}}},commandsOptions:{info:{custom:{}},edit:{editors:[]}},resizable:false}})(jQuery);(function($){var ui=$.sakai.elfinder.ui;var ckeditor=function(){var ckloaded=false;var instance;var setup=function(textarea){var editor=instance=CKEDITOR.replace(textarea.id,{startupFocus:true,fullPage:true,allowedContent:true,removePlugins:"resize"});var $dialog=$(textarea).closest(".elfinder-dialog");$dialog.on("resize",function(event,ui){var $content=$dialog.find(".ui-dialog-content");var height=$content.height()-1;var width=$content.width();editor.resize(width,height)})};return{mimes:["text/html"],load:function(textarea){var $dialog=$(textarea).closest(".elfinder-dialog");ui.setSaveCloseButtons($dialog);if(!ckloaded){$.getScript("//cdn.ckeditor.com/4.5.2/standard/ckeditor.js",function(){setup(textarea)});ckloaded=true}else{setup(textarea)}},close:function(textarea){},save:function(textarea){if(instance){textarea.value=instance.getData()}},focus:function(textarea){}}}();var codemirror=function(){var url="codemirror/";var codemirrorjs=url+"lib/codemirror.js";var scripts=[];var instance;var setup=function(textarea,mime){var $textarea=$(textarea);var $dialog=$textarea.closest(".elfinder-dialog");var config={lineNumbers:true};if(mime)config.mode=mime;var editor=instance=CodeMirror.fromTextArea(textarea,config);var $content=$dialog.find(".ui-dialog-content").addClass("elfinder-codemirror");var setDimensions=function(){var width=$content.width();var height=$content.height();editor.setSize(width,height)};$dialog.on("resize",setDimensions);setDimensions()};var loaded=function(url){return scripts.indexOf(url)!==-1};return{load:function(textarea){var $dialog=$(textarea).closest(".elfinder-dialog");ui.setSaveCloseButtons($dialog);var mime=this.file.mime;var run=function(){var mode=CodeMirror.findModeByMIME(mime).mode;var script=url+"/mode/"+mode+"/"+mode+".js";if(mode==="null"){scripts.push(script)}if(loaded(script)){setup(textarea,mime);return}$.getScript(url+"/mode/"+mode+"/"+mode+".js").done(function(){scripts.push(script);setup(textarea,mime)}).fail(function(){console.log("Failed to load mode for "+mode);setup(textarea)})};if(!loaded(codemirrorjs)){$("head").append($('<link rel="stylesheet" href="'+url+'lib/codemirror.css">'));$.getScript(codemirrorjs,function(){scripts.push(codemirrorjs);$.getScript(url+"mode/meta.js",run)})}else{run()}},close:function(textarea){},save:function(textarea){if(instance){textarea.value=instance.getValue()}},focus:function(textarea){}}}();$.sakai.elfinder.options.commandsOptions.edit.editors=[ckeditor,codemirror]})(jQuery);(function($){var ui=$.sakai.elfinder.ui;var elements=ui.elements;$.sakai.elfinder.options.handlers={open:function(event,instance){var $footer=$(elements.footer);$footer.data("cwd",event.data.options.url)},select:function(event,instance){var selected=event.data.selected;var $footer=$(elements.footer);if(!selected.length){var cwd=$footer.data("cwd");$footer.data("embed",cwd)}else{instance.exec("getfile",selected)}}};var enterHit;$(document).keydown(function(e){enterHit=e.which==13}).click(function(){enterHit=false});$.sakai.elfinder.options.getFileCallback=function(file,instance){instance.options.commandsOptions.getfile={folders:false};var $footer=$(elements.footer);$footer.data("embed",file.url);$footer.data("file",file);if(enterHit){$(elements.footer).find(elements.ok).click()}};$.sakai.elfinder.confirm=function($elfinder){var $footer=$elfinder.find(elements.footer);var funcNum=$.sakai.elfinder.query().CKEditorFuncNum;$footer.on("click",".button-ok",function(event){var embed=$footer.data("embed");window.opener.CKEDITOR.tools.callFunction(funcNum,embed);window.close()});$footer.on("click",".button-cancel",function(event){window.close()})}})(jQuery);(function($){elFinder.prototype.i18.en.messages.kind="Type"})(jQuery);(function($,window){$(function(){var options=$.sakai.elfinder.options;var ui=$.sakai.elfinder.ui;var resizer=$.sakai.elfinder.resizer;var confirm=$.sakai.elfinder.confirm;var $elfinder=$("#elfinder");var $window=$(window);$elfinder.elfinder(options);resizer($elfinder,$window);ui($elfinder);confirm($elfinder)})})(jQuery,window);