<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html rsf:id="html" xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE"/>
<script rsf:id="scr=portal-matter" type="text/javascript" language="JavaScript" src="/library/js/headscripts.js"></script>
<link rsf:id="scr=portal-matter" href="/library/skin/tool_base.css" type="text/css" rel="stylesheet" media="all" />
<link rsf:id="scr=portal-matter" href="/library/skin/default/tool.css" type="text/css" rel="stylesheet" media="all" />
<title rsf:id="msg=simplepage.blti.chooser"></title>
<style>
.ui-widget-overlay.ui-front {
    opacity:.75;
}
</style>
</head>
<body rsf:id="scr=sakai-body">
	<div class="portletBody" id="portletBody">
		<div rsf:id="error-div" class="ui-widget">
			<div class="sak-banner-error below-link-help">
				<p><span rsf:id="error"></span></p>
			</div>
		</div>
		<div rsf:id="no-blti-tools" class="ui-widget" role="alert">
			<div class="instruction below-link-help">
				<div rsf:id="no-blti-tools-text" ></div>
			</div>
		</div>

		<a role="menuitem" class="usebutton" target="sakai-basiclti-admin-iframe" onclick="showIframe(this.title, true);" id="blti-main-link" href="#" rsf:id="blti-main-link"></a>

		<h2 rsf:id="mainhead" id="mainhead"></h2>

		<p rsf:id="blti-tools-text"></p>

		<div rsf:id="app-store-shortcut:" class="col-md-11 col-md-offset-1">
			<div rsf:id="blti-create:">
				<a rsf:id="blti-create-link" id="blti-shortcut-link" href="#" class="btn btn-primary" target="sakai-basiclti-admin-iframe" onclick="showIframe(this.title, true);">
					<i class="fa fa-shopping-cart lessons-shopping-cart" rsf:id="blti-search-icon"></i>
					<i class="" rsf:id="blti-create-icon"></i>
					<span rsf:id="blti-create-text"></span>
				</a>
			</div>
		</div>

		<div class="table-responsive">
			<table class="externalToolContainerClass table table-striped table-bordered" rsf:id="app-store-container:">
				<thead>
				<tr>
					<th><span rsf:id="blti-name-header"></span></th>
					<th><span rsf:id="blti-description-header"></span></th>
				</tr>
				</thead>
				<tbody>
				<tr rsf:id="blti-create:">
					<td><a rsf:id="blti-create-link" href="#" target="sakai-basiclti-admin-iframe" onclick="showIframe(this.title, false);">
						<i class="fa fa-shopping-cart lessons-shopping-cart" rsf:id="blti-search-icon"></i>
						<i class="" rsf:id="blti-create-icon"></i>
						<span rsf:id="blti-create-text"></span>
					</a></td>
					<td><span rsf:id="blti-create-description"></span></td>
				</tr>
				</tbody>
			</table>
		</div>

		<div class="table-responsive">
			<table class="externalToolContainerClass table table-striped table-bordered" rsf:id="external-tool-container:">
				<thead>
				<tr>
					<th><span rsf:id="blti-name-header"></span></th>
					<th><span rsf:id="blti-description-header"></span></th>
				</tr>
				</thead>
				<tbody>
				<tr rsf:id="blti-create:">
					<td><a rsf:id="blti-create-link" href="#" target="sakai-basiclti-admin-iframe" onclick="showIframe(this.title, false);">
						<i class="fa fa-shopping-cart lessons-shopping-cart" rsf:id="blti-search-icon"></i>
						<i class="" rsf:id="blti-create-icon"></i>
						<span rsf:id="blti-create-text"></span>
					</a></td>
					<td><span rsf:id="blti-create-description"></span></td>
				</tr>
				</tbody>
			</table>
		</div>

		<form action="#" rsf:id="blti-autosubmit" id="blti-autosubmit">
			<input type="hidden" rsf:id="csrf"/>
			<input type="hidden" rsf:id="item-id" id="item-id" />
			<input type="hidden" rsf:id="select"/>
			<input type="hidden" rsf:id="add-before" id="add-before" />
			<input type="hidden" rsf:id="item-description" id="item-description" />
			<input type="hidden" class="bold" rsf:id="submit" />
		</form>

		<script>
		// If we have the blti-autosubmit form, submit it
		setTimeout(function(){
			var form = document.getElementById("blti-autosubmit");
			if ( form != null ) form.submit();
			}, 250);
		</script>

		<form action="#" rsf:id="blti-cancel" id="blti-cancel">
			<input type="hidden" rsf:id="csrf"/>
			<input type="hidden" rsf:id="cancel2"/>
			<input type="submit" rsf:id="cancel" class='cancelButton'/>
		</form>

		<div id="modal-iframe-div" style="display:none" tabindex="-1" role="dialog">
			<iframe name="sakai-basiclti-admin-iframe" id="sakai-basiclti-admin-iframe" src="/library/image/sakai/spinner.gif" style="min-height: 80vh;" tabindex="0"></iframe>
		</div>
	</div>

<script>
includeLatestJQuery('BltiPicker.html');
</script>

<script>
//<![CDATA[
function showIframe(title, doreload) {
	$("#modal-iframe-div").dialog({
		title: title,
		width: modalDialogWidth(),
		height: modalDialogHeight(),
		modal: true,
		draggable: false,
		open: function() {
		    $("#modal-iframe-div").dialog("option", "width", modalDialogWidth());
		    $("#modal-iframe-div").dialog("option", "height", modalDialogHeight());
			$('#sakai-basiclti-admin-iframe').attr('width', '100%');
			$('#sakai-basiclti-admin-iframe').attr('height', '100%');
			// https://stackoverflow.com/questions/1202079/prevent-jquery-ui-dialog-from-setting-focus-to-first-textbox
			$(this).parent().focus();
		},
		close: function() {
            if ( doreload ) {
                location.reload();
            } else {
			    $('#sakai-basiclti-admin-iframe').attr('src','/library/image/sakai/spinner.gif');
            }
		}
	});

	$(window).resize(function() {
		$("#modal-iframe-div").dialog("option", "width", modalDialogWidth());
		$("#modal-iframe-div").dialog("option", "height", modalDialogHeight());
		$('#sakai-basiclti-admin-iframe').attr('width', '100%');
		$('#sakai-basiclti-admin-iframe').attr('height', '100%');
	});
}
/* We don't need this - the within iframe content gets a scroll bar
   and we are in a modal - so that is the best we can do.

   Removed in SAK-42243

// Make sure to be careful to use .style.height or .height depending on the iframe
// tag you are working with.
window.addEventListener('message', function(e) {
	try {
		var message = JSON.parse(e.data);
		var idval = 'sakai-basiclti-admin-iframe';
		if ( message.subject == 'lti.frameResize' ) {
		var height = message.height;
			document.getElementById(idval).style.height = height;
			document.getElementById(idval).style.width = '100%';
			console.debug('BltiPicker received lti.frameResize height='+height);
		}
	} catch (error) {
		console.debug('BltiPicker lti.frameResize of '+idval+' failed height='+height);
		console.debug(e.data);
	}
});
*/

// See if we are supposed to launch the shortcut link
var shortcut_tag = document.getElementById('app-store-shortcut::blti-create::blti-create-link');
if ( shortcut_tag ) {
    var shortcut_title = shortcut_tag.getAttribute('title');
    var shortcut_href = shortcut_tag.getAttribute('href');
    if ( shortcut_href && shortcut_title ) {
        document.getElementById('sakai-basiclti-admin-iframe').src = shortcut_href;
        showIframe(shortcut_title);
    }
}

//]]>

//If none of the tools have a description, hides the column.
$( document ).ready(function() {
    var emptyDescriptionCount = $('.externalToolContainerClass td:nth-child(2):not(:has(:not(:empty)))').length;
    var rowNumber = $('.externalToolContainerClass tbody tr').length;
    if(emptyDescriptionCount == rowNumber){
        $('.externalToolContainerClass td:nth-child(2), .externalToolContainerClass th:nth-child(2)').hide();
    }
});
</script>


</body>
</html>
