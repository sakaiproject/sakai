##
## the Site Tabs part of the standard view
##
##

#if ( ${pageColumn0Tools} ) 
    
    #foreach ( $tool in $pageColumn0Tools ) 

        #if ( $tool.breadcrumbs )
            #set ($portalBreadCrumbs = $tool.breadcrumbs )
        #end

    #end
    
#end

#foreach ( $site in $tabsSites.tabsSites)

    #if (${site.isCurrentSite} and  $site.isChild )
        #set ($portalPwd = $site.pwd)
    #end
    
#end

<!-- START VM includeTabs.vm -->
    <div class="${tabsCssClass}">
        <div id="maxToolsInt" class="hidden">$maxToolsInt</div>
        <div id="maxToolsAnchor" class="hidden">${rloader.sit_alltools}</div>
        <div id="siteNav">
            <!-- login component -->
            <div id="mastLogin">
               
                #if (!${loginTopLogin})
                
                    #if ($viewAsStudentLink)                        
                        
                        #parse("/vm/morpheus/snippets/roleSwitch-snippet.vm")
                        
                    #end ##if ($viewAsStudentLink)
                    
                    <nav id="loginLinks">
                        <span class="topnav">
                            <span class="nav-menu" aria-haspopup="true">
                                <ul class="nav-submenu subnav" role="menu">
                                
                                    #if (${displayUserloginInfo})
                                    
                                        #if (${tabsSites.profileToolUrl})
                                            <li class="submenuitem"><a id="loginUser" role="menuitem" href="${tabsSites.profileToolUrl}?sakai_nav_minimized=true&sakai.state.reset=true" class="login-user-icon"><span class="login-user-name">${loginUserDispName}</span> <span class="login-user-id">${loginUserDispId}</span></a></li>
                                             
                                        #else
                                            <li class="submenuitem" role="menuitem"><span class="login-user-name">${loginUserDispName}</span> <span class="login-user-id">${loginUserDispId}</span></li>
                                        #end
                                        
                                    #end ##if (${displayUserloginInfo})
                                    
                                    
                                    #if (${tabsSites.prefsToolUrl})
                                        <li class="submenuitem"><span class="toolMenuIcon submenuitem-prefs"> </span><a role="menuitem" href="${tabsSites.prefsToolUrl}?sakai_nav_minimized=true" class="login-user-icon submenuitem-prefs">${rloader.sit_preferences}</a></li>
                                    #end
                                    
                                    #if (${tabsSites.worksiteToolUrl})
                                    
                                        #if ($allowAddSite)
                                            <li class="submenuitem"><span><a id="addNewSiteLink" role="menuitem" href="${tabsSites.worksiteToolUrl}?sakai_nav_minimized=true&panel=Shortcut&sakai_action=doNew_site&sakai.state.reset=true"><span class="toolMenuIcon submenuitem-new-site"> </span>${rloader.sit_newsite}</a></span></li>
                                        #end
                                    
                                    #end ##if (${tabsSites.prefsToolUrl})
                                    
                                    #if (${tabsSites.tutorial})
                                        <li class="submenuitem"><span><a id="tutorialLink" role="menuitem" href="#" onclick="startTutorial({});"><span class="toolMenuIcon submenuitem-tutorial"> </span>${rloader.sit_tutorial}</a></span></li>
                                    #end
                                    
                                </ul>
                                <span class="drop" tabindex="-1"></span>
                            </span>
                        </span>
                        
                        #parse("/vm/morpheus/snippets/loginImage-snippet.vm")
                        
                        ##end
                    </nav> <!-- end of nav#loginLinks-->
                #else ## else of #if (!${loginTopLogin})
                    
                    #parse("/vm/morpheus/snippets/loginForm-snippet.vm")
                    
                #end ## end of #if (!${loginTopLogin})
                
            </div> <!--  end of div#mastLogin -->
            
            <!-- end login component -->
            <nav id="linkNav" role="navigation" aria-labelledby="sitetabs">
            <!-- this allows us to reliably detect if the browser is internet explorer, depends on these elements ul#topnav h1#sitetabs -->
            <script>var sakai_portal_ie_detected=false;</script>
            <!--[if IE]><script>sakai_portal_ie_detected=true;</script><![endif]-->
            <h1 class="skip" id="sitetabs">${rloader.sit_worksiteshead}</h1>
            <ul class="topnav" id="topnav" role="menubar" aria-label="${rloader.sit_worksiteshead}">
                #foreach ( $site in $tabsSites.tabsSites ) 
                    #if (${site.isCurrentSite})
                        #if (${site.isMyWorkspace})
                            <li class="nav-selected nav-menu"><a href="#" role="menuitem" aria-haspopup="true"><span>${rloader.sit_mywor}</span></a></li>
                        #else
                            #if (( ${tabDisplayLabel} == 2 ) && ( ${site.shortDescription} ))
                                <li class="nav-selected nav-menu"><a href="#" title="${site.shortDescription}" role="menuitem" aria-haspopup="true"><span>${site.shortDescription}</span></a></li>
                            #else
                                <li class="nav-selected nav-menu"><a href="#" title="${site.fullTitle}" role="menuitem" aria-haspopup="true"><span>${site.siteTitle}</span></a></li>
                            #end
                        #end
                    #else
                        #if (${site.isMyWorkspace})
                            <li class="nav-menu"><a href="${site.siteUrl}" title="${rloader.sit_mywor}" role="menuitem" aria-haspopup="true"><span>${rloader.sit_mywor}</span></a></li>
                        #else
                            #if (( ${tabDisplayLabel} == 2 ) && ( ${site.shortDescription} ))
                                <li class="nav-menu"><a href="${site.siteUrl}" title="${site.shortDescription}" role="menuitem" aria-haspopup="true"><span>${site.shortDescription}</span></a></li>
                            #else    
                                <li class="nav-menu"><a href="${site.siteUrl}" title="${site.siteTitle}: ${site.fullTitle}" role="menuitem" aria-haspopup="true"><span>${site.siteTitle}</span></a></li>
                            #end
                        #end
                    #end
                    ## submenus used to be rendered here - they were removed - menus are retrieved via js and Entity Broker
                    ## add the site id as a value to data attr (SAK-22907)
                    <span class="drop" tabindex="-1" data="${site.siteId}"></span>
                #end ## end of  #foreach ( $site in $tabsSites.tabsSites ) 

                #if ($tabsSites.tabsMoreSitesShow)
                    <li class="more-tab"><a href="javascript:;" onclick="return dhtml_view_sites();" title="${rloader.sit_more}" aria-haspopup="true"><span>${rloader.sit_more}</span></a></li>
                #end
            </ul>
        </nav> <!-- /linkNav -->
        #if ($tabsAddLogout)
            <div class="galleryLogin">
                <a href="$tabsLogoutUrl">${rloader.sit_log}</a>
            </div>
            </div> <!-- /siteNav -->
        #else
            </div>
            <div class="divColor" id="tabBottom">
            </div>
        #end
        #if ($tabsSites.tabsMoreSitesShow)
            <div id="selectSite" class="hidden">
                <div id="otherSiteSearch"> 
                    <label for="txtSearch">${rloader.sit_search}</label> <input type="text" id="txtSearch" name="txtSearch" maxlength="50">
                    <a id="imgSearch" href="#" class="hidden"><img src="${pageSkinRepo}/${pageSkin}/images/cancel.png" alt="${rloader.sit_search_cancel}" title="${rloader.sit_search_cancel}"></a>
                    <span id="noSearchResults" class="hidden">${rloader.sit_search_none}</span>
                </div>
                <ul id="otherSitesMenu">
                    #if (${tabsSites.worksiteToolUrl})
                        <li><a id="allSites" href="${tabsSites.worksiteToolUrl}?sakai_nav_minimized=true&sakai.state.reset=true"><span>${rloader.sit_allsites}</span></a></li>
                        #if ($allowAddSite)
                            <li><a id="newSite" href="${tabsSites.worksiteToolUrl}?sakai_nav_minimized=true&panel=Shortcut&sakai_action=doNew_site&sakai.state.reset=true"><span>${rloader.sit_newsite}</span></a></li>
                        #end
                    #end
                    #if (${tabsSites.prefsToolUrl})
                        <li><a href="${tabsSites.prefsToolUrl}?sakai_nav_minimized=true"><span>${rloader.sit_preferences}</span></a></li>
                    #end
                     <li id="otherSiteCloseW">
                        <a href="#" onclick="closeDrawer()" title="${rloader.sit_othersitesclose}"><span>X</span><span class="skip">${rloader.sit_othersitesclose}</span></a>
                    </li>
                </ul>
                #if ($useDHTMLMore)
                    <div id="otherSitesCategorWrap">
                        ### TODO: format well
                        #foreach( $termKey in $tabsSites.tabsMoreSortedTermList)
                            #if ( !$termKey || $termKey == "" )
                                <h4>${rloader.sit_notermkey}</h4>
                            #else
                                <h4>$termKey</h4>
                            #end
                            <ul class="otherSitesCategorList">
                                #foreach( $site in $tabsSites.tabsMoreTerms.get($termKey))
                                    #if (${site.isMyWorkspace})
                                        <li>
                                            <a href="${site.siteUrl}" title="${rloader.sit_mywor}">
                                                <span  class="fullTitle">${rloader.sit_mywor}</span>
                                            </a>
                                            <a href="#" id="${site.siteId}" class="toolMenus">&nbsp;<span class="skip">Tools</span></a>
                                        </li>
                                    #else
                                        <li>
                                            #if (( ${tabDisplayLabel} == 2 ) && ( ${site.shortDescription} ))
                                                <a href="${site.siteUrl}" title="${site.shortDescription}"><span  class="fullTitle">${site.shortDescription}</span></a><a href="#" id="${site.siteId}" class="toolMenus">&nbsp;<span class="skip">Tools</span></a>
                                            #else
                                                <a href="${site.siteUrl}" title="${site.fullTitle}"><span  class="fullTitle">${site.siteTitle}</span></a><a href="#" id="${site.siteId}" class="toolMenus">&nbsp;<span class="skip">Tools</span></a>
                                            #end
                                        </li>
                                    #end
                                #end
                            </ul>
                        #end
                    </div><!--  end of #otherSitesCategorWrap -->
                #else
                    <div id="otherSiteMenuWrap">
                         <ul id="otherSiteList" role="navigation">
                            #foreach( $site in $tabsSites.tabsMoreSites )
                                <li><a href="${site.siteUrl}" title="${site.fullTitle}" id="${site.siteId}" class="moreSitesLink"><span class="fullTitle">${site.siteTitle}</span></a><a href="javascript:;" id="${site.siteId}" class="toolMenus" tabindex="-1">&nbsp;<span class="skip">Tools</span></a></li>
                            #end    
                          </ul>
                    </div>
                #end
            </div>
        #end ## end of #if ($tabsSites.tabsMoreSitesShow)
        <script>
            jQuery(document).ready(function() {
                setupSiteNav();
                // sakai_portal_ie_detected should have been set above
                if (sakai_portal_ie_detected) {
                    // SAK-22308
                    //if (jQuery.browser.msie && jQuery('ul#topnav[role="navigation"]') && jQuery('h1#sitetabs')) {
                    var $ul_topnav = jQuery('ul#topnav');
                    var aria_label_val = $ul_topnav.attr('aria-label');
                    jQuery('h1#sitetabs').attr('role','navigation').attr('aria-label', aria_label_val);
                    jQuery('div#linkNav').removeAttr('role').removeAttr('aria-labelledby');
                    $ul_topnav.removeAttr('aria-label');
                }
            });
        </script>
    </div> <!-- /end of div.tabsCssClass -->
<!-- END VM includeTabs.vm -->
