<!-- start: chef_assignments_list_assignments.vm  -->
#rubricsRequirements
<script>
	focus_path = ["search"];
	var linkFlag = true;

	function duplicateLink(lnk) {
		var params = ASN.params_unserialize(lnk.search.substring(1));
		params.push({'name':'sakai_csrf_token','value':'$sakai_csrf_token'});
		var myForm = document.createElement("form");
		myForm.action = lnk.pathname;
		myForm.method = "post";
		for (var i=0; i<params.length; i++) {
			var myInput = document.createElement("input");
			myInput.type = "hidden";
			myInput.name = params[i].name;
			myInput.value = params[i].value;
			myForm.appendChild(myInput);
		}
		document.body.appendChild(myForm);
		myForm.submit();
		return false;
	}

    <!-- Initialize the Bootstrap-multiselect plugin: -->
    $(document).ready(function() {
        $('#filterByGroup').multiselect({
            enableFiltering: true,
            filterPlaceholder: '$tlang.getString("listassig.searchgroup")',
            enableCaseInsensitiveFiltering: true,
            templates: {
                button: `
                    <button type="button"
                            class="select multiselect"
                            data-bs-toggle="dropdown">
                        <span class="multiselect-selected-text"></span>
                    </button>
                `,
                filter: `
                    <div class="multiselect-filter d-flex align-items-center"><i class="fa fa-sm fa-search text-muted"></i><input type="search" class="multiselect-search form-control" /></div>
                `,
            },
        });
        ASN.checkIframeTags();

        // Initialize tag selector
        #if ($!view.equals('lisofass1') && $!tagsEnabled && ($!allowAddTags || $!show_tags_student) && ($!assignments.hasNext() || $!tag_selector))
            window.syncTagSelectorInput("tag-selector", "tag_selector");
        #end
    });
</script>

<div class="portletBody container-fluid">

	#if ($allowAddAssignment || $!allowGradeSubmission)
		## for user who cannot create assignment nor grade submission, no need to show "Assignment List" link at all since there is really no other toolbar choices
		#navBarHREF( $allowAddAssignment $allowGradeSubmission $allowAddAssignment $allowRecoverAssignment $allowAllGroups $assignmentscheck $allowUpdateSite $enableViewOption $view "" )
	#end
	#if ($alertMessage)<div class="sak-banner-error"><strong>$tlang.getString("gen.alert")</strong> $alertMessage</div>#end

	<div class="page-header">
		<h1>
			$!tlang.getString('lisofass1')
		</h1>
	</div>

	<div class="sakai-table-toolBar mb-3">
		<div id="tagSection" class="pe-lg-3 w-100" >
		#if ($!view.equals('lisofass1') && $!tagsEnabled && ($!allowAddTags || $!show_tags_student) && ($!assignments.hasNext() || $!tag_selector))
			<form id="tagFilterForm" name="tagFilterForm" class="d-flex gap-1" method="post" action="#toolForm("AssignmentAction")">
				<input hidden id="tag_selector" name="tag_selector" />
				<input type="hidden" name="eventSubmit_doSearchTags" value="tag_selector" />
				
				<div class="flex-grow-1">
					<sakai-tag-selector id="tag-selector" selected-temp="$!tag_selector" collection-id="$siteId" add-new="false" extra-options="$allTaggedGroupsAndInstructors" tag-tool="$!tagTool" site-id="$siteId"></sakai-tag-selector>
				</div>
				<div  class="">
					<input type="submit" id="btnSearchTags1" value="$tlang.getString("tags_search")" accesskey="t"
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'tagFilterForm', null, null, null ); return false;" />
					#if ($!tag_selector)
					<input type="submit" id="btnSearchTagsClear" value="$tlang.getString("search_clear")" accesskey="c"
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.clearShadowTags(); ASN.submitForm( 'tagFilterForm', null, null, null ); return false;" />
					#end
					<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
				</div>
			</form>
		#end
		</div>
		<div class="mb-auto">
			#searchFilterPanel("$form_search", $searchString, "doView_assignments_list_search", "doView_assignments_list_search_clear")
		</div>
	</div>

	#if ($allowAddAssignment)
		#if ($!view.equals('stuvie'))
			<div class="sak-banner-info">$tlang.getString("stulistassig.selanass1")</div>
		#end
	#else
		<div>$tlang.getString("stulistassig.selanass")</div>
	#end

	<div class="sakai-table-toolBar">
		#if($!groupFilterEnabled && $!filterGroupIterator.hasNext())
		<div class="sakai-table-filterGroupContainer">
			<div class="row" id="filterByGroupDiv">
				<form id="groupFilterForm" name="groupFilterForm" class="inlineForm col-md-12" method="post" action="#toolForm("AssignmentAction")">
					<input type="hidden" name="eventSubmit_doFilterByGroup" value="filterByGroup" />
					<label for="groupFilter">
						$!tlang.getString("listassig.filterbygroup")
					</label>
					<span class="skip">$tlang.getString("newassig.selectmessage")</span>
					<select id="filterByGroup" name="filterByGroup" onchange="SPNR.disableControlsAndSpin(this, null); ASN.submitForm( 'groupFilterForm', null, null, null ); return false;">
						<option value="all" #if($!filterByGroup.equals('all'))selected="selected"#end>$!tlang.getString("listassig.allgroups")</option>
						#foreach($group in $!filterGroupIterator)
							<option value="$group.getId()" #if($!filterByGroup.equals($group.getId()))selected="selected"#end>$group.getTitle()</option>
						#end
					</select>
					<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
				</form>
			</div>
		</div>
		#end
		<div class="sakai-table-filterContainer">
			<div class="row">
				<form name="filterForm" class="col-md-12 inlineForm" method="post" action="#toolForm("AssignmentAction")">
					<input type="hidden" name="eventSubmit_doFilter" value="filterOption" />
					<label for="filterOption">$tlang.getString("view.label")</label>
					<span class="skip">$tlang.getString("gen.listnavselect")</span>
					<select id="filterOption" name="filterOption" size="1" onchange="SPNR.disableControlsAndSpin(this, null);document.filterForm.submit();">
					#foreach($filter in $!filterOptions)
						#set($filterMessageKey = "listassig.filter." + $filter)
						<option value="$!filter" #if($!filter.equals($!currentFilterOption)) selected="selected" #end>$!tlang.getString($!filterMessageKey)</option>
					#end
					</select>
					<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
				</form>
			</div>
		</div>
		<div class="sakai-table-pagerContainer">
			#pagerPanel("pager1")
		</div>
	</div>

	#if (!$!hasAssignments)
		<div class="sak-banner-info">
			$tlang.getString("gen.thearecur1")
		</div>
	#else

	<form name="listAssignmentsForm" action="#toolForm("$action")" method="post">
		<div class="table">
			<input type="hidden" name="source" value="0" />
			<table class="table table-hover table-striped table-bordered" summary="$tlang.getString("gen.ass.lis.sum")">
				<tr>
					<th id="title" scope="col">
						<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=title")'; return false;"   title="$tlang.getString("listassig.sorbytit")">
							$tlang.getString("gen.asstit")
							#if ($sortedBy.equals("title"))
								#if ($sortedAsc.equals("true"))
									<i id="sortascendingtitle" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
								#else
									<i id="sortdescendingtitle" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
								#end
							#end
						</a>
					</th>
					#if ($!allowGradeSubmission)
						<th id="$tlang.getString('gen.visible')" scope="col" class="d-none d-sm-table-cell">
							#if (!$sortedBy.equals("for"))
								<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=for")'; return false;"   title="$tlang.getString('gen.sortbyfor')">$tlang.getString("gen.visible")</a>
							#else
								#if ($sortedAsc.equals("true"))
									<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=for")'; return false;"    title="$tlang.getString('gen.sortbyforasc')">$tlang.getString("gen.visible") <i class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sortbyforasc")"></i></a>
								#else
									<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=for")'; return false;"    title="$tlang.getString('gen.sortbyfordesc')">$tlang.getString("gen.visible") <i class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sortbyfordesc")"></i></a>
								#end
							#end
						</th>
					#end
					<th id="status" scope="col">
						<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=assignment_status")'; return false;"   title="$tlang.getString("list.sorbysta")">
							$tlang.getString("gen.status")
							#if ($sortedBy.equals("assignment_status"))
								#if ($sortedAsc.equals("true"))
									<i id="sortascendingstatus" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
								#else
									<i id="sortdescendingstatus" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
								#end
							#end
						</a>
					</th>
					#if ($allowAddAssignment == false)
						<th id="grade" scope="col">
							$tlang.getString("grade.title")
						</th>
					#end
					<th id="openDate" scope="col" class="d-none d-sm-table-cell">
						<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=opendate")'; return false;"  title="$tlang.getString("listassig.sorbyope")">
							$tlang.getString("newassig.opedat")
							#if ($sortedBy.equals("opendate"))
								#if ($sortedAsc.equals("true"))
									<i id="sortascendingopendate" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
								#else
									<i id="sortdescendingopendate" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
								#end
							#end
						</a>
					</th>
					<th id="dueDate">
						<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=duedate")'; return false;"  title="$tlang.getString("gen.sorbydue")">
							$tlang.getString("gen.duedat")
							#if ($sortedBy.equals("duedate"))
								#if ($sortedAsc.equals("true"))
									<i id="sortascendingduedate" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
								#else
									<i id="sortdescendingduedate" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
								#end
							#end
						</a>
					</th>
					<th id="lastModifiedUser" class="d-none d-sm-table-cell">
						<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=modifieduser")'; return false;"  title="$tlang.getString("gen.sorbymodusr")">
							$tlang.getString("gen.mod.user")
							#if ($sortedBy.equals("modifieduser"))
								#if ($sortedAsc.equals("true"))
									<i id="sortascendingmodifieduser" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
								#else
									<i id="sortdescendingmodifieduser" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
								#end
							#end
						</a>
					</th>
					<th id="lastModifiedDate" class="d-none d-sm-table-cell">
						<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=modifieddate")'; return false;"  title="$tlang.getString("gen.sorbymoddat")">
							$tlang.getString("gen.mod.date")
							#if ($sortedBy.equals("modifieddate"))
								#if ($sortedAsc.equals("true"))
									<i id="sortascendingmodifieddate" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
								#else
									<i id="sortdescendingmodifieddate" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
								#end
							#end
						</a>
					</th>
					#if ($!isTimesheet)
						<th id="timeSheet">
							<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=timesheet")'; return false;"  title="$tlang.getString("gen.sorbytime")">
								#if ($!allowGradeSubmission)
									$tlang.getString("gen.timesheet.instructor")
								#else
									$tlang.getString("gen.timesheet.student")
								#end
								#if ($sortedBy.equals("timesheet"))
									#if ($sortedAsc.equals("true"))
										<i id="sortascendingtimesheet" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
									#else
										<i id="sortdescendingtimesheet" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
									#end
								#end
							</a>
						</th>
					#end
					#if ($!allowGradeSubmission)
						#if ($!view.equals('lisofass1'))
						#if ($!showNumSubmissionColumn)
						<th id="num_submissions" scope="col" class="d-none d-sm-table-cell">
							<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=num_submissions")'; return false;"   title="$tlang.getString("listassig.sorbynum1")">$tlang.getString("gen.in")</a>
								#if ($sortedBy.equals("num_submissions"))
									<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=num_submissions")'; return false;"   title="$tlang.getString("listassig.sorbynum1")">
										#if ($sortedAsc.equals("true"))
											<i id="sortascendingtotalsubmissions" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
										#else
											<i id="sortdescendingtotalsubmissions" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
										#end
									</a>
								#end
								/
							<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=num_ungraded")'; return false;"  title="$tlang.getString("listassig.sorbynum2")">$tlang.getString("gen.new")</a>
								#if ($sortedBy.equals("num_ungraded"))
									<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=num_ungraded")'; return false;"   title="$tlang.getString("listassig.sorbynum2")">
										#if ($sortedAsc.equals("true"))
											<i id="sortascendingungradedsubmissions" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
										#else
											<i id="sortdescendingungradedsubmissions" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
										#end
									</a>
								#end
						</th>
						#end
						#end
					#end
					#if ($!allowGradeSubmission)
						<th id="maxgrade" scope="col" class="d-none d-sm-table-cell">
							<a href="javascript:void(0)" onclick="location='#toolLinkParam("$action" "doSort" "criteria=max_grade")'; return false;"   title="$tlang.getString("gen.sorbymax")">
								$tlang.getString("gen.sca")
								#if ($sortedBy.equals("max_grade"))
									#if ($sortedAsc.equals("true"))
										<i id="sortascendingungraded" class="fa fa-sort-asc" aria-hidden="true" title="$tlang.getString("gen.sorasc")"></i>
									#else
										<i id="sortdescendingungraded" class="fa fa-sort-desc" aria-hidden="true" title="$tlang.getString("gen.sordes")"></i>
									#end
								#end
							</a>
						</th>
					#end
					#if ($!tagsEnabled && ($!allowAddTags || $!show_tags_student))
						<th id="tags" scope="col" class="hidden-xs">
							<span>$tlang.getString('tags_header')</span>
						</th>
					#end
					#if ($!allowRemoveAssignment && $!view.equals('lisofass1'))
						<th id="remove" scope="col">
							<span class="d-none d-sm-table-cell">$tlang.getString("select")</span>
						</th>
					#end
				</tr>
				#set ($assignmentCount = 0)
				#foreach ($assignment in $assignments)
					#set ($assignmentReference = $!service.assignmentReference($assignment.Id))
					#set($assignmentProperties=$!assignment.getProperties())
					## all allow function results
					#set($allowUpdateAssignment=$!service.allowUpdateAssignment($assignmentReference))
					#if (!($!allowAddAssignment && $!view.equals('lisofass1')))
						## get submission instance only if 1) not an instructor type user or 2) is an instructor type user but in student view
						#set($submission=false)
						#set($submission=$service.getSubmission($assignment.Id, $user))
						#set($submissionReference=$service.submissionReference($assignment.Context, $submission.Id, $assignment.Id))
						#set($submissionReturned=$!submission.Returned)
						#set($submissionSubmitted=$!submission.Submitted)
						#set($submissionProperties=$!submission.Properties)
						#set($submitTime=false)
						#set ($submitTime = $submission.DateSubmitted)
					#end
					## no need to do permission check again, since it was done when the list was constructed
						#set ($assignmentCount = $assignmentCount + 1)
						<tr>
							<td headers="title" scope="row">
								#if (($!allowAddAssignment || $!allowUpdateAssignment || $!service.allowGradeSubmission($assignmentReference)) && $!view.equals('lisofass1'))
									<strong>
										## normal instructor view
										#if ($assignment.Draft && $!allowUpdateAssignment )
											<a name="asnActionLink" href="#toolLinkParam("$action" "doEdit_assignment" "assignmentId=$formattedText.escapeUrl($assignmentReference)")" title="$formattedText.escapeHtml($!assignment.Title)">
										#else
											<a name="asnActionLink" href="#toolLinkParam("$action" "doView_assignment" "assignmentId=$formattedText.escapeUrl($assignmentReference)")" title="$formattedText.escapeHtml($!assignment.Title)">
										#end
										#if ($!assignment.draft)
											<span class="highlight">$tlang.getString("gen.dra2")</span>
										#end
											$formattedText.escapeHtml($!assignment.Title)
										</a>
										#if ($assignmentAlertMap.containsKey($assignment.getId()))
											<span>$assignmentAlertMap.get($assignment.getId())</span>
										#end

										#assignmentIcons($assignment)
										#if ($rubricMap.containsKey($assignment.getId()))
										<sakai-rubric-student-button
											class="ms-1"
											force-preview
											dont-check-association
											rubric-id="$rubricMap.get($assignment.getId())"
											site-id="$assignment.getContext()"
											tool-id="sakai.assignment.grades"
											entity-id="$assignment.Id"
											instructor="true">
										</sakai-rubric-student-button>
										#end

									</strong>
									<div class="itemAction">
										#set($prevAction=false)
										#if ($!allowUpdateAssignment)#set($prevAction=true)<a name="asnActionLink" onclick="SPNR.insertSpinnerInPreallocated( this, null, 'linksSpinnerPlaceholder_$formattedText.escapeUrl($assignmentReference)' );" href="#toolLinkParam("$action" "doEdit_assignment" "assignmentId=$formattedText.escapeUrl($assignmentReference)")">$!tlang.getString("gen.revi")<span class="skip"> $formattedText.escapeHtml($!assignment.Title)</span></a>#end
										#if ($allowAddAssignment&&$!allowUpdateAssignment)#if($prevAction) |#else#set($prevAction=true)#end<a name="asnActionLink" onclick="duplicateLink(this);SPNR.insertSpinnerInPreallocated( this, null, 'linksSpinnerPlaceholder_$formattedText.escapeUrl($assignmentReference)' );return false;" href="#toolLinkParam("$action" "doDuplicate_assignment" "assignmentId=$formattedText.escapeUrl($assignmentReference)")">$!tlang.getString("dupli")<span class="skip"> $formattedText.escapeHtml($!assignment.Title)</span></a>#end
										#if ($taggable && $allowAddAssignment)
											#foreach ($provider in $providers)
												#set ($helperInfo = false)
												#set ($activity = $producer.getActivity($assignment))
												#set ($helperInfo = $provider.getActivityHelperInfo($activity.reference))
												#if ($helperInfo)
													#if($prevAction)
														|
													#else
														#set($prevAction=true)
													#end
														<a name="asnActionLink" href="#toolLinkParam("$action" "doHelp_activity" "activityRef=$formattedText.escapeUrl($activity.reference)&providerId=$formattedText.escapeUrl($provider.id)")" onclick="SPNR.insertSpinnerInPreallocated( this, null, 'linksSpinnerPlaceholder_$formattedText.escapeUrl($assignmentReference)' );" title="$!helperInfo.description">$!helperInfo.name</a>
												#end
											#end
										#end
										#if (!$assignment.Draft && $!service.allowGradeSubmission($assignmentReference))#if($prevAction) |#end
										#set ($gradeScale = $assignment.TypeOfGrade.ordinal())
										## show "view submissions" link for ungraded type of assignment
											<a name="asnActionLink" href="javascript:void(0)" onclick="if(ASN.allowClick(this)){ SPNR.insertSpinnerInPreallocated( this, null, 'linksSpinnerPlaceholder_$formattedText.escapeUrl($assignmentReference)' ); window.location='#toolLinkParam("$action" "doGrade_assignment" "assignmentId=$formattedText.escapeUrl($assignmentReference)")'; }" >#if ($gradeScale != 1)$!tlang.getString("gen.assign.gra")#else$!tlang.getString("viewsubmissions")#end<span class="skip"> $formattedText.escapeHtml($!assignment.getTitle())</span></a>
										#end
										<div id="linksSpinnerPlaceholder_$formattedText.escapeUrl($assignmentReference)" class="allocatedSpinPlaceholder"></div>
									</div>
								#else
									#if ($!allowAddAssignment)
										## still for instructor, different view
										#if ($!submission && $submitTime)
											#set($allowResubmitNumber=$!submissionProperties.getProperty($!allowResubmitNumberProp))
											#if(!$!allowResubmitNumber.equals("0"))
												#set($allowResubmitCloseTimeString=$!submissionProperties.getProperty($!allowResubmitCloseTimeProp))
												#if($!allowResubmitCloseTimeString)
													#set($allowResubmitCloseTime=$!TimeService.newTime($!LongObject.parseLong($!allowResubmitCloseTimeString)))
												#end
											#end
											## if not submitted or returned and still allowed to submit within the due time
											#if ($service.canSubmit($assignment))
												## go to view submission page when (1) submission has been returned and allow for resubmit;(2)submission has not been posted yet.
												<a name="asnActionLink" href="#toolLinkParam("AssignmentAction" "doView_submission" "assignmentReference=$formattedText.escapeUrl($assignmentReference)")" title="$formattedText.escapeHtml($!assignment.Title)">
											#else
												<a name="asnActionLink" href="#toolLinkParam("AssignmentAction" "doView_grade" "submissionId=$formattedText.escapeUrl($submissionReference)")" title="$formattedText.escapeHtml($!assignment.Title)">
											#end
											$formattedText.escapeHtml($assignment.Title)</a>
											#assignmentIcons($assignment)
											#if ($rubricMap.containsKey($assignment.getId()))
												<sakai-rubric-student-button
													site-id="$assignment.getContext()"
													rubric-id="$rubricMap.get($assignment.getId())"
													tool-id="sakai.assignment.grades"
													evaluated-item-id="$submission.Id"
													entity-id="$assignment.Id">
												</sakai-rubric-student-button>
											#end
										#else
											$formattedText.escapeHtml($assignment.Title)
											#assignmentIcons($assignment)
											#if ($rubricMap.containsKey($assignment.getId()))
												<sakai-rubric-student-button
													site-id="$assignment.getContext()"
													rubric-id="$rubricMap.get($assignment.getId())"
													tool-id="sakai.assignment.grades"
													evaluated-item-id="$submission.Id"
													entity-id="$assignment.Id">
												</sakai-rubric-student-button>
											#end
											#if ($!allowSubmit)
												<div class="itemAction">
													<a name="asnActionLink" href="#toolLinkParam("AssignmentAction" "doView_submission" "assignmentReference=$formattedText.escapeUrl($assignmentReference)&submitterIdInstructor=instructor")" onclick="SPNR.insertSpinnerInPreallocated( this, null, 'subAsStudentSpinnerPlaceholder_$formattedText.escapeUrl($assignmentReference)' );" title="$formattedText.escapeHtml($!assignment.Title)">
														$tlang.getString("subasstudent")<span class="skip">: $formattedText.escapeHtml($assignment.Title)</span>
													</a>
													<div id="subAsStudentSpinnerPlaceholder_$formattedText.escapeUrl($assignmentReference)" class="allocatedSpinPlaceholder"></div>
												</div>
											#end
										#end
									#else
										## SAK-21525 START
										## If this assignment has groups, their access controls must take precedence
										#if ($assignment.TypeOfAccess.Ordinal == 1)
											#set($groupIds='')
											#set($groupIds=$assignment.Groups)
											#if($groupIds != '' && $groupIds.size() > 0)
												#set($allowSubmit=false)
												## If asn.submit is set on at least one of the assignment's authz groups, set allowSubmit to true
												#foreach($groupId in $groupIds)
													#if($AuthzGroupService.isAllowed($user.getId(),'asn.submit',$groupId))
														#set($allowSubmit=true)
													#end
												#end
											#end
										#end

										## SAK-21525 END
										#if($allowSubmit)
											<strong>
												<a name="asnActionLink" href="#toolLinkParam("AssignmentAction" "doView_submission" "assignmentReference=$formattedText.escapeUrl($assignmentReference)")" title="$formattedText.escapeHtml($!assignment.Title)">$formattedText.escapeHtml($assignment.Title)</a>
												#assignmentIcons($assignment)
											</strong>
											#set($submissionId="undefined")
											#if ($submission && $submission.Graded && ($submission.GradeReleased || $submission.Returned))
												#set($submissionId=$submission.Id)
											#end
										    #if ($rubricMap.containsKey($assignment.getId()))
											<sakai-rubric-student-button
												site-id="$assignment.getContext()"
												tool-id="sakai.assignment.grades"
												evaluated-item-id="$submissionId"
												#if($!assignment.IsGroup)
													evaluated-item-owner-id="$submission.GroupId"
												#else
													evaluated-item-owner-id="$user.getId()"
												#end
												entity-id="$assignment.Id">
											</sakai-rubric-student-button>
											#end
											#if ($taggable && $allowAddAssignment)
												<div class="itemAction">
													#set($prevAction=false)
													#foreach ($provider in $providers)
														#set ($activityHelperInfo = false)
														#set ($activity = $producer.getActivity($assignment))
														#set ($activityHelperInfo = $provider.getActivityHelperInfo($activity.reference))
														#if ($activityHelperInfo)
															#if($prevAction)
																|
															#else
																#set($prevAction=true)
															#end
															<a name="asnActionLink" href="#toolLinkParam("$action" "doHelp_activity" "activityRef=$formattedText.escapeUrl($activity.reference)&providerId=$formattedText.escapeUrl($provider.id)")" title="$!activityHelperInfo.description">$!activityHelperInfo.name</a>
														#end
														#if ($!submission)
															#set ($itemHelperInfo = false)
															#set ($item = $producer.getItem($submission, $user.getId()))
															#set ($itemHelperInfo = $provider.getItemHelperInfo($item.reference))
															#if ($itemHelperInfo)
																#if($prevAction)
																	|
																#else
																	#set($prevAction=true)
																#end
																<a name="asnActionLink" href="#toolLinkParam("$action" "doHelp_item" "itemRef=$formattedText.escapeUrl($item.reference)&providerId=$formattedText.escapeUrl($provider.id)")" title="$!itemHelperInfo.description">$!itemHelperInfo.name</a>
															#end
														#end
													#end
												</div>
											#end
										#else
											<a name="asnActionLink" href="#toolLinkParam("AssignmentAction" "doView_assignment_as_student" "assignmentId=$assignmentReference")" title="$formattedText.escapeHtml($!assignment.Title)">$formattedText.escapeHtml($assignment.Title)</a>
										#end
									#end
									#set ($deleted = false)
									#set ($deleted = $assignment.Deleted)
									#if ($!deleted.equalsIgnoreCase("true"))
										<span class="highlight">$tlang.getString("stulistassig.asshasbee1")</span>
									#end
								#end
							</td>
						#if ($!allowGradeSubmission)
							<td headers="for" class="d-none d-sm-table-cell">
								#if($assignment.TypeOfAccess == "SITE")
									$tlang.getString("gen.viewallgroupssections")
								#else
									#set($groupTitleList = $asnGroupTitleMap.get($assignment.Id))
									#if(!$groupTitleList.isEmpty())
										<div class="groupsContainer">
											<strong class="collapse" onclick="ASN.toggleGroups(this);">
												$groupTitleList.size() #if($groupTitleList.size() == 1) $tlang.getString("selected.group") #else $tlang.getString("selected.groups") #end
											</strong>

											<div id="groupsPanel" style="display: none;">
												<ul>
													#foreach($title in $groupTitleList)
														<li>$formattedText.escapeHtml($title)</li>
													#end
												</ul>
											</div>
										</div>
									#else
										<div class="sak-banner-warn">$tlang.getString("assignment.inaccessible")</div>
									#end
								#end
							</td>
						#end
							<td headers="status">
								#if ($allowAddAssignment && $!view.equals('lisofass1'))
								   $!service.getAssignmentStatus($assignment.Id)
								#else
									#if ($submission)
										#set ($submissionId = $submission.Id)
									#end
									$!service.getSubmissionStatus($!submissionId, true)

									#if ($submission && $submission.Properties)
										#set($isAutoSubmitted = "false")
										#set($isAutoSubmitted = $submission.Properties.get("auto_submitted"))
										#if ($isAutoSubmitted.equalsIgnoreCase("true"))
											<br/>
											<span class="badge bg-info" title="$tlang.getString('auto.submit.indicator')">
												<span class="bi bi-clock-history me-1" aria-hidden="true"></span>
												$tlang.getString("auto.submit.indicator")
											</span>
										#end
									#end
								#end
							</td>
							#if ($allowAddAssignment == false)
								<td headers="grade">
									#if ($submission)
										#set ($gradeForSubmitter = $service.getGradeForSubmitter($submission, $user.getId()))
									#else
										#set ($gradeForSubmitter = "")
									#end
									#if ($submission.Graded && ($submission.GradeReleased || $submission.Returned))
										#if ((($service.getSubmissionStatus($submission.Id, false) == $tlang.getString("gen.returned")) || ($service.getSubmissionStatus($submission.Id, false) == $tlang.getString("gen.pending_resubmit"))) && $submission.grade)
											#if ($gradeForSubmitter.equals(""))
												<span>$tlang.getString("unchecked")</span>
												<span>$gradeForSubmitter</span>
											#else
												<span>$gradeForSubmitter#if ($assignment.TypeOfGrade.ordinal() == 3)/$service.getMaxPointGradeDisplay($assignment.ScaleFactor, $assignment.MaxGradePoint)#end</span>
											#end
										#else
											#if ($gradeForSubmitter.equals("") || ($service.getSubmissionStatus($submission.Id) == $tlang.getString("gen.notsta")))
												<span>-#if ($assignment.TypeOfGrade.ordinal() == 3)/$service.getMaxPointGradeDisplay($assignment.ScaleFactor, $assignment.MaxGradePoint)#end</span>
											#else
												<span>$gradeForSubmitter#if ($assignment.TypeOfGrade.ordinal() == 3)/$service.getMaxPointGradeDisplay($assignment.ScaleFactor, $assignment.MaxGradePoint)#end</span>
											#end
										#end
									#end
								</td>
							#end
							<td headers="openDate" class="d-none d-sm-table-cell">
								$!service.getUsersLocalDateTimeString($!assignment.OpenDate)
							</td>
							<td headers="dueDate">
							#if (!$assignment.HideDueDate || ($!allowUpdateAssignment && !$!view.equals('stuvie')))
								##Instructors can still see the due date
								<span class="highlight">$!service.getUsersLocalDateTimeString($!assignment.DueDate)</span>
							#end
							</td>
							<td headers="lastModifiedUser" class="d-none d-sm-table-cell">
							#if ($!assignment.Modifier)
								<span>$!service.getAssignmentModifier($!assignment.Modifier)</span>
							#end
							</td>
							<td headers="lastModifiedDate" class="d-none d-sm-table-cell">
								<span>$!service.getUsersLocalDateTimeString($!assignment.DateModified)</span>
							</td>
							#if ($!isTimesheet)
								#if ($!allowGradeSubmission)
									<td headers="timeSheet">
									#if (!$assignment.Estimate || $assignment.Estimate.equals(""))
										-
									#else
										#if (!$!rate.get($assignment.Id) || $!rate.get($assignment.Id).equals(""))
											-/$!assignment.Estimate
										#else
											$!rate.get($assignment.Id)/$!assignment.Estimate
										#end
									#end	
									</td>
								#else
									<td headers="timeSheet">
									#if (!$assignment.Estimate || $assignment.Estimate.equals(""))
										-
									#else
										#if (!$!rateStudent.get($assignment.Id) || $!rateStudent.get($assignment.Id).equals(""))
											-/$!assignment.Estimate
										#else
											$!rateStudent.get($assignment.Id)/$!assignment.Estimate
										#end
									#end	
									</td>
								#end
							#end
							#if ($!allowGradeSubmission)
								#if ($!view.equals('lisofass1'))
								#if ($!showNumSubmissionColumn)
								<td headers="num_submissions" class="specialLink d-none d-sm-table-cell">
								## not show the link for draft assignment
								#if (!$assignment.Draft && $!service.allowGradeSubmission($assignmentReference))
									#set($ungradedNumber = $!service.countSubmissions($assignmentReference, false))
									#set($totalNumber = $!service.countSubmissions($assignmentReference, null))
									<div class="spinnerBesideContainer">
										<a name="asnActionLink" href="javascript:void(0)" onclick="if(ASN.allowClick(this)){ SPNR.insertSpinnerAfter( this, null, null ); window.location='#toolLinkParam("$action" "doGrade_assignment" "assignmentId=$formattedText.escapeUrl($assignmentReference)")'; }" >
											<span class="skip"> #if ($gradeScale != 1)$!tlang.getString("gen.assign.gra")#else$!tlang.getString("viewsubmissions")#end : $formattedText.escapeHtml($!assignment.Title). </span> <span class="skip">$!tlang.getString("gen.subm2"): </span>$!totalNumber/<span class="skip">$!tlang.getString("ungra"): </span>$!ungradedNumber
										</a>
									</div>
								#end
								</td>
								#end
								#end
							#end
							#if ($!allowGradeSubmission)
							<td headers="maxgrade" class="d-none d-sm-table-cell">
									#set ($gradeScale = $assignment.TypeOfGrade.ordinal())
									#if ($gradeScale == 0)
										## Grade type not set
										$tlang.getString("gen.notset")
									#elseif ($gradeScale == 1)
										## Ungraded grade type
										$tlang.getString("gen.nograd")
									#elseif ($gradeScale == 2)
										## Letter grade type
										A-F
									#elseif ($gradeScale == 3)
										## Score based grade type
										0-$!service.getMaxPointGradeDisplay($assignment.ScaleFactor, $assignment.MaxGradePoint)
									#elseif ($gradeScale == 4)
										## Pass/fail grade type
										$tlang.getString("gen.pf")
									#elseif ($gradeScale == 5)
										## Grade type that only requires a check
										<span class="si si-check fs-3" aria-label="$tlang.getString("check")" />
									#end
							</td>
							#end
							#if ($!tagsEnabled && ($!allowAddTags || $!show_tags_student))
								<td class="tag-header hidden-xs">
								#if ($tagsMap.containsKey($assignment.getId()))
									#foreach($tag in $tagsMap.get($assignment.getId()))
										<span class="badge bg-info">$tag</span>
									#end
								#end
								</td>
							#end
							#if ($!allowRemoveAssignment && $!view.equals('lisofass1'))
								<td headers="remove" class="screenOnly">
										<input type="checkbox" name="selectedAssignments" value="$assignmentReference" id="check_$assignmentCount" onclick="ASN.checkEnableRemove();" />
										<label for="check_$assignmentCount" class="skip">$tlang.getString("gen.remove"): $formattedText.escapeHtml($!assignment.Title)</label>
								</td>
							#end
						</tr>
						<!-- Peer assessment rows -->
						#if($assignment.getAllowPeerAssessment() && !($allowAddAssignment && $!view.equals('lisofass1')))
							#set($reviews = $peerAssessmentItemsMap.get($assignment.Id))
							<!-- only show to "students" -->
							<!-- peer assessment overview row -->
							<tr>
								<!-- title col -->
								<td class="peer-header">
									<strong title="$formattedText.escapeHtml($!assignment.Title)"><span class="fa fa-caret-square-o-right" aria-hidden="true"></span> $formattedText.escapeHtml($assignment.Title)</strong>
									#if ($assignment.IsGroup)
										$tlang.getFormattedMessage("peerAssessmentName", $tlang.getString("peerAssessmentGroups"))
									#else
										$tlang.getFormattedMessage("peerAssessmentName", $tlang.getString("peerAssessmentStudents"))
									#end
								</td>
								#if ($!allowGradeSubmission)
									<!-- scope col -->
									<td></td>
								#end
								<!-- status col -->
								<td>
									#if ($!submission)
										#if($!service.isPeerAssessmentPending($!assignment))
											<!-- peer review hasn't opened and user submitted -->
											#if ($submission.Submitted)
												$tlang.getString("peerassessment.notOpen")
											#else
												<!-- user has only submitted a draft, tell the user submission is required to encourage submission (although technically it isn't) -->
												$tlang.getString("peerassessment.submissionReq")
											#end
										#else
											<!-- peer review is open (or over) and user submitted
												status will be "not started", "incomplete", or "submitted"
											-->

											#if(!$reviews || $reviews.size() == 0)
												<!-- something is wrong here, don't show anything to the user, just show not open -->
												$tlang.getString("peerassessment.notOpen")
											#else
												#set($completedReviews = true)
												#set($anyDraftReviews = false)
												#set($anyCompleteReviews = false)
												#foreach ($review in $reviews)
													#if(!$review.getSubmitted())
														#set($completedReviews = false)
														#if($review.isDraft())
															#set($anyDraftReviews = true)
														#end
													#else
														#set($anyCompleteReviews = true)
													#end
												#end
												#if($completedReviews)
													<!-- all reviews are completed -->
													$tlang.getString("peerassessment.submitted")
												#elseif($anyDraftReviews || $anyCompleteReviews)
													<!-- some are still in draft -->
													$tlang.getString("peerassessment.incomplete")
												#else
													<!-- user hasn't started -->
													$tlang.getString("peerassessment.notStarted")
												#end
											#end
										#end
									#else
										<!-- submission required -->
										$tlang.getString("peerassessment.submissionReq")
									#end
								</td>
								<td>-</td>
								<!-- open col -->
								<td headers="openDate" class="d-none d-sm-table-cell">
									$!service.getUsersLocalDateTimeString($!assignment.CloseDate)
								</td>
								<!-- due col -->
								<td>
									<span class="highlight">$!service.getUsersLocalDateTimeString($!assignment.PeerAssessmentPeriodDate)</span>
								</td>
								<td headers="lastModifiedUser" class="d-none d-sm-table-cell"></td>
								<td headers="lastModifiedDate" class="d-none d-sm-table-cell"></td>
								<!-- the following are empty columns as place holders -->
								#if ($!allowGradeSubmission)
									#if ($!view.equals('lisofass1'))
									#if ($!showNumSubmissionColumn)
										<!-- num submissions col -->
										<td></td>
									#end
									#end
								#end
								#if ($!allowGradeSubmission)
									<!-- grade scale col -->
									<td></td>
								#end
								#if ($!tagsEnabled && $!show_tags_student)
									<td class="hidden-xs"></td>
								#end
								#if ($!allowRemoveAssignment && $!view.equals('lisofass1'))
									<!-- remove col -->
									<td></td>
								#end
							</tr>

							<!-- end peer assessment overview row -->
							<!-- peer assessment items rows -->
							#if ($!submission && $!service.isPeerAssessmentOpen($!assignment) && $!reviews)
								<!-- peer assessment is open and user has submitted, show item details -->
								#set ($reviewCount = 0)
								#foreach ($review in $reviews)
									#set ($reviewCount = $reviewCount + 1)
									<tr>
										<!-- title col -->
										<td>
											<span class="indnt2">
												#if($review.getSubmitted())
													#if ($assignment.IsGroup)
														$tlang.getFormattedMessage("peerassessment.group", $reviewCount)&nbsp;<span class="bi bi-check" aria-hidden="true" aria-label="$tlang.getString("gen.subm4")"></span>
													#else
														$tlang.getFormattedMessage("peerassessment.student", $reviewCount)&nbsp;<span class="bi bi-check" aria-hidden="true" aria-label="$tlang.getString("gen.subm4")"></span>
													#end
												#else
													<a name="asnActionLink" href="#toolLinkParam("$action" "doEdit_review" "assignmentId=$formattedText.escapeUrl($assignmentReference)&submissionId=$formattedText.escapeUrl($review.id.SubmissionId)")">
														#if ($assignment.IsGroup)
															$tlang.getFormattedMessage("peerassessment.group", $reviewCount)
														#else
															$tlang.getFormattedMessage("peerassessment.student", $reviewCount)
														#end
													</a>
												#end
											</span>
										</td>
										#if ($!allowGradeSubmission)
											<!-- scope col -->
											<td></td>
										#end
										<!-- status col -->
										<td>
											#if($review.getSubmitted())
												$tlang.getString("peerassessment.submitted")
											#elseif($review.isDraft())
												$tlang.getString("peerassessment.draftInProgress")
											#else
												$tlang.getString("peerassessment.notStarted")
											#end
										</td>
										<td>-</td>
										<!-- open col -->
										<td headers="openDate" class="d-none d-sm-table-cell">
										</td>
										<!-- due col -->
										<td>
										</td>
										<td headers="lastModifiedUser" class="d-none d-sm-table-cell"></td>
										<td headers="lastModifiedDate" class="d-none d-sm-table-cell"></td>
										<!-- the following are empty columns as place holders -->
										#if ($!allowGradeSubmission)
											#if ($!view.equals('lisofass1'))
											#if ($!showNumSubmissionColumn)
												<!-- num submissions col -->
												<td></td>
											#end
											#end
										#end
										#if ($!allowGradeSubmission)
											<!-- grade scale col -->
											<td></td>
										#end
										#if ($!tagsEnabled && $!show_tags_student)
											<td class="hidden-xs"></td>
										#end
										#if ($!allowRemoveAssignment && $!view.equals('lisofass1'))
											<!-- remove col -->
											<td></td>
										#end
									</tr>
								#end
							#end
						<!-- End peer assessment items rows -->

						<!-- End Peer assessment rows -->
						#end
				#end
			</table>
		</div>

			#if ($!allowRemoveAssignment && $!view.equals('lisofass1'))
				<p class="act">
					<input type="submit" id="btnRemove" name="eventSubmit_doDelete_confirm_assignment" value="$tlang.getString("removeSelected")" accesskey="s" disabled="disabled"
						onclick="SPNR.disableControlsAndSpin( this, null );" />
					<input type="submit" id="btnPublish" name="eventSubmit_doPublish_confirm_assignment" value="$tlang.getString("publishSelected")" accesskey="s" disabled="disabled"
						onclick="SPNR.disableControlsAndSpin( this, null );" />
					<input type="submit" id="btnUnpublish" name="eventSubmit_doUnpublish_confirm_assignment" value="$tlang.getString("unpublishSelected")" accesskey="s" disabled="disabled"
						onclick="SPNR.disableControlsAndSpin( this, null );" />
				</p>
			#end
			<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
		</form>
	#end
</div>
<!-- end: chef_assignments_list_assignments.vm  -->
