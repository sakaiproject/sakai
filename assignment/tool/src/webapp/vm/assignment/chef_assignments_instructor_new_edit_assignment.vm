<!-- start: chef_assignments_instructor_new_edit_assignment.vm  -->
#set( $H = '-' )
#set( $T = 'T' )
#rubricsRequirements
<!-- Initialize the Bootstrap-multiselect plugin: -->
<script>
    $(document).ready(function() {
        $('#selectedGroups').multiselect({
            selectAllText: '$tlang.getString("asn.edit.selectall")',
            nonSelectedText: '$tlang.getString("asn.edit.selectone")',
            allSelectedText: '$tlang.getString("asn.edit.allselected")',
            nSelectedText: ' $tlang.getString("asn.edit.groupsselected")',
            filterPlaceholder: '$tlang.getString("asn.edit.searchgroup")',
            enableFiltering: true,
            enableCaseInsensitiveFiltering: true,
            includeSelectAllOption: true,
            templates: {
                button: `
                    <button type="button"
                            class="btn btn-primary multiselect dropdown-toggle"
                            data-bs-toggle="dropdown">
                        <span class="multiselect-selected-text"></span>
                        <i class="si si-caret-down-fill ps-2"></i>
                    </button>
                `,
                filter: `
                    <div class="multiselect-filter d-flex align-items-center"><i class="fa fa-sm fa-search text-muted"></i><input type="search" class="multiselect-search form-control" /></div>
                `,
            },
        });
        $('#selectedGroups').change(function(){
            ASN_INE.validateGroupSelection();
        });
        ASN.checkIframeTags();

        // Initialize tag selector
        #if ($!tagsEnabled && $!allowAddTags)
            window.syncTagSelectorInput("tag-selector", "tag_selector");
        #end
        #if ($!isGradebookGroupEnabled)
            window.syncGbSelectorInput("gb-selector", "gb_selector");
        #end
    });
</script>
<script>
	#if($turnitin_forceSingleAttachment)
		function forceSingleAttachment(checked) {
			if(checked){
 				$("#subType").val(5);
 			}
			$("#subType > option").each(function(){
 				    if(checked){
					if($(this).val() != 5){
 						$(this).prop('disabled', 'disabled');
					}
 					}else{
						$(this).removeProp('disabled');
		 			}
 			});
		}
        #end
	$(document).ready(function() {
		ASN.setupAssignNew();
		#if($turnitin_forceSingleAttachment)
		   	if ($("#new_assignment_use_review_service").is(':checked')) {
				forceSingleAttachment(true);
			} 
		 	$("#new_assignment_use_review_service").click(function (){
		 		var checked = this.checked;
				forceSingleAttachment(checked);
		 	});
		#end
		ASN_INE.validateGroupSelection();
	});

	## handles the Student Submissions dropdown
	function switchAssignmentSubmissionType()
	{
		var useReview = document.getElementById('$name_UseReviewService');
		var lblUseReview=document.getElementById('lblReviewService');
		var reviewSwitchNe1 = document.getElementById('review.switch.ne.1');
		var reviewSwitchNe2 = document.getElementById('review.switch.ne.2');
		if(document.getElementById('subType').value == 6)
        {
			document.getElementById('External_Tool_Fieldset').style.display = 'block';
			document.getElementById('ltiSubmissionResubmitNote').style.display = 'block';
			document.getElementById('site').checked = true;
			document.getElementById('notificationOptions').style.display = 'none';
			#if ($allowReviewService && ($reviewServiceProviderId == $turnitinProviderId || $reviewServiceProviderId == $turnitinOCProviderId))
				document.getElementById('contentReviewServiceOptions').style.display = 'none';
			#end
			document.getElementById('notsendnotif').checked = true;
			document.getElementById('releaseGradeNotifications').style.display = 'none';
			document.getElementById('notsendreleasegradenotif').checked = true;
			document.getElementById('additionalInformation').style.display = 'none';
			document.getElementById('peerAssessmentCheckboxLabel').checked = false;
			document.getElementById('peerAssessmentContainer').style.display = 'none';
        } else {
			document.getElementById('External_Tool_Fieldset').style.display = 'none';
			document.getElementById('ltiSubmissionResubmitNote').style.display = 'none';
			document.getElementById('notificationOptions').style.display = 'block';
			#if ($allowReviewService && ($reviewServiceProviderId == $turnitinProviderId || $reviewServiceProviderId == $turnitinOCProviderId))
				document.getElementById('contentReviewServiceOptions').style.display = 'block';
			#end
			document.getElementById('releaseGradeNotifications').style.display = 'block';
			document.getElementById('additionalInformation').style.display = 'block';
			document.getElementById('peerAssessmentContainer').style.display = 'block';
        }

		if(document.getElementById('subType').value != 4 )
		{
			#if ($allowReviewService)
				reviewSwitchNe1.style.display='none';
				lblReviewService.className='';
				reviewSwitchNe2.style.display='none';
				useReview.disabled=false;
				lblUseReview.style.display = 'block';
			#end
			document.getElementById('tempAllowRes').parentNode.parentNode.style.display = 'block';
			if (document.getElementById('allowResToggle').checked)
			{
				document.getElementById('allowResubmitNumber').style.display = 'block';
				document.getElementById('allowResubmitTime').style.display = 'block';
				document.getElementById('resubmitNotification').style.display = 'block';
				ASN.resizeFrame();
			}
		}
		else
		{
			#if ($allowReviewService)
				if (useReview.checked)
				{
					reviewSwitchNe2.style.removeProperty('display');
					ASN.toggleReviewServiceOptions(this.checked);
				}
				useReview.checked=false;
				useReview.disabled=true;
				lblUseReview.className='';
				reviewSwitchNe1.style.removeProperty('display');
				lblUseReview.style.display = 'none';
			#end
			document.getElementById('tempAllowRes').parentNode.parentNode.style.display = 'none';
			document.getElementById('allowResToggle').checked = false;
			document.getElementById('allowResubmitNumber').style.display = 'none';
			document.getElementById('allowResubmitTime').style.display = 'none';
			document.getElementById('resubmitNotification').style.display = 'none';
		}
	}
	focus_path = [ '$fField' ];
</script>
#javascript("/library/js/lang-datepicker/lang-datepicker.js")
## Include other javascript specific to this page
#javascript("/sakai-assignment-tool/js/instructorNewEdit.js")

<div class="portletBody container-fluid">
	#navBarOnClick( $allowAddAssignment $allowGradeSubmission $allowAddAssignment $allowRecoverAssignment $allowAllGroups $assignmentscheck $allowUpdateSite $enableViewOption $view "newAssignmentForm" "new" )

	<div class="page-header">
		<h1>
		#if($formattedText.escapeHtml($!value_title) && $formattedText.escapeHtml($!value_title) !='')
			$formattedText.escapeHtml($!value_title) <span class="highlight">	$tlang.getString("edit")</span>
		#else
			$tlang.getString("new.title")
		#end
		</h1>
	</div>

	#if ($alertMessage)
		<div class="sak-banner-error" id="generalAlert" role="alert" aria-live="assertive">
			<strong>$tlang.getString("gen.alert")</strong> $alertMessage
		</div>
	#end

	#set($submitnotif="submitnotifTop")

	<form name="newAssignmentForm" id="newAssignmentForm" action="#toolForm("AssignmentAction")" method="post">
		<input type="hidden" name="assignmentId" value="$!assignmentId" />
		<input type="hidden" name="eventSubmit_doAssignment_form" value="" />
		<input type="hidden" name="option" id="option" value="" />
		<input type="hidden" name="view" id="view" value="" />
		<input type="hidden" name="$name_order" id="$name_order" value="$!value_position_order" />

		<div class="form-group row form-required">
			<label for="$name_title" class="col-sm-12 form-control-label block">
				$tlang.getString("gen.title")
			</label>
			<div class="col-sm-8">
				<input name="$name_title" id="$name_title" type="text" value="$formattedText.escapeHtml($!value_title)" maxlength="100" class="form-control" placeholder="$tlang.getString("gen.title")" />
			</div>
		</div>

		<div class="longtext form-group row form-required">
			<label for="$name_Description" class="block form-control-label col-sm-12">
				$tlang.getString("gen.assinf")
			</label>
			<div class="col-sm-12">
                        #set($contextkey = "ckeditor-autosave-context")
                        #set($entitykey = "ckeditor-autosave-entity-id")
                        #set($entityval = "$assignmentId")
                        <input type="hidden" id="$contextkey" name="$contextkey" value="asn_instructor_edit">
                        <input type="hidden" id="$entitykey" name="$entitykey" value="$entityval">

				<table border="0" style="margin:0"><tr><td>
					<textarea name="$name_Description" id="$name_Description" cols="80" rows="30" wrap="virtual">$formattedText.escapeHtmlFormattedTextarea($value_Description)</textarea>
					#chef_setupformattedtextarea($name_Description)
					</td></tr>
				</table>
			</div>
		</div>

		<div class="checkbox">
			<label for="$name_CheckAddHonorPledge">
				<input id="$name_CheckAddHonorPledge" name="$name_CheckAddHonorPledge" type="checkbox" value="true"
					#if ($!value_CheckAddHonorPledge)
                       checked="checked"
					#end
				/>
				$tlang.getString("gen.addhonple")
			</label>
		</div>

		#if ($!allowAutoSubmit)
			<div class="checkbox">
				<label for="$name_CheckAutoSubmit">
					<input id="$name_CheckAutoSubmit" name="$name_CheckAutoSubmit" type="checkbox" value="true"
						#if ($!value_CheckAutoSubmit)
							checked="checked"
						#end
					/>
					$tlang.getString("auto.submit.checkbox.label")
				</label>
				<p class="text-muted small">
					$tlang.getString("auto.submit.checkbox.description")
				</p>
			</div>
		#end

		## attachments
		<h4>
			$tlang.getString("gen.att")
		</h4>
		#set ($size = 0)
		#set ($props = false)
		#foreach ($attachment in $attachments)
			#set ($props = $attachment.Properties)
			#if ($!props)
				#set ($size = $size + 1)
			#end
		#end
		#if ($size == 0)
			<p class="alert alert-info rounded p-2">
                            #if ($value_SubmissionType == 5)
                                $tlang.getString("gen.noatt.single")
                            #else
                                $tlang.getString("gen.noatt")
                            #end
                        </p>

			<div class="act">
				<input type="button" name="attach" value="$tlang.getString('gen.addatt')" onclick="document.getElementById('option').value='attach';document.newAssignmentForm.submit();return false;"/>
			</div>
		#else
			<ul class="attachList indnt1">
				#foreach ($attachment in $attachments)
					<input type="hidden" name="attachments" id="attachments" value="$attachment.Reference" />
					#set ($props = false)
					#set ($props = $attachment.Properties)
					#if ($!props)
						<li>
							#if ($props.getBooleanProperty($props.NamePropIsCollection))
								<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
							#else
								<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
							#end
							<a href="$attachment.Url" target="_blank">$formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>
							#propertyDetails($props)
						</li>
					#end
				#end
			</ul>
			<div class="act">
				<input type="button" name="attach" value="$tlang.getString('gen.adddroatt')" onclick="document.getElementById('option').value='attach';document.newAssignmentForm.submit();return false;" />
			</div>
		#end

		<h4>
			$tlang.getString("gen.availability")
		</h4>
		#if ($visible_date_enabled)
		<div class="form-group row visible-date">
 			<div id="tempVisibleDate" >
				<label for="allowVisibleDateToggle" class="col-sm-2 control-label">
                    $tlang.getString("allowVisibleDate")
				</label>
				<div class="col-sm-10">
					<input type="checkbox" id="allowVisibleDateToggle" name="allowVisibleDateToggle" #if($!new_assignment_visibletoggle)checked="checked"#end onclick="ASN.changeVisibleDate();" />
				</div>
			</div>
		</div>
		<div class="form-group row visibleDatePanel" #if(!$!new_assignment_visibletoggle)style="display:none;"#end>
			<label class="col-sm-2 form-control-label">
				$tlang.getString("gen.visible.date")
			</label>
			<div class="col-sm-6 form-inline">
				<sakai-date-picker
					label="$tlang.getString("gen.visible.date")"
					hidden-prefix="new_assignment_visible_"
					iso-date="$value_VisibleYear$H$value_VisibleMonth$H$value_VisibleDay$T$value_VisibleHour:$value_VisibleMin"
					add-hidden-fields>
				</sakai-date-picker>
				<p class="text-muted small visibleDatePanel" #if(!$!new_assignment_visibletoggle)style="display:none;"#end>
					$tlang.getString("gen.stuwonsee")
				</p>
			</div>
		</div>
		#end

		<div class="form-group row form-required">
			<label for="opendate" class="col-sm-2 form-control-label">
				$tlang.getString("newassig.opedat")
			</label>
			<div class="col-sm-3 form-inline">
			    <div class="d-flex align-items-center">
					<sakai-date-picker
						id="opendate"
						label="$tlang.getString("newassig.opedat")"
						hidden-prefix="new_assignment_open_"
						iso-date="$value_OpenYear$H$value_OpenMonth$H$value_OpenDay$T$value_OpenHour:$value_OpenMin"
						add-hidden-fields>
					</sakai-date-picker>
				</div>	
				<p class="text-muted small">
					$tlang.getString("gen.stucantdo")
				</p>
			</div>
		</div>

		<div class="form-group row form-required">
			<label for="duedate" class="col-sm-2 form-control-label">
				$tlang.getString("gen.duedat")
			</label>
			<div class="col-sm-3 form-inline">
				<div class="d-flex align-items-center">
					<sakai-date-picker
						id="duedate"
						label="$tlang.getString("gen.duedat")"
						hidden-prefix="new_assignment_due_"
						iso-date="$value_DueYear$H$value_DueMonth$H$value_DueDay$T$value_DueHour:$value_DueMin"
						add-hidden-fields>
					</sakai-date-picker>
				</div>	
			</div>
 		</div>

		<div class="form-group row form-required">
			<label for="closedate" class="col-sm-2 form-control-label">
				$tlang.getString("gen.acesubunt")
			</label>
			#if ($value_EnableCloseDate)
			<div class="col-sm-3 form-inline">
			    <div class="d-flex align-items-center">
					<sakai-date-picker
						id="closedate"
						label="$tlang.getString("gen.acesubunt")"
						hidden-prefix="new_assignment_close_"
						iso-date="$value_CloseYear$H$value_CloseMonth$H$value_CloseDay$T$value_CloseHour:$value_CloseMin"
						add-hidden-fields>
					</sakai-date-picker>
				</div>
				<p class="text-muted small">
					$tlang.getString("gen.noasscan")
				</p>
			</div>
 			#else
				<select name="$name_CloseMonth" id="$name_CloseMonth" title="$tlang.getString("dateselectionwidget.month")" disabled="disabled">
					#foreach ($i in [1..12])
						#if ($i == $value_CloseMonth)
							<option value="$i" selected="selected">$monthTable.get($i)</option>
						#else
							<option value="$i">$monthTable.get($i)</option>
						#end
					#end
				</select>
                <label class="skip" for="$name_CloseDay">$tlang.getString("dateselectionwidget.day")</label>
				<select name="$name_CloseDay" id="$name_CloseDay" title="$tlang.getString("dateselectionwidget.day")" disabled="disabled">
					#foreach ($i in [1..31])
						#if ($i == $value_CloseDay)
							<option value="$i" selected="selected">$i</option>
						#else
							<option value="$i">$i</option>
						#end
					#end
				</select>
                <label class="skip" for="$name_CloseYear">$tlang.getString("dateselectionwidget.year")</label>
				<select name="$name_CloseYear" id="$name_CloseYear" title="$tlang.getString("dateselectionwidget.year")" disabled="disabled">
					#foreach ($i in [$!value_year_from..$!value_year_to])
						#if ($i == $value_CloseYear)
							<option value="$i" selected="selected">$i</option>
						#else
							<option value="$i">$i</option>
						#end
					#end
				</select>
				&nbsp;$tlang.getString("gen.at")&nbsp;
                <label class="skip" for="$name_CloseHour">$tlang.getString("dateselectionwidget.hour")</label>
				<select name="$name_CloseHour" id="$name_CloseHour" title="$tlang.getString("dateselectionwidget.hour")" disabled="disabled">
					#foreach ($i in [1..12])
						#if ($i == $value_CloseHour)
							<option value="$i" selected="selected">$i</option>
						#else
							<option value="$i">$i</option>
						#end
					#end
				</select>
                <label class="skip" for="$name_CloseMin">$tlang.getString("dateselectionwidget.minute")</label>
				<select name="$name_CloseMin" id="$name_CloseMin" title="$tlang.getString("dateselectionwidget.minute")" disabled="disabled">
					#foreach ($i in [00, 05, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55])
						<option value="$i" #if($i == $value_CloseMin)selected="selected"#end>#if($i ==0)00#elseif($i == 5)05#else$i#end</option>
					#end
				</select>
                <label class="skip" for="$name_CloseAMPM">$tlang.getString("dateselectionwidget.ampm")</label>
				<select name="$name_CloseAMPM" id="$name_CloseAMPM" title="$tlang.getString("dateselectionwidget.ampm")" disabled="disabled">
					#foreach ($i in ["AM", "PM"])
						#if ($i == $value_CloseAMPM)
							<option value="$i" selected="selected">$i</option>
						#else
							<option value="$i">$i</option>
						#end
					#end
				</select>
			#end
		</div>
		<div class="checkbox" id="div_$name_CheckEmailReminder">
			<label for="$name_CheckEmailReminder">
				<input type="checkbox" name="$name_CheckEmailReminder" id="$name_CheckEmailReminder" value="true" 
				#if ($!value_CheckEmailReminder)
					checked="checked"
				#end
				/>
				$tlang.getFormattedMessage("gen.ass.remind", $value_reminder_hours)
			</label>
		</div>
		<div class="checkbox">
			<label for="$name_CheckHideDueDate">
				<input id="$name_CheckHideDueDate" name="$name_CheckHideDueDate" type="checkbox" value="true"
				#if ($!value_CheckHideDueDate)
                       checked="checked"
				#end
                />
				$tlang.getString("gen.hideduedate")
			</label>
		</div>

		#if ($!name_CheckAddDueDate)
			<div class="checkbox">
				<label for="$name_CheckAddDueDate">
				#if ($value_CheckAddDueDate.equals("true"))
					<input id="$name_CheckAddDueDate" name="$name_CheckAddDueDate" type="checkbox" value="true" checked="checked" />
				#else
					<input id="$name_CheckAddDueDate" name="$name_CheckAddDueDate" type="checkbox" value="true" />
				#end
					$tlang.getString("gen.addduedat")
				</label>
			</div>
		#end

		#if ($!name_CheckAutoAnnounce)
			<div class="checkbox" id="div_$name_CheckAutoAnnounce">
				<label for="$name_CheckAutoAnnounce">
				#if ($value_CheckAutoAnnounce.equals("true"))
					<input id="$name_CheckAutoAnnounce" name="$name_CheckAutoAnnounce" type="checkbox" value="true" checked="checked" onclick="ASN.toggleAutoAnnounceOptions(this.checked)" />
				#else
					<input id="$name_CheckAutoAnnounce" name="$name_CheckAutoAnnounce" type="checkbox" value="true" onclick="ASN.toggleAutoAnnounceOptions(this.checked)" />
				#end
					$tlang.getString("gen.anntheope")
				</label>
			</div>

			#if ($!$value_CheckAutoAnnounce.equals("true"))
			<div id="selectAutoAnnounceOptions" class="indnt3">
			#else
			<div id="selectAutoAnnounceOptions" style="display:none" class="indnt3">
			#end
				<div class="col-sm-offset-1">
					<select name="$name_OpenDateNotification" id="$name_OpenDateNotification">
						<option value="$value_opendate_notification_none" #if($value_OpenDateNotification.equals($value_opendate_notification_none)) selected="selected" #end>$tlang.getString('send.notification.opendate.email.none')</option>
						<option value="$value_opendate_notification_low" #if($value_OpenDateNotification.equals($value_opendate_notification_low)) selected="selected" #end>$tlang.getString('send.notification.opendate.email.low')</option>
						<option value="$value_opendate_notification_high" #if($value_OpenDateNotification.equals($value_opendate_notification_high)) selected="selected" #end>$tlang.getString('send.notification.opendate.email.high')</option>
					</select>
				</div>
			</div>
		#end

		<h4>
			$tlang.getString("gen.stusub")
		</h4>
		<div class="form-group row form-required">
			<label for="subType" class="col-sm-2 form-control-label">
				$tlang.getString("gen.submissionType")
			</label>
			<div class="col-sm-6">
				<select name="$name_SubmissionType" id="subType" onchange="switchAssignmentSubmissionType();" class="assignment-submission-type">
				#foreach ($i in [1..$!value_totalSubmissionTypes])
					#if ($i == $value_SubmissionType)
						<option value="$i" selected="selected">$submissionTypeTable.get($i)</option>
					#else
						<option value="$i">$submissionTypeTable.get($i)</option>
					#end
				#end
				</select>
			</div>
			<div id="review.switch.ne.2" class="sak-banner-info" style="display:none;">$reviewSwitchNe2</div>
		</div>

		<div id="External_Tool_Fieldset" #if ($value_SubmissionType != 6) style = "display:none"#end>
        <fieldset>
		<h4>
			$tlang.getString("external.tool.label")
		</h4>
		<p class="sak-banner-info">
			$tlang.getString("external.tool.detail")
        </p>
		<div class="form-group row">
			<label class="col-sm-12 control-label block" for="tempContentId">
				$tlang.getString("launchContentId")
			</label>
			<div class="col-sm-6" id="tempContentId">
					<input type="text" readonly id="returnToolTitle" name="$name_ContentTitle" size="30"
                        class="form-control" maxlength="100"
                        placeholder="$tlang.getString('external.tool.placeholder')" value="$!value_ContentTitle">
					<input type="hidden" id="returnContentId" name="$name_ContentId" value="$value_ContentId">
					<input type="hidden" id="returnContentLaunchNewWindow" name="returnContentLaunchNewWindow">
					<input type="hidden" id="returnContentToolNewpage" name="$name_ContentToolNewpage" value="$value_ContentToolNewpage">
                    <script>
                        window.returnContentItem = function (contentItem) {
                            console.debug("returnContentItem", contentItem);
                            if ( ! Array.isArray(contentItem) ) return;
                            if ( contentItem.length != 1 ) return;
                            var item = contentItem[0];
                            console.debug("item", item);
                            // Strangely, https://www.sakailms.org/spec/lti-ags/v2p0/releaseToStudent does not have an analog in Assignments
                            // Content Item Variant
                            if ( item && item.lineItem && item.lineItem.scoreConstraints ) {
                                var scoreConstraints = item.lineItem.scoreConstraints;
                                console.debug("item.lineItem.scoreConstraints", scoreConstraints);
                                if ( scoreConstraints.normalMaximum  ) {
                                    $("#new_assignment_grade_points").val(scoreConstraints.normalMaximum);
                                }
                                if ( scoreConstraints.totalMaximum  ) {
                                    $("#new_assignment_grade_points").val(scoreConstraints.totalMaximum);
                                }
                            }

                            // Deep Linking variant
                            if ( item && item.lineItem && item.lineItem.scoreMaximum ) {
                                $("#new_assignment_grade_points").val(item.lineItem.scoreMaximum);
                            }

                            // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/DateTimeFormat/DateTimeFormat
                            // https://stackoverflow.com/a/63160519/1994792
                            var options = {year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit'};
                            if ( item && item.submission ) {
                                var submission = item.submission;
                                if ( submission.startDateTime ) {
                                    var tdate = new Date(submission.startDateTime);
                                    tdate = tdate.toLocaleString([], options).replace(',','');
                                    $("#opendate").val(tdate);
                                }
                                if ( submission.endDateTime ) {
                                    var tdate = new Date(submission.endDateTime);
                                    tdate = tdate.toLocaleString([], options).replace(',','');
                                    $("#duedate").val(tdate);
                                }
                            }
                            if ( item && item.available ) {
                                var available = item.available;
                                if ( available.startDateTime ) {
                                    var tdate = new Date(available.startDateTime);
                                    tdate = tdate.toLocaleString([], options).replace(',','');
                                    $("#opendate").val(tdate);
                                }
                                if ( available.endDateTime ) {
                                    var tdate = new Date(available.endDateTime);
                                    tdate = tdate.toLocaleString([], options).replace(',','');
                                    $("#closedate").val(tdate);
                                }
                            }
                            // Handle new page
                            if ( item ) {
                                if( item.tool_newpage == 2 ) {
                                    $("#content-launch-new-window-checkbox").show();
                                    $( "#$name_ContentLaunchNewWindow" ).prop( "checked", ( item.content_newpage == 1 ) );
                                } else {
                                    $("#content-launch-new-window-checkbox").hide();
                                }
                            }
                        };
                        window.returnContentTitle = function (newTitle) {
                            setTimeout(function(){
                                if ( confirm('$tlang.getString("launchContentTitle")'+" "+newTitle) ) {
                                    $("#new_assignment_title").val(newTitle);
                                }
                            }, 500);
                        };
                    </script>
			</div>
        </div>
		<div class="form-group row">
			<div class="col-sm-6">
                    <a title="$tlang.getString('external.tool.find')" target="sakai-lti-admin-iframe" onclick="showExternalIframe(this.title, false);"
                        class="btn btn-primary" role="button"
                        href="$findExternalToolUrl">$tlang.getString('external.tool.find')</a>
            </div>
		</div>

		<div class="checkbox" id="content-launch-new-window-checkbox" #if ($!value_ContentToolNewpage != 2) style="display:none;" #end>
			<label for="$name_ContentLaunchNewWindow">
			#if ($!value_ContentLaunchNewWindow == true)
				<input id="$name_ContentLaunchNewWindow" name="$name_ContentLaunchNewWindow" type="checkbox" value="true" checked="checked" />
			#else
				<input id="$name_ContentLaunchNewWindow" name="$name_ContentLaunchNewWindow" type="checkbox" value="true" />
			#end
				$tlang.getString("launchContentNewWindow")
			</label>
		</div>
		</fieldset>
        </div>
        <div id="external-modal-iframe-div" style="display:none" tabindex="-1" role="dialog">
            <iframe name="sakai-lti-admin-iframe" id="sakai-lti-admin-iframe" src="/library/image/sakai/spinner.gif" tabindex="0"></iframe>
        </div>
<style>
.ui-widget-overlay.ui-front {
    opacity:.75;
}
</style>
<script>
//<![CDATA[
function showExternalIframe(title, doreload) {
    $("#external-modal-iframe-div").dialog({
        title: title,
        width: modalDialogWidth(),
        height: modalDialogHeight(),
        modal: true,
        draggable: false,
        open: function() {
            $("#external-modal-iframe-div").dialog("option", "width", modalDialogWidth());
            $("#external-modal-iframe-div").dialog("option", "height", modalDialogHeight());
            $('#sakai-lti-admin-iframe').attr('width', '100%');
            $('#sakai-lti-admin-iframe').attr('height', '100%');
            // https://stackoverflow.com/questions/1202079/prevent-jquery-ui-dialog-from-setting-focus-to-first-textbox
            $(this).parent().focus();
        },
        close: function() {
            if ( doreload ) {
                location.reload();
            } else {
                $('#sakai-lti-admin-iframe').attr('src','/library/image/sakai/spinner.gif');
            }
        }
    });

    $(window).resize(function() {
        $("#external-modal-iframe-div").dialog("option", "width", modalDialogWidth());
        $("#external-modal-iframe-div").dialog("option", "height", modalDialogHeight());
        $('#sakai-lti-admin-iframe').attr('width', '100%');
        $('#sakai-lti-admin-iframe').attr('height', '100%');
    });
}
//]]>
</script>

		#if ($!isTimesheet)
			<div id="timesheetsetupsection">
				<h4>
					$tlang.getString("gen.estimate")
				</h4>

				<div class="checkbox">
					<label for="$name_NEW_ASSIGNMENT_CHECK_ADD_ESTIMATE">
						<input id="$name_NEW_ASSIGNMENT_CHECK_ADD_ESTIMATE" name="$name_NEW_ASSIGNMENT_CHECK_ADD_ESTIMATE" type="checkbox" value="true" #if ($value_NEW_ASSIGNMENT_CHECK_ADD_ESTIMATE) checked #end onclick="ASN.toggleAutoAnnounceEstimate(this.checked)" />
						$tlang.getString("gen.isestimate")
					</label>
				</div>

				<div id="checkestimaterequired" class="checkbox hidden">
					<label for="$name_NEW_ASSIGNMENT_CHECK_ADD_ESTIMATE_REQUIRED">
						<input id="$name_NEW_ASSIGNMENT_CHECK_ADD_ESTIMATE_REQUIRED" name="$name_NEW_ASSIGNMENT_CHECK_ADD_ESTIMATE_REQUIRED" type="checkbox" value="true" #if ($value_NEW_ASSIGNMENT_CHECK_ADD_ESTIMATE_REQUIRED) checked #end />
						$tlang.getString("gen.reqestimate")
					</label>
				</div>

				<div id="inputtimestimate" class="form-group row form-required hidden">
						<label for="$name_NEW_ASSIGNMENT_INPUT_ADD_TIME_ESTIMATE" class="col-sm-2 form-required">
							$tlang.getString("gen.timestimate")
						</label>
						<div class="col-sm-2">
							<input name="$name_NEW_ASSIGNMENT_INPUT_ADD_TIME_ESTIMATE" id="$name_NEW_ASSIGNMENT_INPUT_ADD_TIME_ESTIMATE" type="text" value="$formattedText.escapeHtml($!value_NEW_ASSIGNMENT_INPUT_ADD_TIME_ESTIMATE)" size="20" maxlength="20" class="form-control" placeholder="$!tlang.getString('ts.modal.field.tspent.format')" />
						</div>
				</div>
			</div>
			#if ($value_AssignTo == $value_AssignTo_Groups && $!groupsList && !$selectedGroupsNotFound)
			<script>
				ASN.disableTimesheetSetupSection();
			</script>
			#end
		#end

        <fieldset id="assignToSection">
		<h4>$!tlang.getString('accessSectionHeader')</h4>
		#parse("vm/assignment/instructor_new_edit/assignto_section.vm")
		</fieldset>

		##show it only for those assignments not of type non-electronic submission
		#if($!value_allowResubmitNumber && $value_SubmissionType != 4)
			#set($resubmitStyle="display:block")
		#else
			#set($resubmitStyle="display:none")
		#end

		<div id="allowResubmissionContainer" class="form-group" #if ($value_SubmissionType == 4) style = "display:none"#end>
			<label class="form-control-label h4" for="allowResToggle">
				$tlang.getString("allowResubmit")
			</label>
			<div class="d-inline-block ml-25">
				<div id="tempAllowRes">
					<input type="checkbox" id="allowResToggle" name ="allowResToggle" #if($!value_allowResubmitNumber) checked="checked"#end onclick="ASN.changeResubmissionDate()" />
				</div>
			</div>
		    <p class="sak-banner-info" id="ltiSubmissionResubmitNote" #if ($value_SubmissionType != 6) style = "display:none"#end>
			    $tlang.getString("external.tool.resubmission")
            </p>
		</div>

		<div class="form-group row ms-3" id="allowResubmitNumber" style="$!resubmitStyle">
			<label for="allowResubmitNumberSelect" class="col-sm-offset-1 col-sm-3 control-label">
				$tlang.getString("allow.resubmit.number")
			</label>
			<div class="col-sm-9">
				<select name="$name_allowResubmitNumber" id="allowResubmitNumberSelect" title="$tlang.getString("allow.resubmit.number")">
					#foreach ($i in [1..10])
						<option value="$i" #if($i==$!value_allowResubmitNumber)selected="selected"#end>
							$i
						</option>
					#end
					<option value="-1" #if($!value_allowResubmitNumber == -1)selected="selected"#end>$tlang.getString("allow.resubmit.number.unlimited")</option>
				</select>
			</div>
		</div>

		## only show date selection when allowed to resubmit
		<div class="form-group row ms-3" id="allowResubmitTime" style="$!resubmitStyle">
			<label for="$name_ResubmitMonth" class="col-sm-offset-1 col-sm-2 control-label">
				$tlang.getString("gen.resubmission") $tlang.getString("gen.acesubunt")
			</label>
			<div class="col-sm-6 form-inline">
				<sakai-date-picker
					id="resubmissiondate"
					label="$tlang.getString("gen.resubmission") $tlang.getString("gen.acesubunt")"
					hidden-prefix="allow_resubmit_close_"
					iso-date="$value_ResubmitYear$H$value_ResubmitMonth$H$value_ResubmitDay$T$value_ResubmitHour:$value_ResubmitMin"
					add-hidden-fields>
				</sakai-date-picker>
			</div>
		</div>

		<div class="col-sm-offset-1 row ms-3" id="resubmitNotification" style="$!resubmitStyle">
			<strong>
				$tlang.getString("send.submission.releasereturn.email.options")
			</strong>
			## whether to notify student about released grade and resubmission is available
			<div class="radio">
				<label>
					<input type="radio" name="$!name_assignment_releasereturn_notification" id="notsendreleasereturnnotif" value="$!value_assignment_releasereturn_notification_none" #if($!value_assignment_releasereturn_notification.equals($!value_assignment_releasereturn_notification_none))checked="checked" #end />
					$tlang.getString('send.submission.releasereturn.email.none')
				</label>
			</div>
			<div class="radio">
				<label>
					<input type="radio" name="$!name_assignment_releasereturn_notification" id="sendreleasereturnnotif" value="$!value_assignment_releasereturn_notification_each" #if($!value_assignment_releasereturn_notification.equals($!value_assignment_releasereturn_notification_each))checked="checked" #end />
					$tlang.getString('send.submission.releasereturn.email')
				</label>
			</div>
		</div>

		## whether to show the instructor notification choices
		#if ($!name_assignment_instructor_notifications)
		<fieldset id="notificationOptions" #if ($value_SubmissionType == 6) style = "display:none"#end>
			<h4>
				$tlang.getString("receive.confirm.submission.email.options")
			</h4>
			<div class="radio">
    				<label for="notsendnotif">
				<input type="radio" name="$!name_assignment_instructor_notifications" id="notsendnotif" value="$!value_assignment_instructor_notifications_none" #if($!value_assignment_instructor_notifications.equals($!value_assignment_instructor_notifications_none))checked="checked" #end />
					$tlang.getString('receive.confirm.submission.email.none')
				</label>
    			</div>
			<div class="radio">
    				<label for="sendnotif">
    				<input type="radio" name="$!name_assignment_instructor_notifications" id="sendnotif" value="$!value_assignment_instructor_notifications_each" #if($!value_assignment_instructor_notifications.equals($!value_assignment_instructor_notifications_each))checked="checked" #end />
					$tlang.getString('receive.confirm.submission.email.each')
				</label>
    			</div>
			<div class="radio">
    				<label for="sendnotifsummary">
    				<input type="radio" name="$!name_assignment_instructor_notifications" id="sendnotifsummary" value="$!value_assignment_instructor_notifications_digest" #if($!value_assignment_instructor_notifications.equals($!value_assignment_instructor_notifications_digest))checked="checked" #end />
					$tlang.getString('receive.confirm.submission.email.digest')
				</label>
    			</div>
		</fieldset>
		#end

		#if ($allowReviewService)
		<fieldset id="contentReviewServiceOptions" #if (($reviewServiceProviderId == $turnitinProviderId || $reviewServiceProviderId == $turnitinOCProviderId) && $value_SubmissionType == 6) style = "display:none"#end>
			<h4> $reviewServiceTitle </h4>
			<div>
				#if (4 == $value_SubmissionType)
					<div id="review.switch.ne.1" class="sak-banner-info">$reviewSwitchNe1</div>
					<div class="checkbox  indnt2">
						<label id="lblReviewService" for="$name_UseReviewService" class="instruction">
						<input id="$name_UseReviewService" name="$name_UseReviewService" type="checkbox" value="true" onclick="ASN.toggleReviewServiceOptions(this.checked)" disabled="disabled"/>

							$reviewServiceUse
						</label>
					</div>
				#else
					<div id="review.switch.ne.1" class="sak-banner-info" style="display:none;">$reviewSwitchNe1</div>
					<div class="checkbox">
						<label id="lblReviewService" for="$name_UseReviewService">
						#if($!value_UseReviewService == true)
							<input id="$name_UseReviewService" name="$name_UseReviewService" type="checkbox" value="true" checked="checked" onclick="ASN.toggleReviewServiceOptions(this.checked)"/>
						#else
							<input id="$name_UseReviewService" name="$name_UseReviewService" type="checkbox" value="true" onclick="ASN.toggleReviewServiceOptions(this.checked)"/>
						#end

							$reviewServiceUse
						</label>
					</div>
				#end

				#if ($!value_UseReviewService == true && $!value_SubmissionType != 4)
					<div id="reviewServiceOptions" class="indnt3">
				#else
					<div id="reviewServiceOptions" style="display:none" class="indnt3">
				#end
					<div class="checkbox">
						<label for="$name_AllowStudentView">
						#if ($!value_AllowStudentView.equals("true"))
							<input id="$name_AllowStudentView" name="$name_AllowStudentView" type="checkbox" value="true" checked="checked" />
						#else
							<input id="$name_AllowStudentView" name="$name_AllowStudentView" type="checkbox" value="true" />
						#end
							$tlang.getString("review.allow")
						</label>
					</div>

					<!-- Start TII custom options -->
					#if($reviewServiceProviderId == $turnitinProviderId)

					#if ($content_review_note)
						$content_review_note
					#end

					<h4>
						$tlang.getString("review.submit.papers.repository")
					</h4>

					<div class="radio">
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_NONE))
							<label><input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_NONE" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_NONE"))checked#end/>$tlang.getString("review.submit.papers.repository.none")</label>
						#end
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_STANDARD))
							<label><input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_STANDARD" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_STANDARD"))checked#end/>$tlang.getString("review.submit.papers.repository.standard")</label>
						#end
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_INSITUTION))
							<label><input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_INSITUTION" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_SUBMIT_INSITUTION"))checked#end/>$tlang.getString("review.submit.papers.repository.institution")</label>
						#end
					</div>

					<h4>
						$tlang.getString("review.originality.reports")
					</h4>

					<div class="radio">
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY))
							<label><input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY"))checked#end/>$tlang.getString("review.originality.reports.immediately")</label>
						#end
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE))
							<label><input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE"))checked#end/>$tlang.getString("review.originality.reports.due")</label>
						#end
					</div>

					<br/>
					#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC || $show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED || $show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_SMALL_MATCHES)
						<h4>
							$tlang.getString("review.exclude.matches.header")
						</h4>
					#end

					<!-- Exclude Bibliographic materials -->
					#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC)
					<div class="checkbox">
						<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC">
							#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC.equals("true"))
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC" type="checkbox" value="true" checked="checked" />
							#else
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC" type="checkbox" value="true" />
							#end
								$tlang.getString("review.exclude.bibliographic")
						</label>
					</div>
					#end
					<!-- Exclude Quoted materials -->
					#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED)
					<div class="checkbox">
						<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED">
							#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED.equals("true"))
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED" type="checkbox" value="true" checked="checked" />
							#else
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED" type="checkbox" value="true" />
							#end
								$tlang.getString("review.exclude.quoted")
						</label>
					</div>
					#end
					<!-- Exclude small matches -->

					#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_SMALL_MATCHES)
						<div class="checkbox">
							<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE">
							#if ($value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE == 1 || $value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE == 2)
								<input type="checkbox" value="true" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_SMALL_MATCHES" checked="checked" onclick="ASN.toggleSmallMatchesOptions(this.checked)"/>
							#else
								<input type="checkbox" value="true" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_SMALL_MATCHES" onclick="ASN.toggleSmallMatchesOptions(this.checked)"/>
							#end
								$tlang.getString("review.exclude.smallMatches")
							</label>
							<br/>
								#if ($value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE == 1 || $value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE == 2)
									<div id="smallMatchesOptions" class="indnt2 smallMatches" style="display:inline-block;">
								#else
									<div id="smallMatchesOptions" class="indnt2 smallMatches" style="display:none;">
								#end
								$tlang.getString("review.exclude.matches.by")<span class="reqStar">*</span>
								<br/>
								<input onchange="ASN.toggleSmallMatchesDisabled()" type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE" id="wordCount" value="1" #if ($value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE ==  1) checked="checked" #end/>
								<label for="wordCount">
									$tlang.getString("review.exclude.matches.wordmax")
								</label>
								<input type="text" size="3" maxlength="3" id="tiiExcludeValueWords" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_VALUE" #if ($value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE ==  1) value="$value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_VALUE" #else disabled="disabled" #end/>
								<br/>

								<input onchange="ASN.toggleSmallMatchesDisabled()" type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE" id="percentage" value="2" #if ($value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE == 2) checked="checked" #end/>
								<label for="percentage">
									$tlang.getString("review.exclude.matches.percentage")
								</label>
								<input type="text" size="3" maxlength="3" id="tiiExcludeValuePercentages" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_VALUE" #if ($value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_TYPE == 2) value="$value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_VALUE" #else disabled="disabled" #end/>
								%
								<!--end div for smallMatchesOptions -->
								</div>
						</div>
					#end

					<h4>
						$tlang.getString("review.originality.check")
					</h4>
					<div class="indnt1">
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_TURNITIN)
						<div class="checkbox">
							<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_TURNITIN">
							#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_TURNITIN.equals("true"))
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_TURNITIN" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_TURNITIN" type="checkbox" value="true" checked="checked" />
							#else
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_TURNITIN" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_TURNITIN" type="checkbox" value="true" />
							#end
								$tlang.getString("review.originality.check.turnitin")
							</label>
						</div>
						#end
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INTERNET)
						<div class="checkbox">
							<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INTERNET">
							#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INTERNET.equals("true"))
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INTERNET" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INTERNET" type="checkbox" value="true" checked="checked" />
							#else
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INTERNET" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INTERNET" type="checkbox" value="true" />
							#end
								$tlang.getString("review.originality.check.internet")
							</label>
						</div>
						#end
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_PUB)
						<div class="checkbox">
							<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_PUB">
							#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_PUB.equals("true"))
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_PUB" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_PUB" type="checkbox" value="true" checked="checked" />
							#else
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_PUB" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_PUB" type="checkbox" value="true" />
							#end
								$tlang.getString("review.originality.check.pub")
							</label>
						</div>
						#end
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INSTITUTION)
						<div class="checkbox">
							<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INSTITUTION">
							#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INSTITUTION.equals("true"))
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INSTITUTION" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INSTITUTION" type="checkbox" value="true" checked="checked" />
							#else
								<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INSTITUTION" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_CHECK_INSTITUTION" type="checkbox" value="true" />
							#end
								$tlang.getString("review.originality.check.institution")
							</label>
						</div>
						#end
					</div>
				<!-- End TII custom options -->
					#elseif($reviewServiceProviderId == $turnitinOCProviderId)
						<!-- Start TurnitinOC custom options -->
						
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC || $show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED)
							<br/>
							<div>
								<label>$tlang.getString("turnitinoc.exclude.header"):</label>
							</div>
							<div style="display:inline-block">
								<!-- Exclude Bibliographic materials -->
								#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC)
									<div class="checkbox">
										<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC">
											#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC.equals("true"))
												<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC" type="checkbox" value="true" checked="checked" />
											#else
												<input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_BIBLIOGRAPHIC" type="checkbox" value="true" />
											#end
											$tlang.getString("turnitinoc.exclude.bibliography")
										</label>
									</div>
								#end
								<!-- Exclude Quoted materials -->
								#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED)
		                            <div class="checkbox">
		                                <label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED">
											#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED.equals("true"))
		                                        <input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED"
		                                               name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED"
		                                               type="checkbox" value="true" checked="checked"/>
											#else
		                                        <input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED"
		                                               name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_EXCLUDE_QUOTED"
		                                               type="checkbox" value="true"/>
											#end
											$tlang.getString("turnitinoc.exclude.quoted")
		                                </label>
		                            </div>
								#end
							</div>
						#end
						
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_STORE_INST_INDEX)
							<br/><br/>
							<div>
								<label>$tlang.getString("turnitinoc.index.header"):</label>
								<p class="text-muted small">
									$tlang.getString("turnitinoc.index.info")
								</p>
							</div>
							<div style="display:inline-block">
		                        <!-- Store Inst Index -->
								#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_STORE_INST_INDEX)
		                            <div class="checkbox">
		                                <label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_STORE_INST_INDEX">
											#if ($!value_NEW_ASSIGNMENT_REVIEW_SERVICE_STORE_INST_INDEX.equals("true"))
		                                        <input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_STORE_INST_INDEX"
		                                               name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_STORE_INST_INDEX"
		                                               type="checkbox" value="true" checked="checked"/>
											#else
		                                        <input id="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_STORE_INST_INDEX"
		                                               name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_STORE_INST_INDEX"
		                                               type="checkbox" value="true"/>
											#end
											$tlang.getString("turnitinoc.index.all")
		                                </label>
		                             </div>
								#end
							</div>
						#end
						
						
						#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT)
						 	<br/><br/>
							<div>
								<label>$tlang.getString("turnitinoc.generate.header"):</label>
							</div>
							<div style="display:inline-block">
								#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY))
									<div class="radio">
										<label><input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY"))checked#end/>$tlang.getString("review.originality.reports.immediately")</label>
									</div>
								#end
								#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE))
									<div class="radio">
										<label><input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE"))checked#end/>$tlang.getString("review.originality.reports.due")</label>
									</div>
								#end
								#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY_AND_DUE))
									<div class="radio">
										<label><input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY_AND_DUE" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY_AND_DUE"))checked#end/>$tlang.getString("review.originality.reports.immediately_and_due")</label>
									</div>
								#end
							</div>
						#end
						<br/><br/>
						<p class="text-muted small">
							<a href="$tlang.getString("turnitinoc.instructions.url")" rel="noreferrer" target="_blank">$tlang.getString("turnitinoc.instructions")</a>
						</p>
                        <!-- End TurnitinOC custom options -->
				#elseif($reviewServiceName.equals("Compilatio"))
						#if ($content_review_note)
							$content_review_note
						#end
						<h4>
							$tlang.getString("review.originality.reports")
						</h4>
						<div class="radio">
							#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY))
								<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO">
									<input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_IMMEDIATELY"))checked#end/>$tlang.getString("review.originality.reports.immediately")<br/>
								</label>
								<br/>
							#end
							#if($show_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT.contains($name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE))
								<label for="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO">
									<input type="radio" name="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO" value="$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE" #if($value_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_RADIO.equals("$name_NEW_ASSIGNMENT_REVIEW_SERVICE_REPORT_DUE"))checked#end/>$tlang.getString("review.originality.reports.due")<br/>
								</label>
							#end
						</div>
				<!-- End Compilatio custom options -->
				#elseif($reviewServiceName.equals("Urkund"))
						#if ($content_review_note)
							$content_review_note
						#end
				<!-- End Urkund custom options -->
				#end
			</div>
			</div>
		</fieldset>
		#end
		#if($enableAnonGrading || $value_CheckAnonymousGrading)
			<h4>$!tlang.getString('grading')</h4>
		#end

		#parse("vm/assignment/instructor_new_edit/grading_section.vm")

		## whether to notify student about released grade
		<fieldset id="releaseGradeNotifications" #if ($value_SubmissionType == 6) style = "display:none"#end>
			<h4>
				$tlang.getString("send.submission.releasegrade.email.options")
			</h4>
			<div class="radio">
				<label for="notsendreleasegradenotif">
				<input type="radio" name="$!name_assignment_releasegrade_notification" id="notsendreleasegradenotif" value="$!value_assignment_releasegrade_notification_none" #if($!value_assignment_releasegrade_notification.equals($!value_assignment_releasegrade_notification_none))checked="checked" #end />
					$tlang.getString('send.submission.releasegrade.email.none')
				</label>
			</div>
			<div class="radio">
				<label for="sendreleasegradenotif">
				<input type="radio" name="$!name_assignment_releasegrade_notification" id="sendreleasegradenotif" value="$!value_assignment_releasegrade_notification_each" #if($!value_assignment_releasegrade_notification.equals($!value_assignment_releasegrade_notification_each))checked="checked" #end />
					$tlang.getString('send.submission.releasegrade.email')
				</label>
			</div>
		</fieldset>

	<a name="extraNodesTop"></a>

	<div id="tagSection">
	#if ($!tagsEnabled && $!allowAddTags)
		<h4>$!tlang.getString('tags_header')</h4>
		#set($assignmentParts = $assignmentId.split("/"))
		#set($lastIndex = $assignmentParts.size() - 1)
		#set($assignId = $assignmentParts.get($lastIndex))
		<sakai-tag-selector id="tag-selector" selected-temp="$!tag_selector" collection-id="$siteId" item-id="$!assignId" add-new="true" tag-tool="$!tagTool" site-id="$siteId"></sakai-tag-selector>
		<input type="hidden" name="tag_selector" id="tag_selector" />
		<div class="checkbox">
			<label for="$name_CheckAddInstructorTags">
				<input id="$name_CheckAddInstructorTags" name="$name_CheckAddInstructorTags" type="checkbox" value="true"
					#if ($!value_CheckAddInstructorTags)
						checked="checked"
					#end
				/>
				$tlang.getString('tags_instructor') $tlang.getString('tags_note')
			</label>
		</div>
		<div class="checkbox">
			<label for="$name_CheckAddGroupTags">
				<input id="$name_CheckAddGroupTags" name="$name_CheckAddGroupTags" type="checkbox" value="true"
					#if ($!value_CheckAddGroupTags)
						checked="checked"
					#end
				/>
				$tlang.getString('tags_groups') $tlang.getString('tags_note')
			</label>
		</div>
	#end
	</div>

    <div id="additionalInformation" #if ($value_SubmissionType == 6) style = "display:none"#end>
	<h4>
		$tlang.getString("additional_information")
	</h4>

	<div class="col-sm-6 row">
		<table class="table table-striped" id="extraNodeLinkList">
			<h6>$tlang.getString("supplement")</h6>
			<tr>
				<td class="col-sm-2">
					$tlang.getString("modelAnswer")
				</td>
				<td class="col-sm-4 itemAction" style="white-space:nowrap">
					<div class="col-sm-2" id="nomodelanswer"  #if(!$!modelanswer) style="display:block"#else style="display:none" #end>
						<a id="modelanswer_add" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("new")<span class="skip"> $tlang.getString("modelAnswer")</span></a>
					</div>
					<div class="col-sm-2" id="hasmodelanswer"  #if($!modelanswer) style="display:block"#else style="display:none" #end>
						<a id="modelanswer_edit" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("gen.revi")<span class="skip"> $tlang.getString("modelAnswer")</span></a> | <a id="modelanswer_delete" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("delet")<span class="skip"> $tlang.getString("modelAnswer")</span></a>
						<input id = "modelanswer_to_delete" name = "modelanswer_to_delete" type= "hidden" value = "false" />
					</div>
				</td>
			</tr>
			## show the private note section if only the user can view or edit the item
			#if ($!allowEditAssignmentNoteItem || $!allowReadAssignmentNoteItem)
				<tr>
					<td class="col-sm-2">
						$tlang.getString("note")
					</td>
					<td class="col-sm-4 itemAction" style="white-space:nowrap">
						<div class="col-sm-2" id="nonote"  #if(!$!note) style="display:block"#else style="display:none" #end>
							<a id="note_add" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("new")<span class="skip"> $tlang.getString("note")</span></a>
						</div>
						<div class="col-sm-2" id="hasnote"  #if($!note) style="display:block"#else style="display:none" #end>
							#if ($!allowEditAssignmentNoteItem)
								<a id="note_edit" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("gen.revi")<span class="skip"> $tlang.getString("note")</span></a> | <a id="note_delete" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("delet")<span class="skip"> $tlang.getString("note")</span></a>
							#else
								#if ($!allowReadAssignmentNoteItem)
									<a id="note_edit" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("gen.view2")</a>
								#end
							#end
						</div>
						<input id = "note_to_delete" name = "note_to_delete" type= "hidden" value = "false" />
					</td>
				</tr>
			#end
			<tr>
				<td class="col-sm-2">
					$tlang.getString("allPurpose")
				</td>
				<td class="col-sm-4 itemAction" style="white-space:nowrap">
					<div class="col-sm-2" id="noallPurpose" #if(!$!allPurpose) style="display:block"#else style="display:none" #end>
						<a id="allPurpose_add" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("new")<span class="skip"> $tlang.getString("allPurpose")</span></a>
					</div>
					<div class="col-sm-2" id="hasallPurpose" #if($!allPurpose) style="display:block"#else style="display:none" #end>
						<a id="allPurpose_edit" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("gen.revi")<span class="skip"> $tlang.getString("allPurpose")</span></a> | <a id="allPurpose_delete" class="extraNodeLink" href="javascript:void(0)">$tlang.getString("delet")<span class="skip"> $tlang.getString("allPurpose")</span></a>
					</div>
					<input type="hidden" name="value_allPurpose" #if($!allPurpose) value="true" #else value="false" #end />
					<input id = "allPurpose_to_delete" name = "allPurpose_to_delete" type= "hidden" value = "false" />
				</td>
			</tr>
		</table>
	</div>

		<a name="extraNodesBoxTop"></a>
		<input type="hidden" name = "attachments_for" id="attachments_for" value="$!attachments_for" />
		<fieldset class="extraNode" id="modelanswer-node" style="display:none">## the panel for model answer
			<legend>$tlang.getString("modelAnswer")</legend>
			<div class="form-group row">
				<label for="modelanswer_text" class="col-lg-2 form-control-label">
					$tlang.getString("modelAnswer.instruction")
				</label>
				<div class="col-lg-8">
					<div class="validationError alertMessage" id="modelanswer_text_message">
						$tlang.getString("extraNodesRequired")
					</div>
					<textarea name="modelanswer_text" id="modelanswer_text" cols="60" rows="10" wrap="virtual">$validator.escapeHtmlTextarea($!modelanswer_text)</textarea>
					<textarea name="modelanswer_text_holder" id="modelanswer_text_holder" style="display:none" cols="60" rows="2" wrap="virtual">$validator.escapeHtmlTextarea($!modelanswer_text)</textarea>
				</div>
				###chef_setupformattedtextareaparams("modeltext" "200" "365" "small")
			</div>
			## attachments
			<label for="modelAnswerAttach" class="block">
					$tlang.getString("gen.att")
			</label>
			#set ($size = 0)
			#set ($props = false)
			#foreach ($attachment in $modelanswer_attachments)
				#set ($props = $attachment.Properties)
				#if ($!props)
					#set ($size = $size + 1)
				#end
			#end
			#if ($size == 0)
				<p>
                                    #if ($value_SubmissionType == 5)
                                        $tlang.getString("gen.noatt.single")
                                    #else
                                        $tlang.getString("gen.noatt")
                                    #end
                                </p>
			#else
				<ul class="attachList indnt1">
					#foreach ($attachment in $modelanswer_attachments)
						#set ($props = false)
						#set ($props = $attachment.Properties)
						#if ($!props)
							<li>
								#if ($props.getBooleanProperty($props.NamePropIsCollection))
									<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
								#else
									<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
								#end
								<a href="$attachment.Url" target="_blank">$formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>
								#propertyDetails($props)
							</li>
						#end
					#end
				</ul>
			#end
			<div class="act">
				<input type="button" name="modelAnswerAttach" value="$tlang.getString('gen.addatt')" onclick="document.getElementById('option').value='modelAnswerAttach';document.newAssignmentForm.submit();return false;"/>
			</div>

			<div class="form-group row form-required">

				<label for="modelanswer_to" class="col-lg-2 form-control-label">
					$tlang.getString("modelAnswer.show_to_student.prompt")
				</label>
				## show to student time option
				<div class="col-lg-8">
					<select id="modelanswer_to" name="modelanswer_showto" title="$tlang.getString("modelAnswer.show_to_student.tooltip")">
						#foreach ($k in ["0", "1", "2", "3", "4"])
							#set($string = "modelAnswer.show_to_student.")
							#set($string = $string.concat($k))
							<option value="$k" #if($k.equals($!modelanswer_showto))selected="selected" #set( $modelanswer_to_val = $k) #end> $tlang.getString($string) </option>
						#end
					</select>
					<span class="validationError alertMessageInline" id="modelanswer_to_message">
						$tlang.getString("extraNodesRequired")
					</span>

					<input type="text" id="modelanswer_to_holder"  style="display:none"  value="$modelanswer_to_val" />
				</div>
			</div>
			<p class="act">
				<input class="extraNodeInput" type="button" id="modelanswer_save" value="$tlang.getString('gen.sav')" class="active" />
				<input class="extraNodeInput" type="button" id="modelanswer_cancel" value="$tlang.getString('gen.can')" />
			</p>
		</fieldset>
		#*the panel for grading guideline
			<fieldset class="extraNode" id="gradingguidelines-node" style="display:none">
				<legend>Grading guidelines</legend>
					<div class="validationError alertMessage" id="gradingguidelines-message">
					</div>
				<div class="longtext" style="margin:.2em">
					<span class="reqStar">*</span>
					<label for="ggtext" class="block">
						Provide grading rationale. You can choose to whom and when this will display.
					</label>
						<textarea name="ggtext" id="ggtext" cols="60" rows="10" wrap="virtual"></textarea>
						###chef_setupformattedtextareaparams("ggtext" "200" "365" "small")
				</div>
				<div class="act">
						<input type="button" name="attach" value="$tlang.getString('gen.addatt')" onclick="document.getElementById('option').value='attach';document.newAssignmentForm.submit();return false;"/>
					</div>
				<p class="longtext"  style="margin:.2em">
					<span class="reqStar">*</span>
					<label for="ggwho" class="block">
						Show
					</label>
					<select id="ggwho">
						<option value="ggwhodefault"> --select one-- </option>
						<option value="ggwho1">Only to instructors</option>
						<option value="ggwho2">also to students (after grading)</option>
						<option value="ggwho3">also to students (after accept until date)</option>
					</select>
				</p>
				<p class="act">
					<input class="extraNodeInput"  type="button" value="Save" class="active"/><input class="extraNodeInput"  type="button" value="Cancel" />
				</p>
			</fieldset>
		*#
		<fieldset class="extraNode" id="note-node" style="display:none">## the panel for private note
			<legend>$tlang.getString("note")</legend>
			<div class="row form-group form-required " >
				<label for="note_text" class="col-lg-2 form-control-label">
					$tlang.getString("note.instruction")
				</label>
				<div class="col-lg-8">
					<div class="validationError alertMessage" id="note_text_message">
						$tlang.getString("extraNodesRequired")
					</div>
					#if ($!note && $!allowEditAssignmentNoteItem || !$!note)
						<textarea name="note_text" id="note_text" cols="60" rows="10" wrap="virtual">$validator.escapeHtmlTextarea($!note_text)</textarea>
						<textarea name="note_text_holder" id="note_text_holder"  style="display:none"  cols="60" rows="2" wrap="virtual">$validator.escapeHtmlTextarea($!note_text)</textarea>
					#else
						#if ($!allowReadAssignmentNoteItem)
					 		<div class="notes">$formattedText.escapeHtml($!note_text)</div>
				 		#end
					#end
					###chef_setupformattedtextareaparams("assigntext" "200" "365" "small")
				</div>
			</div>
			<div class="row form-group form-required">
				<label for="note_to" class="col-lg-2 form-control-label">
					$tlang.getString("note.to.prompt")
				</label>
				<div class="col-lg-8">
					#if ($!note && $!allowEditAssignmentNoteItem || !$!note)
						<select id="note_to" name="note_to" title="$tlang.getString("note.to.tooltip")">
							#foreach ($k in ["0", "1", "2", "3"])
								#set($string = "note.to.")
								#set($string = $string.concat($k))
								<option value="$k" #if($k.equals($!note_to)) selected="selected" #set ($note_to_val=$k) #end> $tlang.getString($string) </option>
							#end
						</select>
					#else
						#if ($!allowReadAssignmentNoteItem)
							#foreach ($k in ["0", "1", "2", "3"])
								#set($string = "note.to.")
								#set($string = $string.concat($k))
								#if($k.equals($!note_to))
									$tlang.getString($string)
								#end
							#end
						#end
					#end
					<span class="validationError alertMessageInline" id="note_to_message">
						$tlang.getString("extraNodesRequired")
					</span>
					<input type="text" id="note_to_holder"  style="display:none"  value="$note_to_val" />
				</div>
			</div>
			#if ($!note && $!allowEditAssignmentNoteItem || !$!note)
				<p class="act">
					## can only edit if there is no note item, or if there is a note item and the current user can edit it.
					<input class="extraNodeInput" type="button" id="note_save" value="$tlang.getString('gen.sav')" class="active" />
					<input class="extraNodeInput" type="button" id="note_cancel" value="$tlang.getString('gen.can')" />
				</p>
			#end
		</fieldset>
		<fieldset class="extraNode" id="allPurpose-node" style="display:none">## the panel for allPurpose type of object
			<legend>$tlang.getString('allPurpose')</legend>
			<div class="form-group row">
				<label  for="allPurpose_title" class="form-control-label col-lg-2">
					$formattedText.escapeHtml($tlang.getString("gen.title"))
				</label>
				<div class="col-lg-8">
					<input id="allPurpose_title" name="allPurposeTitle" type="text" size="20" maxlength="30" value="$!value_allPurposeTitle" class="form-control"/>
					<input id="allPurpose_title_holder"  style="display:none"  name="allPurposeTitle" type="text" size="2" maxlength="30" value="$!value_allPurposeTitle" />
					<span class="validationError alertMessageInline" id="allPurpose_title_message">
						$tlang.getString("extraNodesRequired")
					</span>
				</div>
			</div>

			<div class="form-group row">
				<label for="allPurpose_text" class="form-control-label col-lg-2">
					$tlang.getString("allPurpose.instruction")
				</label>
				<div class="col-lg-8">
					<div class="validationError alertMessage" id="allPurpose_text_message">
						$tlang.getString("extraNodesRequired")
					</div>
					<textarea name="allPurposeText" id="allPurpose_text" cols="60" rows="10" wrap="virtual">$validator.escapeHtmlTextarea($!value_allPurposeText)</textarea>
					<textarea name="allPurposeTextHolder"  id="allPurpose_text_holder"  style="display:none"  cols="60" rows="2" wrap="virtual">$validator.escapeHtmlTextarea($!value_allPurposeText)</textarea>
				</div>
			</div>
			## attachments for allpurpose item
			<label for="allPurposeAttach" class="form-control-label block">
					$tlang.getString("gen.att")
			</label>
			#set ($size = 0)
			#set ($props = false)
			#foreach ($attachment in $allPurpose_attachments)
				#set ($props = $attachment.Properties)
				#if ($!props)
					#set ($size = $size + 1)
				#end
			#end
			#if ($size == 0)
				<p>
                                    #if ($value_SubmissionType == 5)
                                        $tlang.getString("gen.noatt.single")
                                    #else
                                        $tlang.getString("gen.noatt")
                                    #end
                                </p>
			#else
				<ul class="attachList indnt1">
					#foreach ($attachment in $allPurpose_attachments)
						#set ($props = false)
						#set ($props = $attachment.Properties)
						#if ($!props)
							<li>
								#if ($props.getBooleanProperty($props.NamePropIsCollection))
									<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
								#else
									<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
								#end
								<a href="$attachment.Url" target="_blank">$formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>
								#propertyDetails($props)
							</li>
						#end
					#end
				</ul>
			#end

			<div class="act">
				<input type="button" name="allPurposeAttach" id="allPurposeAttach" value="$tlang.getString('gen.addatt')" onclick="document.getElementById('option').value='allPurposeAttach';document.newAssignmentForm.submit();return false;"/>
			</div>
			<div class="validationError alertMessage" id="allPurpose_release_after_retract_message">
				$tlang.getString("allPurpose.alert.release.afer.retract")
			</div>
			## Show This Item Checkbox
			<div class="form-group row">

				<div class="col-sm-3">
					<label for="allPurposeHide1" class="form-control-label">
						<input name="allPurposeHide" id="allPurposeHide1" value="false" #if(!$!value_allPurposeHide)checked="checked"#end type="radio" />
						$tlang.getString("allPurpose.show")
					</label>
				</div>

				<div class="col-sm-9">
					<div class="form-group d-flex align-items-center justify-content-evenly">
						<label for="allPurposeShowFrom" class="col-sm-2 form-control-label">
							<input name="allPurposeShowFrom" id="allPurposeShowFrom" value="true" type="checkbox" #if ($value_allPurposeShowFrom) checked="checked" #end />
							$tlang.getString("allPurpose.show.from")
						</label>
						<div class="col-sm-10">
							<sakai-date-picker
								hidden-prefix="all_purpose_release_"
								iso-date="$value_allPurposeReleaseYear$H$value_allPurposeReleaseMonth$H$value_allPurposeReleaseDay$T$value_allPurposeReleaseHour:$value_allPurposeReleaseMin"
								add-hidden-fields>
							</sakai-date-picker>
						</div>
					</div>
					<div class="form-group d-flex align-items-center justify-content-evenly">
						<label for="allPurposeShowTo" class="col-sm-2 form-control-label">
							<input name="allPurposeShowTo" id="allPurposeShowTo" value="true" type="checkbox" #if ($!value_allPurposeShowTo) checked="checked" #end />
							$tlang.getString("allPurpose.show.util")
						</label>
						<div class="col-sm-10">
							<sakai-date-picker
								hidden-prefix="all_purpose_retract_"
								iso-date="$value_allPurposeRetractYear$H$value_allPurposeRetractMonth$H$value_allPurposeRetractDay$T$value_allPurposeRetractHour:$value_allPurposeRetractMin"
								add-hidden-fields>
							</sakai-date-picker>
						</div>
					</div>
				</div>
			</div>
			## Hide This Item Checkbox
			<label for="allPurposeHide2" class="form-control-label">
				<input name="allPurposeHide" id="allPurposeHide2" value="true" #if($!value_allPurposeHide)checked="checked"#end type="radio" />
				$tlang.getString("allPurpose.show.hide")
			</label>
			<h4><span class="reqStar">*</span>$tlang.getString("allPurpose.show.to")</h4>
			<div class="validationError alertMessage" id="allPurpose_userselect">
				$tlang.getString("extraNodesRequired")
			</div>
			<div class="table">
			<table class="table table-striped table-bordered table-hover" id="allPurposeGroupLists">
				<tbody>
					#set ($roleCount=0)
					#foreach ($role in $!roleUsers.keySet())
						#set ($allSelected=true)
						#set ($roleCount=$roleCount + 1)
						#set($expandString=$tlang.getString("allPurpose.show.expand").concat(" ").concat($role).concat(" ").concat($tlang.getString("allPurpose.show.list")))
						#set($collapseString=$tlang.getString("allPurpose.show.collapse").concat(" ").concat($role).concat(" ").concat($tlang.getString("allPurpose.show.list")))
						#set($expandId = "expand_")
						#set($expandId = $expandId.concat($role))
						#set($collapseId="collapse_")
						#set($collapseId=$collapseId.concat($role))
						#set($roleDivString = $role.concat("Div"))
						#set($showInputString = "allPurpose_")
						#set($showInputString = $showInputString.concat($role))
						<tr>
							<td class="groupCell">
								<a href="javascript:void(0)" id="collapse_$roleCount" class="toggleRoleLink" style="display:none;" title="$collapseString">
									<img src="/library/image/sakai/collapse.gif" alt="$collapseString" /><span class="members"><i class="si si-sakai-membership"></i></span>
								</a>
								<a href="javascript:void(0)" id="expand_$roleCount" class="toggleRoleLink" style="display:inline" title="$expandString">
									<img src="/library/image/sakai/expand.gif"  alt="$expandString"/><span class="members"><i class="si si-sakai-membership"></i></span>
								</a>
								<input id="$showInputString" name="showInputString_$roleCount" #if ($!value_allPurposeAccessList.contains($role)) checked="checked" #end type="checkbox" name="allPurpose_$role" class="selectAllMembers"/>
								<label for="showInputString_$roleCount" class="form-control-label">
									$role
								</label>
								(<span class="highlight countDisplay"></span> <span class="highlight">$tlang.getString("allPurpose.user.selection.count")</span>)
								<ul id="roleDiv_$roleCount"  style="display:none;" class="attachList userList">
									#set($userCount=0)
									#foreach($user in $!roleUsers.get($role))
										#set($showInputString = "allPurpose_")
										#set($showInputString = $showInputString.concat($user.getId()))
										<li>
											<label for="$showInputString" class="form-control-label" style="white-space:nowrap;padding:2px;width:90%;display:block" #if ($!value_allPurposeAccessList.contains($user.getId())) class="selectedItem" #else #set ($allSelected=false) #end>
												<input id="$showInputString" name="$showInputString" #if ($!value_allPurposeAccessList.contains($user.getId())) class="selectedItem" checked="checked" #set($userCount=$userCount + 1) #end type="checkbox" value="$user.Id"/>
												$formattedText.escapeHtml($user.getDisplayName())
											</label>
										</li>
									#end
									<li class="countHolder" class="skip" style="display:none">$userCount</li>
								</ul>
								#if($!allSelected)
									<script>
										$('#allPurposeGroupLists tr:last').find('.selectAllMembers').prop('checked', true);
									</script>
								#end
							</td>
						</tr>
					#end
				</tbody>
			</table>
			</div>
			<p class="act" style="margin:0;padding:0">
				<input class="extraNodeInput" type="button" id="allPurpose_save" value="$tlang.getString("allPurpose_save")" class="active"/>
				<input class="extraNodeInput" type="button" id ="allPurpose_cancel" value="$tlang.getString("allPurpose_cancel")" />
			</p>
		</fieldset>
</div> <!-- id="additionalInformation" -->
		<div class="row col-sm-12">
			#buttonBar()
		</div>
		<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
	</form>
</div>
<!-- end: chef_assignments_instructor_new_edit_assignment.vm  -->
