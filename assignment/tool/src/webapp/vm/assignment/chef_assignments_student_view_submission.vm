<!-- start: chef_assignments_student_view_submission.vm  -->
#rubricsRequirements
<script>
$(document).ready(function(){
    $('#submissionFileCount').val(1);
    $('#addMoreAttachmentControls').click(function(e){
        e.preventDefault();
        if ($('#submissionFileCount').val() < 5) {
            var $input = $('#clonableUpload').clone().removeAttr('id').addClass('cloned').appendTo('#clonedHolder').children('input');
            $input.val('');
            var $count = $('#submissionFileCount').val();
            var $nameCount = "upload"+$count;
            $input.attr("name", $nameCount);
            $('#submissionFileCount').val(parseInt($('#submissionFileCount').val(), 10) + 1);
            if ($('#submissionFileCount').val() == 5) {
                $('#addMoreAttachmentControls').hide();
                $('#addMoreAttachmentControlsInactive').show();
            }
        }
        $('.cloned a').show();
        ASN.resizeFrame('grow');
    });
    $('body').on('rubrics-grading-loaded', e => {
        const studentSelfReportMode = $studentSelfReportMode;
        switch (studentSelfReportMode) {
            // The student has to select a criteria on every criterion
            case 0:
            default:
                if($('sakai-rubric-grading').length) {
                    $('body').on('rubric-ratings-changed', e => {
                        const criterionRatingsLength = $('sakai-rubric-grading').find('.criterion-ratings').length;
                        const ratingsSelected = $('sakai-rubric-grading').find('.rating-item.selected').length;
                        if (ratingsSelected === criterionRatingsLength) {
                            disableSubmitButtons(false);
                        } else {
                            disableSubmitButtons(true);
                        }
                    });
                }
                break;

            // The student has to select at least one criteria in one criterion
            case 1:
                if($('sakai-rubric-grading').length) {
                    $('body').on('rubric-ratings-changed', e => {
                        const ratingsSelected = $('sakai-rubric-grading').find('.rating-item.selected').length;
                        if (ratingsSelected > 0) {
                            disableSubmitButtons(false);
                        } else {
                            disableSubmitButtons(true);
                        }
                    });
                }
                break;

            // The student is not required to select any criteria
            case 2:
                disableSubmitButtons(false);
                break;
        }
    });

    function disableSubmitButtons(disabled) {
        document.getElementById('confirm').disabled = disabled;
        document.getElementById('preview').disabled = disabled;
        document.getElementById('save').disabled = disabled;
    }

});
</script>
## Include other javascript specific to this page
#javascript("/sakai-assignment-tool/js/studentViewSubmission.js")

<div class="portletBody">
#if ($isTimesheet && $assignment.Estimate && !$assignment.Estimate.equals("") && !$!nonElectronicType)
    #navBarTimesheet("Assignment")
#end
## submission times
	#set($dateReturned=false)
	#set($dateReturned=$submission.DateReturned)
	#set($dateSubmitted=false)
	#set($dateSubmitted=$submission.DateSubmitted)
	#set($submitted=false)
	#set($submitted=$submission.Submitted)
	#set($isUserSubmission=$submission.UserSubmission)
	#set($returned=false)
	#set($returned=$submission.Returned)
	#set($closeDate = false)
	#set($closeDate = $assignment.CloseDate)
	#set($timeSheetSource = "submission")
	#set($extensionTime=$submission.properties.get("allow_extension_closeTime"))

	#set ($submissionType = $assignment.TypeOfSubmission.ordinal())
	#if ($submissionType == 6 )
        #if ( $value_ContentId && $value_ContentLaunchURL )
            ## It is all good
        #else
		    <div class="sak-banner-error">$tlang.getString("external.tool.missing")</div>
        #end
	#end

	#if ($alertMessage)<div class="sak-banner-error"><strong>$tlang.getString("gen.alert")</strong> $alertMessage</div>#end

	#if ($!canSubmit)
		#if ($!submission && $dateSubmitted)
			## if there is a submitted submission
			## get the properies
			#if ($!allowAddAssignment)
				<h3>$tlang.getString("exampleassign") </h3>
				<p class="sak-banner-info">$tlang.getString("exampleassign2")</p>
				#if ($!assignment.isGroup) <p class="sak-banner-warn">$tlang.getString("exampleassign3")</p> #end
			#else
			<h3>
				$formattedText.escapeHtml($assignment.Title)
				<span class="highlight">
					 - $!service.getSubmissionStatus($submission.Id, true)
				</span>
			</h3>
			#end
			#if ($returned)
					#if ($dateSubmitted && $dateReturned && $dateReturned.isAfter($dateSubmitted))
					<p class="instruction">
						$tlang.getString("stuviewsubm.asshasbee4") $!service.getUsersLocalDateTimeString($submission.DateReturned) $tlang.getString("stuviewsubm.plesub")
					</p>	
					#else
					<p class="instruction">
						$tlang.getString("stuviewsubm.asshasbee3") $!service.getUsersLocalDateTimeString($submission.DateSubmitted)
						#if ($dateSubmitted && $dateSubmitted.isAfter($assignment.DueDate))
							<span class="highlight"> $tlang.getString("gen.late")</span>
						#end
					</p>	
					#end
			#elseif ($submission.Graded && ($submission.GradeReleased || $returned))
					$tlang.getString("stuviewsubm.asshasbee2")
			#else
					<p class="instruction">$tlang.getString("gen.hasbee") $!service.getUsersLocalDateTimeString($submission.DateSubmitted)</p>
					#if ($!dateSubmitted && $!dateSubmitted.isAfter($assignment.DueDate))
						<span class="highlight"> $tlang.getString("gen.late")</span>
					#end
			#end
		#else
			#if ($!allowAddAssignment)
				<h3>$tlang.getString("exampleassign")</h3>
				<p class="sak-banner-info">$tlang.getString("exampleassign2")</p>
				#if ($!assignment.isGroup) <p class="sak-banner-warn">$tlang.getString("exampleassign3")</p> #end
			#else 
				<h3>$tlang.getString("gen.assig")
					## no need to show status if this is for an non-electronic submission type of assignment
					#if (!$!nonElectronicType)
							<span class="highlight">
						 	- $tlang.getString("gen.inpro")
							</span>
						#end
				</h3>
			#end
			## TEXT_ONLY_ASSIGNMENT_SUBMISSION = 1;
			## ATTACHMENT_ONLY_ASSIGNMENT_SUBMISSION = 2;
			## TEXT_AND_ATTACHMENT_ASSIGNMENT_SUBMISSION = 3;
			## NON_ELECTRONIC_ASSIGNMENT_SUBMISSION = 4;
			## SINGLE_ATTACHMENT_SUBMISSION = 5
			## EXTERNAL_TOOL_SUBMISSION = 6
			## VIDEO_SUBMISSION = 7
			<p class="instruction">
				#if (($submissionType==1) || ($submissionType==3))
					 $tlang.getString("stuviewsubm.asshasnot")
				#elseif (($submissionType==2) || ($submissionType==5))
				 	$tlang.getString("stuviewsubm.assattonly")
				#elseif ($submissionType == 6)
                    $tlang.getString("stuviewsubm.externaltool")
				#elseif ($submissionType == 7)
					<div class="sak-banner-warn">$tlang.getString("stuviewsubm.video")</div>
				#end
				#if($assignment.AllowPeerAssessment)
					<div class="highlight">
						#if($assignment.PeerAssessmentAnonEval)
				 			$tlang.getString("stuviewsubm.peerreviewanon")
						#else
				 			$tlang.getString("stuviewsubm.peerreview")
						#end
					</div>
				#end
			</p>	
		#end
	#end
##		<h4>$tlang.getString("gen.assdet")</h4>
	#if ($isTimesheet && $assignment.Estimate && !$assignment.Estimate.equals(""))
		#parse ("/vm/assignment/chef_assignments_student_estimate.vm")
	#end
		<div id="StudentAssignmentCurrent">
		<div class="itemSummary">
			<div class="row">
				<div class="col-lg-4 col-sm-6 col-xs-12">
					<div class="itemSummaryHeader">$tlang.getString("gen.title")</div>
				</div>
				<div class="col-lg-4 col-sm-6 col-xs-12">
					<div class="itemSummaryValue">
						$formattedText.escapeHtml($assignment.Title)
						#assignmentIcons($assignment)
						#set ($deleted = false)
						#set ($deleted = $assignment.Deleted)
						#if ($deleted)
							<span class="highlight">(Assignment has been deleted)</span>
						#end
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col-lg-4 col-sm-6 col-xs-12">
					<div class="itemSummaryHeader">$tlang.getString("gen.due.header")</div>
				</div>
				#set($allowUpdateAssignment=$!service.allowUpdateAssignment($assignmentReference))
				<div class="col-lg-4 col-sm-6 col-xs-12">
					<div class="itemSummaryValue">
						#if (!$assignment.HideDueDate || $!allowUpdateAssignment)
							$!service.getUsersLocalDateTimeString($!assignment.DueDate)
						#end
					</div>
				</div>
			</div>
			##resubmit number
			#if ($submissionType != 4)
				<div class="row">
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryHeader">$tlang.getString("allow.resubmit.number")</div>
					</div>
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryValue">
							#if ($!resubmitNumber) $resubmitNumber #else 0 #end 
						</div>
					</div>
				</div>
				## resubmit close time
				#if($!resubmitNumber && !$!resubmitNumber.equals("0") )
					<div class="row">
						<div class="col-lg-4 col-sm-6 col-xs-12">
							<div class="itemSummaryHeader">$tlang.getString("allow.resubmit.closeTime")</div>
						</div>
						<div class="col-lg-4 col-sm-6 col-xs-12">
							<div class="itemSummaryValue">
								$resubmitCloseTime
							</div>
						</div>
					</div>
				#end
				#if ($!extensionTime)   ##put in some info about the extension deadline, if we have it.
					<div class="row">
						<div class="col-lg-4 col-sm-6 col-xs-12">
							<div class="itemSummaryHeader" >$tlang.getString("gen.extension")</div>
						</div>
						<div class="col-lg-4 col-sm-6 col-xs-12">
							<div class="itemSummaryValue">$!service.getUsersLocalDateTimeStringFromProperties($extensionTime)</div>
						</div>
					</div>
				#end
			#end
			## no need to show status if this is for an non-electronic submission type of assignment
			#if (!$!nonElectronicType)
				<div class="row">
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryHeader">$tlang.getString("gen.status")</div>
					</div>
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryValue">
							#if ($!submission)
								$!service.getSubmissionStatus($submission.Id, true)
							#else
								$tlang.getString("gen.notsta")
							#end
						</div>
					</div>
				</div>
			#end
			#if ($submissionType == 6)
				<div class="row">
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryHeader">$tlang.getString("external.tool.header")</div>
					</div>
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryValue">
                            #if ( $value_ContentId && $value_ContentLaunchURL )
                                $!value_ContentTitle
                            #else
                                $tlang.getString("external.tool.missing")
                            #end
						</div>
					</div>
				</div>
			#end
			#set ($gradeScale = $assignment.TypeOfGrade.ordinal())
			#if ($submission.Graded && $submission.GradeReleased)
				<div class="row">
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryHeader">$tlang.getString("gen.gra")</div>
					</div>
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryValue highlight">
							<strong>
								#if ($gradeScale != 1)
									#if ($!grade == $tlang.getString("pass") || $!grade == $tlang.getString("gen.checked"))
										<span class="text-success">$!grade</span>
									#elseif ($!grade == $tlang.getString("fail"))
										<span class="text-danger">$!grade</span>
									#else
										$!grade
									#end
								#else
									$tlang.getString("gen.nograd")
								#end
								#if ($gradeTypeTable.get($gradeScale) == $!tlang.getString("points"))
									($tlang.getString("grade.max") $!service.getMaxPointGradeDisplay($!assignment.ScaleFactor, $!assignment.MaxGradePoint))
								#end
							</strong>

							<!--for grading via an external scoring service, if enabled for an associated gradebook item -->
							#if($scoringComponentEnabled)
								#parse ("/vm/assignment/chef_assignments_scoring_agent.vm")
							#end
						</div>
					</div>
				</div>
			#else
				<div class="row">
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryHeader">$tlang.getString("gen.grasca")</div>
					</div>
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryValue">
							$gradeTypeTable.get($gradeScale)
							#if ($gradeTypeTable.get($gradeScale) == $!tlang.getString("points"))
								($tlang.getString("grade.max") $!service.getMaxPointGradeDisplay($!assignment.ScaleFactor, $!assignment.MaxGradePoint))
							#end

							<!--for grading via an external scoring service, if enabled for an associated gradebook item -->
							#if($scoringComponentEnabled)
								#parse ("/vm/assignment/chef_assignments_scoring_agent.vm")
							#end
						</div>
					</div>
				</div>
			#end
			#if ($isTimesheet && $assignment.Estimate && !$assignment.Estimate.equals(""))
			<div class="row">
				<div class="col-lg-4 col-sm-6 col-xs-12">
					<div class="itemSummaryHeader">$tlang.getString("gen.estimatedselfempl")</div>
				</div>
				<div class="col-lg-4 col-sm-6 col-xs-12">
					<div class="itemSummaryValue">
						$formattedText.escapeHtml($!assignment.Estimate)
					</div>
				</div>
			</div>
			#end
			##show alert when assignment is modified and the modified date is after its open date	
			#set($newAssignment="false")
			#set($newAssignment=$assignment.Properties.get("newAssignment"))
			#if ($assignment.DateModified.isAfter($assignment.OpenDate) && !$!newAssignment.equalsIgnoreCase("true"))
				<div class="row">
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryHeader">$tlang.getString("gen.modbyins")</div>
					</div>
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryValue">
							$!service.getUsersLocalDateTimeString($assignment.DateModified)
						</div>
					</div>
				</div>
			#end
			#if($allowReviewService && $assignment.ContentReview && $!submission && $!service.isContentReviewVisibleForSubmission($!submission))
				<div class="row">
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryHeader">$reviewServiceName&nbsp;$tlang.getString("review.report")</div>
					</div>
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryValue">
							#contentReviewReports($submission false true)
						</div>
					</div>
				</div>
			#end

			## Submission Log
			#if ($!submissionLog && !$!submissionLog.isEmpty())
				<div class="row">
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryHeader">$tlang.getString("gen.history")</div>
					</div>
					<div class="col-lg-4 col-sm-6 col-xs-12">
						<div class="itemSummaryValue">
							#foreach ($message in $submissionLog)
								$message<br/>
							#end
						</div>
					</div>
				</div>
			#end

		</div>
		<div class="clearfix"></div>
		<h4>
			$tlang.getString("gen.instr")
		</h4>
		
		#if (!$!assignment.Instructions.isEmpty())
			<div class="textPanel">$formattedText.escapeHtmlFormattedText($!assignment.Instructions)</div>
		#end

		## Assignment Attachments
		#attachmentFragment($assignment.Attachments $assignmentAttachmentReferences $!decoratedUrlMap false)

		#supplementItems($!allowViewModelAnswer $!allowReadAssignmentNoteItem $!allowViewAllPurposeItem $!assignmentModelAnswerItem $!assignmentNoteItem $!assignmentAllPurposeItem)

		#if (!$!rubricSelfReport)
		<sakai-rubric-student-preview-button
			site-id="$context"
			tool-id="sakai.assignment.grades"
			entity-id="$assignment.Id">
		</sakai-rubric-student-preview-button>
		#end

		#if ($submission.Graded && ($submission.GradeReleased || $returned))
		<sakai-rubric-student
			site-id="$context"
			tool-id="sakai.assignment.grades"
			entity-id="$assignment.Id"
			evaluated-item-id="$submission.Id"
			enable-pdf-export="$enablePdfExport"
			evaluated-item-owner-id="$submitter.id"
		></sakai-rubric-student>
		#end

		#if ($taggable)
        	#parse ("/vm/assignment/chef_assignments_tags_list.vm")
		#end
		<hr class="itemSeparator" />
		#if ($returned)
			<h3>$tlang.getString("gen.resubmission")</h3> 
		#else
			<h3>$tlang.getString("gen.submission")</h3> 
		#end	

		#set($notes = [])
		#set($notes = $notesMap.get($submitter.id))
		#if ($!isAdditionalNotesEnabled && !$assignment.IsGroup && $notes.size() > 0)
			#set($notesstr = "")
			#foreach($note in $!notes)
				#if($!note) #set($notesstr = "$notesstr<li>$note</li>") #end
			#end
			#if($notesstr) 
				#set($notesstr = "<ul>$notesstr</ul>")
			#else 
				#set($notesstr = "---")
			#end
			<div class="instruction">
				$tlang.getFormattedMessage("assignment.additional.notes.students.explanation", $notesstr)
			</div>
		#end

		## show special instruction if this is for an non-electronic submission type of assignment
		#if ($!nonElectronicType)
			<p class="sak-banner-info">
				$tlang.getString("nonelec_instruction")
			</p>
			## show feedbacks if any
			#if ($returned && $!dateReturned)
					#if (($!submission.FeedbackComment) && ($submission.FeedbackComment.trim().length()>0))
						#if ($submissionType==2)
							<h3>$tlang.getString("gen.addinst2")</h3>
						#else
							<h3>$tlang.getString("gen.addinst")</h3>
						#end	
							<div class="textPanel">$formattedText.escapeHtmlFormattedText($submission.FeedbackComment)</div>
					#end
					## for returned (not resubmitted ) submission, show the instructor feedback
					#if ($!prevFeedbackComment && $!prevFeedbackComment.trim().length() > 0)
							<h4  id="toggleGen" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />
								$tlang.getString("gradingsub.prefee2")
							</h4>
					<div class="toggledContent gencoms">					
						$cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackComment)</div>
					#end
					#parse ("/vm/assignment/chef_assignments_student_view_feedback_attachments.vm")
			#end
			##just show a simple done button for non-electronic submission type
			<form name="dummyForm" action="#toolForm("AssignmentAction")" method="post" onsubmit="return true;">
				<input type="submit" accesskey="x" name="eventSubmit_doCancel_show_submission" value="$tlang.getString('gen.don')" onclick="SPNR.disableControlsAndSpin( this, null );" />
				<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
			</form>
		#else
	<form name="addSubmissionForm" id="addSubmissionForm" action="#toolForm("AssignmentAction")" method="post" onsubmit="return true;" enctype="multipart/form-data" >
		<input type="hidden" name="eventSubmit_doRead_add_submission_form" value="x" />
		<input type="hidden" name="option" id="option" value="cancel" />
		<input type="hidden" name="currentAttachment" value="" />
		<input type="hidden" name="assignmentId" value="$assignmentReference" />
		
		#if ($!rubricSelfReport)
		<p class="instruction">
			#if ($studentSelfReportMode == 0)
				$tlang.getString("youhavetorubric")
			#elseif ($studentSelfReportMode == 1)
				$tlang.getString("youhavetorubricone")
			#elseif ($studentSelfReportMode == 2)
				$tlang.getString("youmustrubric")
			#end
		</p>
		<sakai-rubric-grading
			site-id="$context"
			tool-id="sakai.assignment.grades"
			entity-id="$assignment.Id"
			#if ($!assignment.isGroup)
				evaluated-item-id="$selectedGroup"
				evaluated-item-owner-id="$selectedGroup"
				group
			#else
				evaluated-item-id="$submitter.id"
				evaluated-item-owner-id="$submitter.id"
			#end
			is-peer-or-self="true" 
		></sakai-rubric-grading>
		#end

		#if ($!canSubmit)
			## if a draft submission or the submission has been returned and has not yet submitted
			## 1- text only; 2-attachment only; 3-text and attachment
			#set ( $submissionType = $assignment.TypeOfSubmission.ordinal())
			
#if ($!assignment.IsGroup)
<h4>$tlang.getString("group.select.represent")</h4>
		#if ($!groups)
                    #set ($size = 0)
                    #set ($listDisplay="block")
                        #set($aoGroup = $!site.getGroup($!originalGroup))
                         #if ($aoGroup)
                         <input type="hidden" name="originalGroup" id="orig-$aoGroup.Id" value="$aoGroup.Id" />
                         #end
			<table id="groupTable" style="width:80%;display:$listDisplay" class="listHier lines indnt3" border="0" cellpadding="0" cellspacing="0" summary="$tlang.getString('group.list.summary')">
					#foreach ($group in $!groups)
                                                #set ($size = $size + 1)
						<tr>
							<td headers="selected" style="width:2em">
								#if ($!group_size.equals("1"))
									#set($selected=true)
								#else
									#set($selected=false)
									#set($aGroup = $!site.getGroup($!selectedGroup))
									#if ($!group.Id == $!aGroup.Id)
										#set($selected = true)
									#end
								#end
								
								<input type="radio" name="selectedGroups" id="id-$group.Id" title="$group.Id" value="$group.Id" #if($selected) checked="checked"#end />
							</td>
							<td headers="name" class="checkbox" style="white-space:nowrap">
								<label for="id-$group.Id">
									$formattedText.escapeHtml($group.Title)
								</label>	
							</td>
                                                        <td headers="description" width="100%"> ##mozilla does not resize table children dynamically , so set here
							<span class="badge bg-primary fs-6 text-wrap text-start">
								#set($gusers = $!service.getSortedGroupUsers($group))
								#foreach ($user in $gusers)
									$formattedText.escapeHtml($user.getDisplayName())#if ($showUserId) ($formattedText.escapeHtml($user.getDisplayId())) #end
									#if ($velocityCount < $gusers.size()),#end
								#end
							</span>	

								#set($description = $group.Description)
								<div style="font-size: smaller;">$formattedText.escapeHtml($!description)</div>
							</td>
						</tr>
					#end
                                        #if ($size == 0)
                                                <tr><td colspan="2"><span class="highlight">$tlang.getString("group.must.member")</span></td></tr>
                                        #end
			</table>
                #else
                    <span class="highlight">$tlang.getString("group.must.member")</span>
		#end
## End if ($!assignment.IsGroup)
#end

			## We are allowing the instructor to submit as long as assignment is not non-electronic and not deleted
			#if (!$submissionType != 4 && !$!deleted.equalsIgnoreCase("true") && $!allowAddAssignment && $!allowSubmitByInstructor && $!student) 
				<h4>$tlang.getString("submitforstudent")</h4>
				<p class="instruction">
					$formattedText.escapeHtml($student.getDisplayName())
					<input type="hidden" name="submit_on_behalf_of" id="submit_on_behalf_of" value="$student.id" />		
				</p>
			#end

			#if (($submissionType==1) || ($submissionType==3))
				#if ($!deleted.equalsIgnoreCase("true"))
					<h4>$tlang.getString("gen.yousub") </h4>
					##if the assignment has been deleted, disable the action button
					$formattedText.escapeHtmlFormattedText($!value_submission_text)
				#else
							<h4>$tlang.getString("assignmenttext")</h4>
							<p class="instruction">
							#if ($returned)
									$tlang.getString("stuviewsubm.entbelo")
							#else
								#if ($submissionType==1)
									$tlang.getString("gen.theassall6")
								#elseif ($submissionType==3)
									$tlang.getString("gen.theassall4")
								#end
							#end
							#if ($plagiarismNote)
								<p>
									<span class="bi bi-award" aria-hidden="true" aria-label="$reviewIndicator"></span>
									<em>
										$plagiarismNote
										#if ($plagiarismFileTypes || $plagiarismProviderInfo)
											<ul>
												#if ($plagiarismFileTypes)
													$plagiarismFileTypes
												#end
												#if ($plagiarismProviderInfo)
													$plagiarismProviderInfo
												#end
											</ul>
										#end
										#if ($plagiarismStudentPreview)
											$plagiarismStudentPreview
										#end
									</em>
								</p>
							#end
							#if ($plagiarismEULALink)
								<p class="checkbox highlightPanel form-required">
									<label for="$name_plagiarism_eula_agreement">
										#if ($value_plagiarism_eula_agreement.equals("true"))
											<input id="$name_plagiarism_eula_agreement" type="checkbox" name="$name_plagiarism_eula_agreement" value="true" checked="checked"/>
										#else
											<input id="$name_plagiarism_eula_agreement" type="checkbox" name="$name_plagiarism_eula_agreement" value="true"/>
										#end
										$tlang.getString("review.eula.agreement")&nbsp;<a href="$plagiarismEULALink" target="_blank">$tlang.getString("review.eula")</a>
									</label>
								</p>
								<input type="hidden" name="$name_check_plagiarism_eula_agreement" id="$name_check_plagiarism_eula_agreement" value="true" checked="checked"/>
							#end
							</p>
							#set($contextkey = "ckeditor-autosave-context")
  						        #set($entitykey = "ckeditor-autosave-entity-id")
							#set($entityval = "$assignment.Id")
                        				<input type="hidden" id="$contextkey" name="$contextkey" value="asn_student_view">
                        				<input type="hidden" id="$entitykey" name="$entitykey" value="$entityval">
							<table border="0">
								<tr>
									<td>
										<textarea cols="80" rows="30" wrap="virtual" name="$name_submission_text" id="$name_submission_text" #if(!$allowSubmit)disabled="disabled"#end >#if($!value_submission_text)$formattedText.escapeHtmlFormattedTextarea($!value_submission_text)#end</textarea>						
											#chef_setupformattedtextarea($name_submission_text)
									</td>
								</tr>
							</table>
						## feedback text
						#set($feedbackText = false)
						#set($feedbackText = $submission.FeedbackText)
						#if ($!feedbackText && $feedbackText.length()>0)
							#if ($!prevFeedbackText)
								<h3>$tlang.getString("gen.orisub3")</h3>							
							#else
								<h3>$tlang.getString("gen.orisub2")</h3>
							#end
						<div class="textPanel">
							$cheffeedbackhelper.escapeAssignmentFeedback($feedbackText)
						</div>
						#end
						## for returned submission, show the instructor commented text as well
						#if ($!prevFeedbackText)
							<h4 id="toggleInline" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />$tlang.getString("gradingsub.prefeetex3")</h4>
							<div class="toggledContent inlinecoms">
								$cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackText)
							</div>
						#end
						#*#else
							## for resubmitted submission, show the input disabled
							<div>
								$tlang.getString("gen.yousub")
							</div>
							$formattedText.escapeHtmlFormattedText($!value_submission_text)
						#end							
					#end*#
				#end
			#else
				#set ($unsubmittableInline = true)
			#end

			#set ($size = 0)
			#set ($props = false)
			#foreach ($attachment in $attachments)
				#set ($props = $attachment.Properties)
				#if ($!props)
					#set ($size = $size + 1)
				#end
			#end

			#if (($submissionType==2) || ($submissionType==3) || ($submissionType==5)) 
				#if ($submissionType==2 && !$unsubmittableInline)
					<p class="instruction">
						#if (($submitted && !$returned) || ($returned && $dateReturned && $dateSubmitted && $dateReturned.isBefore($dateSubmitted)) || ($closeDate && $currentTime.isAfter($closeDate)))
							## for submitted not yet returned submission; or returned by resubmitted submission; or after close date
							$tlang.getString("stuviewsubm.youatt")
						#else
							$tlang.getString("stuviewsubm.theassall2")
						#end
					</p>
				#end	
				#if (($submissionType == 2) || ($submissionType == 5))
					#if ($plagiarismNote)
						<p>
							<span class="bi bi-award" aria-hidden="true" aria-label="$reviewIndicator"></span>
							<em>
								$plagiarismNote
								#if ($plagiarismFileTypes || $plagiarismProviderInfo)
									<ul>
										#if ($plagiarismFileTypes)
											$plagiarismFileTypes
										#end
										#if ($plagiarismProviderInfo)
											$plagiarismProviderInfo
										#end
									</ul>
								#end
								#if ($plagiarismStudentPreview)
									$plagiarismStudentPreview
								#end
							</em>
						</p>
					#end
					#if ($unsubmittableInline && ""!="$!value_submission_text")
						<div class="assignmentUnsubmittable">
							<h3>$tlang.getString("gen.orisub")</h3>
							<p class="assignmentWarning">$tlang.getString("stuviewsubm.typesubhaschanged.inline")</p>
							<div class="assignmentInline">
								$formattedText.escapeHtmlFormattedText($!value_submission_text)
							</div>
						</div>
					#end
				#end
			#end
			#if ($isTimesheet && $assignment.Estimate && !$assignment.Estimate.equals(""))
			<div id="spenttimepanel" class="highlightPanel">
				<h3>
					$tlang.getString("gen.spenttime")
				</h3>
				<div class="row">
					#if ($assignment.estimateRequired)
						<div class="col-sm-5 form-required">
					#else
						<div class="col-sm-5">
					#end
						<label class="itemSummaryHeader itemSummaryWrap">$tlang.getString("gen.totaltimespent")</label>
					</div>
					<div class="col-sm-3">
						<div class="itemSummaryValue">
							<input name="$name_ASSIGNMENT_INPUT_ADD_TIME_SPENT" id="$name_ASSIGNMENT_INPUT_ADD_TIME_SPENT" type="text" value="$formattedText.escapeHtml($!value_ASSIGNMENT_INPUT_ADD_SUBMISSION_TIME_SPENT)" size="20" maxlength="20" class="form-control" <input type="text" class="form-control" id="duration" name="duration" placeholder="$!tlang.getString('ts.modal.field.tspent.format')">
							<input name="assignment_input_add_submission_time" id="assignment_input_add_submission_time" type="hidden" value="$formattedText.escapeHtml($!value_ASSIGNMENT_INPUT_ADD_SUBMISSION_TIME_SPENT)">
							##$formattedText.escapeHtml($!assignment.Estimate)
						</div>
					</div>
				</div>
				<div class="row">
					#if(!$formattedText.escapeHtml($!value_ASSIGNMENT_INPUT_ADD_TIME_SPENT).equals(""))
						<div class="col-sm-5">
							<label for="timeTimesheet" class="itemSummaryHeader itemSummaryWrap">$!tlang.getString( "gen.useimputedtime" )<a href="javascript:void(0)" title="$!tlang.getString( "ts.tab.timesheet" )" onclick="ASN.switchTimesheetTab( 'tabTimeSheet' ); return false;">$!tlang.getString( "ts.tab.timesheet" )</a> ($formattedText.escapeHtml($!value_ASSIGNMENT_INPUT_ADD_TIME_SPENT))</label>
						</div>
						<div class="col-sm-2">
							<div class="itemSummaryValue">
								<input type="checkbox" name="timeTimesheet" id="timeTimesheet" onclick="ASN.checkTimesheetSpent('$formattedText.escapeHtml($!value_ASSIGNMENT_INPUT_ADD_TIME_SPENT)');" />
							</div>
						</div>
					#else
						<div class="col-sm-5">
							<label for="timeTimesheet" class="itemSummaryHeader itemSummaryWrap">$!tlang.getString( "gen.notimeimputted" )<a href="javascript:void(0)" title="$!tlang.getString( "ts.tab.timesheet" )" onclick="ASN.switchTimesheetTab( 'tabTimeSheet' ); return false;">$!tlang.getString( "ts.tab.timesheet" )</a>$!tlang.getString( "gen.notimeimputted.enter" )</label>
						</div>
					#end
				</div>
			</div>
			#end
			#if (($submissionType==2) || ($submissionType==3) || ($submissionType==5 && $size < 2))
				<div id="attachmentspanel" class="highlightPanel">
					<h3 style="margin-top:0;margin-bottom:.5em">
						#if ($submissionType == 5)
							$tlang.getString("gen.att.single")
						#else
							$tlang.getString("gen.att")
						#end
					</h3>	
					#if ($size == 0)
						<p class="instruction">
							#if ($submissionType == 5)
								$tlang.getString("gen.noatt.single")
							#else
								$tlang.getString("gen.noatt")
							#end
						</p>
					#else
						<table class="attachList listHier indnt1 centerLines" style="margin-bottom:.5em;margin-top:0; width:auto" summary="$tlang.getString("stuviewsubm.listsummary")">
							#foreach ($attachment in $attachments) 
								#set ($props = false)
								#set ($props = $attachment.Properties) 
								#if ($!props && !$!props.isEmpty())
									<tr>
										<td>
											#if ($props.getBooleanProperty($props.NamePropIsCollection))
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
											#else
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
											#end
											<a href="$attachment.Url" target="_blank">$formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
										</td>
										<td>
											#propertyDetails($props)
										</td>
										<td class="itemAction">
											<div class="spinnerBesideContainer">
												<a href="javascript:void(0)" onclick="SPNR.insertSpinnerAfter( this, null, null ); ASN.doStudentViewSubmissionAction( 'addSubmissionForm', 'removeAttachment', '$attachment.id', 'attachmentspanel' ); return false;">
													$tlang.getString("stuviewsubm.removeatt")<span class="skip"> $formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</span>
												</a>
											</div>
										</td>
									</tr>
								#end
							#end
						</table>
					#end
					#if (($submissionType==2) || ($submissionType==3))
						<div class="highlightPanel specialLink" style="margin:0;padding-bottom:.5em;">
							#if ($!deleted.equalsIgnoreCase("true")) 	 
		    					##if the assignment has been deleted, disable the action button 	 
		     					<input type="submit" name="eventSubmit_doAttachments" value="Attachment" accesskey="a" disabled="disabled" /> 	 
		     				#else
								#if ($!canSubmit)
									#if ($size==0) 
										#set($howManySubAtts=$tlang.getString("stuviewsubm.attfromcomputerlabel"))
										#set($howManySubAttsLinks=$tlang.getString("stuviewsubm.attfromserverlabel"))
									#else
										#set($howManySubAtts=$tlang.getString("stuviewsubm.attfromcomputerlabelmore"))
										#set($howManySubAttsLinks=$tlang.getString("stuviewsubm.attfromserverlabelmore"))
									#end
									<input type="hidden" name="submissionFileCount" id="submissionFileCount" value="1"/>
									<table border="0" cellpadding="0" cellspacing="0" class="listHier  centerLines" style="width:auto;margin:0">
										<tr>
											<td>
												<span><label for="clonableUpload">$howManySubAtts</label></span>
											</td>
											<td>
												<div id="clonableUploadW spinnerBesideContainer"> 
													<input type="file" name="upload" class="upload" id="clonableUpload" #if($content_review_acceptedMimeTypes) accept="$content_review_acceptedMimeTypes" #end onchange="SPNR.insertSpinnerAfter( this, null, null ); document.getElementById('addSubmissionForm').action='#toolLinkParam("AssignmentAction" "doAttachUpload" "sakai_csrf_token=$formattedText.escapeUrl($sakai_csrf_token)")';ASN.submitForm( 'addSubmissionForm', null, null, null, 'attachmentspanel' );"/> 
												</div>
												</td>
												##Only show for inline and attachments
												#if ($submissionType == 3)
												<td>
													<span class="navIntraToolLink">
														<input class="disableme enabled" type="button" value="$howManySubAttsLinks" name="attach" id="attach" accesskey="a" #if(!$allowSubmit) disabled="disabled"#end
															onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'addSubmissionForm', 'attach', null, null, 'attachmentspanel' ); return false;" />
													</span>
												</td>
												#end
										</tr>	
										<tr>
											<td></td>
											<td id="clonedHolder"></td>
											<td></td>
										</tr>
									</table>	
									
								#end
							#end
						</div>
					#end
					## for single file upload case
					#if ($submissionType==5 && $attachments && $attachments.size() == 0)
						<div class="highlightPanel">
							<table border="0" cellpadding="0" cellspacing="0" class="listHier centerLines" style="width:auto;margin:0;">
								<tbody>
									<tr>
										<td>
											<label for="upload">$tlang.getString("att.upl")</label>
										</td>
										<td>
											<div class="spinnerBesideContainer">
												<input type="file" name="upload" class="upload" id="clonableUpload" #if($content_review_acceptedMimeTypes) accept="$content_review_acceptedMimeTypes" #end onchange="SPNR.insertSpinnerAfter( this, null, null ); document.getElementById('addSubmissionForm').action='#toolLinkParam("AssignmentAction" "doAttachUploadSingle" "sakai_csrf_token=$formattedText.escapeUrl($sakai_csrf_token)")';ASN.submitForm( 'addSubmissionForm', null, null, null, 'attachmentspanel' );"/>
											</div>
											<input type="hidden" name="submissionFileCount" id="submissionFileCount" value="1"/>
										</td>
									</tr>
								</tbody>
							</table>
				 		</div>
					#end
				</div>
			#elseif ($submissionType == 5)
					## attachments > 1, but the assignment type is single uploaded file only

					<div class="assignmentAttachBox">
					<h3>
						#if ($submissionType == 5)
							$tlang.getString("gen.att.single")
						#else
							$tlang.getString("gen.att")
						#end
					</h3>
					<p> $tlang.getString("stuviewsubm.typesubhaschanged.singleUploadedFileOnly")</p>
					#foreach ($attachment in $attachments)
						#set ($props = false)
						#set ($props = $attachment.Properties)
						#if ($!props)
							<div class="assignmentAttachRadio">
								<input type="radio" name="attachmentSelection" value="$attachments.indexOf($attachment)" onclick="ASN.highlightSelectedAttachment(); ASN.enableSubmitUnlessNoFile(false);">
								#attachmentDetails()
								<br>
							</div>
						#end
					#end

					<div class="assignmentAttachRadio assignmentAttachmentHighlight">
						<input type="radio" name="attachmentSelection" value="newAttachment" onclick="ASN.highlightSelectedAttachment(); ASN.enableSubmitUnlessNoFile(true);" checked />
						<span>
							#set($attachment = $newSingleUploadedFile)
							#if (!$attachment)
								#if ($newSingleAttachmentList && !$newSingleAttachmentList.isEmpty())
									#set($attachment = $newSingleAttachmentList.get(0))
								#end
							#end
							#set($props = false)
							#set($props = $attachment.Properties)
							#if ($props)
								#attachmentDetails()
								<a href="javascript:void(0)" onclick="SPNR.insertSpinnerAfter( this, null, null ); ASN.submitForm( 'addSubmissionForm', 'removeNewSingleUploadedFile', null, null, 'attachmentspanel' ); return false;">
									$tlang.getString("stuviewsubm.removeatt")<span class="skip"> $formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</span>
								</a>
								<br>
							#else
								$tlang.getString("stuviewsubm.uploadnew")
								<input type="file" name="upload" class="upload" id="clonableUpload" #if($content_review_acceptedMimeTypes) accept="$content_review_acceptedMimeTypes" #end onchange="SPNR.insertSpinnerAfter( this, null, null ); document.getElementById('addSubmissionForm').action='#toolLinkParam("AssignmentAction" "doAttachUploadSingle" "sakai_csrf_token=$formattedText.escapeUrl($sakai_csrf_token)")';ASN.submitForm( 'addSubmissionForm', null, null, null, 'attachmentspanel' );"/>
							#end
						</span>
					</div>

				</div>
           #elseif ($submissionType == 7)
               #parse ("/vm/assignment/assignments_display_video_submission.vm")
               <br>
               #parse ("/vm/assignment/assignments_record_video_submission.vm")
			#else
				## this is where we show any previous attachments when the submission type doesn't allow them
				#if ($size != 0)
					<div class="assignmentUnsubmittableAttachments">
						<h3>
							#if ($submissionType == 5)
								$tlang.getString("gen.stuatt.single")
							#else
								$tlang.getString("gen.stuatt")
							#end
						</h3>
						<p class="assignmentWarning">$tlang.getString("stuviewsubm.typesubhaschanged.attach")</p>
						<table class="attachList listHier indnt1 centerLines" style="width:auto;" summary="$tlang.getString("stuviewsubm.listsummary.simple")">
							#foreach ($attachment in $attachments)
								#set ($props = false)
								#set ($props = $attachment.Properties)
								#if ($!props)
									<tr>
										<td>
											#if ($props.getBooleanProperty($props.NamePropIsCollection))
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
											#else
												<img src = "#imageLink($contentTYpeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
											#end
											<a href="$attachment.Url" target="_blank">$formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>
										</td>
										<td>
											#propertyDetails($props)
										</td>
									</tr>
								#end
							#end
						</table>
					</div>
				#end
			#end

				#if ($returned && $dateReturned && ($dateSubmitted && $dateReturned && $dateReturned.isAfter($dateSubmitted) || !$dateSubmitted || !$!submitted))
					#if (($!submission.FeedbackComment) && ($submission.FeedbackComment.trim().length()>0))
						#if ($submissionType==2)
							<h3>$tlang.getString("gen.addinst2")</h3>
						#else
							<h3>$tlang.getString("gen.addinst")</h3>
						#end	
							<div class="textPanel">$formattedText.escapeHtmlFormattedText($submission.FeedbackComment)</div>
					#end
					## for returned (not resubmitted ) submission, show the instructor feedback
					#if ($!prevFeedbackComment && $!prevFeedbackComment.trim().length() > 0)
							<h4  id="toggleGen" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />
								$tlang.getString("gradingsub.prefee2")
							</h4>
					<div class="toggledContent gencoms">					
						$cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackComment)</div>
					#end					
					#parse ("/vm/assignment/chef_assignments_student_view_feedback_attachments.vm")
					## show previous grading/feedback attachments if any
					#if ($!prevFeedbackAttachments && $prevFeedbackAttachments.size()>0)
						## show previous grading/feedback attachments if any
						<h4 id="toggleAttach" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />
							$tlang.getString("gradingsub.prefeedbackAttachments")
						</h4>
						<div class="attachcoms toggledContent">
						#set ($size = 0)
						#set ($props = false)
						#foreach ($attachment in $!prevFeedbackAttachments) 
							#set ($props = $attachment.Properties) 
							#if ($!props)
								#set ($size = $size + 1)
							#end
						#end
						#if ($size == 0)
							<p class="instruction">
								#if ($submissionType == 5)
									$tlang.getString("gen.noatt.single")
								#else
									$tlang.getString("gen.noatt")
								#end
							</p>
						#else
							<ul class="attachList indnt1">
								#foreach ($attachment in $!prevFeedbackAttachments) 
									#set ($props = false)
									#set ($props = $attachment.Properties) 
									#if ($!props)
										<li>
											#if ($props.getBooleanProperty($props.NamePropIsCollection))
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
											#else
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
											#end
											<a href="$attachment.Url" target="_blank">$formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
											#propertyDetails($props)
										</li>
									#end
								#end
							</ul>
						#end
						</div>
					#end
				#end
				#set ($previousGrades = $!submission.Properties.get($NamePropSubmissionScaledPreviousGrades))
				#if ($previousGrades && $previousGrades.length() > 0 )
					<h4 id="toggleGrade" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />
						$tlang.getString("gradingsub.pregra")
					</h4>
					<div class="gradecoms toggledContent">
						$!previousGrades
					</div>
				#end
				#if ($submissionType == 6)
					<form name="dummyForm" action="#toolForm("AssignmentAction")" method="post" onsubmit="return true;">
						#if ( $!value_ContentId > 0 && $!value_ContentLaunchURL)
							#if ($!deleted.equalsIgnoreCase("true") || !$!canSubmit)
								## Can't submit
							#else
								<a class="btn btn-primary" href="#toolLinkParam("$action" "doView_external_tool_launch" "assignmentId=$formattedText.escapeUrl($assignmentReference)")">$tlang.getString("external.tool.goto")</a>
								#if ($externalToolDeleted)
									<span>$tlang.getString("external.tool.deleted")</span>
								#end
							#end
						#end
						<input type="submit" accesskey="x" name="eventSubmit_doCancel_show_submission" value="$tlang.getString('gen.can')" onclick="SPNR.disableControlsAndSpin( this, null );" />
						<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
					</form>
				#else
				<div id="submitPanel"
					#if ($!deleted.equalsIgnoreCase("true") || !$!canSubmit)
					 class="act">
						<input type="button" name="cancel" accesskey="x" id="cancel" value="$tlang.getString("gen.don")" onclick="ASN_SVS.confirmDiscardOrSubmit( '$name_submission_text', $!new_attachments ); return false;" />
					#else
					 class="act">
								<input type="button" class="active" name="confirm" accesskey="s" id="confirm" value="$tlang.getString("gen.proceed")"
									onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'addSubmissionForm', 'confirm', null, null ); return false;" 
								#if ($submitted && ($submissionType == 2 || $submissionType == 5) && !$!new_attachments && !$!newSingleUploadedFile && (!$!newSingleAttachmentList || $!newSingleAttachmentList.isEmpty()))
									disabled="disabled"
								#end
							/>
					## for single file upload case and video submission, no need for preview or save draft
					#if ($submissionType != 5 && $submissionType != 7)
							<input class="disableme" type="button" name="preview" accesskey="v" id="preview" value="$tlang.getString("gen.pre")"
								onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'addSubmissionForm', 'preview', null, null ); return false;" />
							<input class="disableme" type="button" name="save" accesskey="d" id="save" value="$tlang.getString("gen.savdra")"
								onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'addSubmissionForm', 'save', null, null ); return false;" />
							#end
							#if (!$!linkInvoked)
								<input class="disableme" type="button" name="cancel" accesskey="x" id="cancel" value="$tlang.getString("gen.can")"
									onclick="ASN_SVS.confirmDiscardOrSubmit( '$name_submission_text', $!new_attachments ); return false;" />
							#end

							<div class="w-100">
								<div>
									#if ($submitted && $!isUserSubmission && ($submissionType == 2 || $submissionType == 5) && !$!new_attachments)
										<span class="sak-banner-info">$tlang.getString("stuviewsubm.modifytoresubmit")</span>
									#elseif ($submissionType == 5)
										<span class="sak-banner-warn">$tlang.getString("stuviewsubm.reminder")</span>
									#elseif ($submissionType == 7)
										<span class="sak-banner-warn">$tlang.getString("stuviewsubm.submitvideoreminder")</span>
									#else
										<span class="sak-banner-warn">$tlang.getString("stuviewsubm.submitreminder")</span>
									#end

									#if ($submission && $submission.Properties)
										#set($isAutoSubmitEnabled = "false")
										#set($isAutoSubmitEnabled = $submission.Properties.get("auto_submit_enabled"))
										#if ($isAutoSubmitEnabled.equalsIgnoreCase("true"))
											<span class="sak-banner-warn">$tlang.getString("auto.submit.warning.message")</span>
										#end
									#end
								</div>
							</div>
					#end
			</div>
			#end
			<div id="confirmationDialogue" class="act sak-banner-warn" style="display:none;">
				$tlang.getString("gen.can.discard")
				<input class="disableme" type="button" name="yes" accesskey="y" id="yes" value="$tlang.getString("gen.yes")" onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'addSubmissionForm', 'cancel', null, null );" />
				<input class="active" type="button" name="no" accesskey="n" id="no" value="$tlang.getString("gen.no")" onclick="ASN_SVS.undoCancel();" />
			</div>
		#else
				#if ($submission.GradeReleased && $!submission.FeedbackText && ($submission.FeedbackText.length()>0))
					#set ($text = $submission.FeedbackText)
					#if ($!text)
						<p class="instruction">
							$tlang.getString("gen.orisub2")
						</p>
						<div class="textPanel">$cheffeedbackhelper.escapeAssignmentFeedback($text)</div>
					#end
				#elseif ($!submission.submittedText && ($submission.SubmittedText.length()>0))
					#set ($text = $submission.SubmittedText)
					#if ($!text)
						<div class="textPanel">$cheffeedbackhelper.escapeAssignmentFeedback($text)</div>
					#end
				#end
				## for returned submission, show the instructor comment as well
				#if ($!prevFeedbackText)
					<h5>$tlang.getString("gradingsub.prefeetex")</h5>
					<div class="textPanel">
						$cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackText)
					</div>
				#end
				## submitted attachment
				#set ($submittedAttachments = $submission.SubmittedAttachments)
				#set ($size = 0)
				#set ($props = false)
				#foreach ($attachment in $submittedAttachments) 
					#set ($props = $attachment.Properties) 
					#if ($!props)
						#set ($size = $size + 1)
				 #end
				#end
				#if ($size == 0)
					#if ($submissionType == 5)
                                            $tlang.getString("gen.noatt.single")
                                        #else
                                            $tlang.getString("gen.noatt")
                                        #end
				#else
					<h5>
						#if ($submissionType == 5)
							$tlang.getString("gen.stuatt.single")
						#else
							$tlang.getString("gen.stuatt")
						#end
					</h5>
					<ul class="attachList indnt1">
						#foreach ($attachment in $submittedAttachments) 
							#set ($props = false)
							#set ($props = $attachment.Properties) 
							#if ($!props)
								<li>
									#if ($props.getBooleanProperty($props.NamePropIsCollection))
										<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
									#else
										<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
									#end
									<a href="$attachment.Url" target="_blank">$formattedText.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
									#propertyDetails($props)
								</li>
							#end
						#end
					</ul>
				#end	
				#if ($submission.getGraded() && $submission.getGradeReleased())
					#if ($submission.getGradeReleased() &&($!submission.FeedbackComment) && ($submission.FeedbackComment.trim().length()>0))
						<h5>$tlang.getString("gen.addinst")</h5>
						<div>$formattedText.escapeHtmlFormattedText($submission.FeedbackComment)</div>
					#end
					## for returned submission, show the instructor feedback
					#if ($!prevFeedbackComment && $!prevFeedbackComment.trim().length() > 0)
						<h5>$tlang.getString("gradingsub.prefee")</h5>
						<div class="textPanel">$cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackComment)</div>
					#end
					#parse ("/vm/assignment/chef_assignments_student_view_feedback_attachments.vm")
				#end
				#set ($previousGrades =  $!submission.Properties.get($NamePropSubmissionScaledPreviousGrades))
				#if ($!previousGrades.length() == 0 )
					#set ($previousGrades =  $!submission.Properties.get($NamePropSubmissionScaledPreviousGrades))
				#end
				#if ($!previousGrades && $!previousGrades.length() > 0 )
					<h4 id="toggleGrade" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />
						$tlang.getString("gradingsub.pregra")
					</h4>
					<div class="gradecoms  toggledContent">
						$!previousGrades.length()$!previousGrades
					</div>
				#end
		#if (!$!linkInvoked)
			<p class="act">
				<input type="button" name="cancel" accesskey="x" id="cancel" value="$tlang.getString("gen.don")" onclick="ASN_SVS.confirmDiscardOrSubmit( '$name_submission_text', $!new_attachments ); return false;" />
			</p>
		#end
		#end
		<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
	</form>
	#end
	</div>
</div>
<!-- end: chef_assignments_student_view_submission.vm  -->
