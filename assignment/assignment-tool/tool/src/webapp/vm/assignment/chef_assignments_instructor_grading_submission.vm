<!-- $Id$ -->
<!-- start: check_assignments_instructor_grading_submission.vm  -->
#set( $H = '-' )
<!-- jQuery already loaded in assignment_chef_header -->
#javascript("/library/js/lang-datepicker/lang-datepicker.js")

<script type="text/javascript">
	focus_path = [ '$fField' ];
	$(document).ready(function(){
		ASN.setupToggleAreas('toggleAnchor', 'toggledContent', false, 'fast');
		//click anywhere to close the peer assessment information box
		$(document).click(function(ev){
			var $pan = $('#peerReviewInfo')
			if ($pan.is(':visible') && ev.target.id !== 'peerReviewInfo' && ev.target.id !== 'infoImg' && ev.target.id !== 'grade') $pan.hide();
		});
		disableBackButton();
	});
</script>
<div class="portletBody">

## SAK-29314
#set( $assignmentContent = $assignment.getContent() )
#set( $gradeType = $assignmentContent.TypeOfGrade )

	#navBarOnClick( $allowAddAssignment $withGrade $allowGradeSubmission $allowAddAssignment $allowAllGroups $assignmentscheck $allowUpdateSite $enableViewOption $view "gradeForm" "" )
	## confirmation
	#if ($!gradingDone)
		<div class="success">
			$!tlang.getString("saved_grading")
		</div>
	#end
	#if ($alertMessage)<div class="alertMessage">$tlang.getString("gen.alert") $alertMessage</div><div style="display:block;clear:both"></div>#end
	
	## the form
	<form name="gradeForm" id="gradeForm" action="#toolForm("AssignmentAction")" method="post" onsubmit="return true;" autocomplete="off">
		<input type="hidden" name="eventSubmit_doAssignment_form" value="" />
		<input type="hidden" name="option" id="option" value="" />
		<input type="hidden" name="view" id="view" value="" />
		<input type="hidden" name="submissionId" id="submissionId" value="$submission.Reference" />
		
		<div class="navPanel">
			<div class="highlight gradingHeader">
				<h3>
					#assignmentTitleIcon($assignment)
					$validator.escapeHtml($!assignment.title)
					<span class="highlight"> - 
					#if ($withGrade)
						#if (!$!submission.getGraded())
							$tlang.getString("gen.grading")
						#else
							$tlang.getString("gen.regrading")
						#end 
					#else
						$tlang.getString("gen.reviewing")
					#end
					</span>
				</h3>

				<strong> $tlang.getString("grading.reminder")</strong>
				$tlang.getString("grading.reminder.body")

			</div>
			## SAK-29314
			<div class="navigator">
				<fieldset class="roundedBorder">
					<legend>$tlang.getString( "nav.header" )</legend>
					<div class="leftColumn">
						<input type="button" name="prevsubmission1" class="prevsubmission" value="$tlang.getString( "nav.prev" )"
							#if( !$!goPTButton ) disabled="disabled" #end 
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'prevsubmission', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />

						#if ($gradeType != 1)
						<input type="button" name="prevungraded1" class="prevUngraded" value="$tlang.getString( "nav.prev.ungraded" )"
							#if( !$!goPrevUngradedEnabled ) disabled="disabled" #end 
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'prevUngraded', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
						#end

						<div class="small text-muted">$tlang.getString( "nav.message" )</div>
					</div>
					<div class="centreColumn">
						<input type="button" name="cancelgradesubmission1" class="cancelgradesubmission" value="$tlang.getString( "nav.list" )"
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'cancelgradesubmission', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
						<div id="subsOnlyContainer">
							<input type="checkbox" id="chkSubsOnly1" name="chkSubsOnly1" #if( $subsOnlySelected ) checked="checked" #end
								onclick="ASN.toggleSubNavButtons( this );" />
							<label for="chkSubsOnly1">$tlang.getString( "nav.view.subsOnly" )</label>
						</div>
					</div>
					<div class="rightColumn">

						#if ($gradeType != 1)
						<input type="button" name="nextungraded1" class="nextUngraded" value="$tlang.getString( "nav.next.ungraded" )"
							#if( !$!goNextUngradedEnabled ) disabled="disabled" #end 
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'nextUngraded', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
						#end

						<input type="button" name="nextsubmission1" class="nextsubmission" value="$tlang.getString( "nav.next" )"
							#if( !$!goNTButton ) disabled="disabled" #end 
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'nextsubmission', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
						<div class="small text-muted">$tlang.getString( "nav.message" )</div>
					</div>
				</fieldset>
			</div>
		</div>
		## 1- text only; 2-attachment only; 3-text and attachment; 4-Non-electronic
		#set ( $submissionType = $assignment.Content.TypeOfSubmission)
		<table class="itemSummary" cellspacing="0" summary="$tlang.getString("gen.assdet")">
#*			<tr>
				<th>
						$tlang.getString("gen.title")
				</th>
				<td>
					$validator.escapeHtml($assignment.title)
				</td>
			</tr>
*#			
			#if ($assignment.isGroup())
                        <tr>
				<th>
                                        $tlang.getString("gen.group")
                                </th>
                                <td>
                                        #set($aGroup = $!site.getGroup($submission.getSubmitterId()))
                                        #if ($aGroup)
                                                $aGroup.getTitle()
                                        #else
                                                $tlang.getString('group.submission.not.found')
                                        #end
                                </td>
                        </tr>
                        #end
			<tr>
				<th>
					$tlang.getString("gen.student")
				</th>	
				<td>
					#set ($submitterNames = "")
					## replace it with submitter sort names
					#set ($count = 1)
					#foreach ($submitter in $submission.submitters)
						#set($submitterName = $submitter.getDisplayName())
						#set($submitterId = $submitter.getDisplayId())
						#if ($!submitterId)
							##attach the displayId
							#set($submitterName=$submitterName.concat(" (").concat($submitterId).concat(")"))
						#end
						#if ($!submitterName)
							#if ($count == 1)
								#set ($submitterNames = $!submitterName)
							#else
								#set ($submitterNames = $submitterNames.concat(", ").concat($!submitterName))
							#end
						#end
						#set ($count = $count + 1)
					#end
					
					## SAK-17606
					#if ($value_CheckAnonymousGrading.equals("true"))
						$validator.escapeHtml($submission.anonymousSubmissionId)
					#else
					$validator.escapeHtml($!submitterNames)
					#end
				</td>
			</tr>
			#if($!isAdditionalNotesEnabled && !$assignment.isGroup() && $!notes.size() > 0)
			<tr>
				<th>
					$tlang.getString("gen.notes")
				</th>
				<td headers="notes">
					<ul>
					#foreach($note in $notes)
						#if($!note) <li>$!note</li> #end
					#end
					</ul>
				</td>
			</tr>
			#end
			#if ($!submissionType != 4)
				## exclude non-electronic type of submission
				<tr>
					<th>
						$tlang.getString("gen.subm5")
					</th>	
					<td>
				 	## get submission time
						#set($timeSubmitted=false)
						#set($timeSubmitted=$submission.TimeSubmitted)
						#if ($!timeSubmitted)
							$!timeSubmitted.toStringLocalFull()
						#end
						#if ($!timeSubmitted && $timeSubmitted.after($assignment.DueTime))
							<span class="highlight">$tlang.getString("gen.late2")</span>
						#end
					</td>
				</tr>
			#end
			#if ($withGrade)
				<tr>
					<th>
						$tlang.getString("gen.status")
					</th>	
					<td>
					$submission.getStatus()
					</td>
				</tr>
			#end
				#if($allowReviewService && $assignmentContent.AllowReviewService)
					<tr>
						<th>
							$reviewServiceName&nbsp;$tlang.getString("review.report")
						</th>
							<td>
							#if (!$submission)
                                				$tlang.getString("review.notavail")
							#else
								#set($reviewResults=$submission.ContentReviewResults)
								#if ($reviewResults.size() >= 3)
									<div class="discTria">
										<input class="disclosureTriangle" type="image" onclick="ASN.handleReportsTriangleDisclosure(this,this.parentNode.parentNode.children[1]); return false;" src="#imageLink("sakai/expand.gif")" alt="$tlang.getString('review.report.expand')"/>
										## TODO: reconsider for i18n:
										$reviewResults.size() $tlang.getString("review.reports")
									</div>
									<div id="reportsDiv" style="display:none;">
								#end
								#foreach ($reviewResult in $reviewResults)
									<div>
										#set ($props = $reviewResult.getContentResource().Properties)
										<span class="reportIcon">										
											#if (!$reviewResult.getReviewReport().equals("Error"))<a href="$reviewResult.getReviewReport()" target="_blank">#end
											<span class="$reviewResult.getReviewIconCssClass()" title="#if($reviewResult.getReviewReport().equals("Error"))$reviewResult.getReviewError()#{else}$reviewResult.getReviewScore()#end"></span>
											#if (!$reviewResult.getReviewReport().equals("Error"))</a>#end
										</span>
										#if ($reviewResult.isInline())
											$tlang.getString("submission.inline")
										#else
											$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))
										#end
									</div>
								#end
								#if ($reviewResults.size() >= 3)
									</div>
								#end
							#end
							</td>
				
					</tr>
				#end			
                                #if ($!submission && $!submission.getSubmissionLog().size() > 0)
					<tr>
						<th>$tlang.getString('gen.history')</th>
						<td>
							#foreach ($entry in $submission.getSubmissionLog())
								$entry<br>
							#end
						</td>
					</tr>
				#end
		</table>
		## show or hide assignment instruction and attachment
			#if ($assignment_expand_flag)
				<p class="discTria">
					<a href="javascript:void(0)" onclick="ASN.submitForm( 'gradeForm', 'hide_instruction', null, null ); return false;">
					<img src="#imageLink("sakai/collapse.gif")" alt="$tlang.getString("gradingsub.opecliass")" border="0" width="13" height="13" align="top" /></a>
					$tlang.getString("gen.assinf")
				</p>	
			#else
				<p class="discTria">
					<a href="javascript:void(0)" onclick="ASN.submitForm( 'gradeForm', 'show_instruction', null, null ); return false;">
					<img src="#imageLink("sakai/expand.gif")" alt="$tlang.getString("gen.clocli")" border="0" width="13" height="13" align="top" /></a>
					$tlang.getString("gen.assinf")
				</p>	
			#end
			#if ($assignment_expand_flag)
					#if ($assignmentContent.getInstructions().length()>0)
+						<div class="textPanel">$validator.escapeHtmlFormattedText($assignmentContent.getInstructions())</div>
					#else
					#end
					## attachments of assignment
					<h4>$tlang.getString("gen.addres2")</h4>
					#set ($size = 0)
					#set ($attachments = $assignmentContent.Attachments)
					#set ($props = false)
					#foreach ($attachment in $attachments) 
						#set ($props = $attachment.Properties) 
						#if ($!props)
							#set ($size = $size + 1)
						#end
					#end
					#if ($size == 0)
						<p class="instruction">
                                                    #if ($submissionType == 5)
                                                        $tlang.getString("gen.noatt.single")
                                                    #else
                                                        $tlang.getString("gen.noatt")
                                                    #end
                                                </p>
					#else
						<ul class="attachList indnt1">
							#foreach ($attachment in $attachments) 
								#set ($props = false)
								#set ($props = $attachment.Properties) 
								#if ($!props)
									<li>
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
										#else
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
										#end
										<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
										#propertyDetails($props)
									</li>
								#end
							#end
						</ul>
					#end	
				#end	## show the assignment content
			## model answer
			#if($allowViewModelAnswer)
			<h4  id="toggleModel" class="toggleAnchor specialLink"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />$tlang.getString('modelAnswer')</h4>
			<div class="model toggledContent">
					<p>$validator.escapeHtml($!assignmentModelAnswerItem.getText())</p>
					#set ($mAttachments = $!assignmentModelAnswerItem.getAttachmentObjectSet())
						<ul class="attachList">
							#set ($size = 0)
							#set ($props = false)
							#foreach ($attachment in $!mAttachments) 
								#set ($props = $attachment.Properties) 
								#if ($!props)
									#set ($size = $size + 1)
								#end
							#end
							#if ($size == 0)
								<p class="instruction">
                                                                    #if ($submissionType == 5)
                                                                        $tlang.getString("gen.noatt.single")
                                                                    #else
                                                                        $tlang.getString("gen.noatt")
                                                                    #end
                                                                </p>
							#else
								#foreach ($attachment in $mAttachments)
									#set ($props = false)
									#set ($props = $attachment.Properties) 
									#if ($!props)
									<li>
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
										#else
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
										#end
										<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
										#propertyDetails($props)
									</li>
									#end
							#end
					#end
					</ul>
				</div>
			#end
			#if ($!allowReadAssignmentNoteItem)
				<h4  id="toggleNotes" class="toggleAnchor specialLink"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />$tlang.getString('note.label')</h4>
				<div class="notes toggledContent">
					$validator.escapeHtml($!assignmentNoteItem.getNote())
				</div>
			#end
			##all purpose
			#if ($!allowViewAllPurposeItem)
			<h4  id="toggleAllPurpose" class="toggleAnchor specialLink"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />$tlang.getString('allPurpose')</h4>
			<div class="allPurpose toggledContent">
					<p>$validator.escapeHtml($!assignmentAllPurposeItem.getTitle())</p>
					<p>$validator.escapeHtml($!assignmentAllPurposeItem.getText())</p>
					#set ($aAttachments = $!assignmentAllPurposeItem.getAttachmentObjectSet())
						<ul class="attachList">
							#set ($size = 0)
							#set ($props = false)
							#foreach ($attachment in $!aAttachments) 
								#set ($props = $attachment.Properties) 
								#if ($!props)
									#set ($size = $size + 1)
								#end
							#end
							#if ($size == 0)
								<p class="instruction">
                                                                    #if ($submissionType == 5)
                                                                        $tlang.getString("gen.noatt.single")
                                                                    #else
                                                                        $tlang.getString("gen.noatt")
                                                                    #end
                                                                </p>
							#else
								#foreach ($attachment in $aAttachments)
									#set ($props = false)
									#set ($props = $attachment.Properties) 
									#if ($!props)
									<li>
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
										#else
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
										#end
										<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
										#propertyDetails($props)
									</li>
									#end
							#end
					#end
					</ul>
				</div>
			#end
			<h3>$tlang.getString("gen.subm")</h3>
				#set($hasInline = $value_feedback.text.length() > 0)
				#set($size = 0)
				#if ($!submission.submitted || !$alertGradeDraft)
					#set ($props = false)
					#foreach ($attachment in $submission.SubmittedAttachments)
						#set ($props = $attachment.Properties)
						#if ($!props)
							#set ($size = $size + 1)
						#end
					#end
				#end
				#if ($submissionType == 4 && !$hasInline && $size == 0)
					## if this is non-electronic submission
					<p class="text-warning">$tlang.getString("nonelec_instruction2")</p>
				#else
					#if(($submission.submitted || !$alertGradeDraft) && $!value_feedback_text.length() >0 )
						<p class="text-info">$tlang.getString("gradingsub.belisthe")</p>
						<div class="textarea-holder">
						<textarea name="$name_feedback_text" id="$name_feedback_text" rows="30" wrap="virtual" cols="80">$validator.escapeHtmlFormattedTextarea($!value_feedback_text)</textarea>		
						#chef_setupformattedtextarea($name_feedback_text)
						</div>
					#elseif($submissionType!=2 && $submissionType!=4)
						## This message only shows when the submission type allows submitted text and the submission doesn't contain submitted text
						<p class="text-warning">$tlang.getString("gradingsub.nosubmittedtext")</p>
					#end
					## for returned submission, show the instructor comment as well
					#if ($!prevFeedbackText)
						<h4  id="toggleInline" class="toggleAnchor specialLink"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />$tlang.getString("gradingsub.prefeetex3")</h4>
						<div class="inlinecoms toggledContent">
							$cheffeedbackhelper.showPrevFeedback($cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackText))
						</div>
					#end
					## submitted attachment

					#set ($attachAllowed = $submissionType != 1 && $submissionType != 4)
					#if ($attachAllowed || $size != 0) ##do not show attach messages if no attach are allowed unless an attach is present anyway.
						<h3>
							#if ($submissionType == 5)
								$tlang.getString("gen.stuatt.single")
							#else
								$tlang.getString("gen.stuatt")
							#end
						</h3>
					#end
					#if ($size == 0 && $attachAllowed)
						## only display in submission types taht are supposed to have attachments
						<p class="text-warning">
							#if ($submissionType == 5)
								$tlang.getString("gen.noattsubmitted.single")
							#else
								$tlang.getString("gen.noattsubmitted")
							#end
						</p>
					#elseif ($size != 0)
						## There are attachments. We don't care which submission type it really is, they need to be displayed
						<ul class="attachList indnt1">
							#foreach ($attachment in $submission.VisibleSubmittedAttachments)
								#set ($props = false)
								#set ($props = $attachment.Properties)
								#if ($!props)
									<li>
										#if ($props.getBooleanProperty($props.NamePropIsCollection))
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
										#else
											<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
										#end
										<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>
										#propertyDetails($props)
									</li>
								#end
							#end
						</ul>
					#end
				#end

				#*					<!-- Grade types
						GRADE_TYPE_NOT_SET: -1; 
						UNGRADED_GRADE_TYPE: 1; 
						LETTER_GRADE_TYPE: 2; 
						SCORE_GRADE_TYPE = 3; 
						PASS_FAIL_GRADE_TYPE = 4;
						CHECK_GRADE_TYPE = 5;
					-->
*#
						#if ($withGrade)
							<div class="highlightPanel" style="width:80%">
							#if ($allowToGrade)
								#if ($gradeType == 1)
									<p class="shorttext">
										<label for="grade">$tlang.getString("gen.gra2")</label>
										<input type="hidden" name="$name_grade" value="gen.nograd" />
										<span class="highlight"> $tlang.getString("gen.nograd")</span>
									</p>	
								#elseif ($gradeType == 2)
									<p class="shorttext">
										<label for="grade">$tlang.getString("gen.gra2")</label>
										<select name="$name_grade" id="grade">
											<option  value="" #if($!value_grade.equals(""))selected="selected"#end>$tlang.getString("non.submission.grade.select")</option>
											#foreach ($i in $letterGradeOptions)
												<option  value="$i" #if ($!value_grade.equals($i))selected="selected"#end>$i</option>
											#end
										</select>
									</p>	
								#elseif ($gradeType == 3)
									<p class="shorttext">
										<label for="grade">$tlang.getString("gen.gra2")
										#if($assignment.getAllowPeerAssessment())
											&nbsp<img id="infoImg" title="$tlang.getString('peerassessment.peerGradeInfo')" src="/library/image/silk/information.png" onclick="$('#peerReviewInfo').show();"/>
										#end
										</label>
										<input type="text" name="$name_grade" size="5" maxlength="11" value="$!value_grade" id="grade" onkeypress="return ASN.handleEnterKeyPress(event);" /> <span class="text-info">($tlang.getString("grade.max") $assignmentContent.getMaxGradePointDisplay())</span>
										
										<!--for grading via an external scoring service, if enabled for the associated gradebook item -->
										#if($scoringComponentEnabled)
											#parse ("/vm/assignment/chef_assignments_scoring_agent.vm")	
								        #end
										
									</p>	
									<div id="peerReviewInfo" class="popupMessage" style="display:none">$tlang.getString("peerassessment.peerGradeInfo")</div>
								#elseif ($gradeType == 4)
									<p class="shorttext">
										<label for="grade">$tlang.getString("gen.gra2")</label>
										<select name="$name_grade" id="grade" >
											<option  value="" #if($!value_grade.equals(""))selected="selected"#end>$tlang.getString("non.submission.grade.select")</option>
											#foreach ($i in ["Pass", "Fail"])
													<option  value="$i" #if ($!value_grade.equalsIgnoreCase($i))selected="selected"#end>#if ($i=="Pass") $tlang.getString("pass") #elseif ($i=="Fail") $tlang.getString("fail") #end</option>
											#end
										</select>
									</p>	
								#elseif ($gradeType == 5)
									<p class="form-group">											
											<label for="gradeChecked">
											<input name="$name_grade" type="checkbox" value="Checked" #if ($!value_grade.equals("Checked"))checked="checked"#end id="gradeChecked"  /> 
											$tlang.getString("gen.gra2") $tlang.getString("gen.checked")
											</label>
									</p>	
								#end

                                                                #if ($assignment.isGroup())
                                                                    <div class="form-group" id="tempGradeOverride" >
                                                                        <input type="checkbox" id="allowGradeOverrideToggle" #if($value_grades && $value_grades.size()>0)checked="checked"#end name ="allowGradeOverrideToggle" onclick="if(checked){document.getElementById('gradeOverridePanel').style.display='block';ASN.resizeFrame();}else{document.getElementById('gradeOverridePanel').style.display = 'none';}" />
                                                                        <label for="allowGradeOverrideToggle">$tlang.getString("allowGradeOverride")</label>
                                                                    </div>
                                                                    <div id="gradeOverridePanel" style="#if(!$value_grades || $value_grades.size()<1)display:none;#end">
                                                                    ## replace it with submitter sort names
                                                                    #foreach ($submitter in $submission.submitters)
                                                                        #set($submitterName = $submitter.getDisplayName())
                                                                        #set($submitterId = $submitter.getDisplayId())
                                                                        #if ($!submitterId)
                                                                            ##attach the displayId
                                                                            #set($submitterName=$submitterName.concat(" (").concat($submitterId).concat(")"))
                                                                        #end
                                                                        #set ($group_name_grade = $name_grade.concat("_").concat($submitter.getId()))
                                                                        #set ($group_value_grade = "")
                                                                        #set ($group_value_grade = $value_grades.get($submitter.getId()))
                                                                        #if ($gradeType == 2)
                                                                            <div class="row-override">
                                                                            <label>$!submitterName</label>
                                                                            <div class="shorttext">
                                                                                <span$tlang.getString("gen.grade.override")</span> 
                                                                                <select name="$group_name_grade" id="grade">
											<option  value="" #if($!group_value_grade.equals(""))selected="selected"#end>$tlang.getString("non.submission.grade.select")</option>
											#foreach ($i in $letterGradeOptions)
												<option  value="$i" #if ($!group_value_grade.equals($i))selected="selected"#end>$i</option>
											#end
                                                                                </select>
                                                                            </div>
                                                                            </div>  
                                                                        #elseif ($gradeType == 3)
                                                                            <div class="row-override">
                                                                                <label>$!submitterName</label>
                                                                                <div class="shorttext">
                                                                                    <span>$tlang.getString("gen.grade.override")</span> <input type="text" name="$group_name_grade" size="5" maxlength="11" value="$!group_value_grade" id="grade" onkeypress="return ASN.handleEnterKeyPress(event);" /> <span>($tlang.getString("grade.max") $assignmentContent.getMaxGradePointDisplay())</span>
                                                                                </div>    
                                                                            </div>
                                                                        #elseif ($gradeType == 4)
                                                                            <div class="row-override">
                                                                                <label>$!submitterName</label>
                                                                                <div class="shorttext">
                                                                                    <span>$tlang.getString("gen.grade.override")</span> 
                                                                                    <select name="$group_name_grade" id="grade" >
                                                                                        <option  value="" #if($!group_value_grade.equals(""))selected="selected"#end>$tlang.getString("ungra")</option>
                                                                                        #foreach ($i in ["Pass", "Fail"])
                                                                                            <option  value="$i" #if ($!group_value_grade.equalsIgnoreCase($i))selected="selected"#end>#if ($i=="Pass") $tlang.getString("pass") #elseif ($i=="Fail") $tlang.getString("fail") #end</option>
                                                                                        #end
                                                                                    </select>
                                                                                </div>   
                                                                            </div>
                                                                        #elseif ($gradeType == 5)
                                                                            <div class="row-override">
                                                                                <label>$!submitterName</label>
                                                                                <div class="assignment-checkbox-inline">
                                                                                    <span>$tlang.getString("gen.grade.override")</span>                                                                                    
                                                                                    <label for="gradeChecked">
                                                                                    <input name="$group_name_grade" type="checkbox" value="Checked" #if ($!group_value_grade.equals("Checked"))checked="checked"#end id="gradeChecked"  /> 
                                                                                    $tlang.getString("gen.gra2") $tlang.getString("gen.checked")
                                                                                    </label>
                                                                                </div>   
                                                                            </div>
                                                                        #end
                                                                    #end
                                                                    </div>
                                                                #end
							#else
								## if not allowed to grade, show the current grade instead
								<input name="$name_grade" type="hidden" value="$!value_grade" />
								<div class="alertMessage">$!notAllowedToGradeWarning</div>
								<label for="grade">$tlang.getString("gen.gra2")</label>
								$!value_grade
							#end
							</div>	
							## the previous grades
								#set ($previousGrades =  $submission.Properties.getProperty($submission.Properties.getNamePropSubmissionScaledPreviousGrades()))
								#if ($!previousGrades && $!previousGrades.length() != 0 )
									<h4 id="toggleGrade" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />
										$tlang.getString("gradingsub.pregra")
									</h4>
									<div class="gradecoms  toggledContent">										
										$previousGrades
									</div>
								#end
					#end
						<h4>
							$tlang.getString("gen.instrcomment")
						</h4>
						<p class="help-block">
							#if ($submissionType==2)
								$tlang.getString("gradingsub.usethebel2")
							#else
								$tlang.getString("gradingsub.usethebel1")
							#end
						</p>
						<div class="textarea-holder">
						<textarea name="$name_feedback_comment" id="$name_feedback_comment" rows="30" wrap="virtual" cols="80">#if($!value_feedback_comment)$validator.escapeHtmlFormattedTextarea($!value_feedback_comment)#end</textarea>
						#chef_setupformattedtextarea($name_feedback_comment)
						</div>
						## for returned (not resubmitted ) submission, show the instructor feedback
						#if ($!prevFeedbackComment)
							<h4 id="toggleGen" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />
								$tlang.getString("gradingsub.prefee2")</h4>
							<div class="gencoms  toggledContent">
								$cheffeedbackhelper.showPrevFeedback($cheffeedbackhelper.escapeAssignmentFeedback($!prevFeedbackComment))</div>
						#end
						<h4>
							#if ($withGrade)
								$tlang.getString("gen.atttoret")
							#else
								$tlang.getString("gen.atttoret2")
							#end
						</h4>	
						#set ($size = 0)
						#set ($props = false)
						#foreach ($attachment in $value_feedback_attachment) 
							#set ($props = $attachment.Properties) 
							#if ($!props)
								#set ($size = $size + 1)
							#end
						#end
						#if ($size == 0)
							<p class="text-warning">
                                                            #if ($submissionType == 5)
                                                                $tlang.getString("gen.noatt.single")
                                                            #else
                                                                $tlang.getString("gen.noatt")
                                                            #end
                                                        </p>
						#else
							<ul class="attachList indnt1">
								#foreach ($attachment in $value_feedback_attachment) 
									#set ($props = false)
									#set ($props = $attachment.Properties) 
									#if ($!props)
										<li>
											#if ($props.getBooleanProperty($props.NamePropIsCollection))
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
											#else
												<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
											#end
											<a href="$attachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
											#propertyDetails($props)
										</li>
									#end
								#end
							</ul>
						#end		
						<p class="act">
							#if ($!props)
								<input type="button" name="attach" value="$tlang.getString('gen.adddroatt')" onclick="ASN.submitForm( 'gradeForm', 'attach', null, null ); return false;" accesskey="a"/>
							#else
								<input type="button" name="attach" value="$tlang.getString('gen.addatt')" onclick="ASN.submitForm( 'gradeForm', 'attach', null, null ); return false;" accesskey="a"/>
							#end
						</p>
						#if ($!prevFeedbackAttachments)
						## show previous grading/feedback attachments if any
						<h4 id="toggleAttach" class="toggleAnchor"><img alt="expand" class="expand" src="/library/image/sakai/expand.gif" /><img alt="collapse" class="collapse" src="/library/image/sakai/collapse.gif" />
							$tlang.getString("gradingsub.prefeedbackAttachments")
						</h4>
						<div class="attachcoms  toggledContent">
							#set ($size = $prevFeedbackAttachments.size())
							#if ($size == 0)
								<p class="instruction">
                                                                    #if ($submissionType == 5)
                                                                        $tlang.getString("gen.noatt.single")
                                                                    #else
                                                                        $tlang.getString("gen.noatt")
                                                                    #end
                                                                </p>
							#else
								<ul class="attachList indnt1">
									#foreach ($prevAttachment in $!prevFeedbackAttachments) 
										#set ($props = false)
										#set ($props = $prevAttachment.Properties) 
										#if ($!props)
											<li>
												#if ($props.getBooleanProperty($props.NamePropIsCollection))
													<img src = "#imageLink($contentTypeImageService.getContentTypeImage("folder"))" border="0" alt="$tlang.getString("gen.folatt")" />
												#else
													<img src = "#imageLink($contentTypeImageService.getContentTypeImage($props.getProperty($props.NamePropContentType)))" border="0" alt="$tlang.getString("gen.filatt")" />
												#end
												<a href="$prevAttachment.Url" target="_blank">$validator.escapeHtml($props.getPropertyFormatted($props.NamePropDisplayName))</a>						
												#propertyDetails($props)
											</li>
										#end
									#end
								</ul>
							#end
						</div>		
						#end
					#if ($nonElectronic)
						## hidden value for non-electronic submission
						<input type="hidden" name="$name_allowResubmitNumber" id="allowResubmitNumber" value="0" />
					#else
						##show it only for those assignments not of type non-electronic submission
						#if($!value_allowResubmitNumber && $submissionType != 4)
							#set($resubmitStyle="display:block")
						#else 
							#set($resubmitStyle="display:none")
						#end
						<div class="form-group" id="tempAllowRes" #if ($submissionType == 4) style = "display:none"#end>
							<input type="checkbox" id="allowResToggle" name ="allowResToggle" #if($!value_allowResubmitNumber && $submissionType != 4) checked="checked"#end onclick="if(checked){document.getElementById('allowResubmitContainer').style.display = 'block';ASN.resizeFrame();}else{document.getElementById('allowResubmitContainer').style.display = 'none';}" />
							<label for="allowResToggle">$tlang.getString("allowResubmit")</label>
	    				</div>
						<div id="allowResubmitContainer" style="$!resubmitStyle">
						  <span id="allowResubmitNumber">
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label for="allowResubmitNumberSelect">
								$tlang.getString("allow.resubmit.number")
							</label>&nbsp;
							<select name="$name_allowResubmitNumber" id="allowResubmitNumberSelect">
								#foreach ($i in [1..10])
									<option value="$i" #if($i==$!value_allowResubmitNumber)selected="selected"#end>
										$i
									</option>
								#end
								<option value="-1" #if($!value_allowResubmitNumber == -1)selected="selected"#end>$tlang.getString("allow.resubmit.number.unlimited")</option>
							</select>
						  </span>
						  <span>&nbsp;</span>
						  <span id="allowResubmitTime">
							<label for="allowResubmitDate">
								$tlang.getString("gen.acesubunt")
							</label>&nbsp;
							<input type="text" id="allowResubmitDate" name="allowResubmitDate" class="datepicker" value="">

							<script type="text/javascript">
								localDatePicker({
									input:'#allowResubmitDate', 
									useTime:1, 
									val:"$value_ResubmitYear$H$value_ResubmitMonth$H$value_ResubmitDay $value_ResubmitHour:$value_ResubmitMin",
									parseFormat: 'YYYY-MM-DD HH:mm',
									ashidden:{
										month:"allow_resubmit_closeMonth",
										day:"allow_resubmit_closeDay",
										year:"allow_resubmit_closeYear",
										hour:"allow_resubmit_closeHour",
										minute:"allow_resubmit_closeMin"
									}
								});
							</script>
						  </span>
						</div> <!-- End of the allowResubmitContainer -->
					#end
		<div class="navPanel">
			<div class="viewNav highlight" style="width:70%;line-height:1.4em;padding-top:.75em;">
				<span class="act">
					## SAK-29314
					<input type="button" accesskey="d" class="active"  name="save" value="$tlang.getString('gen.savdragra')" onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'savegrade', '$validator.escapeUrl( $submission.Reference )', null ); return false;" title="$tlang.getString("gen.savdratit")" />
					<input type="button" accesskey="s" name="return" value="$tlang.getString('gen.retustud')" onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'returngrade', '$validator.escapeUrl( $submission.Reference )', null ); return false;" title="$tlang.getString("gen.retustudtit")" />
					<input type="button" accesskey="v" name="preview" value="$tlang.getString('gen.pre')" onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'previewgrade', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
					<input type="button" accesskey="x" name="cancel" value="$tlang.getString('cancel_changes')" onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'cancelgrade', null, null ); return false;" />
					#if ($!prevSubmissionId)
						<input type="hidden" name="prevSubmissionId" id="prevSubmissionId" value = "$!prevSubmissionId" />
					#end
					#if ($!nextSubmissionId)
						<input type="hidden" name="nextSubmissionId" id="nextSubmissionId" value = "$!nextSubmissionId" />
					#end

					## SAK-29314
					#if( $!prevUngradedSubmissionID )
						<input type="hidden" name="prevUngradedSubmissionID" id="prevUngradedSubmissionID" value="$!prevUngradedSubmissionID" />
					#end
					#if( $!nextUngradedSubmissionID )
						<input type="hidden" name="nextUngradedSubmissionID" id="nextUngradedSubmissionID" value="$!nextUngradedSubmissionID" />
					#end
					#if( $!nextWithSubmissionID )
						<input type="hidden" name="nextWithSubmissionID" id="nextWithSubmissionID" value="$!nextWithSubmissionID" />
					#end
					#if( $!prevWithSubmissionID )
						<input type="hidden" name="prevWithSubmissionID" id="prevWithSubmissionID" value="$!prevWithSubmissionID" />
					#end
					#if( $!nextUngradedWithSubmissionID )
						<input type="hidden" name="nextUngradedWithSubmissionID" id="nextUngradedWithSubmissionID" value="$!nextUngradedWithSubmissionID" />
					#end
					#if( $!prevUngradedWithSubmissionID )
						<input type="hidden" name="prevUngradedWithSubmissionID" id="prevUngradedWithSubmissionID" value="$!prevUngradedWithSubmissionID" />
					#end
				</span>
			</div>

			## SAK-29314
			<div class="navigator">
				<fieldset class="roundedBorder">
					<legend>$tlang.getString( "nav.header" )</legend>
					<div class="leftColumn">
						<input type="button" name="prevsubmission2" class="prevsubmission" value="$tlang.getString( "nav.prev" )"
							#if( !$!goPTButton ) disabled="disabled" #end 
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'prevsubmission', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />

						#if ($gradeType != 1)
						<input type="button" name="prevungraded2" class="prevUngraded" value="$tlang.getString( "nav.prev.ungraded" )"
							#if( !$!goPrevUngradedEnabled ) disabled="disabled" #end 
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'prevUngraded', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
						#end

						<div class="small text-muted">$tlang.getString( "nav.message" )</div>
					</div>
					<div class="centreColumn">
						<input type="button" name="cancelgradesubmission2" class="cancelgradesubmission" value="$tlang.getString( "nav.list" )"
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'cancelgradesubmission', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
						<div id="subsOnlyContainer">
							<input type="checkbox" id="chkSubsOnly2" name="chkSubsOnly2" #if( $subsOnlySelected ) checked="checked" #end
								onclick="ASN.toggleSubNavButtons( this );" />
							<label for="chkSubsOnly2">$tlang.getString( "nav.view.subsOnly" )</label>
						</div>
					</div>
					<div class="rightColumn">

						#if ($gradeType != 1)
						<input type="button" name="nextungraded2" class="nextUngraded" value="$tlang.getString( "nav.next.ungraded" )"
							#if( !$!goNextUngradedEnabled ) disabled="disabled" #end 
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'nextUngraded', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
						#end

						<input type="button" name="nextsubmission2" class="nextsubmission" value="$tlang.getString( "nav.next" )"
							#if( !$!goNTButton ) disabled="disabled" #end 
							onclick="SPNR.disableControlsAndSpin( this, null ); ASN.submitForm( 'gradeForm', 'nextsubmission', '$validator.escapeUrl( $submission.Reference )', null ); return false;" />
						<div class="small text-muted">$tlang.getString( "nav.message" )</div>
					</div>
				</fieldset>
			</div>
		</div>
		<input type="hidden" name="sakai_csrf_token" value="$sakai_csrf_token" />
	</form>
</div>
<!-- end: check_assignments_instructor_grading_submission.vm  -->
