#macro( header $title $viewBean )
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
	lang="${rlb.jsp_lang}" 
	xml:lang="${rlb.jsp_xml_lang}" >
    <head>
      <title>${title}</title>
      ${request.getAttribute("sakai.html.head")}
      #if ( $viewBean ) 
	<link rel="alternate" title="Sakai Wiki RSS" 
 			href="${util.escapeHtml(${viewBean.rssAccessUrl})}" type="application/rss+xml" />
 			  #end
    #if ( ${requestScope.RemoveAutoSave} )
	  <script>
		autoSaveClear('${requestScope.CurrentPageName}');
	  </script>
	  #end
    </head>
    <body onload="setMainFrameHeightNoScroll('${request.getAttribute("sakai.tool.placement.id")}');setFocus(focus_path);parent.updCourier(doubleDeep,ignoreCourier); callAllLoaders(); "  >
  	#if (${requestScope.headerScriptSource}) 
  		<script  type="text/javascript" src="${requestScope.headerScriptSource}"> <!-- don't reduce this! --></script>
  	#end
<script type="text/javascript" >
var placementid = "Main${request.getAttribute("sakai.tool.placement.id").toString().replace('-','x')}";
</script>  
#end

#macro( footer ) 
    <div id="guillotineFixer">&nbsp;</div>
    #if ( $requestScope.FooterScript ) 
    <script type="text/javascript" >${requestScope.footerScript}</script>
    #end
    </body>
</html>
#end


#macro( commandlinks $useHomeLink $usePrinterLink $useViewLink $viewLinkName $useEditLink $useInfoLink $useHistoryLink $useWatchLink $withNotification $homeBean $viewBean $resourceLoaderBean )
<span class="rwiki_pageLinks">
#if ($usePrinterLink) 
<a href="${util.escapeHtml($viewBean.getRssAccessUrl())}"
	target="rssfeed" 
	id="rssLink"  
	title="${resourceLoaderBean.getString("jsp_rss_feed_changes")}" >&nbsp;</a> 
<a href="${util.escapeHtml($viewBean.getPrintViewUrl())}"
	target="_blank" 
	id="printerFriendlyLink"  
	title="${resourceLoaderBean.getString("jsp_printer_friendly")}" >&nbsp;</a> 
#end

#if ( !$viewLinkName )
#set( $viewLinkName = $resourceLoaderBean.getString("jsp_view"));
#end

#if ($useHomeLink)
<a href="${util.escapeHtml($homeBean.getHomeLinkUrl())}"
	id="homeLink"  
	title="${resourceLoaderBean.getString("jsp_wiki_home")}" >${util.escapeHtml($homeBean.getHomeLinkValue())}</a> 
#end
#if ($useViewLink)
<a href="${util.escapeHtml($viewBean.getViewUrl())}"
	id="viewLink"  
	title="${resourceLoaderBean.getString("jsp_view")}" >${util.escapeHtml($viewLinkName)}</a> 
#end
#if ($useEditLink)
#set( $permissionsCheckBean = ${requestScope.permissionsBean} )
#if (${permissionsCheckBean.updateAllowed} )
<a href="${util.escapeHtml($viewBean.getEditUrl())}"
	id="editLink"  
	title="${resourceLoaderBean.getString("jsp_edit")}" >${resourceLoaderBean.getString("jsp_edit")}</a> 
#else
<span
	id="editLink" class="pageLinkInactive" >${resourceLoaderBean.getString("jsp_edit")}</span> 
#end
#end	
#if ($useInfoLink) 
<a href="${util.escapeHtml($viewBean.getInfoUrl())}"
	id="infoLink"  
	title="${resourceLoaderBean.getString("jsp_info")}" >${resourceLoaderBean.getString("jsp_info")}</a> 
#end
#if ($useHistoryLink) 
<a href="${util.escapeHtml($viewBean.getHistoryUrl())}"
	id="historyLink"  
	title="${resourceLoaderBean.getString("jsp_history")}" >${resourceLoaderBean.getString("jsp_history")}</a> 
#end
#if ($useWatchLink)
	   #if ( $withNotification)
<a href="${util.escapeHtml($viewBean.getPreferencesUrl())}"
	id="watchLink"  
	title="${resourceLoaderBean.getString("jsp_watch_for_changes")}" >${resourceLoaderBean.getString("jsp_watch")}</a> 
	   #end
#end
</span>
#end


#macro( formatDisplayName $name )
${util.formatDisplayName($name)}
#end

#macro( formatDateTime $date )
${util.formatDateTime($date,$request)}
#end


#macro( infoPageGranted $granted $span )
#if ($span) 
   #if ($granted) 
	<span class="rwiki_info_page_granted" >${resourceLoaderBean.getString("jsp_yes")}</span>
   #else
	<span class="rwiki_info_page_denied" >${resourceLoaderBean.getString("jsp_no")}</span>
   #end
#else
   #if ($granted) 
	  ${resourceLoaderBean.getString("jsp_yes")}
   #else
	  ${resourceLoaderBean.getString("jsp_no")}
   #end
#end
#end

#macro( sidebar )
#set( $permissionsBeanRight = ${requestScope.PermissionsBean} )
#set( $permissionsBeanObject = ${permissionsBeanRight.RwikiObject} )
#set( $rlb = ${requestScope.ResourceLoaderBean} )
  #if (${rightRenderBean.hasContent})
  <div style="display: block;" id="rwiki_sidebar">
    <div class="rwiki_renderedContent">
      ${rightRenderBean.renderedPage}
    </div>
    #set( ${permissionsBeanRight.rwikiObject} = ${rightRenderBean.rwikiObject} )
  	#if (${permissionsBeanRight.updateAllowed})
      <span class="instruction" >
    	<a href="${util.escapeHtml(${rightRenderBean.editUrl})}" >
    		${rlb.jsp_edit}: ${util.escapeHtml($rightRenderBean.localisedPageName)}
    	</a>
      </span> 
    #end
    #set ( ${permissionsBeanRight.rwikiObject} = ${permissionsBeanObject} )
  </div>
  #end
#end


#macro( sidebar_switcher ) 
  #if (${rightRenderBean.hasContent}) 
     <div id="rwiki_sidebar_switcher">
        <a id="sidebar_switch_on" 
        	href="#" 
        	onclick="showSidebar('none')" >(+)</a>
        <a id="sidebar_switch_off" 
        	href="#" 
        	onclick="hideSidebar('none')" >(+)</a>
	 </div>
  #end
#end


#macro( breadcrumbs )
#set ($recentlyVisitedBean = ${requestScope.RecentlyVisitedBean})
#set ( $links = ${recentlyVisitedBean.breadcrumbLinks} )
<p class="breadcrumb" >
	#foreach ( $link in $links ) 	
		${link}
	#end
</p>
#end

#macro( publicbreadcrumbs )
#set ($recentlyVisitedBean = ${requestScope.RecentlyVisitedBean})
#set ( $links = ${recentlyVisitedBean.publicBreadcrumbLinks} )
<p class="breadcrumb" >
	#foreach ( $link in $links ) 	
		${link}
	#end
</p>
#end


#macro( comments )
 #if (${requestScope.Withcomments})
<div class="rwiki_comments" >
<a href="#" onclick="ajaxRefPopup(this,'${util.escapeHtml(${renderBean.newCommentURL})}',0); return false;" >Comment</a>
  #foreach( $comment in ${renderBean.comments} )
		 <div class="rwikicommentbody_${comment.commentLevel}">
		
	    <div class="rwikicommentheader">
	    
	        ${rlb.jsp_comment_by}: 
	        #formatDisplayName(${comment.rwikiObject.user})
	        ${rlb.jsp_on} ${comment.rwikiObject.version} 
        		<a href="#" onclick="ajaxRefPopup(this,'${util.escapeHtml(${comment.newCommentURL})}',0); return false;" >${rlb.jsp_comment}</a>
        		#if (${comment.canEdit})
        			<a href="#" onclick="ajaxRefPopup(this,'${util.escapeHtml(${comment.editCommentURL})}',0); return false;" >${rlb.jsp_edit}</a>
        		#end
     </div>
		   <div class="rwikicomenttext" >
				  ${comment.renderedPage}<br/>	    
	    </div>
	 </div>
  #end
</div> 
 #end
#end
#*
<!-- To Turn AJAX Comments on, uncomment this and change the commandComponents.xml to use EditSaveAction 
	    <script type="text/javascript" >
var commentsShowing = false;
var lastCommentControl = null;
function toggleComments(target) {
	if ( target == null ) 
		target = lastCommentControl;
	lastCommentControl = target;
	if ( commentsShowing ) {
		target.innerHTML = "<c:out value="${rlb.jsp_show_comments}" />";
	    popupClose(0);
	    commentsShowing = false;
	} else {
		popupClose(0);
		ajaxRefPopup(target,'<c:out value="${renderBean.listCommentsURL}" escapeXml="false" />',0);
		target.innerHTML = "<c:out value="${rlb.jsp_hide_comments}" />";
		commentsShowing = true;
	}
}
var presenceShowing = false;
var lastPresenceControl = null;
function togglePresence(target) {
	if ( target == null ) 
		target = lastPresenceControl;
	lastPresenceControl = target;
	if ( presenceShowing ) {
		target.innerHTML = "<c:out value="${rlb.jsp_show_who}" />";
	    popupClose(0);
	    presenceShowing = false;
	} else {
		popupClose(0);
		ajaxRefPopup(target,'<c:out value="${renderBean.listPresenceURL}" escapeXml="false" />',0);
		target.innerHTML = "<c:out value="${rlb.jsp_hide_who}" />";
		presenceShowing = true;
	}
}
</script>
<div id="rwiki_comments_sidebar" >
<a href="#" onclick="toggleComments(this); return false;" ><c:out value="${rlb.jsp_show_comments}" /></a>
<a href="#" onclick="togglePresence(this); return false;" ><c:out value="${rlb.jsp_show_who}" /></a>
</div>
-->
*#



#macro( helppopup $id $pop_head $pop_body )   		
    	<div id="${id}" style=" position: absolute; top: -1000px; left: -1000px; visibility: hidden; " 
    		class="rwiki_help_popup" >
    		<h3>${pop_head}</h3>
    		${pop_body}
    	</div>
#end
#macro( helppopup2 $id $pop_head $pop_body1 $pop_body2 )   		
    	<div id="${id}" style=" position: absolute; top: -1000px; left: -1000px; visibility: hidden; " 
    		class="rwiki_help_popup" >
    		<h3>${pop_head}</h3>
    		${pop_body1} <br />
    		${pop_body2}
    	</div>
#end
#macro( helppopup1 $id $pop_body )   		
    	<div id="${id}" style=" position: absolute; top: -1000px; left: -1000px; visibility: hidden; " 
    		class="rwiki_help_popup" >
    		<pre>${pop_body}</pre>
    	</div>
#end


#macro( granted $granted $span )
#if ($span) 
#if ($granted)
	<span class="rwiki_info_page_granted" >${rlb.jsp_yes}</span>
#else
	<span class="rwiki_info_page_denied" >${rlb.jsp_no}</span>
#end
#else
#if ($granted)
		${rlb.jsp_yes}
#else
		${rlb.jsp_no}
#end
#end
#end


#macro( edittoolbar ) 
<div class="editToolBarContainer" >
<a class="editToolBar" 
			href="#" 
			id="toolbarButtonSave" 
			onclick="var form = document.getElementById('editForm'); var saveButton = document.getElementById('saveButton'); form.save.value = saveButton.value; form.submit();" >
			<img src="/library/image/transparent.gif" 
								border="0"   
								title="${rlb.jsp_toolb_save}" 
								alt="${rlb.jsp_toolb_save}" /></a>
<a class="editToolBar" 
   href="#" 
   id="toolbarButtonBold" 
   onclick="addMarkup('content','bold','__','__'); return false;" >
   <img src="/library/image/transparent.gif" 
        border="0"   
        title="${rlb.jsp_toolb_bold}" 
        alt="${rlb.jsp_toolb_bold}" /></a>
<a class="editToolBar" 
   href="#" 
   id="toolbarButtonItalic" 
   onclick="addMarkup('content','italic','~~','~~'); return false;" >
   <img src="/library/image/transparent.gif" 
        border="0"  
        title="${rlb.jsp_toolb_italic}" 
        alt="${rlb.jsp_toolb_italic}" /></a>
<a class="editToolBar" 
   href="#" 
   id="toolbarButtonSuper" 
   onclick="addMarkup('content','super','^^','^^'); return false;"  >
   <img src="/library/image/transparent.gif" 
        border="0" 
        title="${rlb.jsp_toolb_superscript}" 
        alt="${rlb.jsp_toolb_superscript}" /></a>
<a class="editToolBar" 
   href="#" 
   id="toolbarButtonSub" 
   onclick="addMarkup('content','sub','%%','%%'); return false;"  >
   <img src="/library/image/transparent.gif" 
        border="0" 
        title="${rlb.jsp_toolb_subscript}" 
        alt="${rlb.jsp_toolb_subscript}" /></a>
<select name="toolbarButtonHeading" 
        id="toobarButtonHeading" 
        onChange="if ( this.value != 'none' ) { addMarkup('content','Heading 1','\n'+this.value+' ','\n'); this.value = 'none'; } return false;" >
	   <option value="none" >${rlb.jsp_toolb_headings}</option>
	   <option value="h1">${rlb.jsp_toolb_heading} 1</option>
	   <option value="h2">${rlb.jsp_toolb_heading} 2</option>
	   <option value="h3">${rlb.jsp_toolb_heading} 3</option>
	   <option value="h4">${rlb.jsp_toolb_heading} 4</option>
	   <option value="h5">${rlb.jsp_toolb_heading} 5</option>
	   <option value="h6">${rlb.jsp_toolb_heading} 6</option>
</select>
<a class="editToolBar" 
   href="#" 
   id="toolbarButtonTable" 
   onclick="addMarkup('content','${rlb.jsp_table_macro_markup}','{table}\n','\n{table}'); return false;" >
   <img src="/library/image/transparent.gif" 
        border="0" 
        title="${rlb.jsp_toolb_table}" 
        alt="${rlb.jsp_toolb_table}" /></a>
<a class="editToolBar" 
   href="#" 
   id="toolbarButtonLink" 
   onclick="addAttachment('content','editForm','editControl', 'link'); return false;"   >
   <img src="/library/image/transparent.gif" 
        border="0" 
        title="${rlb.jsp_toolb_link}" 
        alt="${rlb.jsp_toolb_link}" /></a>
<a class="editToolBar" 
   href="#" 
   id="toolbarButtonImage" 
   onclick="addAttachment('content','editForm', 'editControl', 'embed'); return false;"   >
   <img src="/library/image/transparent.gif" 
        border="0" 
        title="${rlb.jsp_toolb_image}" 
        alt="${rlb.jsp_toolb_image}" /></a> 
</div>
#end

#macro( previewtoolbar ) 
<div class="previewToolBarContainer" >
<a class="previewToolBar" 
			href="#" 
			id="toolbarButtonSave" 
			onclick="var form = document.getElementById('editForm'); var saveButton = document.getElementById('saveButton'); form.save.value = saveButton.value; form.submit();" >
			<img src="/library/image/transparent.gif" 
								border="0"   
								title="${rlb.jsp_toolb_save}" 
								alt="${rlb.jsp_toolb_save}" /></a>
	</div>
#end
